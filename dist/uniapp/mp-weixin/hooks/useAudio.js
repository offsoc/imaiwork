"use strict";const l=require("../common/vendor.js"),e=new Set;exports.useAudio=a=>{const u=l.shallowRef(null),n=l.ref(!1),v=l.ref(0),o=l.ref(0),r=()=>{var l;n.value=!0,null==(l=null==a?void 0:a.onPlay)||l.call(a)},t=()=>{var l;n.value=!1,null==(l=null==a?void 0:a.onStop)||l.call(a)},d=()=>{var l;n.value=!1,null==(l=null==a?void 0:a.onPause)||l.call(a)},i=l=>{var e;n.value=!1,null==(e=null==a?void 0:a.onError)||e.call(a,l)},s=()=>{var l,e,n;v.value=(null==(l=u.value)?void 0:l.duration)||0,0==v.value&&setTimeout((()=>{var l,e;v.value=(null==(l=u.value)?void 0:l.duration)||0,null==(e=null==a?void 0:a.onDuration)||e.call(a,v.value)}),100),null==(e=null==a?void 0:a.onCanplay)||e.call(a),null==(n=null==a?void 0:a.onDuration)||n.call(a,v.value)},c=l=>{var e,n;o.value=(null==(e=u.value)?void 0:e.currentTime)||0,null==(n=null==a?void 0:a.onTimeUpdate)||n.call(a,o.value)},p=()=>{u.value=l.index.createInnerAudioContext(),e.add(u.value),u.value.onCanplay(s),u.value.onPlay(r),u.value.onEnded(t),u.value.onError(i),u.value.onStop(t),u.value.onPause(d),u.value.onTimeUpdate(c)},y=()=>{u.value&&(u.value.destroy(),e.delete(u.value),u.value=null)},m=l=>{u.value||p(),u.value.src=l},f=()=>{var l;null==(l=u.value)||l.pause()},T=()=>{e.forEach((l=>{l.paused||l.stop()}))};return l.onBeforeUnmount((()=>{n.value&&f(),y()})),{pause:f,pauseAll:T,play:async l=>{T(),u.value||p(),l&&m(l),u.value.play()},destroy:y,setUrl:m,stop:()=>{var l;null==(l=u.value)||l.stop()},seek:l=>{var e,n;null==(e=u.value)||e.seek(l),o.value=l,null==(n=null==a?void 0:a.onTimeUpdate)||n.call(a,o.value)},duration:v,currentTime:o,isPlaying:n}};
