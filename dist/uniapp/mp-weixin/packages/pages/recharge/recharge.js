"use strict";const e=require("../../../common/vendor.js"),r=require("../../../common/assets.js"),t=require("../../../api/recharge.js"),i=require("../../../api/user.js"),s=require("../../../utils/pay/index.js"),n=require("../../../hooks/useLockFn.js"),o=require("../../../enums/appEnums.js"),a=require("../../../stores/user.js"),u=require("../../../utils/util.js"),c=require("../../../utils/client.js"),l=require("../../../stores/app.js"),p=require("../../../config/index.js");if(require("../../../utils/request/index.js"),require("../../../utils/request/http.js"),require("../../../enums/requestEnums.js"),require("../../../utils/request/cancel.js"),require("../../../utils/auth.js"),require("../../../enums/constantEnums.js"),require("../../../utils/cache.js"),require("../../../router/index.js"),require("../../../utils/pay/alipay.js"),require("../../../utils/pay/balance.js"),require("../../../utils/pay/pay.js"),require("../../../utils/pay/wechat.js"),require("../../../utils/pay/e_wechat.js"),require("../../../utils/pay/e_alipay.js"),require("../../../hooks/useShareMessage.js"),require("../../../stores/navigationBarTitle.js"),require("../../../api/app.js"),require("../../../api/chat.js"),require("../../../api/voice_chat.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-button")+e.resolveComponent("u-checkbox")+e.resolveComponent("empty")+e.resolveComponent("z-paging")+e.resolveComponent("popup-bottom"))()}Math||((()=>"../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-checkbox/u-checkbox.js")+(()=>"../../../components/empty/empty.js")+(()=>"../../../node-modules/z-paging/components/z-paging/z-paging.js")+(()=>"../../../components/popup-bottom/popup-bottom.js"))();const d=e.defineComponent({__name:"recharge",setup(d){const f=l.useAppStore(),g=a.useUserStore(),m=e.computed((()=>g.userTokens)),h=e.computed((()=>f.getCardCodeConfig)),_=e.computed((()=>{const{customer_service:e}=f.getWebsiteConfig;return{qrcode:null==e?void 0:e.wx_image}})),y=e.computed((()=>b.value.find((e=>e.id==q.value)))),v=e.ref(!0),j=e.ref(!0),b=e.ref([]),q=e.ref(-1),x="tokens",k=e.ref(-1),w=e.ref([]),F=async()=>{const{lists:e}=await t.getPaymentList({from:x});e&&e.length&&(w.value=e,k.value=w.value[0].id)},C=u.series((async()=>{try{return e.index.showLoading({title:"创建订单中"}),await t.createRechargeOrder({type:1,package_id:y.value.id})}catch(r){return e.index.showToast({icon:"none",title:r||"创建订单失败",duration:5e3}),Promise.reject(r)}finally{e.index.hideLoading()}}),(async r=>{try{return e.index.showLoading({title:"正在支付中"}),await t.prePay({order_id:r.order_id,from:x,pay_way:k.value})}catch(i){return e.index.showToast({title:i||"支付失败",icon:"none",duration:5e3}),Promise.reject(i)}finally{e.index.hideLoading()}}),(async r=>{try{return await s.pay.payment(r.pay_way,r.config)}catch(t){return e.index.showToast({title:t||"支付失败",icon:"none",duration:5e3}),Promise.reject(t)}})),{isLock:L,lockFn:S}=n.useLockFn((async()=>{try{const e=await C();z(e)}catch(r){e.index.showToast({title:r||"支付失败",icon:"none",duration:5e3})}finally{e.index.hideLoading()}})),z=r=>{switch(r){case o.PayStatusEnum.SUCCESS:e.index.$u.toast("购买成功"),g.getUser();case o.PayStatusEnum.FAIL:}},P=e.ref(!1),U=e.ref([]),E=e.shallowRef(),R=async(e,r)=>{var t;try{const{lists:s}=await i.accountLog({page_no:e,page_size:r,type:"tokens",is_order:1,action:1});null==(t=E.value)||t.complete(s)}catch(s){console.log(s)}};return(async()=>{const{lists:e}=await t.getRechargeList({type:1});F(),b.value=e,j.value=!1,e&&e.length&&(q.value=e[0].id)})(),(t,i)=>e.e({a:e.p({"border-bottom":!1,"is-fixed":!1,background:{background:"transparent"},"back-icon-color":"#ffffff","title-color":"#ffffff",title:"充值中心","title-bold":!0}),b:e.t(e.unref(m)),c:`url(${e.unref(p.config).baseUrl}static/images/recharge_img1.png)`,d:e.unref(c.isIOS)()},e.unref(c.isIOS)()?{e:r._imports_0,f:r._imports_0,g:`url(${e.unref(p.config).baseUrl}static/images/recharge_qrcode_bg.png)`,h:e.unref(_).qrcode,i:e.o((e=>P.value=!0)),j:e.p({type:"primary",shape:"circle","custom-style":{height:"90rpx",fontSize:"26rpx"}})}:e.e({k:r._imports_1,l:e.f(e.unref(b),((t,i,s)=>e.e({a:e.t(t.price),b:e.n(e.unref(q)==t.id?"text-_hFF9500_":"text-white"),c:e.n(e.unref(q)==t.id?"text-_hFF9500_":"text-_h808080_"),d:e.unref(q)==t.id},e.unref(q)==t.id?{e:r._imports_2}:{f:r._imports_0$1},{g:e.t(t.package_info.tokens),h:e.n(e.unref(q)==t.id?"text-_hFF9500_":"text-_h16F49F_"),i:e.n(e.unref(q)==t.id?"border-_h624E35_ bg-_hff95001a_":"bg-_h16f49f1a_ border-_h16f49f33_"),j:i,k:e.unref(q)==t.id?`url(${e.unref(p.config).baseUrl}static/images/recharge_tokens_item_active_bg.png)`:`url(${e.unref(p.config).baseUrl}static/images/recharge_tokens_item_bg.png)`,l:e.o((e=>{return r=t.id,void(q.value=r);var r}),i)}))),m:`url(${e.unref(p.config).baseUrl}static/images/recharge_box_bg.png)`,n:e.o((r=>e.isRef(v)?v.value=r:null)),o:e.p({shape:"circle",size:"28",modelValue:e.unref(v)}),p:1==e.unref(h).is_open},(e.unref(h).is_open,{}),{q:e.o(e.unref(S)),r:e.p({type:"primary",shape:"circle",loading:e.unref(L),"custom-style":{height:"100rpx",fontSize:"26rpx"}}),s:e.o((e=>P.value=!0))}),{t:e.f(e.unref(U),((r,t,i)=>({a:e.t(r.remark),b:e.t(r.sn),c:e.t(r.change_amount_desc),d:e.t(r.create_time),e:t}))),v:e.sr(E,"2d45d13e-5,2d45d13e-4",{k:"pagingRef"}),w:e.o(R),x:e.o((r=>e.isRef(U)?U.value=r:null)),y:e.p({fixed:!1,"default-page-size":20,"safe-area-inset-bottom":!0,"auto-show-back-to-top":!0,modelValue:e.unref(U)}),z:e.o((r=>e.isRef(P)?P.value=r:null)),A:e.p({title:"订阅记录","is-disabled-touch":!0,"custom-class":"bg-_hF9FAFB_",show:e.unref(P)})})}}),f=e._export_sfc(d,[["__scopeId","data-v-2d45d13e"]]);wx.createPage(f);
