"use strict";const e=require("../../../../common/vendor.js"),o=require("../../../../common/assets.js"),n=require("../../../../api/ladder_player.js"),i=require("../../../../hooks/useKeyboardHeight.js"),r=require("../../../../stores/app.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../config/index.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-input")+e.resolveComponent("u-icon")+e.resolveComponent("u-button")+e.resolveComponent("u-line")+e.resolveComponent("u-popup"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-line/u-line.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js")+t)();const t=()=>"../../../../components/knb-select/knb-select.js",a=e.defineComponent({__name:"scene_create",setup(t){const a=r.useAppStore(),{dynamicHeight:u}=i.useKeyboardHeight(),s=e.reactive({id:"",name:"",description:"",coach_name:"",coach_persona:"",coach_voice:"",practitioner_persona:"",coach_emotion:"",coach_intensity:"",index_id:""}),c=e.ref(null),l=e.computed((()=>{var e;const o=(null==(e=a.getLadderConfig)?void 0:e.emotions)||[];return o.length?(s.id||(s.coach_emotion=o[0].value),o):[]})),d=e.computed((()=>{var e;const o=(null==(e=a.getLadderConfig)?void 0:e.intensity)||[];return o.length?(s.id||(s.coach_intensity=o[0].value),o):[]})),p=e.computed((()=>{var e;const o=(null==(e=a.getLadderConfig)?void 0:e.voice)||[];return o.length?(s.id||(s.coach_voice=o[0].code),o):[]})),m=e.shallowRef(),h=e.ref({name:"",index_id:""}),f=e=>{h.value=e,s.index_id=e.index_id},v=e.ref(!1),_=async()=>{if(!s.name)return void e.index.$u.toast("请输入场景名称");if(!s.description)return void e.index.$u.toast("请输入场景简介");if(!s.coach_name)return void e.index.$u.toast("请输入陪练者名称");if(!s.coach_persona)return void e.index.$u.toast("请输入陪练画像描述");if(!s.practitioner_persona)return void e.index.$u.toast("请输入我的角色");e.index.showLoading({title:"创建中",mask:!0});const o=s.id?"编辑":"创建";try{const i=s.id?await n.lpSceneEdit(s):await n.lpSceneAdd(s);if(e.index.showToast({title:`${o}成功`,icon:"none",duration:2e3}),!s.id)return void e.index.$u.route({url:"/ai_modules/ladder_player/pages/chat/chat",params:{id:i.id},type:"redirect"});setTimeout((()=>{e.index.navigateBack()}),2e3)}catch(i){e.index.showToast({title:i||`${o}失败`,icon:"none",duration:2e3})}finally{e.index.hideLoading()}},x=()=>{e.index.showModal({title:"提示",content:"确定要删除场景吗？",success:async o=>{if(o.confirm){e.index.showLoading({title:"删除中",mask:!0});try{await n.lpSceneDelete({id:s.id}),e.index.showToast({title:"删除成功",icon:"none",duration:2e3}),setTimeout((()=>{e.index.navigateBack({delta:2})}),2e3)}catch(i){e.index.showToast({title:i||"删除失败",icon:"none",duration:2e3})}finally{e.index.hideLoading()}}}})},g=async e=>{for(const o in s)null!=e[o]&&null!=e[o]&&(s[o]=e[o])};return e.onLoad((e=>{e.id&&(s.id=e.id,(async()=>{var e,o;const i=await n.lpSceneDetail({id:s.id});c.value=i,h.value.index_id=null==(e=i.knowledge)?void 0:e.index_id,h.value.name=null==(o=i.knowledge)?void 0:o.name,g(i)})())})),(n,i)=>e.e({a:e.p({"is-fixed":!1,"border-bottom":!1,background:{background:"transparent"}}),b:o._imports_0$17,c:e.f(e.unref(p),((o,n,i)=>({a:o.logo,b:e.t(o.name),c:n,d:e.unref(s).coach_voice===o.code?1:"",e:e.o((n=>e.unref(s).coach_voice=o.code),n)}))),d:e.o((o=>e.unref(s).name=o)),e:e.p({placeholder:"点击此输入您想练习的场景；如：茶叶销售","placeholder-style":"color: #524B6B;",modelValue:e.unref(s).name}),f:e.o((o=>e.unref(h).name=o)),g:e.p({placeholder:"点击配置挂载知识库","placeholder-style":"color: #524B6B;",disabled:!0,modelValue:e.unref(h).name}),h:e.p({name:"arrow-right",color:"#524B6B",size:24}),i:e.o((o=>(async()=>{var o;await e.nextTick$1(),null==(o=m.value)||o.open(h.value)})())),j:e.o((o=>e.unref(s).description=o)),k:e.p({placeholder:"简单概括您的场景，如：售后服务人员，正在沟通处理客户提出的退款问题",type:"textarea","placeholder-style":"color: #524B6B;",height:"160",modelValue:e.unref(s).description}),l:e.o((o=>e.unref(s).coach_name=o)),m:e.p({placeholder:"点击此输入您设定的陪练者名称；如：王总","placeholder-style":"color: #524B6B;",modelValue:e.unref(s).coach_name}),n:e.f(e.unref(l),((o,n,i)=>({a:e.t(o.name),b:n,c:e.unref(s).coach_emotion==o.value?1:"",d:e.o((n=>e.unref(s).coach_emotion=o.value),n)}))),o:e.f(e.unref(d),((o,n,i)=>({a:e.t(o.name),b:n,c:e.unref(s).coach_intensity==o.value?1:"",d:e.o((n=>e.unref(s).coach_intensity=o.value),n)}))),p:e.o((o=>e.unref(s).coach_persona=o)),q:e.p({placeholder:"点击此输入您需要创建的陪练对象背景设定；如：对茶叶研究很丰富的上市公司老板，对圈子和品质要求较高，脾气不太好。",type:"textarea","placeholder-style":"color: #524B6B;",height:"160",modelValue:e.unref(s).coach_persona}),r:e.o((o=>e.unref(s).practitioner_persona=o)),s:e.p({placeholder:"点击此输入您当前扮演的角色；如：茶叶首席销售","placeholder-style":"color: #524B6B;",modelValue:e.unref(s).practitioner_persona}),t:e.unref(u)+"px",v:e.unref(s).id},e.unref(s).id?{}:{w:o._imports_1$10},{x:e.o(_),y:e.p({type:"primary",shape:"circle","custom-style":{width:"556rpx",height:"104rpx"}}),z:e.unref(c)&&0!=e.unref(c).user_id},e.unref(c)&&0!=e.unref(c).user_id?{A:e.p({name:"trash-fill",color:"#fff",size:48}),B:e.o((e=>v.value=!0))}:{},{C:e.p({name:"info-circle",color:"#FE975F",size:32}),D:e.o((e=>v.value=!1)),E:e.o(x),F:e.o((o=>e.isRef(v)?v.value=o:null)),G:e.p({mode:"bottom","border-radius":"40",height:"25%",modelValue:e.unref(v)}),H:e.sr(m,"6f2455f0-13",{k:"knbSelectRef"}),I:e.o(f)})}});wx.createPage(a);
