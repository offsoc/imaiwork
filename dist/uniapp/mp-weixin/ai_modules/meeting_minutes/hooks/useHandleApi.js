"use strict";const e=require("../../../common/vendor.js"),t=require("../../../api/meeting_minutes.js"),n=require("../enums/index.js"),i=require("../../../stores/user.js"),s=require("../../../enums/appEnums.js"),a=require("../../../stores/app.js"),o=require("../../../hooks/usePaging.js"),u=require("../../../utils/util.js");exports.useHandleApi=function(r){var l;const{onSuccess:d}=r||{},c=a.useAppStore(),m=i.useUserStore(),g=e.computed((()=>m.userInfo.tokens)),p=null==(l=m.getTokenByScene(s.TokensSceneEnum.MEETING))?void 0:l.score,v=e.computed((()=>{var e;return((null==(e=c.getMeetingConfig)?void 0:e.language)||[]).map((e=>({text:e.name,value:e.code})))})),x=e.computed((()=>{var e;return[{text:"不翻译",value:0},...((null==(e=c.getMeetingConfig)?void 0:e.translation)||[]).map((e=>({text:e.name,value:e.code})))]})),{pager:h,getLists:f}=o.usePaging({fetchFun:t.meetingMinutesLists,params:{page_size:10}}),T=e=>e?u.formatAudioTime(e/1e3):0,w=e.computed((()=>e=>{var t,n,i;const{response:s}=e||{};return null==(i=null==(n=null==(t=null==s?void 0:s.Result)?void 0:t.MeetingAssistance)?void 0:n.MeetingAssistance)?void 0:i.Keywords})),S=e.computed((()=>e=>{var t,n,i;const{response:s}=e||{};return null==(i=null==(n=null==(t=null==s?void 0:s.Result)?void 0:t.Summarization)?void 0:n.Summarization)?void 0:i.ParagraphSummary}));return{pager:h,userTokens:g,tokensValue:p,languageList:v,targetLanguageList:x,speakerOptions:[{value:0,text:"不区分"},{value:1,text:"单人"},{value:2,text:"多人"}],getTags:w,getDuration:e.computed((()=>e=>{var t,n,i,s;const{response:a}=e||{},o=null==(s=null==(i=null==(n=null==(t=null==a?void 0:a.Result)?void 0:t.Transcription)?void 0:n.Transcription)?void 0:i.AudioInfo)?void 0:s.Duration;return T(o)})),getResult:S,getLists:f,handleAgain:async n=>{await e.index.showModal({title:"确定要重新转写？",success:async i=>{if(i.confirm)try{e.index.showLoading({title:"重试中",mask:!0}),await t.meetingMinutesRetry({id:n}),null==d||d("retry"),e.index.showToast({title:"重试成功",icon:"none",duration:1e3})}catch(s){e.index.showToast({title:s||"重试失败",icon:"none",duration:1e3})}finally{e.index.hideLoading()}}})},handleDelete:async n=>new Promise(((i,s)=>{e.index.showModal({title:"确定删除此会议纪要吗？",success:async a=>{if(a.confirm)try{e.index.showLoading({title:"删除中",mask:!0}),await t.meetingMinutesDelete({id:n}),null==d||d("delete"),e.index.showToast({title:"删除成功",icon:"none",duration:1e3}),i(!0)}catch(o){e.index.showToast({title:o||"删除失败",icon:"none",duration:1e3}),s(o)}finally{e.index.hideLoading()}}})})),handleItem:t=>{const{status:i}=t;i==n.TurnStatus.SUCCESS?e.index.navigateTo({url:`/ai_modules/meeting_minutes/pages/detail/detail?id=${t.id}`}):i==n.TurnStatus.ERROR?e.index.$u.toast("文件转写失败，不可查看"):i==n.TurnStatus.ING&&e.index.$u.toast("文件转写中，不可查看")},formatDate:t=>{const n=new Date(t);return e.index.$u.timeFormat(n,"mm/dd hh:MM")},formatName:e=>-1!==e.lastIndexOf(".")?e.slice(0,e.lastIndexOf(".")):e,formatDuration:T}};
