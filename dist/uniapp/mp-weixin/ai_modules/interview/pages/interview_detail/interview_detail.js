"use strict";const e=require("../../../../common/vendor.js"),i=require("../../../../components/file-upload/choose-file.js"),n=require("../../../../api/app.js"),r=require("../../../../api/interview.js"),t=require("../../../../utils/util.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../config/index.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-icon"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js"))();const a=e.defineComponent({__name:"interview_detail",setup(a){const s=e.reactive({id:""}),u=e.ref(null),o=e.reactive({name:"",sex:"",age:"",mobile:"",school:"",degree:"",work_years:"",work_ex:"",word_url:"",project_ex:""}),d=e.ref(0),c=e.reactive({name:"",date:"",size:"",url:""}),l=e.computed((()=>!c.url));e.computed((()=>c.name.endsWith(".pdf")));const m=async()=>{if(l.value){const e=await i.chooseFile({type:"file"});f(e)}else q()},f=async i=>{const{tempFilePaths:n,tempFiles:r}=i,t=r[0];t.size>20971520?e.index.$u.toast("文件大小不能超过20M"):p(t)},p=async i=>{const a=i=>e.index.showLoading({title:i,mask:!0}),u=(i,n=5e3)=>e.index.showToast({title:i,icon:"none",duration:n});try{a("上传中");const{uri:l}=await n.uploadFile("file",{filePath:i.path});e.index.hideLoading(),a("解析中");const m=await r.getResumeRecognition({word:l,interview_job_id:s.id});e.index.hideLoading(),o.word_url=l,y(m),Object.assign(c,{name:i.name,date:e.index.$u.timeFormat(1e3*i.date,"yyyy/mm/dd hh:MM"),size:t.formatFileSize(i.size),url:l});if(Object.values(o).some((e=>!e)))return d.value=3,void u("当前简历信息不完整，请点击简历信息完善");await j()}catch(l){u(l||"解析失败")}finally{e.index.hideLoading()}},v=()=>{c.url="",c.name="",c.date="",c.size="",d.value=0,Object.keys(o).forEach((e=>{o[e]=""}))};function h(i,n="none",r=2e3){return e.index.showToast({title:i,icon:n,duration:r})}const j=async()=>{var i;i="保存中",e.index.showLoading({title:i,mask:!0});try{await r.saveResume({interview_job_id:s.id,...o}),d.value=1,h("保存成功")}catch(n){h(n||"保存失败")}finally{e.index.hideLoading()}},q=async()=>{e.index.$u.route({url:"/ai_modules/interview/pages/resume_form/resume_form",params:{id:s.id,data:JSON.stringify(o)}})},w=async()=>{e.index.$u.route({url:"/ai_modules/interview/pages/full_screen/full_screen",params:{id:s.id},type:"reLaunch"})},y=async e=>{for(const i in o)null!=e[i]&&null!=e[i]&&(o[i]=e[i])};return e.onLoad((e=>{s.id=e.id,(async()=>{const e=await r.getInterviewJobDetail({id:s.id});u.value=e})()})),e.onMounted((()=>{e.index.$on("update-resume",(async e=>{d.value=1,y(e.formData)}))})),(i,n)=>e.e({a:e.unref(u)},e.unref(u)?e.e({b:e.p({"border-bottom":!1,background:{background:"transparent"},title:"岗位选择","title-bold":!0}),c:e.unref(u).avatar,d:e.t(e.unref(u).name),e:e.t(e.unref(u).company),f:e.t(e.unref(u).desc),g:e.t(e.unref(u).jd),h:e.unref(l)},e.unref(l)?{i:e.t(e.unref(o).name||"点击此手动添加简历"),j:e.o(q)}:{},{k:e.unref(l)},e.unref(l)?{l:e.p({name:"/static/images/icons/upload.svg",size:32}),m:e.t(20)}:{n:e.t(e.unref(c).name),o:e.t(e.unref(c).size),p:e.t(e.unref(c).date),q:e.p({name:"trash",size:24}),r:e.o(v)},{s:e.o(m),t:3==e.unref(d)},(e.unref(d),{}),{v:0==e.unref(d)},(0==e.unref(d)||1==e.unref(d)||e.unref(d),{}),{w:1==e.unref(d),x:3==e.unref(d),y:1!=e.unref(d),z:e.o(w)}):{})}}),s=e._export_sfc(a,[["__scopeId","data-v-19eb0847"]]);wx.createPage(s);
