"use strict";const o=require("../../../common/vendor.js"),i=require("../../../components/file-upload/choose-file.js"),e=require("../../../api/app.js"),n=require("../enums/index.js"),t={size:300,minResolution:360,maxResolution:1080,videoMinDuration:5,videoMaxDuration:600},a={[n.DigitalHumanModelVersionEnum.STANDARD]:{size:100,minResolution:480,maxResolution:1080,videoMinDuration:15,videoMaxDuration:60},[n.DigitalHumanModelVersionEnum.SUPER]:{size:500,minResolution:640,maxResolution:2048,videoMinDuration:2,videoMaxDuration:120},[n.DigitalHumanModelVersionEnum.ADVANCED]:t,[n.DigitalHumanModelVersionEnum.ELITE]:t};exports.commonUploadLimit=t,exports.uploadLimit=a,exports.useUpload=n=>{const{size:t=100,resolution:a=[640,2048],duration:s=[15,60],extension:u=["mp4","mov"],onSuccess:r,onError:l,onProgress:d}=n,m=o.reactive({url:"",pic:"",seconds:0,duration:"00:00"}),c=async i=>{const{tempFilePaths:e,tempFiles:n}=i,u=n[0],l=u.size,d=u.width;l>1024*t*1024?o.index.showToast({title:`视频大小不能超过${t}M`,icon:"none",duration:4e3}):d<a[0]||d>a[1]?o.index.showToast({title:`上传视频分辨率不能满足${a[0]}*${a[1]}`,icon:"none",duration:4e3}):u.duration<s[0]||u.duration>s[1]?o.index.showToast({title:`上传视频时长不能小于${s[0]}秒或大于${s[1]}秒`,icon:"none",duration:4e3}):(await x(u.thumbTempFilePath),await p(u.tempFilePath),null==r||r(m))},p=async i=>{try{const{uri:o}=await e.uploadFile("video",{filePath:i},(o=>{null==d||d({type:"video",progress:o})}));m.url=o}catch(n){if(null==l||l(n),"uploadFile:fail abort"==n)return;o.index.$u.toast("上传失败")}},x=async o=>{const{uri:i}=await e.uploadImage(o,"","",(o=>{null==d||d({type:"image",progress:o})}));m.pic=i};return{upload:async()=>{try{const o=await i.chooseFile({count:1,type:"video",camera:"front",sourceType:["album"],extension:u});c(o)}catch(o){null==l||l(o)}},uploadResult:m}};
