"use strict";const e=require("../../../../common/vendor.js"),o=require("../../../../common/assets.js"),r=require("../../../../api/digital_human.js"),n=require("../../../../utils/cache.js"),i=require("../../../../stores/app.js"),a=require("../../../../stores/user.js"),s=require("../../enums/index.js"),u=require("../../config/copywriter.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../router/index.js"),require("../../../../config/index.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),!Array){(e.resolveComponent("u-tabs")+e.resolveComponent("u-icon")+e.resolveComponent("u-input")+e.resolveComponent("u-button")+e.resolveComponent("recharge-popup"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-tabs/u-tabs.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+t+l+c+m+d+p+_+v+(()=>"../../../../components/recharge-popup/recharge-popup.js"))();const t=()=>"../../components/video-preview/video-preview.js",l=()=>"../../components/choose-anchor/choose-anchor.js",c=()=>"../../components/choose-tone/choose-tone.js",m=()=>"../../components/choose-model/choose-model.js",d=()=>"../../components/model-rule/model-rule.js",p=()=>"../../components/content-input/content-input.js",v=()=>"../../components/agreement/agreement.js",_=()=>"../../components/create-panel/create-panel.js",h=e.defineComponent({__name:"video_create",setup(t){const l=i.useAppStore(),c=a.useUserStore(),m=e.reactive({name:"",pic:"",anchor_id:"",anchor_name:"",gender:"male",model_version:"",audio_type:s.CreateType.TEXT,voice_id:"",voice_type:0,voice_name:"",msg:"",video_url:""}),d=e.computed((()=>({[s.DigitalHumanModelVersionEnum.STANDARD]:150,[s.DigitalHumanModelVersionEnum.SUPER]:300,[s.DigitalHumanModelVersionEnum.ADVANCED]:1e3,[s.DigitalHumanModelVersionEnum.ELITE]:1e3}[m.model_version]))),p=e.computed((()=>{var e;return(null==(e=l.getDigitalHumanConfig)?void 0:e.channel)||[]})),v=e.computed((()=>!!m.model_version)),_=()=>{e.index.$u.toast("敬请期待~")},h=e.computed((()=>p.value.reduce(((e,o)=>(e[o.id]=o.name,e)),{}))),f=e.ref([]),g=e=>{const{name:o,model_version:r,anchor_id:n,url:i,pic:a}=e;if(m.model_version!=r&&(m.msg="",E.value=!1,1==m.voice_type)){const e={voice_id:"",voice_name:""};Object.assign(m,e)}m.anchor_id=n,m.anchor_name=o,m.model_version=r,m.video_url=i,m.pic=a},y=e.ref(!1),j=()=>{y.value=!0},x=e=>{g(e),f.value=[...f.value,e],y.value=!1},w=e.ref(!1),q=()=>{w.value=!0},b=o=>{w.value=!1,e.index.$u.route({url:`/ai_modules/digital_human/pages/video_upload/video_upload?model_version=${o}&type=${s.ModeType.ANCHOR}`})},R=e.ref(""),C=e.ref(!1),$=e.ref(!1),D=e=>{const{voice_id:o,name:r,type:n}=e;$.value=!1,m.voice_id!=o&&(m.voice_id=o,m.voice_name=r,m.voice_type=n)},T=e.ref(-1),E=e.ref(!1),k=e.ref(!1),A=e.shallowRef(),L=()=>{var e;null==(e=A.value)||e.open()},M=e.ref(!1),O="create_agreement",S=()=>{n.cache.set(O,"1"),P()},V=e.shallowRef(),H=e.ref(),I=()=>{var e;null==(e=H.value)||e.open()},P=async()=>{var o;if(n.cache.get(O)){M.value=!1;try{e.index.showLoading({title:"正在生成",mask:!0}),await r.createTask({name:e.index.$u.timeFormat(Date.now(),"yyyymmddhhMM").substring(2),msg:m.msg,pic:m.pic,video_url:m.video_url,anchor_id:m.anchor_id,anchor_name:m.anchor_name,voice_id:-1==m.voice_id?"":m.voice_id,voice_name:m.voice_name,voice_type:m.voice_type,audio_type:m.audio_type,model_version:m.model_version}),null==(o=V.value)||o.close(),c.getUser(),e.index.showToast({title:"创作成功，请在我的作品中查看",icon:"success",duration:3e3,success:()=>{U()}})}catch(i){e.index.showToast({title:i||"生成失败",icon:"error",duration:3e3})}finally{e.index.hideLoading()}}else M.value=!0},U=()=>{e.index.$u.route({url:"/ai_modules/digital_human/pages/index/index",type:"redirect"})};return e.onShow((()=>{e.index.$on("confirm",(o=>{const{type:r,data:n}=o;r===s.ListenerType.AI_COPYWRITER&&(m.msg=n.content,m.msg.length>d.value&&(m.msg=m.msg.slice(0,d.value))),s.ListenerType.UPLOAD_ANCHOR,e.index.$off("confirm")}))})),e.onLoad((e=>{const{type:o,data:r}=e;if(o===s.ListenerType.UPLOAD_VIDEO)try{const e=JSON.parse(decodeURIComponent(r)),{name:o,url:n,model_version:i,anchor_id:a,pic:s}=e;m.model_version||m.model_version==a||(m.voice_id="",m.voice_name="",m.msg="",E.value=!1),Object.assign(m,{anchor_name:o,video_url:n,model_version:i,anchor_id:a,pic:s}),f.value=[...f.value,e]}catch(n){}})),(r,n)=>e.e({a:e.o(_),b:e.p({list:[{name:"真人数字人"},{name:"图片数字人"}],"bg-color":"",bold:!0,height:"100","font-size":"30","active-color":"#000000","inactive-color":"#00000080","bar-style":{backgroundColor:"#0065FB",height:"4rpx"},"is-scroll":!1}),c:o._imports_0$6,d:e.o(j),e:o._imports_1$4,f:e.o((e=>q())),g:e.unref(f).length},e.unref(f).length?{h:e.f(e.unref(f),((r,n,i)=>e.e({a:e.unref(m).anchor_id==r.anchor_id},e.unref(m).anchor_id==r.anchor_id?{b:o._imports_0$7}:{},{c:e.o((e=>{return o=r.url,C.value=!0,void(R.value=o);var o}),n),d:e.t(e.unref(h)[r.model_version]),e:n,f:`url(${r.pic})`,g:e.o((e=>g(r)),n)}))),i:o._imports_1$3}:{j:o._imports_4$1,k:e.o((e=>q()))},{l:e.unref(v)?"":1,m:e.unref(v)},e.unref(v)?{n:e.t(e.unref(m).voice_name||"去定制你的第一个声音"),o:e.p({name:"arrow-right",color:"#0065FB"}),p:e.o((e=>{$.value=!0}))}:{},{q:e.unref(v)?"":1,r:e.unref(v)},e.unref(v)?e.e({s:!e.unref(E)},e.unref(E)?{v:o._imports_6}:{t:o._imports_5},{w:e.n(e.unref(E)?"bg-primary-light-9 text-primary":" text-_h333333_"),x:e.o((e=>(E.value=!0,T.value=(T.value+1)%u.createVideoCopywriter.length,void(m.msg=u.createVideoCopywriter[T.value])))),y:o._imports_7,z:`/ai_modules/digital_human/pages/ai_copywriter/ai_copywriter?limit=${e.unref(d)}`,A:e.o(L),B:e.o((o=>e.unref(m).msg=o)),C:e.p({type:"textarea",height:"364",placeholder:"请输入或粘贴您的文案 ...","placeholder-style":"color: #00000033; font-size: 26rpx;",disabled:!0,maxlength:e.unref(d),modelValue:e.unref(m).msg})}):{},{D:o._imports_8,E:e.o((e=>{k.value=!0})),F:e.o((o=>(async()=>{var o;m.model_version?m.voice_id?m.msg?null==(o=V.value)||o.confirm():e.index.$u.toast("请先输入视频文案"):e.index.$u.toast("请先选择音色"):q()})())),G:e.p({type:"primary",shape:"circle","custom-style":{height:"90rpx",fontSize:"26rpx",boxShadow:"0px 3px 12px 0px rgba(0, 0, 0, 0.12)"}}),H:e.o((e=>C.value=!1)),I:e.o((o=>e.isRef(C)?C.value=o:null)),J:e.p({title:"视频预览","video-url":e.unref(R),show:e.unref(C)}),K:e.o(x),L:e.o((o=>e.isRef(y)?y.value=o:null)),M:e.p({"active-ids":e.unref(f).map((e=>e.anchor_id)),show:e.unref(y)}),N:e.o(D),O:e.o((o=>e.isRef($)?$.value=o:null)),P:e.p({"model-version":e.unref(m).model_version,"active-tone":e.unref(m).voice_id,show:e.unref($)}),Q:e.o(b),R:e.o((o=>e.isRef(w)?w.value=o:null)),S:e.p({show:e.unref(w)}),T:e.o((o=>e.isRef(k)?k.value=o:null)),U:e.p({show:e.unref(k)}),V:e.sr(A,"9a529d99-9",{k:"contentInputRef"}),W:e.o((o=>e.unref(m).msg=o)),X:e.p({"text-limit":e.unref(d),"model-value":e.unref(m).msg}),Y:e.sr(V,"9a529d99-10",{k:"createPanelRef"}),Z:e.o(P),aa:e.o(I),ab:e.p({formData:e.unref(m)}),ac:e.o(S),ad:e.o((e=>M.value=!1)),ae:e.p({"show-agreement":e.unref(M)}),af:e.sr(H,"9a529d99-12",{k:"rechargePopupRef"})})}}),f=e._export_sfc(h,[["__scopeId","data-v-9a529d99"]]);wx.createPage(f);
