"use strict";const e=require("../../../../common/vendor.js"),o=require("../../../../common/assets.js"),i=require("../../../../config/index.js"),r=require("../../../../api/digital_human.js"),n=require("../../../../stores/app.js"),u=require("../../../../enums/appEnums.js"),a=require("../../enums/index.js"),s=require("../../../../stores/user.js"),t=require("../../hooks/useUpload.js"),l=require("../../../../utils/request/cancel.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../router/index.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../components/file-upload/choose-file.js"),!Array){(e.resolveComponent("u-button")+e.resolveComponent("recharge-popup"))()}Math||(m+(()=>"../../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+d+(()=>"../../../../components/recharge-popup/recharge-popup.js"))();const m=()=>"../../components/video-player/video-player.js",d=()=>"../../components/upload-loading/upload-loading.js",p=e.defineComponent({__name:"video_upload",setup(m){n.useAppStore();const d=s.useUserStore(),{userTokens:p}=e.toRefs(d),c=e.ref(),v=e.reactive({name:"",url:"",pic:"",anchor_id:"",model_version:""}),g=e.ref(!1),_=e.ref(),f=["mp4","mov"],A=e.ref(!1),E=e.ref(0),q=e.ref(),D=e.ref(!1),h=e.ref(""),j={resolution:`${t.commonUploadLimit.minResolution}P-${t.commonUploadLimit.maxResolution}P`,fileSize:t.commonUploadLimit.size},x={[a.DigitalHumanModelVersionEnum.STANDARD]:{resolution:`${t.uploadLimit[a.DigitalHumanModelVersionEnum.STANDARD].minResolution}P-${t.uploadLimit[a.DigitalHumanModelVersionEnum.STANDARD].maxResolution}P`,fileSize:t.uploadLimit[a.DigitalHumanModelVersionEnum.STANDARD].size},[a.DigitalHumanModelVersionEnum.SUPER]:{resolution:`${t.uploadLimit[a.DigitalHumanModelVersionEnum.SUPER].minResolution}P-${t.uploadLimit[a.DigitalHumanModelVersionEnum.SUPER].maxResolution}P`,fileSize:t.uploadLimit[a.DigitalHumanModelVersionEnum.SUPER].size},[a.DigitalHumanModelVersionEnum.ADVANCED]:j,[a.DigitalHumanModelVersionEnum.ELITE]:j},y=e.computed((()=>{var e,o;return[{name:"视频方向",value:"横向或纵向"},{name:"文件格式",value:f.join("、")},{name:"视频时长",value:"10秒-300秒"},{name:"分辨率",value:null==(e=x[v.model_version])?void 0:e.resolution},{name:"文件大小",value:`小于${null==(o=x[v.model_version])?void 0:o.fileSize}MB`}]})),M=e.computed((()=>t.uploadLimit[v.model_version])),R=async()=>{var o,i,n,s,l,m,j;if(c.value==a.ModeType.ANCHOR){const i={pro:{avatar:u.TokensSceneEnum.HUMAN_AVATAR_PRO},normal:{avatar:u.TokensSceneEnum.HUMAN_AVATAR},advanced:{avatar:u.TokensSceneEnum.HUMAN_AVATAR_ADVANCED},elite:{avatar:u.TokensSceneEnum.HUMAN_AVATAR_ELITE}},r=(()=>{switch(parseInt(v.model_version)){case a.DigitalHumanModelVersionEnum.SUPER:return i.pro;case a.DigitalHumanModelVersionEnum.ADVANCED:return i.advanced;case a.DigitalHumanModelVersionEnum.ELITE:return i.elite;default:return i.normal}})(),{score:n}=(j=r.avatar,d.getTokenByScene(j));if(p.value<n)return g.value=!0,await e.nextTick$1(),void(null==(o=_.value)||o.open())}e.index.setNavigationBarColor({frontColor:"#000000",backgroundColor:"#000000"});const{upload:x}=t.useUpload({size:null==(i=M.value)?void 0:i.size,resolution:[null==(n=M.value)?void 0:n.minResolution,null==(s=M.value)?void 0:s.maxResolution],duration:[null==(l=M.value)?void 0:l.videoMinDuration,null==(m=M.value)?void 0:m.videoMaxDuration],extension:f,async onSuccess(o){const{url:i,pic:n}=o;v.url=i,v.pic=n,v.name=e.index.$u.timeFormat(Date.now(),"yyyymmddhhMM").substring(2),h.value="形象克隆中...";try{const e=await r.createAnchor(v);v.anchor_id=e.id,D.value=!0,h.value=""}catch(u){A.value=!1,E.value=0,h.value="",e.index.$u.toast(u||"上传失败"),H()}},onProgress(e){q.value=e.type,E.value=e.progress,h.value="video"==q.value?"视频正在上传中...":"图片正在上传中...",A.value=!0},onError(e){A.value=!1,E.value=0,H()}});x()},S=()=>{l.requestCancel.remove("/upload/video"),l.requestCancel.remove("/upload/image"),A.value=!1,E.value=0,H()},T=async()=>{e.index.$u.route({url:"/ai_modules/digital_human/pages/video_create/video_create",type:"redirect",params:{type:a.ListenerType.UPLOAD_VIDEO,data:JSON.stringify(v)}})},V=()=>{e.index.$u.route({url:"/ai_modules/digital_human/pages/index/index",type:"redirect"})},H=()=>{e.index.setNavigationBarColor({frontColor:"#000000",backgroundColor:"#F9FAFB"})};return e.onLoad((e=>{c.value=e.type,e.model_version&&(v.model_version=parseInt(e.model_version))})),(r,n)=>e.e({a:o._imports_0$5,b:e.p({"play-icon-size":88,poster:`${e.unref(i.config).baseUrl}static/images/dh_example_bg2.png`,"video-url":`${e.unref(i.config).baseUrl}static/videos/dh_example2.mp4`}),c:o._imports_1$2,d:o._imports_2$1,e:e.f(e.unref(y),((o,i,r)=>({a:e.t(i+1),b:e.t(o.name),c:e.t(o.value),d:i}))),f:o._imports_3,g:o._imports_4,h:e.o((e=>R())),i:e.p({type:"primary",shape:"circle","custom-style":{height:"90rpx",boxShadow:" 0px 3px 12px 0px rgba(0, 0, 0, 0.12)",fontSize:"26rpx"}}),j:e.unref(A)},e.unref(A)?{k:e.o(S),l:e.o(V),m:e.o(T),n:e.p({progress:e.unref(E),"loading-text":e.unref(h),"is-success":e.unref(D),"progress-type":e.unref(q)})}:{},{o:e.unref(g)},e.unref(g)?{p:e.sr(_,"6f628058-3",{k:"rechargePopupRef"}),q:e.o((e=>g.value=!1))}:{})}});wx.createPage(p);
