import{g as X,E as Y}from"./index.fdfb054e.js";import{E as Z}from"./index.6c2ab172.js";import{d as x,z as ee,A as te,r as S,B as C,C as D,c as F,D as ae,E as se,F as oe,R as N,G as l,_ as re,k as y,l as $,q as M,s as P,H as ie,I as le,m as L,J as ne,K as de,t as ue,L as ce,M as me}from"./entry.46557796.js";/* empty css                  *//* empty css                    *//* empty css                  */const fe=x({components:{},props:{action:{type:String,default:""},type:{type:String,default:"image"},drag:{type:Boolean,default:!1},multiple:{type:Boolean,default:!0},limit:{type:Number,default:10},data:{type:Object,default:()=>({})},showProgress:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},listType:{type:String,default:"picture"},showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},maxSize:{type:Number,default:1/0},minSize:{type:Number,default:0},ratioSize:{type:Array,default:()=>[0,0]},videoMaxWidth:{type:Number,default:1/0},videoMinWidth:{type:Number,default:0},minDuration:{type:Number,default:0},maxDuration:{type:Number,default:1/0}},emits:["change","error","remove","success","on-progress"],setup(e,{emit:r,expose:R}){const B=ee(),n=te(),b=S(e.action||`${C()}${D()}/upload/${e.type}`),E=F(()=>({token:B.token,version:se()})),c=S(!1),i=S([]),d=async t=>{const{type:a,ratioSize:o,videoMaxWidth:v,videoMinWidth:m,minDuration:f,maxDuration:p,minSize:U,maxSize:I}=e,V=t.size/1024/1024,H=()=>V<U?(l.msgError(`上传文件大小不能小于 ${U} MB`),!1):V>I?(l.msgError(`上传文件大小不能大于 ${I} MB`),!1):!0,J=async()=>o[0]<=0||o[1]<=0?!0:new Promise(g=>{const s=new Image;s.onload=()=>{const u=s.height>=o[0]&&s.width>=o[1];u||l.msgError(`上传图片尺寸不能小于 ${o[0]}*${o[1]}`),g(u)},s.src=URL.createObjectURL(t)}),K=async()=>f<=0||p<=0?!0:new Promise(g=>{const s=new Audio(URL.createObjectURL(t));s.addEventListener("loadedmetadata",()=>{const u=s.duration,h=u>=f&&u<=p;h||l.msgError(`上传音频时长不能小于${f}秒或大于${p}秒`),g(h)})}),Q=async()=>v<=0||m<=0?!0:new Promise(g=>{const s=document.createElement("video");s.src=URL.createObjectURL(t),s.muted=!0,s.playsInline=!0,s.preload="auto",s.crossOrigin="anonymous",s.addEventListener("loadedmetadata",()=>{const{videoWidth:u,duration:h}=s,k=Math.floor(h),z=u>=m&&u<=v,A=k>=f&&k<=p;z||l.msgError(`上传视频分辨率不能满足${m}*${v}`),A||l.msgError(`上传视频时长不能小于${f}秒或大于${p}秒`),g(z&&A)})});if(!H())return!1;switch(a){case"image":return await J();case"audio":return await K();case"video":return await Q();default:return!0}},w=(t,a,o)=>{c.value=!0,i.value=oe(o),r("on-progress",t.percent)},j=(t,a,o)=>{o.every(m=>m.status=="success")&&(c.value=!1),r("change",a),t.code==N.SUCCESS&&(l.msgSuccess(t.msg||"上传成功"),r("success",t)),t.code==N.FAIL&&(i.value.splice(i.value.findIndex(m=>m.raw.uid==a.raw.uid),1),l.msgError(t.msg||"上传失败"))},O=(t,a)=>{var o;l.msgError(`${a.name}文件上传失败`),(o=n.value)==null||o.abort(a),c.value=!1,r("change",a),r("error",a)},W=t=>{if(e.limit===1){n.value.clearFiles();const a=t[0];a.uid=X(),n.value.handleStart(a),n.value.submit()}else l.msgError(`文件数量上限为${e.limit}个，请重新上传`)},_=t=>{i.value=i.value.filter(a=>a.uid!==t.uid),r("remove",t)},q=()=>{var t;(t=n.value)==null||t.clearFiles(),c.value=!1},T=()=>{var t;(t=n.value)==null||t.clearFiles(),i.value=[]},G=F(()=>{if(e.accept)return e.accept;switch(e.type){case"image":return".jpg,.png,.gif,.jpeg";case"video":return".wmv,.avi,.mpg,.mpeg,.3gp,.mov,.mp4,.flv,.rmvb,.mkv";case"audio":return".mp3,.wav";default:return"*"}});return ae(()=>e.type,t=>{b.value=`${C()}${D()}/upload/${t}`}),R({setFileList:t=>{i.value=t}}),{uploadRefs:n,action:b,headers:E,visible:c,fileList:i,getAccept:G,clearFile:T,beforeUpload:d,handleProgress:w,handleSuccess:j,handleError:O,handleExceed:W,handleRemove:_,handleClose:q}}}),pe={class:"upload"},ge={class:"file-list p-4"},ve={class:"flex-1"};function he(e,r,R,B,n,b){const E=Y,c=Z,i=me;return y(),$("div",pe,[M(E,{"file-list":e.fileList,"onUpdate:fileList":r[0]||(r[0]=d=>e.fileList=d),class:"w-[inherit] upload-wrap",ref:"uploadRefs",drag:e.drag,action:e.action,multiple:e.multiple,limit:e.limit,disabled:e.disabled,"show-file-list":e.showFileList,"list-type":e.listType,headers:e.headers,data:e.data,"before-upload":e.beforeUpload,"on-progress":e.handleProgress,"on-success":e.handleSuccess,"on-exceed":e.handleExceed,"on-error":e.handleError,"on-remove":e.handleRemove,accept:e.getAccept},{default:P(()=>[ie(e.$slots,"default",{},void 0,!0)]),_:3},8,["file-list","drag","action","multiple","limit","disabled","show-file-list","list-type","headers","data","before-upload","on-progress","on-success","on-exceed","on-error","on-remove","accept"]),e.showProgress&&e.fileList.length?(y(),le(i,{key:0,modelValue:e.visible,"onUpdate:modelValue":r[1]||(r[1]=d=>e.visible=d),title:"上传进度","append-to-body":"","close-on-click-modal":!1,"close-on-press-escape":!1,"show-close":!1,width:"500px",modal:!1,onClose:e.handleClose},{default:P(()=>[L("div",ge,[(y(!0),$(ne,null,de(e.fileList,(d,w)=>(y(),$("div",{key:w,class:"mb-5"},[L("div",null,ue(d.name),1),L("div",ve,[M(c,{percentage:parseInt(d.percentage)},null,8,["percentage"])])]))),128))])]),_:1},8,["modelValue","onClose"])):ce("",!0)])}const Le=re(fe,[["render",he],["__scopeId","data-v-9e81586c"]]);export{Le as _};
