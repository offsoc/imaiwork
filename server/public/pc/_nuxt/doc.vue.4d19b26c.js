import{d as O,A as P,x as W,r as b,bb as Y,k as d,l as p,aI as I,Z as c,q as o,s as v,m as t,v as S,t as k,J as $,K as q,Y as B,bM as Z,L as H,bG as Q,G as X,u as ee,y as te,ba as ae,au as se,ax as oe,cW as le}from"./entry.2beb4577.js";import{E as ne}from"./index.e8be04c0.js";import{_ as ce}from"./index.vue.478e85a5.js";import{E as re}from"./index.47b30189.js";/* empty css                  *//* empty css                    *//* empty css                     */import{isSameFile as ie}from"./hook.050168d8.js";import{r as N,a as de,b as pe}from"./file-reader.7514380a.js";import{s as ue}from"./text-splitter.ed74dd16.js";import me from"./data-item.730808cc.js";const _e={class:"h-full flex flex-col px-3 pb-3"},fe={class:"flex-shrink-0"},ve={class:"text-[#00000080] flex items-center gap-2 justify-center"},xe={class:"text-[#00000080] mt-2"},he={key:0,class:"grow min-h-0 mt-3 flex gap-x-2"},be={class:"w-1/4 h-full flex flex-col bg-[#F6F6F6] rounded-xl border border-[#efefef]"},ge={class:"flex-shrink-1 min-h-0 mb-3"},we={class:"p-3 flex flex-col gap-y-2"},ke=["onClick"],ye={class:"ml-2 line-clamp-1 flex-1"},Ee=["onClick"],Fe={class:"flex-shrink-0 border-t border-[#EFEFEF] pt-3 mx-3"},Ce={class:"flex items-center gap-x-2"},Ve={class:"cursor-pointer"},De={class:"mt-4 flex items-center gap-x-2"},Le={class:"flex-1 flex flex-col bg-[#F6F6F6] rounded-xl border border-[#efefef]"},Ie={class:"px-3 mt-3"},Se={class:"grow min-h-0"},$e={class:"px-3"},Je=O({__name:"doc",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(T){const y=P(),l=W(T,"modelValue"),E=[".txt",".docx",".pdf",".md"],g=E.join(", "),u=b([]),x=b(!1),i=b(0),h=b(512),U=async({raw:e})=>{var a,s;try{if(e){x.value=!0;const n="."+((a=e.name.split(".").pop())==null?void 0:a.toLowerCase());if(!E.includes(n))throw`不支持的文件类型，请上传 ${g} 格式的文件`;const{uri:w}=await Q({file:e});await ie(e,u.value);const _=await A(e);if(!_)throw"解析结果为空，已自动忽略";l.value.push({name:e.name,size:e.size,path:w,data:[]}),e.data=_,x.value=!1,u.value.push(e),C(u.value.length-1),F()}}catch(n){X.msgError(n)}finally{x.value=!1,(s=y.value)==null||s.clearFiles()}},F=()=>{l.value.forEach(e=>{e.data.length=0;const a=u.value.findIndex(n=>n.name==e.name);ue({text:u.value[a].data,chunkLen:h.value}).forEach(n=>{e.data.push({q:n,a:""})})})},A=async e=>{const a=e.name.substring(e.name.lastIndexOf(".")+1);let s="";switch(a){case"md":case"txt":s=await N(e);break;case"pdf":s=await pe(e);break;case"doc":case"docx":s=await de(e);break;default:s=await N(e);break}return s},R=async e=>{ee().$confirm({message:"确定要删除该段落吗？",onConfirm:()=>{l.value.splice(e,1),u.value.splice(e,1)}})},j=async e=>{l.value[i.value].data.splice(e,1)},C=e=>{i.value=e};return(e,a)=>{var V;const s=te,n=ne,w=ce,_=re,z=ae,M=se,G=oe,J=le,K=Y("number-input");return d(),p("div",_e,[I((d(),p("div",fe,[o(n,{ref_key:"uploadRef",ref:y,drag:"","show-progress":"",multiple:"","auto-upload":!1,"show-file-list":!1,accept:c(g),limit:50,"on-change":U},{default:v(()=>[t("div",ve,[o(s,{name:"local-icon-upload"}),a[1]||(a[1]=S(" 拖拽文件至此，或点击",-1)),a[2]||(a[2]=t("span",{class:"text-primary"}," 选择文件 ",-1))]),t("div",xe,"支持 "+k(c(g))+" 文件",1)]),_:1},8,["accept"])])),[[J,c(x)]]),l.value.length>0?(d(),p("div",he,[t("div",be,[t("div",ge,[o(_,null,{default:v(()=>[t("div",we,[(d(!0),p($,null,q(l.value,(m,r)=>(d(),p("div",{key:r,class:B(["flex items-center p-2 rounded-lg mt-1 cursor-pointer",[c(i)==r?"bg-[#0065fb0d] shadow-[0_0_0_1px_var(--color-primary)]":"bg-[#f6f6f6] shadow-[0_0_0_1px_#EFEFEF]"]]),onClick:f=>C(r)},[t("div",{class:B(["w-5 h-5 rounded bg-[#0000000d] flex items-center justify-center",{"bg-primary text-white":c(i)==r}])},[o(s,{name:"local-icon-upload2"})],2),t("div",ye,k(m.name),1),t("div",{onClick:f=>R(r)},[o(w)],8,Ee)],10,ke))),128))])]),_:1})]),t("div",Fe,[t("div",Ce,[a[3]||(a[3]=t("div",null,"分段长度",-1)),o(z,{"popper-class":"w-[400px]",content:"按结束符号进行分段。我们建议您的文档应合理的使用标点符号，以确保每个完整的句子长度不要超过该值中文文档建议400~1000英文文档建议600~1200",placement:"top"},{default:v(()=>[t("span",Ve,[o(s,{name:"local-icon-privacy",color:"#00000080"})])]),_:1})]),t("div",De,[I(o(M,{modelValue:c(h),"onUpdate:modelValue":a[0]||(a[0]=m=>Z(h)?h.value=m:null),type:"number",class:"w-[100px]"},null,8,["modelValue"]),[[K,{min:0,decimal:0}]]),o(G,{type:"primary",class:"!rounded-full !h-[38px]",onClick:F},{default:v(()=>[...a[4]||(a[4]=[S("重新预览",-1)])]),_:1})])])]),t("div",Le,[t("div",Ie,"分段预览（"+k((V=l.value[c(i)])==null?void 0:V.data.length)+"组）",1),t("div",Se,[o(_,null,{default:v(()=>{var m;return[t("div",$e,[(d(!0),p($,null,q((m=l.value[c(i)])==null?void 0:m.data,(r,f)=>{var D;return d(),p("div",{key:f,class:"rounded-xl p-[10px] mt-2 break-all bg-white"},[o(me,{data:r.q,"onUpdate:data":L=>r.q=L,index:f,name:(D=l.value[c(i)])==null?void 0:D.name,onDelete:L=>j(f)},null,8,["data","onUpdate:data","index","name","onDelete"])])}),128))])]}),_:1})])])])):H("",!0)])}}});export{Je as _};
