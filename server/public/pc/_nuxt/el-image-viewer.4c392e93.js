import{Q as Ie,S as G,U as ye,aU as J,d as se,cd as Q,ce as Ce,cf as xe,V as Ne,W as ze,cg as Ee,r as I,ch as Le,A as Oe,c as b,D as ee,aH as Te,o as Re,bd as z,k as w,I as ae,s as d,q as l,be as $e,m as v,Y as c,Z as a,a3 as te,ci as Se,a0 as Ve,L as h,a1 as k,a6 as Ye,l as E,J as D,cj as Ae,ck as Me,H as P,v as De,t as Pe,cl as Xe,a7 as Be,aq as Fe,cm as He,cn as We,K as qe,co as Ke,aa as Ze,aW as y,cp as je,am as Ue}from"./entry.46557796.js";import{t as X}from"./throttle.f2fe0ca7.js";const Ge=Ie({urlList:{type:G(Array),default:()=>ye([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:G(String)}}),Je={close:()=>!0,switch:C=>J(C),rotate:C=>J(C)},Qe=se({name:"ElImageViewer"}),ea=se({...Qe,props:Ge,emits:Je,setup(C,{expose:ne,emit:L}){var B;const r=C,x={CONTAIN:{name:"contain",icon:Q(Ce)},ORIGINAL:{name:"original",icon:Q(xe)}};let $,F="";const{t:oe}=Ne(),s=ze("image-viewer"),{nextZIndex:le}=Ee(),S=I(),H=I([]),W=Le(),_=I(!0),u=I(r.initialIndex),O=Oe(x.CONTAIN),n=I({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),re=I((B=r.zIndex)!=null?B:le()),ie=b(()=>{const{urlList:e}=r;return e.length<=1}),q=b(()=>u.value===0),K=b(()=>u.value===r.urlList.length-1),ce=b(()=>r.urlList[u.value]),ue=b(()=>[s.e("btn"),s.e("prev"),s.is("disabled",!r.infinite&&q.value)]),de=b(()=>[s.e("btn"),s.e("next"),s.is("disabled",!r.infinite&&K.value)]),fe=b(()=>{const{scale:e,deg:o,offsetX:t,offsetY:i,enableTransition:f}=n.value;let m=t/e,g=i/e;const N=o*Math.PI/180,j=Math.cos(N),U=Math.sin(N);m=m*j+g*U,g=g*j-t/e*U;const M={transform:`scale(${e}) rotate(${o}deg) translate(${m}px, ${g}px)`,transition:f?"transform .3s":""};return O.value.name===x.CONTAIN.name&&(M.maxWidth=M.maxHeight="100%"),M}),me=b(()=>`${u.value+1} / ${r.urlList.length}`);function T(){pe(),$==null||$(),document.body.style.overflow=F,L("close")}function ve(){const e=X(t=>{switch(t.code){case y.esc:r.closeOnPressEscape&&T();break;case y.space:V();break;case y.left:Y();break;case y.up:p("zoomIn");break;case y.right:A();break;case y.down:p("zoomOut");break}}),o=X(t=>{const i=t.deltaY||t.deltaX;p(i<0?"zoomIn":"zoomOut",{zoomRate:r.zoomRate,enableTransition:!1})});W.run(()=>{z(document,"keydown",e),z(document,"wheel",o)})}function pe(){W.stop()}function ge(){_.value=!1}function be(e){_.value=!1,e.target.alt=oe("el.image.error")}function ke(e){if(_.value||e.button!==0||!S.value)return;n.value.enableTransition=!1;const{offsetX:o,offsetY:t}=n.value,i=e.pageX,f=e.pageY,m=X(N=>{n.value={...n.value,offsetX:o+N.pageX-i,offsetY:t+N.pageY-f}}),g=z(document,"mousemove",m);z(document,"mouseup",()=>{g()}),e.preventDefault()}function Z(){n.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function V(){if(_.value)return;const e=je(x),o=Object.values(x),t=O.value.name,f=(o.findIndex(m=>m.name===t)+1)%e.length;O.value=x[e[f]],Z()}function R(e){const o=r.urlList.length;u.value=(e+o)%o}function Y(){q.value&&!r.infinite||R(u.value-1)}function A(){K.value&&!r.infinite||R(u.value+1)}function p(e,o={}){if(_.value)return;const{minScale:t,maxScale:i}=r,{zoomRate:f,rotateDeg:m,enableTransition:g}={zoomRate:r.zoomRate,rotateDeg:90,enableTransition:!0,...o};switch(e){case"zoomOut":n.value.scale>t&&(n.value.scale=Number.parseFloat((n.value.scale/f).toFixed(3)));break;case"zoomIn":n.value.scale<i&&(n.value.scale=Number.parseFloat((n.value.scale*f).toFixed(3)));break;case"clockwise":n.value.deg+=m,L("rotate",n.value.deg);break;case"anticlockwise":n.value.deg-=m,L("rotate",n.value.deg);break}n.value.enableTransition=g}function we(e){var o;((o=e.detail)==null?void 0:o.focusReason)==="pointer"&&e.preventDefault()}function he(){r.closeOnPressEscape&&T()}function _e(e){if(e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}return ee(ce,()=>{Te(()=>{const e=H.value[0];e!=null&&e.complete||(_.value=!0)})}),ee(u,e=>{Z(),L("switch",e)}),Re(()=>{ve(),$=z("wheel",_e,{passive:!1}),F=document.body.style.overflow,document.body.style.overflow="hidden"}),ne({setActiveItem:R}),(e,o)=>(w(),ae(a(Ke),{to:"body",disabled:!e.teleported},{default:d(()=>[l($e,{name:"viewer-fade",appear:""},{default:d(()=>[v("div",{ref_key:"wrapper",ref:S,tabindex:-1,class:c(a(s).e("wrapper")),style:te({zIndex:re.value})},[l(a(Se),{loop:"",trapped:"","focus-trap-el":S.value,"focus-start-el":"container",onFocusoutPrevented:we,onReleaseRequested:he},{default:d(()=>[v("div",{class:c(a(s).e("mask")),onClick:Ve(t=>e.hideOnClickModal&&T(),["self"])},null,10,["onClick"]),h(" CLOSE "),v("span",{class:c([a(s).e("btn"),a(s).e("close")]),onClick:T},[l(a(k),null,{default:d(()=>[l(a(Ye))]),_:1})],2),h(" ARROW "),a(ie)?h("v-if",!0):(w(),E(D,{key:0},[v("span",{class:c(a(ue)),onClick:Y},[l(a(k),null,{default:d(()=>[l(a(Ae))]),_:1})],2),v("span",{class:c(a(de)),onClick:A},[l(a(k),null,{default:d(()=>[l(a(Me))]),_:1})],2)],64)),e.$slots.progress||e.showProgress?(w(),E("div",{key:1,class:c([a(s).e("btn"),a(s).e("progress")])},[P(e.$slots,"progress",{activeIndex:u.value,total:e.urlList.length},()=>[De(Pe(a(me)),1)])],2)):h("v-if",!0),h(" ACTIONS "),v("div",{class:c([a(s).e("btn"),a(s).e("actions")])},[v("div",{class:c(a(s).e("actions__inner"))},[P(e.$slots,"toolbar",{actions:p,prev:Y,next:A,reset:V,activeIndex:u.value,setActiveItem:R},()=>[l(a(k),{onClick:t=>p("zoomOut")},{default:d(()=>[l(a(Xe))]),_:1},8,["onClick"]),l(a(k),{onClick:t=>p("zoomIn")},{default:d(()=>[l(a(Be))]),_:1},8,["onClick"]),v("i",{class:c(a(s).e("actions__divider"))},null,2),l(a(k),{onClick:V},{default:d(()=>[(w(),ae(Fe(a(O).icon)))]),_:1}),v("i",{class:c(a(s).e("actions__divider"))},null,2),l(a(k),{onClick:t=>p("anticlockwise")},{default:d(()=>[l(a(He))]),_:1},8,["onClick"]),l(a(k),{onClick:t=>p("clockwise")},{default:d(()=>[l(a(We))]),_:1},8,["onClick"])])],2)],2),h(" CANVAS "),v("div",{class:c(a(s).e("canvas"))},[(w(!0),E(D,null,qe(e.urlList,(t,i)=>(w(),E(D,{key:i},[i===u.value?(w(),E("img",{key:0,ref_for:!0,ref:f=>H.value[i]=f,src:t,style:te(a(fe)),class:c(a(s).e("img")),crossorigin:e.crossorigin,onLoad:ge,onError:be,onMousedown:ke},null,46,["src","crossorigin"])):h("v-if",!0)],64))),128))],2),P(e.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var aa=Ze(ea,[["__file","image-viewer.vue"]]);const na=Ue(aa);export{na as E};
