import{d as se,a as le,z as oe,aG as ae,A as ne,aF as D,c as S,r as I,cx as re,k as i,l as c,q as p,s as v,m as e,Y as U,Z as l,v as x,t as u,L as M,J as h,K as C,dW as ie,I as ce,cV as ue,G as _,bG as de,ax as pe,y as fe,ba as me}from"./entry.2beb4577.js";import{E as ve}from"./index.47b30189.js";import{E as _e,a as ge}from"./index.4d719c96.js";/* empty css                     *//* empty css                  *//* empty css               */import{u as xe,m as he}from"./useHandleApi.9e42988e.js";const ke=""+new URL("upload.7ee49dea.png",import.meta.url).href,ye=""+new URL("audio.c5cfc0a3.svg",import.meta.url).href,be={class:"edit-popup"},we={class:"flex gap-4"},Ee={class:"w-full overflow-hidden text-[#737373] text-xs px-[30px] mt-4"},Ce={class:"break-words"},Fe={key:1,class:"flex flex-col h-full"},Le={class:"flex justify-between items-center px-4 mt-4"},Re={class:"text-[#737373] text-xs"},Se={key:0},Ue={class:"grow min-h-0"},ze={class:"flex flex-col gap-4 p-4"},Ve={class:"flex-1 flex items-center gap-3"},$e={class:"flex-1 w-0"},Ae={class:"line-clamp-1"},je={class:"flex gap-2"},Be={class:"text-xs text-[#9492ad]"},De={class:"text-xs text-[#9492ad]"},Ie={class:"flex-shrink-0"},Me=["onClick"],Oe={key:1},Te={class:"grow flex flex-col"},Ne={class:"grow min-h-0 flex flex-col gap-6"},Pe={class:"flex flex-wrap gap-4 mt-6"},Ge=["onClick"],We={class:"mt-6"},qe={class:"flex flex-wrap gap-4 mt-6"},He=["onClick"],Je={class:"flex justify-between gap-x-4"},Ke={class:"flex-1"},Ye={class:"flex items-center gap-1"},Ze=["accept"],k=10,z=500,O=3,nt=se({__name:"add-audio",emits:["success","close"],setup(Qe,{expose:T,emit:N}){le();const V=oe(),{userTokens:P}=ae(V),$=N,F=ne(),f=D({language:"cn",speaker:0,translation:0}),{tokensValue:y,speakerOptions:G,languageList:W,targetLanguageList:q}=xe(),L=S(()=>{let s=a.value.reduce((t,n)=>t+n.duration,0);return s=s/60,y.value.score*Math.ceil(s)}),A=S(()=>".mp3,.wav,.wma,.aac,.ogg,.amr,.flac,.aiff"),a=I([]),b=I(null),H=S(()=>a.value.length>0&&a.value.every(s=>s.status===1)),j=()=>{var s;(s=b.value)==null||s.click()},J=async s=>{const t=event.target,n=Array.from(t.files||[]),g=z*1024*1024;n.some(d=>d.size>g)&&_.msgError(`单个文件最大${z}M,已过滤超出限制的文件`);const w=n.filter(d=>d.size<g);if(w.length>k-a.value.length){_.msgError(`上传文件超出限制,最多可上传${k}个音频文件`);return}const R=d=>new Promise((m,o)=>{const r=new Audio;r.src=URL.createObjectURL(d),r.onloadedmetadata=()=>{m(r.duration),URL.revokeObjectURL(r.src)},r.onerror=E=>{o(E)}});for(const d of w)try{const m=new FileReader,o=await R(d);if(o>O*60*60){_.msgError(`单个文件最长${O}小时，已过滤超出限制的文件`);continue}const r=D({url:"",loading:!0,file:d,status:2,duration:Math.floor(o)});m.onload=()=>{r.url=m.result},m.readAsDataURL(d),a.value.push(r)}catch{_.msgError(`无法上传“${d.name}”`)}await K(),b.value&&(b.value.value=null)},K=async()=>{const s=a.value.map((t,n)=>Y(t,n));await Promise.allSettled(s),a.value=a.value.filter(t=>t.status===1)},Y=async(s,t)=>{if(s.status==2)try{s.loading=!0;const n=await de({file:s.file});s.audio_id=n.audio_id,s.loading=!1,s.status=1,s.url=n.uri,a.value[t]=s}catch{_.msgError(`无法上传“${s.file.name}”`),s.loading=!1,a.value=a.value.splice(t,1)}},Z=s=>{a.value.splice(s,1)},Q=async()=>{var s;if(a.value.length==0){_.msgError("请上传音频文件");return}if(P.value<=y.value.score*a.value.length){_.msgPowerInsufficient();return}try{let t=[];a.value.forEach(n=>{t.push({...f,url:n.url,name:n.file.name,translation:f.translation==0?"":f.translation})}),await he(t),V.getUser(),(s=F.value)==null||s.close(),$("success")}catch(t){_.msgError(t||"创建失败")}},{lockFn:X,isLock:ee}=re(Q),te=()=>{var s;(s=F.value)==null||s.open()},B=()=>{$("close")};return T({open:te}),(s,t)=>{const n=pe,g=fe,w=ve,R=_e,d=ge,m=me;return i(),c("div",be,[p(ue,{ref_key:"popupRef",ref:F,title:"上传本地会议音频文件",async:!0,width:"848px","confirm-button-text":"","cancel-button-text":"",onClose:B},{default:v(()=>[e("div",we,[e("div",{class:U(["w-[388px] flex-shrink-0 rounded-2xl bg-primary-light-9 h-[400px] border border-dashed border-token-primary-2 cursor-pointer",{"hover:border-primary":l(a).length===0}])},[l(a).length==0?(i(),c("div",{key:0,class:"flex flex-col items-center justify-center w-full h-full",onClick:j},[t[1]||(t[1]=e("img",{class:"w-[130px] object-cover",src:ke},null,-1)),t[2]||(t[2]=e("div",{class:"font-bold text-lg mt-"},[e("span",{class:"text-primary"},"点击上传"),x("本地音频文件")],-1)),e("div",Ee,[e("div",null,"·单个文件最长3小时，单次只能上传"+u(k)+"个。"),e("div",Ce,"·音频格式支持："+u(l(A))+"，单个最大"+u(z)+"M。",1)])])):(i(),c("div",Fe,[e("div",Le,[e("div",Re,[x(" 文件数量："+u(l(a).length),1),e("span",{class:"text-[#c3c3d0]"},"/"+u(k))]),l(a).length<k?(i(),c("div",Se,[p(n,{type:"primary",link:"",size:"small",onClick:j},{default:v(()=>[...t[3]||(t[3]=[x("继续添加",-1)])]),_:1})])):M("",!0)]),e("div",Ue,[p(w,null,{default:v(()=>[e("div",ze,[(i(!0),c(h,null,C(l(a),(o,r)=>(i(),c("div",{class:"flex justify-between items-center gap-2",key:r},[e("div",Ve,[t[4]||(t[4]=e("img",{src:ye,class:"h-[32px]"},null,-1)),e("div",$e,[e("div",Ae,u(o.file.name),1),e("div",je,[e("div",Be,u(l(ie)(o.file.size)),1),e("div",De,u(o.duration)+"秒",1)])])]),e("div",Ie,[o.status==1?(i(),c("div",{key:0,onClick:E=>Z(r)},[p(g,{name:"el-icon-Close",size:18})],8,Me)):(i(),c("div",Oe,[p(g,{name:"local-icon-loading",size:18})]))])]))),128))])]),_:1})])]))],2),e("div",Te,[e("div",Ne,[e("div",null,[t[5]||(t[5]=e("div",{class:"text-[#737373] text-lg"},"音频文件的语音",-1)),e("div",Pe,[(i(!0),c(h,null,C(l(W),(o,r)=>(i(),c("div",{key:r,class:U(["bg-[#F5F5F5] rounded-lg px-6 py-1.5 cursor-pointer",{"bg-[#f1f6ff] text-primary":l(f).language===o.code}]),onClick:E=>l(f).language=o.code},u(o.name),11,Ge))),128))])]),e("div",null,[t[6]||(t[6]=e("div",{class:"text-[#737373] text-lg"},"翻译目标语言",-1)),e("div",We,[p(d,{modelValue:l(f).translation,"onUpdate:modelValue":t[0]||(t[0]=o=>l(f).translation=o),placeholder:"请选择"},{default:v(()=>[(i(!0),c(h,null,C(l(q),(o,r)=>(i(),ce(R,{key:r,label:o.name,value:o.code},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),e("div",null,[t[7]||(t[7]=e("div",{class:"text-[#737373] text-lg"},"区分发言人",-1)),e("div",qe,[(i(!0),c(h,null,C(l(G),(o,r)=>(i(),c("div",{key:r,class:U(["bg-[#F5F5F5] rounded-lg px-6 py-1.5 cursor-pointer",{"bg-primary-light-9 text-primary":l(f).speaker===o.value}]),onClick:E=>l(f).speaker=o.value},u(o.label),11,He))),128))])])]),e("div",Je,[e("div",Ke,[p(m,{placement:"top"},{content:v(()=>[e("div",null,[e("div",null,u(l(y).score)+" "+u(l(y).unit),1)])]),default:v(()=>[p(n,{class:"w-full !h-[39px]",type:"primary",disabled:!l(H)||l(L)<=0,loading:l(ee),onClick:l(X)},{default:v(()=>[e("div",Ye,[t[8]||(t[8]=x(" 开始转写",-1)),l(L)?(i(),c(h,{key:0},[x("("+u(l(L))+"算力)",1)],64)):M("",!0),p(g,{name:"el-icon-Warning"})])]),_:1},8,["disabled","loading","onClick"])]),_:1})]),p(n,{class:"flex-1 !h-[39px]",onClick:B},{default:v(()=>[...t[9]||(t[9]=[x("取消",-1)])]),_:1})])])]),e("input",{type:"file",class:"hidden",ref_key:"fileInputRef",ref:b,accept:l(A),multiple:"",onChange:J},null,40,Ze)]),_:1},512)])}}});export{nt as _};
