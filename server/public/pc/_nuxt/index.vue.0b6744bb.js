import{d as j,aF as F,r as C,k as o,l as f,m as u,q as s,s as a,v as i,Z as l,aI as O,I as E,t as c,L as m,bM as G,J as q,aH as T,G as x,ax as H,y as J,au as K,cW as W,u as X}from"./entry.ee599c70.js";import{E as Z,a as z}from"./index.8fd3c68c.js";import{E as Q,a as Y}from"./index.ef8eb140.js";import{E as ee}from"./el-empty.76498597.js";import{_ as te}from"./index.vue.33025166.js";/* empty css                  *//* empty css               *//* empty css                     *//* empty css                        *//* empty css                 */import{u as se}from"./usePaging.5914886e.js";import{S as ae,T as ne,U as le}from"./person_wechat.703f63bb.js";import{MaterialTypeEnum as h}from"./index.cf59f1a8.js";import{_ as oe}from"./add.vue.9b3cca66.js";const ie={class:"h-full flex flex-col bg-white rounded-xl"},de={class:"flex items-center justify-between flex-shrink-0 p-4"},ue={class:"flex items-center justify-end gap-2 grow"},re={class:"grow min-h-0 flex flex-col overflow-hidden"},ce={class:"grow min-h-0"},me={class:"flex items-center gap-2 justify-center"},pe={key:0,class:"text-warning"},_e={key:1,class:"text-success"},fe={key:2,class:"text-[#918980]"},he={key:3,class:"text-danger"},ve={key:4,class:"text-info"},ye={class:"flex justify-end p-4"},Le=j({__name:"index",setup(ge){const b=X(),v=F({send_status:"",wechat_id:""}),{pager:y,getLists:p,resetPage:V,resetParams:ke}=se({fetchFun:ae,params:v}),g=C(),k=C(!1),$=async()=>{var n;k.value=!0,await T(),(n=g.value)==null||n.open()},I=async n=>{var t,d;k.value=!0,await T(),(t=g.value)==null||t.open(),(d=g.value)==null||d.getDetail(n)},S=async n=>{await b.$confirm({message:"确定要删除任务吗？",onConfirm:async()=>{try{await ne({id:n}),x.msgSuccess("删除成功"),p()}catch(t){x.msgError(t)}}})},A=async n=>{await b.$confirm({message:`确定要${n.send_status==4?"恢复":"暂停"}任务吗？`,onConfirm:async()=>{try{await le({id:n.id,send_status:n.send_status==4?0:4}),x.msgSuccess("操作成功"),p()}catch(t){x.msgError(t)}}})},D=n=>({[h.IMAGE]:"图片",[h.VIDEO]:"视频",[h.LINK]:"链接",[h.MINI_PROGRAM]:"小程序",[h.FILE]:"文件",[h.TEXT]:"文本"})[n];return p(),(n,t)=>{const d=H,_=Z,N=z,B=J,L=K,r=Q,P=ee,M=Y,R=te,U=W;return o(),f(q,null,[u("div",ie,[u("div",de,[s(d,{type:"primary",onClick:$},{default:a(()=>[...t[6]||(t[6]=[i("添加朋友圈任务",-1)])]),_:1}),u("div",ue,[s(N,{modelValue:l(v).send_status,"onUpdate:modelValue":t[0]||(t[0]=e=>l(v).send_status=e),class:"!w-[140px]",placeholder:"请选择状态",clearable:"","empty-values":[null,void 0],onChange:t[1]||(t[1]=e=>l(V)())},{default:a(()=>[s(_,{label:"全部",value:""}),s(_,{label:"待执行",value:0},null,8,["value"]),s(_,{label:"执行中",value:1},null,8,["value"]),s(_,{label:"已完成",value:2},null,8,["value"]),s(_,{label:"已失败",value:3},null,8,["value"]),s(_,{label:"暂停中",value:4},null,8,["value"])]),_:1},8,["modelValue"]),u("div",null,[s(L,{modelValue:l(v).wechat_id,"onUpdate:modelValue":t[3]||(t[3]=e=>l(v).wechat_id=e),placeholder:"请选择微信号"},{append:a(()=>[s(d,{onClick:t[2]||(t[2]=e=>l(p)())},{default:a(()=>[s(B,{name:"el-icon-Search"})]),_:1})]),_:1},8,["modelValue"])])])]),u("div",re,[u("div",ce,[O((o(),E(M,{data:l(y).lists,stripe:"",height:"100%","header-row-style":{height:"62px"},"row-style":{height:"60px"}},{empty:a(()=>[s(P,{description:"暂无数据"})]),default:a(()=>[s(r,{prop:"wechat_nickname",label:"发送账号","min-width":"200"},{default:a(({row:e})=>[i(c(e.wechat_nickname)+"（"+c(e.wechat_id)+"） ",1)]),_:1}),s(r,{prop:"device_model",label:"朋友圈类型",width:"120"},{default:a(({row:e})=>[i(c(D(e.attachment_type)),1)]),_:1}),s(r,{prop:"send_status",label:"状态",width:"120"},{default:a(({row:e})=>[u("div",me,[e.send_status==1?(o(),f("span",pe,"执行中")):m("",!0),e.send_status==2?(o(),f("span",_e,"已完成")):m("",!0),e.send_status==4?(o(),f("span",fe,"暂停中")):m("",!0),e.send_status==3?(o(),f("span",he,"已失败")):m("",!0),e.send_status==0?(o(),f("span",ve,"待执行")):m("",!0)])]),_:1}),s(r,{label:"发送类型",width:"120"},{default:a(({row:e})=>[i(c(e.task_type==1?"定时发送":"即时"),1)]),_:1}),s(r,{prop:"send_time",label:"执行时间",width:"180"},{default:a(({row:e})=>[i(c(e.send_time||"-"),1)]),_:1}),s(r,{prop:"finish_time",label:"完成时间",width:"180"},{default:a(({row:e})=>[i(c(e.finish_time||"-"),1)]),_:1}),s(r,{label:"操作",width:"160",fixed:"right"},{default:a(({row:e})=>[s(d,{type:"primary",link:"",onClick:w=>I(e.id)},{default:a(()=>[...t[7]||(t[7]=[i("详情",-1)])]),_:1},8,["onClick"]),[0,1,4].includes(e.send_status)?(o(),E(d,{key:0,type:"warning",link:"",onClick:w=>A(e)},{default:a(()=>[i(c(e.send_status==4?"恢复":"暂停"),1)]),_:2},1032,["onClick"])):m("",!0),s(d,{type:"danger",link:"",onClick:w=>S(e.id)},{default:a(()=>[...t[8]||(t[8]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[U,l(y).loading]])]),u("div",ye,[s(R,{modelValue:l(y),"onUpdate:modelValue":t[4]||(t[4]=e=>G(y)?y.value=e:null),onChange:l(p)},null,8,["modelValue","onChange"])])])]),l(k)?(o(),E(oe,{key:0,ref_key:"addTaskRef",ref:g,onClose:t[5]||(t[5]=e=>k.value=!1),onSuccess:l(p)},null,8,["onSuccess"])):m("",!0)],64)}}});export{Le as _};
