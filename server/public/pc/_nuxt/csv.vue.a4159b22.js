import{d as z,A as M,x as R,r as w,k as c,l as d,aI as G,Z as n,q as r,s as v,m as t,v as k,t as y,a0 as J,J as D,K as S,Y as U,L as K,bE as O,bw as Q,G as T,u as X,y as Y,ax as Z,cQ as H}from"./entry.d9d53b29.js";import{E as P}from"./index.d23c2db7.js";import{_ as W}from"./index.vue.3e248b2d.js";import{E as ee}from"./index.050c9b6b.js";/* empty css                  *//* empty css                    *//* empty css                     */import{c as te,d as se}from"./file-reader.a4000edd.js";import{isSameFile as ae}from"./hook.050168d8.js";import oe from"./csv-item.d5a3f2e9.js";const le={class:"h-full flex flex-col px-3 pb-3"},ne={class:"flex-shrink-0"},re={class:"text-[#00000080] flex items-center gap-2 justify-center"},ie={class:"text-[#00000080] mt-2"},ce={key:0,class:"grow min-h-0 mt-3 flex gap-x-2"},de={class:"w-1/4 h-full flex flex-col bg-[#F6F6F6] rounded-xl border border-[#efefef]"},me={class:"flex-shrink-1 min-h-0 mb-3"},pe={class:"p-3 flex flex-col gap-y-2"},ue=["onClick"],fe={class:"ml-2 line-clamp-1 flex-1"},_e=["onClick"],ve={class:"flex-1 flex flex-col bg-[#F6F6F6] rounded-xl border border-[#efefef]"},xe={class:"px-3 mt-3"},he={class:"grow min-h-0"},ge={class:"px-3"},De=z({__name:"csv",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(B){const C=M(),l=R(B,"modelValue"),F=[".csv",".xlsx"],x=F.join(", "),h=w([]),g=w(!1),i=w(0),I=async({raw:e})=>{var s,o;try{if(e){const{uri:p}=await O({file:e}),b="."+((s=e.name.split(".").pop())==null?void 0:s.toLowerCase());if(!F.includes(b))throw`不支持的文件类型，请上传 ${x} 格式的文件`;g.value=!0,await ae(e,h.value);const m=await L(e);if(!m)throw"解析结果为空，已自动忽略";if(!Q(m))throw"解析失败";l.value.push({name:e.name,size:e.size,path:p,data:m}),e.data=m,h.value.push(e),E(h.value.length-1)}}catch(p){T.msgError(p)}finally{g.value=!1,(o=C.value)==null||o.clearFiles()}},L=async e=>{const s=e.name.substring(e.name.lastIndexOf(".")+1);let o="";switch(s){case"csv":o=await se(e);break;case"xlsx":o=await te(e);break}return o},N=async e=>{X().$confirm({message:"确定要删除该段落吗？",onConfirm:()=>{l.value.splice(e,1)}})},A=async e=>{l.value[i.value].data.splice(e,1)},E=e=>{i.value=e};return(e,s)=>{var V;const o=Y,p=Z,b=P,m=W,q=ee,j=H;return c(),d("div",le,[G((c(),d("div",ne,[r(b,{ref_key:"uploadRef",ref:C,drag:"","show-progress":"",multiple:"","auto-upload":!1,"show-file-list":!1,accept:n(x),limit:50,"on-change":I},{default:v(()=>[t("div",re,[r(o,{name:"local-icon-upload"}),s[1]||(s[1]=k(" 拖拽文件至此，或点击",-1)),s[2]||(s[2]=t("span",{class:"text-primary"}," 选择文件 ",-1))]),t("div",ie,"支持 "+y(n(x))+" 文件",1),r(p,{link:"",type:"primary",class:"mt-2",onClick:s[0]||(s[0]=J(()=>{},["stop"]))},{default:v(()=>s[3]||(s[3]=[t("a",{href:"/static/file/template/kn_qa.csv",target:"_blank"},"点击下载模版",-1)])),_:1,__:[3]})]),_:1},8,["accept"]),s[4]||(s[4]=t("div",{class:"mt-2 text-[#00000080] text-xs leading-5"},[k(" 先完成填写后再上传，问题总数建议不要超过1000条，否则上传会卡顿 "),t("br"),k(" 导入前会进行去重，如果问题和答案完全相同，则不会被导入，所以最终导入的内容可能会比文件的内容少。但是，对于带有换行的内容，目前无法去重。 ")],-1))])),[[j,n(g)]]),l.value.length>0?(c(),d("div",ce,[t("div",de,[t("div",me,[r(q,null,{default:v(()=>[t("div",pe,[(c(!0),d(D,null,S(l.value,(f,a)=>(c(),d("div",{key:a,class:U(["flex items-center p-2 rounded-lg mt-1 cursor-pointer",[n(i)==a?"bg-[#0065fb0d] shadow-[0_0_0_1px_var(--color-primary)]":"bg-[#f6f6f6] shadow-[0_0_0_1px_#EFEFEF]"]]),onClick:u=>E(a)},[t("div",{class:U(["w-5 h-5 rounded bg-[#0000000d] flex items-center justify-center",{"bg-primary text-white":n(i)==a}])},[r(o,{name:"local-icon-upload2"})],2),t("div",fe,y(f.name),1),t("div",{onClick:u=>N(a)},[r(m)],8,_e)],10,ue))),128))])]),_:1})])]),t("div",ve,[t("div",xe,"分段预览（"+y((V=l.value[n(i)])==null?void 0:V.data.length)+"组）",1),t("div",he,[r(q,null,{default:v(()=>{var f;return[t("div",ge,[(c(!0),d(D,null,S((f=l.value[n(i)])==null?void 0:f.data,(a,u)=>{var $;return c(),d("div",{key:u,class:"rounded-xl p-[10px] mt-2 break-all bg-white"},[r(oe,{q:a.q,"onUpdate:q":_=>a.q=_,a:a.a,"onUpdate:a":_=>a.a=_,index:u,name:($=l.value[n(i)])==null?void 0:$.name,onDelete:_=>A(u)},null,8,["q","onUpdate:q","a","onUpdate:a","index","name","onDelete"])])}),128))])]}),_:1})])])])):K("",!0)])}}});export{De as _};
