import{aF as y,r as i,c as S,cz as m,cA as C,G as h}from"./entry.ca4d3d61.js";import{useChatStore as p}from"./chat.620091d1.js";import{useChatManager as H}from"./useChatManager.9478f2c4.js";function L(){const a=p(),{taskId:f,fetchChatHistory:g,resetScroll:v,chatScrollToBottom:d}=H(),r=y({page_no:1,page_size:40}),o=i(!1),c=i(!1),e=i([]),n=S(()=>f.value),l=async()=>{o.value=!0;try{const{lists:t,count:s}=await m(r);c.value=!(t.length<(r.page_size||s)),e.value=e.value.concat(t)}finally{o.value=!1}},u=t=>{a.clearChat(),a.resetRoute()};return{chatHistory:e,currentSessionId:n,isLoading:o,isFinished:c,fetchChatHistory:l,createNewSession:u,switchToSession:async t=>{n.value!==t&&(a.setTaskId(t),await g(),v(),d())},deleteSession:async t=>{try{e.value=e.value.filter(s=>s.task_id!==t),await C({task_id:t}),h.msgSuccess("删除成功"),n.value===t&&u()}catch(s){h.msgError(s)}},saveCurrentSession:()=>{a.chatContentList.length},loadHistory:async()=>{!c.value||o.value||(r.page_no++,l())}}}export{L as useChatHistory};
