import{d as fe,r as p,k as n,l as c,m as e,q as l,s as f,Z as t,J as h,I as v,d$ as ue,t as i,K as N,v as L,L as x,bz as me,cO as xe,aH as k,bI as _e,G as M,y as ve,aw as ge,ax as Ee,au as ye,av as he,ay as ke,u as be}from"./entry.d7219633.js";import{E as we}from"./el-avatar.e0eb87c8.js";import{E as Te}from"./el-empty.77af023a.js";import{E as Ce}from"./index.4953ba77.js";import{E as De}from"./index.f15af271.js";import{E as Ie}from"./el-date-picker.fe7cdba3.js";/* empty css               *//* empty css                     */import{AccountTypeMap as Pe,AccountTypeEnum as Ve,AccountSource as Ue,HandleEventEnum as $e}from"./index.cf59f1a8.js";import{_ as Fe}from"./friends-bind-tag.vue.76518142.js";import Re from"./useHandle.2b5b26f8.js";import ze from"./useTodo.60b74ae1.js";import Se from"./user-detail-panel.3140458c.js";import{_ as Be}from"./user-todo-edit.vue.f79f4fdd.js";const je={class:"w-full h-full bg-white flex flex-col"},Ae={class:"grow min-h-0"},He={class:"px-4 pb-4 flex flex-col gap-y-4 mt-4"},Ye={class:"shadow-lighter rounded-lg p-2"},Ne={class:"flex items-center justify-between"},Le={class:"flex-shrink-0"},Me=["src"],qe={class:""},Ge={class:"text-[#9E9E9E] text-xs mt-1 break-all"},Je={class:"text-[#9E9E9E] text-xs break-all"},Ke={class:"flex flex-col gap-y-1"},Oe={class:"text-xs flex"},We={class:"text-[#07C160]"},Ze={class:"text-xs flex"},Qe={class:"text-xs flex"},Xe={class:"text-xs flex"},es={class:"text-xs flex"},ss={key:1},ts={class:"shadow-lighter rounded-lg p-2"},os={class:"flex items-center justify-between"},ls={class:"flex flex-wrap gap-2 mt-2"},ns={class:"w-[14px] h-[14px] bg-primary flex items-center justify-center rounded-[2px]"},as={key:0,class:"absolute -top-1 -right-1"},rs=["onClick"],is={class:"shadow-lighter rounded-lg p-2"},ds={key:0,class:"mt-2 flex flex-col gap-y-5"},cs={class:"relative"},ps={key:0,class:"h-[80%] border-r border-dashed absolute right-1 mt-3"},fs={class:"flex-1"},us={class:"flex items-center justify-between"},ms={class:"flex flex-col gap-y-1 mt-1"},xs={class:"text-xs flex"},_s={class:"text-xs flex"},vs={class:"text-xs flex"},gs={key:1},Es={class:"h-[65px] shadow-lighter bg-white flex-shrink-0 px-4"},ys={class:"flex items-center h-full"},js=fe({__name:"user-panel",setup(hs,{expose:q}){const G=be(),{currentWechat:P,currentFriend:V,friendInfo:r,userInfoIsLocked:J,userInfoForm:d,friendTagLists:K,getFriendTagDetail:U,deleteFriendTag:O,updateUserInfo:W,triggerHandleEvent:Z}=Re(),{todoPager:m,todoParams:g,getTodoLists:$,resetTodoPage:F,handleDeleteTodo:Q}=ze(),R=p(null),E=p(!1),X=async()=>{var a;E.value=!0,await k(),(a=R.value)==null||a.open(),_e(r.value,d)},ee=async()=>{await W(d),Z("action",{type:$e.UpdateUserInfo,...d}),E.value=!1},b=p(!1),z=p(),se=async()=>{var a;b.value=!0,await k(),(a=z.value)==null||a.open()},S=p(),w=p(!1),B=async a=>{var s;w.value=!0,await k(),(s=S.value)==null||s.open(a)},te=async()=>{m.lists=[],F()},j=p(),T=p(!1),C=p(!1),oe=async()=>{var a;T.value=!0,await k(),(a=j.value)==null||a.open()},le=a=>{G.$confirm({message:"确定要删除该标签吗？",onConfirm:async()=>{try{await O(a),M.msgSuccess("删除标签成功")}catch(s){M.msgError(s)}}})},A=p(null),ne=a=>{var _;if(!((_=a.value)!=null&&_.wrapRef))return!1;const{scrollTop:s,scrollHeight:u,clientHeight:D}=a.value.wrapRef;return Math.abs(u-s-D)<=1},ae=async()=>{ne(A)&&!m.isLoad&&(g.page_no++,await $())};return q({init:async()=>{m.lists=[],g.page_no=1,g.wechat_id=P.value.wechat_id,g.friend_id=V.value.UserName,await Promise.allSettled([$(),U()])}}),(a,s)=>{const u=ve,D=we,_=ge,H=Te,re=Ce,ie=Ee,de=De,I=ye,y=he,ce=Ie,pe=ke;return n(),c(h,null,[e("div",je,[e("div",Ae,[l(de,{ref_key:"scrollbarRef",ref:A,onScroll:ae},{default:f(()=>[e("div",He,[e("div",Ye,[e("div",Ne,[s[11]||(s[11]=e("div",{class:"flex items-center gap-x-2"},[e("span",{class:"w-[4px] h-[14px] bg-primary"}),e("span",{class:""},"基本信息")],-1)),e("div",{class:"cursor-pointer p-1 hover:bg-token-sidebar-surface-secondary rounded-lg leading-[0]",onClick:X},[l(u,{name:"el-icon-Edit",size:20,color:"#9E9E9E"})])]),t(r).friend_id?(n(),c(h,{key:0},[e("div",{class:"flex gap-x-2 cursor-pointer py-2 px-1 rounded hover:bg-token-sidebar-surface-secondary",onClick:se},[e("div",Le,[t(r).avatar?(n(),c("img",{key:0,src:t(r).avatar,class:"w-[56px] h-[56px] rounded-[2px] object-cover"},null,8,Me)):(n(),v(D,{key:1,size:56,icon:t(ue)},null,8,["icon"]))]),e("div",null,[e("div",qe,i(t(r).remark||t(r).nickname),1),e("div",Ge," 微信昵称："+i(t(r).nickname),1),e("div",Je," 微信ID："+i(t(r).friend_no||t(r).friend_id),1)])]),l(_,{"border-style":"dashed",class:"!my-2"}),e("div",Ke,[e("div",Oe,[s[12]||(s[12]=e("span",{class:"text-[#9E9E9E] flex-shrink-0"},"账号类型：",-1)),e("span",We,"@"+i(t(Pe)[t(Ve).Personal]),1)]),e("div",Ze,[s[13]||(s[13]=e("span",{class:"text-[#9E9E9E] flex-shrink-0"},"手机号码：",-1)),e("span",null,i(t(r).phone||"暂无"),1)]),e("div",Qe,[s[14]||(s[14]=e("span",{class:"text-[#9E9E9E] flex-shrink-0"},"来源方式：",-1)),e("span",null,i(t(Ue)[t(r).source]||"未知"),1)]),e("div",Xe,[s[15]||(s[15]=e("span",{class:"text-[#9E9E9E] flex-shrink-0"},"出生日期：",-1)),e("span",null,i(t(r).birth_date||"暂无"),1)]),e("div",es,[s[16]||(s[16]=e("span",{class:"text-[#9E9E9E] flex-shrink-0"},"联系地址：",-1)),e("span",null,i(t(r).contact_address||"暂无"),1)])])],64)):(n(),c("div",ss,[l(H,{description:"暂无数据","image-size":100})]))]),e("div",ts,[e("div",os,[s[17]||(s[17]=e("div",{class:"flex items-center gap-x-2"},[e("span",{class:"w-[4px] h-[14px] bg-primary"}),e("span",{class:""},"标签信息")],-1)),e("div",{class:"cursor-pointer p-1 hover:bg-token-sidebar-surface-secondary rounded-lg leading-[0]",onClick:s[0]||(s[0]=o=>C.value=!t(C))},[l(u,{name:"el-icon-Setting",size:20,color:"#9E9E9E"})])]),e("div",ls,[e("div",{class:"h-[24px] w-[64px] el-tag el-tag--primary el-tag--light",onClick:oe},[e("span",ns,[l(u,{name:"el-icon-Plus",size:10,color:"#ffffff"})])]),(n(!0),c(h,null,N(t(K),o=>(n(),c("div",{key:o.tag_id,class:"relative"},[l(re,{type:"primary"},{default:f(()=>[L(i(o.tag_name),1)]),_:2},1024),t(C)?(n(),c("div",as,[e("span",{class:"bg-[#D43030] rounded-full w-[14px] h-[14px] flex items-center justify-center cursor-pointer",onClick:Y=>le(o.tag_id)},[l(u,{name:"el-icon-Close",size:10,color:"#ffffff"})],8,rs)])):x("",!0)]))),128))])]),e("div",is,[s[23]||(s[23]=e("div",{class:"flex items-center justify-between"},[e("div",{class:"flex items-center gap-x-2"},[e("span",{class:"w-[4px] h-[14px] bg-primary"}),e("span",{class:""},"跟进信息")])],-1)),t(m).lists.length?(n(),c("div",ds,[(n(!0),c(h,null,N(t(m).lists,(o,Y)=>(n(),c("div",{key:o.id,class:"flex gap-x-4"},[e("div",cs,[s[18]||(s[18]=e("div",{class:"bg-black rounded-full w-2 h-2 mt-[6px]"},null,-1)),Y<t(m).lists.length?(n(),c("div",ps)):x("",!0)]),e("div",fs,[e("div",us,[e("div",null,i(t(me)(o.create_time).format("YYYY-MM-DD HH:mm")),1),l(ie,{link:"",type:"danger",size:"small",onClick:bs=>t(Q)(o.id)},{default:f(()=>s[19]||(s[19]=[L(" 删除 ",-1)])),_:2,__:[19]},1032,["onClick"])]),e("div",ms,[e("div",xs,[s[20]||(s[20]=e("span",{class:"text-[#9E9E9E] flex-shrink-0"},"活动类型：",-1)),e("span",null,i(o.todo_type==0?"添加代办":"自动跟进"),1)]),e("div",_s,[s[21]||(s[21]=e("span",{class:"text-[#9E9E9E] flex-shrink-0"},"办理日期：",-1)),e("span",null,i(o.todo_time),1)]),e("div",vs,[s[22]||(s[22]=e("span",{class:"text-[#9E9E9E] flex-shrink-0"},"待办内容：",-1)),e("span",null,i(o.todo_content),1)])])])]))),128))])):(n(),c("div",gs,[l(H,{description:"暂无数据","image-size":100})]))])])]),_:1},512)]),e("div",Es,[e("div",ys,[e("div",{class:"flex flex-col items-center gap-x-2 py-[6px] hover:bg-token-sidebar-surface-secondary rounded-lg cursor-pointer flex-1",onClick:s[1]||(s[1]=o=>B(0))},[l(u,{name:"local-icon-todo",size:20}),s[24]||(s[24]=e("span",{class:"mt-1 text-[#727D8F] text-xs"},"添加待办",-1))]),l(_,{direction:"vertical",class:"!h-[50%]"}),e("div",{class:"flex flex-col items-center gap-x-2 py-[6px] hover:bg-token-sidebar-surface-secondary rounded-lg cursor-pointer flex-1",onClick:s[2]||(s[2]=o=>B(1))},[l(u,{name:"local-icon-todo_list",size:20}),s[25]||(s[25]=e("span",{class:"mt-1 text-[#727D8F] text-xs"},"自动跟进",-1))])])])]),t(E)?(n(),v(xe,{key:0,ref_key:"userInfoPopRef",ref:R,async:"",title:"信息修改",width:"487px","confirm-button-text":"确认保存","confirm-loading":t(J),onConfirm:ee,onClose:s[7]||(s[7]=o=>E.value=!1)},{default:f(()=>[l(pe,{ref:"userInfoFormRef",model:t(d),"label-position":"top"},{default:f(()=>[l(y,{label:"请输入修改后的微信备注名称（若为空则不进行备注）"},{default:f(()=>[l(I,{modelValue:t(d).remark,"onUpdate:modelValue":s[3]||(s[3]=o=>t(d).remark=o),placeholder:"请输入微信备注名称"},null,8,["modelValue"])]),_:1}),l(y,{label:"请输入修改后的手机号码（若为空则清空手机信息）"},{default:f(()=>[l(I,{modelValue:t(d).phone,"onUpdate:modelValue":s[4]||(s[4]=o=>t(d).phone=o),placeholder:"请输入手机号码"},null,8,["modelValue"])]),_:1}),l(y,{label:"请输入修改后的联系地址（若为空则清空地址信息）"},{default:f(()=>[l(I,{modelValue:t(d).contact_address,"onUpdate:modelValue":s[5]||(s[5]=o=>t(d).contact_address=o),placeholder:"请输入联系地址"},null,8,["modelValue"])]),_:1}),l(y,{label:"请输入修改后的出生日期（若为空则清空出生日期）"},{default:f(()=>[l(ce,{class:"!w-full",modelValue:t(d).birth_date,"onUpdate:modelValue":s[6]||(s[6]=o=>t(d).birth_date=o),type:"date","value-format":"YYYY-MM-DD",placeholder:"请选择出生日期"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["confirm-loading"])):x("",!0),t(w)?(n(),v(Be,{key:1,ref_key:"userTodoEditRef",ref:S,"wechat-id":t(P).wechat_id,"friend-id":t(V).UserName,onChangeTag:t(U),onChangeTodo:t(F),onClose:s[8]||(s[8]=o=>w.value=!1),onConfirm:te},null,8,["wechat-id","friend-id","onChangeTag","onChangeTodo"])):x("",!0),t(T)?(n(),v(Fe,{key:2,ref_key:"friendsBindTagRef",ref:j,onClose:s[9]||(s[9]=o=>T.value=!1)},null,512)):x("",!0),t(b)?(n(),v(Se,{key:3,ref_key:"userDetailPopRef",ref:z,onClose:s[10]||(s[10]=o=>b.value=!1)},null,512)):x("",!0)],64)}}});export{js as _};
