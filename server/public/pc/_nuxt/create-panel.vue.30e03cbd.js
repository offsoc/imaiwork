import{d as Q,at as W,z as Y,aG as $,r as D,c as K,cq as ee,D as oe,k as ae,I as te,s as se,v as re,Z as V,G as n,ax as ie,dt as e}from"./entry.46557796.js";import{f as ce}from"./digital_human.b276942f.js";import{DigitalHumanModelVersionEnum as I,CreateTypeEnum as v}from"./index.728f9c9c.js";const le=Q({__name:"create-panel",props:{formData:{}},emits:["error","success"],setup(h,{emit:y}){const m=h,R=y;W();const U=Y(),{userTokens:w}=$(U),g=D(!1),k=D({}),f=D(0),u=D({}),r=o=>U.getTokenByScene(o),L=K(()=>{const{video_cost:o,figure_cost:a,voice_cost:s,audio_cost:i}=k.value;return(o||0)*f.value+(a||0)+(s||0)+(i||0)*f.value}),x=async()=>{const{anchor_id:o,msg:a,model_version:s,voice_id:i,voice_type:l,audio_type:d,audio_duration:H}=m.formData,t={video_cost:0,figure_cost:0,voice_cost:0,audio_cost:0,video_unit:"",voice_unit:"",figure_unit:"",audio_unit:""};C(a,H);const T=(E,N,p,A)=>{t.video_cost=parseFloat(r(E).score||0),t.video_unit=r(E).unit,t.voice_cost=v.AUDIO==d||l==1&&i==-1?parseFloat(r(N).score||0):0,t.voice_unit=r(N).unit,t.audio_cost=parseFloat(r(p).score||0),t.audio_unit=r(p).unit,A&&(t.figure_cost=parseFloat(r(A).score||0),t.figure_unit=r(A).unit)},c={pro:{video:e.HUMAN_VIDEO_PRO,voice:e.HUMAN_VOICE_PRO,audio:e.HUMAN_AUDIO_PRO,avatar:e.HUMAN_AVATAR_PRO},normal:{video:e.HUMAN_VIDEO,voice:e.HUMAN_VOICE,audio:e.HUMAN_AUDIO,avatar:e.HUMAN_AVATAR},advanced:{video:e.HUMAN_VIDEO_ADVANCED,voice:e.HUMAN_VOICE_ADVANCED,audio:e.HUMAN_AUDIO_ADVANCED,avatar:e.HUMAN_AVATAR_ADVANCED},elite:{video:e.HUMAN_VIDEO_ELITE,voice:e.HUMAN_VOICE_ELITE,audio:e.HUMAN_AUDIO_ELITE,avatar:e.HUMAN_AVATAR_ELITE},chanjing:{video:e.HUMAN_VIDEO_CHANJING,voice:e.HUMAN_VOICE_CHANJING,audio:e.HUMAN_AUDIO_CHANJING,avatar:e.HUMAN_AVATAR_CHANJING}},_=(()=>{switch(parseInt(s)){case I.SUPER:return c.pro;case I.ADVANCED:return c.advanced;case I.ELITE:return c.elite;case I.CHANJING:return c.chanjing;default:return c.normal}})();T(_.video,_.voice,_.audio,o?void 0:_.avatar),k.value=t},C=(o,a)=>{f.value=a||Math.floor(o.trim().length/3)},F=o=>{const{url:a,audio_type:s,msg:i,voice_id:l,audio_url:d}=o;if(!a)return n.msgError("请选择一位数字人"),!1;switch(s){case v.TEXT:if(i){if(!l)return n.msgError("请选择音色"),!1}else return n.msgError("请输入视频文案"),!1;break;case v.AUDIO:if(!d)return n.msgError("请上传音频文件"),!1;break}return!0},S=()=>{const{url:o,msg:a,name:s,pic:i,anchor_id:l,anchor_name:d,model_version:H,audio_type:t,voice_type:T,gender:c,voice_id:_,voice_name:E,audio_url:N,audio_duration:p,width:A,height:b,music_url:J,clip_type:j,automatic_clip:z,music_type:X}=m.formData;u.value={...u.value,name:s,pic:i,video_url:o,voice_type:T,anchor_id:l,anchor_name:d,model_version:H,audio_type:t,gender:c,audio_url:N,width:A,height:b,music_url:J,clip_type:j,automatic_clip:z,music_type:X};const M=(q,Z,O)=>{u.value.msg=q,O!=-1&&(u.value.voice_id=O,u.value.voice_name=E),C(a,Z)};switch(t){case v.TEXT:M(a,f.value,_);break;case v.AUDIO:M("",p);break}g.value=!g.value},G=async()=>{try{if(S(),!F(m.formData))return;if(L.value>w.value){n.msgPowerInsufficient();return}await ce(u.value),n.msgSuccess("创建成功,请在数字人管理中或者历史记录查看"),U.getUser(),g.value=!1,R("success")}catch(o){n.msgError(o||"创建失败")}},{lockFn:P,isLock:B}=ee(G);return oe(()=>m.formData,x,{immediate:!0}),(o,a)=>{const s=ie;return ae(),te(s,{class:"w-full !rounded-full !h-[50px]",type:"primary",size:"large",loading:V(B),onClick:V(P)},{default:se(()=>a[0]||(a[0]=[re(" 确定 ",-1)])),_:1,__:[0]},8,["loading","onClick"])}}});export{le as _};
