import{E as Re,a as Se}from"./el-breadcrumb.708b09d4.js";import{E as Pe}from"./el-card.58a9be5d.js";import{d as Te,bO as Ne,a as $e,r as u,c as j,aF as Le,dP as G,o as Be,k as i,l as d,m as s,q as l,s as a,v as A,t as p,Z as n,J as L,K as U,Y as M,L as h,$ as Ie,aI as Oe,I as D,a0 as B,bM as Ve,G as c,em as m,aH as Fe,y as je,aw as Ge,ax as Ue,au as Me,cW as qe,u as He}from"./entry.2beb4577.js";import{E as Ke}from"./index.e6c47712.js";import{E as ze}from"./el-avatar.5169f9ed.js";import{E as Je}from"./index.dcd97a19.js";import{E as We}from"./el-empty.bc763313.js";import{E as _,a as Xe}from"./index.6beaca44.js";import{_ as Ye}from"./index.vue.5646543a.js";/* empty css                   *//* empty css               *//* empty css                 *//* empty css                     */import{u as Ze}from"./useSocialPlatform.694640c2.js";import{u as Qe}from"./useDeviceWs.1848965d.js";import{u as et}from"./useAddDeviceAccount.1c4e07c2.js";import{u as tt}from"./usePaging.85211d66.js";import{g as q,m as ot,n as st}from"./service.595be035.js";import{h as nt}from"./device.b7e58507.js";import{_ as lt}from"./device-add.vue.c61f6404.js";import{_ as at}from"./device-progress.vue.4b56f227.js";import"./index.47b30189.js";import"./_baseIteratee.70cb6d8d.js";import"./debounce.dd7f88c1.js";import"./toNumber.c824a4a2.js";import"./index.9d200730.js";import"./raf.c0777355.js";import"./index.4d719c96.js";import"./strings.a9740cf6.js";import"./clamp.a46ea567.js";import"./useWebSocket.a6ad43de.js";import"./usePolling.a210b06f.js";import"./index.a9d48d33.js";/* empty css                    */const rt={class:"h-full flex flex-col p-4"},it={class:"h-[71px] px-5 flex items-center justify-between border-b border-b-[#E8E8E8]"},ct={class:"flex items-center gap-2"},dt={class:"min-w-[170px] flex items-center gap-2 cursor-pointer"},ut={class:"text-[#36393F] text-lg font-bold"},pt={class:"flex flex-col"},mt={class:"flex flex-col gap-y-1 p-2 max-h-[300px] overflow-y-auto"},ft=["onClick"],_t={class:"flex justify-center py-3"},vt={key:0,class:"bg-[#F2F3F8] text-xs py-1 px-2 rounded-lg"},gt={class:"grow min-h-0 flex w-full"},yt={class:"w-[178px] bg-white border-r border-r-[#E8E8E8] flex-shrink-0"},ht={class:"flex flex-col gap-y-4 p-4"},xt=["onClick"],Et=["src"],bt={class:"flex-1 overflow-auto flex flex-col mt-4"},kt={class:"flex justify-between items-center px-4"},Ct={class:"grow min-h-0 mt-4 w-full"},wt={class:"flex items-center justify-center gap-x-2"},At={class:"flex flex-col gap-2"},Dt=["onClick"],Rt={class:"flex items-center justify-center"},St=["onClick"],Pt=["onClick"],Tt={key:0,class:"flex items-center justify-center h-full"},Nt={key:1,class:"flex items-center justify-center h-full"},$t={class:"flex justify-end p-4"},vo=Te({__name:"[id]",setup(Lt){const H=Ne(),K=$e(),z=He(),{socialPlatformList:J,currentSocialPlatform:R}=Ze(),S=u([]),I=u(null),x=u(!1),C=u(!1),O=u(""),W=j(()=>S.value.find(o=>o.device_code===r.device_code)),X=j(()=>J.filter(o=>o.show)),{onEvent:Y,send:V}=Qe(),{showAddDevice:P,addDeviceLoading:Z,progressValue:Q,handleAddAccount:ee,refreshAccount:te,handleAddDeviceConfirm:oe,handleRefreshAccount:se}=et({send:V,onEvent:Y,onSuccess:o=>{const{msg:e,type:v,data:k}=o;switch(v){case m.GET_USER_INFO:x.value=!1,f();break;case m.GET_BUSINESS_CARD:le(k.content);break;case m.OPEN_APP:case m.OPEN_PERSON_CENTER:case m.GET_ACCOUNT_INFO:case m.DATA_SEND:case m.GET_ACCOUNT_INFO_COMPLETE:O.value=e;break;default:C.value=!1,c.closeLoading();break}},onError:o=>{C.value=!0,c.closeLoading(),c.msgError(o.error)}}),w=u(!1),ne=async()=>{if(!w.value)try{w.value=!0;const{lists:o}=await q({status:1,device_code:r.device_code});if(o.length==0){c.msgError("暂无在线账号");return}N(o[0])}catch(o){c.msgError(o)}finally{w.value=!1}},le=async o=>{const{account:e,account_no:v}=b.value;try{await ot({account:e,account_no:v||e,type:R.value,content:JSON.stringify(o),m_type:5,sort:0}),f(),c.msgSuccess("添加成功")}catch(k){c.msgError(k)}b.value=null,c.closeLoading()},ae=u(null),re=async()=>{const{lists:o}=await nt({page_size:999});S.value=[{device_model:"全部",device_code:""},...o]},ie=async()=>{P.value=!0,await Fe(),I.value.open()},ce=o=>{C.value=!1,R.value=o,r.type=o,pe()},de=o=>{r.device_code=o,f()},r=Le({type:G.XHS,name:"",account:"",device_code:""}),{pager:E,getLists:f,resetParams:ue,resetPage:pe}=tt({fetchFun:q,params:r}),me=o=>{K.push({path:"/app/service",query:{type:G.XHS}})},T=u(),b=u(null),F=()=>{x.value=!0,ee({device_code:r.device_code,type:r.type})},N=o=>{x.value=!0,te.value=[{id:o.id,account:o.account,type:o.type}],se(o.device_code,o.type)},fe=()=>{b.value?N(b.value):F()},_e=async o=>{b.value=o,c.loading("获取名片中...",T.value),V({type:m.GET_BUSINESS_CARD,deviceId:o.device_code,appType:o.type})},ve=o=>{z.$confirm({message:"删除账号时，当前执行的任务将中断并无法继续，确定要删除该账号吗？",onConfirm:async()=>{c.loading("删除中...",T.value);try{await st({id:o.id}),c.msgSuccess("删除成功"),f()}catch(e){c.msgError(e)}finally{c.closeLoading()}}})};return Be(async()=>{r.device_code=H.query.device_code,f()}),re(),(o,e)=>{const v=Re,k=Se,ge=Pe,g=je,ye=Ge,$=Ue,he=Ke,xe=Me,Ee=ze,be=Je,ke=We,Ce=Xe,we=Ye,Ae=qe;return i(),d(L,null,[s("div",rt,[l(ge,{class:"!border-none !rounded-xl",shadow:"never"},{default:a(()=>[l(k,null,{default:a(()=>[l(v,null,{default:a(()=>[s("span",{class:"cursor-pointer text-[#8A8C99] hover:text-primary",onClick:e[0]||(e[0]=t=>o.$router.back())}," 智能体 ")]),_:1}),l(v,null,{default:a(()=>[...e[7]||(e[7]=[A("账号设置",-1)])]),_:1})]),_:1})]),_:1}),s("div",{class:"grow min-h-0 bg-white rounded-lg mt-4 flex flex-col overflow-hidden",ref_key:"containerRef",ref:T},[s("div",it,[s("div",null,[s("div",ct,[l(he,{"show-arrow":!1,"popper-class":"!p-0 !min-w-[200px]  !border-none !rounded-lg !shadow-[0_0_10px_1px_rgba(0,0,0,0.1)]"},{reference:a(()=>{var t;return[s("div",dt,[l(g,{name:"el-icon-ArrowDownBold"}),s("span",ut,p((t=n(W))==null?void 0:t.device_model),1)])]}),default:a(()=>[s("div",pt,[s("div",mt,[(i(!0),d(L,null,U(n(S),(t,y)=>(i(),d("div",{class:M(["break-all hover:bg-primary-light-9 rounded-lg p-2 cursor-pointer",{"bg-primary-light-9 text-primary":n(r).device_code===t.device_code}]),key:y,onClick:De=>de(t.device_code)},p(t.device_model),11,ft))),128))]),l(ye,{class:"!m-0"}),s("div",_t,[l($,{type:"primary",link:"",onClick:ie},{default:a(()=>[l(g,{name:"el-icon-Plus"}),e[8]||(e[8]=s("span",null,"添加设备",-1))]),_:1})])])]),_:1}),n(r).device_code?(i(),d("span",vt,"设备ID："+p(n(r).device_code),1)):h("",!0)])])]),s("div",gt,[s("div",yt,[s("div",ht,[(i(!0),d(L,null,U(n(X),(t,y)=>(i(),d("div",{key:y,class:M(["flex items-center gap-x-3 px-4 hover:bg-primary-light-9 py-1.5 rounded-lg cursor-pointer",{"bg-primary-light-9":n(R)===t.type}]),onClick:De=>ce(t.type)},[s("img",{src:t.icon,class:"w-6 h-6"},null,8,Et),s("div",null,p(t.name),1)],10,xt))),128))])]),s("div",bt,[s("div",kt,[s("div",null,[l($,{link:"",onClick:ne,loading:n(w)},{default:a(()=>[l(g,{name:"el-icon-Refresh"}),e[9]||(e[9]=s("span",null,"刷新数据",-1))]),_:1},8,["loading"])]),l(xe,{modelValue:n(r).account,"onUpdate:modelValue":e[1]||(e[1]=t=>n(r).account=t),placeholder:"搜索账号信息",class:"!w-[200px]","prefix-icon":"el-icon-Search",clearable:"",onClear:e[2]||(e[2]=t=>n(ue)()),onKeyup:e[3]||(e[3]=Ie(t=>n(f)(),["enter"]))},null,8,["modelValue"])]),s("div",Ct,[Oe((i(),D(Ce,{ref_key:"tableRef",ref:ae,data:n(E).lists,height:"100%",stripe:"","row-style":{height:"60px",cursor:"pointer"},"header-cell-style":{height:"63px"},onRowClick:me},{empty:a(()=>[n(r).device_code?(i(),d("div",Tt,[e[15]||(e[15]=A(" 还没有账号，",-1)),l($,{type:"primary",link:"",onClick:F},{default:a(()=>[...e[14]||(e[14]=[A("点击获取设备账号信息",-1)])]),_:1})])):(i(),d("div",Nt,[l(ke,{description:"暂无账号信息"})]))]),default:a(()=>[l(n(_),{label:"头像",width:"80"},{default:a(({row:t})=>[l(Ee,{src:t.avatar},null,8,["src"])]),_:1}),l(n(_),{label:"账号/昵称",prop:"account","min-width":"180"},{default:a(({row:t})=>[s("div",wt,[s("div",null,[s("div",null,p(t.account),1),s("div",null,"("+p(t.nickname)+")",1)]),t.status==1?(i(),D(be,{key:0,type:"success"},{default:a(()=>[...e[10]||(e[10]=[A("当前账号",-1)])]),_:1})):h("",!0)])]),_:1}),l(n(_),{label:"粉丝数量",prop:"fans","min-width":"100"},{default:a(({row:t})=>[s("div",null,p(t.fans||"-"),1)]),_:1}),l(n(_),{label:"点赞数量",prop:"thumbup_collect","min-width":"100"},{default:a(({row:t})=>[s("div",null,p(t.thumbup_collect||"-"),1)]),_:1}),l(n(_),{label:"关注数量",prop:"followers","min-width":"100"},{default:a(({row:t})=>[s("div",null,p(t.followers||"-"),1)]),_:1}),l(n(_),{label:"更新时间",prop:"create_time",width:"180"}),l(n(_),{label:"操作",width:"120px",fixed:"right"},{default:a(({row:t})=>[s("div",At,[t.status==1?(i(),d("div",{key:0,class:"px-2 py-1 hover:bg-primary-light-9 rounded-lg cursor-pointer flex items-center gap-2",onClick:B(y=>N(t),["stop"])},[s("span",Rt,[l(g,{name:"el-icon-Refresh"})]),e[11]||(e[11]=s("span",null,"刷新数据",-1))],8,Dt)):h("",!0),t.account_type==1&&t.status==1?(i(),d("div",{key:1,class:"px-2 py-1 hover:bg-primary-light-9 rounded-lg cursor-pointer flex items-center gap-2",onClick:B(y=>_e(t),["stop"])},[l(g,{name:"el-icon-Postcard"}),e[12]||(e[12]=s("span",null,"名片获取",-1))],8,St)):h("",!0),s("div",{class:"px-2 py-1 hover:bg-primary-light-9 rounded-lg cursor-pointer flex items-center gap-2",onClick:B(y=>ve(t),["stop"])},[l(g,{name:"el-icon-Delete"}),e[13]||(e[13]=s("span",null,"账号移除",-1))],8,Pt)])]),_:1})]),_:1},8,["data"])),[[Ae,n(E).loading]])]),s("div",$t,[l(we,{modelValue:n(E),"onUpdate:modelValue":e[4]||(e[4]=t=>Ve(E)?E.value=t:null),onChange:n(f)},null,8,["modelValue","onChange"])])])])],512)]),n(P)?(i(),D(lt,{key:0,ref_key:"addDeviceRef",ref:I,"bind-loading":n(Z),onClose:e[5]||(e[5]=t=>P.value=!1),onConfirm:n(oe)},null,8,["bind-loading","onConfirm"])):h("",!0),n(x)?(i(),D(at,{key:1,"progress-value":n(Q),"progress-error":n(C),step:n(O),onClose:e[6]||(e[6]=t=>x.value=!1),onRetry:fe},null,8,["progress-value","progress-error","step"])):h("",!0)],64)}}});export{vo as default};
