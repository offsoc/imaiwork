import{d as k,r as c,G as y,aF as w,bz as E,k as G,l as v,q as u,s as h,m as O,Z as l}from"./entry.46557796.js";import{o as M}from"./drawing.7058a163.js";import{drawTypeEnumMap as x,DrawTypeEnum as A}from"./index.fb0aa6a9.js";import C from"./useCreateForm.91aa09b3.js";import I from"./useDrawingTask.323114d7.js";import S from"./result-content.ed816fb5.js";import{E as T}from"./index.304400de.js";const b={class:"h-full relative w-full"},Y={class:"px-[10px]"},V=k({__name:"index",setup(B){let r;(s=>{s[s.GOODS_IMAGE=x[A.GOODS_IMAGE]]="GOODS_IMAGE"})(r||(r={}));const{onEvent:f,setFormData:_}=C(),n=c([]),t=c(!1);f("update:formData",async s=>{var m;if(t.value){y.msgWarning("请等待上一次任务完成");return}t.value=!0;const{type_name:i,style_name:g,params:e}=s,a=w({date:E().format("YYYY-MM-DD HH:mm"),prompt:e.prompt,tags:[(m=e.resolution)==null?void 0:m.join("*"),i,g,e.template_name_zh],images:[],formData:s});n.value.unshift(a);try{a.images=new Array(parseInt(e.img_count)).fill({url:"",loading:!0,progress:0,status:0,error:!1});const{result:p}=await M(e),{processDrawingTask:o}=I({type:r.GOODS_IMAGE,task_id:p.task_id,dataLists:a.images});await o({callback:D=>{a.images=D}})}catch{a.images=a.images.map(o=>({...o,loading:!1,progress:0,status:4,error:!0}))}finally{t.value=!1}});const d=s=>{_(s)};return(s,i)=>(G(),v("div",b,[u(l(T),null,{default:h(()=>[O("div",Y,[u(S,{"result-lists":l(n),"is-all-tasks-completed":l(t),onRetry:d},null,8,["result-lists","is-all-tasks-completed"])])]),_:1})]))}});export{V as _};
