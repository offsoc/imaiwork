import{d as y,r as c,G as V,aF as x,bz as b,k as h,l as C,q as p,s as I,m as L,Z as d}from"./entry.d9d53b29.js";import{p as N,q as Y,r as q,s as A}from"./drawing.7058a163.js";import B from"./useCreateForm.dcfd1ba7.js";import{ModelEnum as u,GenerateVideoTypeEnum as f}from"./index.fb0aa6a9.js";import v from"./useDrawingTask.6ee58e89.js";import F from"./result-content.ff67a2a6.js";import{E as G}from"./index.050c9b6b.js";const M={class:"h-full relative w-full"},R={class:"px-[10px]"},J=y({__name:"index",setup(H){const{onEvent:_,setFormData:g}=B(),m=c([]),i=c(!1);_("update:formData",async s=>{if(i.value){V.msgWarning("请等待上一次任务完成");return}i.value=!0;const{type:t,type_name:T,model:l,model_name:k,aspect_ratio:D,params:o}=s,e=x({date:b().format("YYYY-MM-DD HH:mm"),prompt:o.prompt,video:[],tags:[T,D,k],formData:s});m.value.unshift(e);try{if(l==u.GENERAL){e.video=[{url:"",loading:!0,progress:0,status:0,error:!1}];const{data:a,request_id:r}=t==f.TXT2VIDEO?await N(o):await Y(o),{processDrawingTask:n}=v({type:t,model:l,task_id:(a==null?void 0:a.task_id)||r,dataLists:e.video,drawType:"video"});await n({callback:E=>{e.video=E}})}else if(l==u.SEEDANCE){e.video=[{url:"",loading:!0,progress:0,status:0,error:!1}];const{task_id:a}=t==f.TXT2VIDEO?await q(o):await A(o),{processDrawingTask:r}=v({type:t,model:l,task_id:a,dataLists:e.video,drawType:"video"});await r({callback:n=>{e.video=n}})}}catch{e.video=e.video.map(r=>({...r,loading:!1,progress:0,status:4,error:!0}))}finally{i.value=!1}});const w=s=>{g(s)};return(s,t)=>(h(),C("div",M,[p(d(G),null,{default:I(()=>[L("div",R,[p(F,{type:"video","result-lists":d(m),"is-all-tasks-completed":d(i),onRetry:w},null,8,["result-lists","is-all-tasks-completed"])])]),_:1})]))}});export{J as _};
