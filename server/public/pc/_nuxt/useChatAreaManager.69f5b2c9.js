import{E as m}from"./agent.a3fcedc5.js";import{C as E}from"./ChatArea.5f15f9fe.js";import{r as u,aH as T}from"./entry.46557796.js";function C(r){const l=u(null);let e=null;const s=u(null),o=u([]),i=(t,n="@")=>{var a;return(a=s.value)!=null&&a.name?t.replace(`${n}${s.value.name} `,""):t},p=async()=>new Promise(t=>{if(!l.value||e){t(!1);return}e=new E({elm:l.value,autoFocus:!0,needCallSpace:!0,placeholder:"发送消息、输入 @ 选择智能体",needCallEvery:!1,userList:o.value}),e.addEventListener("afterAtCheck",n=>{var d;(d=s.value)!=null&&d.id&&s.value.id!==n[0].id&&e.delUserTags([s.value.id]),s.value=n[0];const a=i(e.getText());r.onInputChange(a,e.isEmpty())}),e.addEventListener("operate",()=>{const n=e.isEmpty();n&&(s.value=null);const a=i(e.getText());r.onInputChange(a,n)}),e.addEventListener("defaultAction",n=>{n==="CUT"&&(s.value=null,r.onInputChange("",!0))}),e.richText.addEventListener("keydown",n=>{n.key==="Enter"&&!n.shiftKey&&(e.chatElement.pcElms.pointDialogElm.classList.contains("chat-view-show")||(n.preventDefault(),r.onEnter(c())))}),t(!0)}),f=()=>{e==null||e.clear(),g()&&e.setUserTag(s.value)},v=()=>{e==null||e.dispose(),e=null},c=()=>{const t=(e==null?void 0:e.getText())??"";return s.value?i(t):t},g=()=>{var t;return!!((t=s.value)!=null&&t.id)};return{chatAreaRef:l,agent:s,setup:p,clear:f,dispose:v,getText:c,getAgentList:async()=>{try{const{lists:t}=await m({page_size:1500});o.value=t.map(n=>({name:n.name,id:n.id}))}catch(t){console.error("获取智能体列表失败:",t)}},isAgent:g,setAgent:async t=>{await T(),s.value=t,e.setUserTag(t)}}}export{C as useChatAreaManager};
