import{E as K,a as P}from"./index.4d719c96.js";import{d as A,r as k,aF as D,c as G,cx as J,bb as Q,k as d,I as g,s,q as a,Z as l,l as y,K as z,J as x,m,t as B,aI as L,L as Z,ay as j,cV as H,G as h,av as M,au as W,y as X,ba as Y}from"./entry.2beb4577.js";import{E as ee}from"./el-slider.bc047fea.js";/* empty css                  *//* empty css               *//* empty css                     */import"./el-input-number.7f732a46.js";import{u as le}from"./useDictOptions.8db81bce.js";import{k as oe,a as ae,b as te}from"./knowledge_base.519704cc.js";import{p as se}from"./common.1373bb04.js";const ne={class:"font-bold"},re={class:"absolute -top-[33px] left-[90px]"},ie={class:"absolute top-0 right-0 cursor-pointer"},xe=A({__name:"index",emits:["close","success"],setup(ue,{expose:C,emit:I}){const V=I,_=k(null),o=D({id:"",category_id:"",strategy:1,separator:"",chunk_size:600,overlap_size:100,rerank_min_score:.5}),U=D({id:[{required:!0,message:"请选择知识库",trigger:"blur"}],separator:[{required:!0,message:"请选择切割符号",trigger:"blur"}]}),E=k(null),{optionsData:F}=le({knbLists:{api:oe,params:{page_size:25e3},transformData:n=>n.lists}}),S=G(()=>F.knbLists.find(n=>n.index_id===o.id)),R=async()=>{var u,r;await((u=E.value)==null?void 0:u.validate());const{type:n,fileName:t,content:i}=w.value;if(n==="txt"){const b=new TextEncoder().encode(i),v=new File([b],`${t}.txt`,{type:"text/plain;charset=utf-8"}),c=new FormData;c.append("file",v),c.append("indexid",o.id);try{const p=await ae(c),{id:e,category_id:T}=S.value;await te({...o,id:e,category_id:T,documents:[p]}),h.msgSuccess("操作成功"),(r=_.value)==null||r.close(),V("success")}catch(p){h.msgError(p||"操作失败")}}},{lockFn:N,isLock:O}=J(R),$=()=>{var n;(n=_.value)==null||n.open()},q=()=>{V("close")},w=k(null);return C({open:$,setFormData:n=>{w.value=n}}),(n,t)=>{const i=K,u=P,r=M,f=W,b=ee,v=X,c=Y,p=Q("number-input");return d(),g(H,{ref_key:"popupRef",ref:_,title:"选择要关联的知识库",async:"",width:"500px","confirm-loading":l(O),onClose:q,onConfirm:l(N)},{default:s(()=>[a(l(j),{model:l(o),"label-position":"top",rules:l(U),ref_key:"formRef",ref:E},{default:s(()=>[a(r,{label:"知识库",prop:"id"},{default:s(()=>[a(u,{modelValue:l(o).id,"onUpdate:modelValue":t[0]||(t[0]=e=>l(o).id=e),placeholder:"请选择知识库",filterable:"",clearable:""},{default:s(()=>[(d(!0),y(x,null,z(l(F).knbLists,e=>(d(),g(i,{key:e.index_id,label:e.name,value:e.index_id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(r,{label:"切割策略",prop:"strategy"},{default:s(()=>[a(u,{modelValue:l(o).strategy,"onUpdate:modelValue":t[1]||(t[1]=e=>l(o).strategy=e),placeholder:"请选择切割策略"},{default:s(()=>[a(i,{label:"智能切分",value:1}),a(i,{label:"自定义切分",value:2})]),_:1},8,["modelValue"])]),_:1}),l(o).strategy===2?(d(),y(x,{key:0},[a(r,{label:"切割符号",prop:"separator"},{default:s(()=>[a(u,{modelValue:l(o).separator,"onUpdate:modelValue":t[2]||(t[2]=e=>l(o).separator=e),placeholder:"请选择切割符号",multiple:""},{default:s(()=>[(d(!0),y(x,null,z(l(se),e=>(d(),g(i,{key:e.value,label:`${e.label}：${e.value}`,value:e.value},{default:s(()=>[m("span",null,B(e.label)+"：",1),m("span",ne,B(e.value),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(r,{label:"切割长度",prop:"chunk_size"},{default:s(()=>[L(a(f,{modelValue:l(o).chunk_size,"onUpdate:modelValue":t[3]||(t[3]=e=>l(o).chunk_size=e),type:"number",placeholder:"请输入切割长度"},null,8,["modelValue"]),[[p,{decimalPlaces:0,max:1024}]])]),_:1}),a(r,{label:"切割重叠度",prop:"overlap_size"},{default:s(()=>[L(a(f,{modelValue:l(o).overlap_size,"onUpdate:modelValue":t[4]||(t[4]=e=>l(o).overlap_size=e),type:"number",placeholder:"请输入切割重叠度"},null,8,["modelValue"]),[[p,{decimalPlaces:0,min:1,max:2048}]])]),_:1}),a(r,{label:"相似度阈值",prop:"rerank_min_score"},{default:s(()=>[a(b,{modelValue:l(o).rerank_min_score,"onUpdate:modelValue":t[5]||(t[5]=e=>l(o).rerank_min_score=e),min:0,max:1,step:.01,size:"small","show-input":""},null,8,["modelValue"]),m("div",re,[a(c,{"popper-class":"w-[200px]"},{content:s(()=>[...t[6]||(t[6]=[m("div",null," 设定最低分数标准，只有达到或超过这个阈值的检索结果才会被考虑用于后续的排序和生成过程 ",-1)])]),default:s(()=>[m("div",ie,[a(v,{name:"el-icon-QuestionFilled",color:"#858585"})])]),_:1})])]),_:1})],64)):Z("",!0)]),_:1},8,["model","rules"])]),_:1},8,["confirm-loading","onConfirm"])}}});export{xe as _};
