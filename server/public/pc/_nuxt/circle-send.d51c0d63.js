import{d as de,c as x,A as pe,aF as ue,r as V,cq as _e,k as r,l as d,m as t,q as i,s as c,J as _,K as M,v as y,t as ve,Z as v,I as f,a0 as b,L as u,bz as R,aH as fe,G as P,au as ge,y as ke,av as ye,cS as he,cT as xe,ay as be,ax as we,u as Ee,_ as Ie}from"./entry.d7219633.js";import{E as Ve}from"./index.1f8dde63.js";import{_ as Me}from"./index.55703cf7.js";import{E as Re}from"./el-image.37ed17f2.js";import{E as Ce}from"./el-date-picker.fe7cdba3.js";import{E as Ae,a as De}from"./index.50778a9c.js";import{E as Ne}from"./index.f15af271.js";/* empty css                   */import"./el-image-viewer.960ba8e6.js";/* empty css                     *//* empty css                  *//* empty css               */import{N as Oe}from"./person_wechat.8bcf26fc.js";import{MaterialTypeEnum as s}from"./index.cf59f1a8.js";import{_ as Le}from"./emoji.vue.e454bd86.js";import{_ as Ge}from"./link-card.vue.5b27e20b.js";import{_ as Pe}from"./mini-program-card.vue.dd66cb8d.js";import{_ as Se}from"./material-picker.vue.2a46b32f.js";import ze from"./useGlobalSettings.c6e3d41d.js";import{s as Fe}from"./dom.7f5b5a10.js";import"./index.3adcf74a.js";import"./index.9efd0300.js";import"./cloneDeep.1f319c9b.js";/* empty css                  *//* empty css                    *//* empty css                  */import"./position.cb246d7d.js";import"./customParseFormat.76f0695f.js";import"./panel-time-pick.8be972f9.js";import"./index.2311001e.js";import"./debounce.085e8a4a.js";import"./index.ead96a32.js";import"./index.4953ba77.js";import"./strings.03d3529c.js";import"./_baseIteratee.5c97421a.js";import"./throttle.70466628.js";import"./useHandle.2b5b26f8.js";import"./index.vue.d7039e6a.js";import"./sidebar.31e3d91b.js";import"./useMaterial.a92b4ad4.js";import"./usePaging.3c53b51c.js";import"./container.ddfb785b.js";import"./el-empty.77af023a.js";import"./index.vue.5e2341cc.js";import"./upload.5cfd2344.js";import"./preview.vue.f85b38ac.js";import"./index.vue.c82b4b26.js";import"./file-card.vue.7b9fc004.js";import"./useDictOptions.2e009744.js";const Be={class:"h-full bg-white w-full overflow-hidden flex flex-col"},Te={class:"grow min-h-0"},Ke={class:"px-6 py-3 flex flex-col"},$e={class:"w-full"},Ue={class:"mt-4 relative"},je={class:"absolute bottom-1 left-2 flex items-center gap-x-2"},qe={class:"rounded-lg hover:bg-token-sidebar-surface-secondary p-2 cursor-pointer"},Ye={class:"w-full"},He={class:"mt-4"},We={class:"mt-4"},Je={class:"flex mb-4"},Xe={class:"upload-select"},Ze={class:"text-[#999999]"},Qe={class:"grid grid-cols-6 gap-5"},et=["onClick"],tt={class:"upload-select"},lt=["src"],at={class:"text-[#999999]"},ot={key:1,class:"p-2 bg-primary-light-7 h-full w-full rounded-lg relative"},st={class:"w-full"},it={class:"mt-4"},nt={class:"w-full"},rt={class:"mt-4"},ct={class:"w-full"},mt={class:"mt-4"},dt={key:0,class:"my-4 flex justify-center"},pt=de({__name:"circle-send",props:{modelValue:{},isShowWeChat:{type:Boolean,default:!0}},emits:["update:modelValue","success"],setup(S,{expose:z,emit:F}){const B=S,C=F,T=Ee(),l=x({get:()=>B.modelValue,set:a=>C("update:modelValue",a)}),A=pe(),K={content:[{required:!0,message:"请输入朋友圈基础文本内容"}],send_time:[{required:!0,message:"请选择朋友圈发送时间"},{validator:(a,e,m)=>{e&&R(e).isBefore(R())?m(new Error("发送时间不能小于当前时间")):m()}}],wechat_ids:[{required:!0,message:"请选择发送账号"}]},o=ue({image:[],video:"",link:{},mini_program:{}}),w=V(),$=({emoji:a})=>{var e;(e=w.value)!=null&&e.textarea&&(l.value.content=Fe(w.value.textarea,a))},U=[{label:"附加图片",value:s.IMAGE,disabled:!1},{label:"附加视频",value:s.VIDEO,disabled:!1},{label:"附加链接",value:s.LINK,disabled:!1},{label:"附加小程序",value:s.MINI_PROGRAM,disabled:!1}],g=x(()=>9-o.image.length),j=x(()=>{const{attachment_type:a}=l.value;return[s.LINK,s.MINI_PROGRAM].includes(a)}),q=x(()=>{const{attachment_type:a}=l.value;return a===s.LINK?!!o.link.title:!!o.mini_program.title}),Y=a=>a.getTime()<R().startOf("day").valueOf(),D=a=>{const{uri:e}=a.data,{attachment_type:m}=l.value;switch(m){case s.IMAGE:g.value>0&&o.image.push(e);break;case s.VIDEO:o.video=e;break}},H=a=>{T.$confirm({message:"确定删除该图片吗？",onConfirm:()=>{o.image.splice(a,1)}})},W=()=>{o.video=""},J=()=>{l.value.attachment_type===s.LINK?o.link={}:o.mini_program={}},h=V(!1),N=V(),E=async()=>{var a;l.value.id||(h.value=!0,await fe(),(a=N.value)==null||a.open())},X=a=>{const{attachment_type:e}=l.value;switch(e){case s.IMAGE:if(g.value>0){const m=a.splice(0,g.value);o.image.push(...m.map(p=>p.file_url))}break;case s.VIDEO:o.video=a.file_url;break;case s.LINK:o.link={title:a.file_name,desc:a.ext_info.link_desc,link:a.ext_info.link,pic:a.file_url};break;case s.MINI_PROGRAM:o.mini_program={title:a.file_name,pic:a.file_url,link:a.ext_info.mini_program_path,appid:a.ext_info.mini_program_appid};break}h.value=!1},{optionsData:Z}=ze(),Q=()=>{const{attachment_type:a}=l.value;switch(a){case s.IMAGE:return o.image;case s.VIDEO:return o.video;case s.LINK:return o.link;case s.MINI_PROGRAM:return o.mini_program;default:return null}},ee=async()=>{var a;await((a=A.value)==null?void 0:a.validate());try{l.value.attachment_content=Q(),l.value.attachment_content||(l.value.attachment_type=s.TEXT),l.value.task_type===0&&(l.value.send_time=""),await Oe(l.value),P.msgSuccess("创建成功"),close(),C("success")}catch(e){P.msgError(e)}},{lockFn:te,isLock:le}=_e(ee);return z({setAssetData:a=>{const{attachment_type:e,attachment_content:m}=a;e==s.IMAGE?o.image=m:e==s.VIDEO?o.video=m:e==s.LINK?o.link=m:e==s.MINI_PROGRAM&&(o.mini_program=m)}}),(a,e)=>{const m=ge,p=ke,ae=Ve,k=ye,I=he,O=xe,L=Me,oe=Re,se=Ce,ie=Ae,ne=De,re=be,ce=Ne,me=we;return r(),d(_,null,[t("div",Be,[e[19]||(e[19]=t("div",{class:"bg-primary h-[48px] flex items-center justify-center font-bold text-white text-xl flex-shrink-0"}," 发送朋友圈 ",-1)),t("div",Te,[i(ce,null,{default:c(()=>[i(re,{ref_key:"formRef",ref:A,model:l.value,rules:l.value.id?{}:K,"label-width":"0",disabled:!!l.value.id},{default:c(()=>[t("div",Ke,[i(k,{prop:"content"},{default:c(()=>[t("div",$e,[e[7]||(e[7]=t("div",{class:"flex items-center gap-x-3"},[t("div",{class:"bg-primary h-[14px] w-[4px]"}),t("div",{class:"text-lg"},"朋友圈基础文本内容")],-1)),t("div",Ue,[i(m,{ref_key:"contentRef",ref:w,modelValue:l.value.content,"onUpdate:modelValue":e[0]||(e[0]=n=>l.value.content=n),type:"textarea",resize:"none",placeholder:"点击输入您要发送的文本内容",autosize:{minRows:6,maxRows:15},maxlength:"300"},null,8,["modelValue"]),t("div",je,[i(ae,{placement:"bottom",width:"466",trigger:"click","show-arrow":!1,"popper-style":{padding:0}},{reference:c(()=>[t("div",qe,[i(p,{name:"local-icon-phiz",size:24})])]),default:c(()=>[i(Le,{onChooseEmoji:$})]),_:1})])])])]),_:1}),i(k,{prop:"attachment_content"},{default:c(()=>[t("div",Ye,[e[13]||(e[13]=t("div",{class:"flex items-center gap-x-3"},[t("div",{class:"bg-primary h-[14px] w-[4px]"}),t("div",{class:"text-lg"},"朋友圈附加内容")],-1)),t("div",He,[i(O,{modelValue:l.value.attachment_type,"onUpdate:modelValue":e[1]||(e[1]=n=>l.value.attachment_type=n)},{default:c(()=>[(r(),d(_,null,M(U,n=>i(I,{key:n.value,value:n.value,disabled:n.disabled},{default:c(()=>[y(ve(n.label),1)]),_:2},1032,["value","disabled"])),64))]),_:1},8,["modelValue"])]),t("div",We,[l.value.attachment_type===v(s).IMAGE?(r(),d(_,{key:0},[t("div",Je,[g.value>0?(r(),f(L,{key:0,class:"img-upload",limit:g.value,"show-file-list":!1,"show-progress":"",onSuccess:D},{default:c(()=>[t("div",Xe,[i(p,{name:"local-icon-image_add",color:"#999999",size:40}),e[9]||(e[9]=t("span",{class:"text-[#999999] mt-2"},"点击上传图片",-1)),t("span",Ze,[e[8]||(e[8]=y(" 或",-1)),t("a",{onClick:b(E,["stop"]),class:"text-primary"},"从素材库选择")])])]),_:1},8,["limit"])):u("",!0)]),t("div",Qe,[(r(!0),d(_,null,M(o.image,(n,G)=>(r(),d("div",{key:G,class:"w-[64px] h-[64px] bg-[#F7F7F7] rounded-lg p-1 relative"},[i(oe,{src:n,"preview-src-list":[n],"preview-teleported":"",class:"h-full rounded-lg w-full object-cover"},null,8,["src","preview-src-list"]),l.value.id?u("",!0):(r(),d("div",{key:0,class:"absolute -top-2 -right-2 cursor-pointer",onClick:ut=>H(G)},[i(p,{name:"local-icon-close_circle_fill",size:20,color:"#D43030"})],8,et))]))),128))])],64)):u("",!0),l.value.attachment_type===v(s).VIDEO?(r(),f(L,{key:1,type:"video",limit:1,"show-file-list":!1,"show-progress":"",onSuccess:D},{default:c(()=>[t("div",tt,[o.video?(r(),d(_,{key:0},[t("div",{class:"absolute -top-2.5 -right-2.5 cursor-pointer",onClick:b(W,["stop"])},[i(p,{name:"local-icon-close_circle_fill",size:20,color:"#D43030"})]),t("video",{src:o.video,class:"w-full h-full"},null,8,lt)],64)):(r(),d(_,{key:1},[i(p,{name:"local-icon-video_add",color:"#999999",size:40}),e[11]||(e[11]=t("span",{class:"text-[#999999] mt-2"},"点击上传视频",-1)),t("span",at,[e[10]||(e[10]=y(" 或",-1)),t("a",{onClick:b(E,["stop"]),class:"text-primary"},"从素材库选择")])],64))])]),_:1})):u("",!0),j.value?(r(),d("div",{key:2,class:"upload-select cursor-pointer",onClick:E},[q.value?(r(),d("div",ot,[l.value.attachment_type===v(s).LINK?(r(),f(Ge,{key:0,title:o.link.title,img:o.link.pic,desc:o.link.desc},null,8,["title","img","desc"])):l.value.attachment_type===v(s).MINI_PROGRAM?(r(),f(Pe,{key:1,title:o.mini_program.title,pic:o.mini_program.pic,link:o.mini_program.link},null,8,["title","pic","link"])):u("",!0),t("div",{class:"absolute -top-2 -right-2 cursor-pointer",onClick:b(J,["stop"])},[i(p,{name:"local-icon-close_circle_fill",size:20,color:"#D43030"})])])):(r(),d(_,{key:0},[i(p,{name:"local-icon-file2",color:"#999999",size:32}),e[12]||(e[12]=t("a",{class:"text-primary mt-3"},"点击从素材库选择",-1))],64))])):u("",!0)])])]),_:1}),i(k,{prop:"comment"},{default:c(()=>[t("div",st,[e[14]||(e[14]=t("div",{class:"flex items-center gap-x-3"},[t("div",{class:"bg-primary h-[14px] w-[4px]"}),t("div",{class:"text-lg"},"朋友圈附加评论")],-1)),t("div",it,[i(m,{modelValue:l.value.comment,"onUpdate:modelValue":e[2]||(e[2]=n=>l.value.comment=n),type:"textarea",placeholder:"点击输入您需要附加的评论，多个评论之间用##隔开",resize:"none",rows:4},null,8,["modelValue"])])])]),_:1}),t("div",nt,[e[16]||(e[16]=t("div",{class:"flex items-center gap-x-3"},[t("div",{class:"bg-primary h-[14px] w-[4px]"}),t("div",{class:"text-lg"},"朋友圈发送策略")],-1)),t("div",rt,[i(k,{prop:l.value.task_type===1?"send_time":""},{default:c(()=>[i(O,{modelValue:l.value.task_type,"onUpdate:modelValue":e[4]||(e[4]=n=>l.value.task_type=n)},{default:c(()=>[i(I,{value:0},{default:c(()=>e[15]||(e[15]=[y("立即发送",-1)])),_:1,__:[15]}),i(I,{value:1},{default:c(()=>[i(se,{modelValue:l.value.send_time,"onUpdate:modelValue":e[3]||(e[3]=n=>l.value.send_time=n),type:"datetime",disabled:l.value.task_type===0,"disabled-date":Y,"value-format":"YYYY-MM-DD HH:mm:ss",placeholder:"选择发送时间"},null,8,["modelValue","disabled"])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["prop"])])]),a.isShowWeChat?(r(),f(k,{key:0,prop:"wechat_ids"},{default:c(()=>[t("div",ct,[e[17]||(e[17]=t("div",{class:"flex items-center gap-x-3"},[t("div",{class:"bg-primary h-[14px] w-[4px]"}),t("div",{class:"text-lg"},"请选择发送账号")],-1)),t("div",mt,[i(ne,{modelValue:l.value.wechat_ids,"onUpdate:modelValue":e[5]||(e[5]=n=>l.value.wechat_ids=n),multiple:"",filterable:"",clearable:""},{default:c(()=>[(r(!0),d(_,null,M(v(Z).wechatLists,n=>(r(),f(ie,{key:n.wechat_id,value:n.wechat_id,label:n.wechat_nickname},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])])]),_:1})):u("",!0)])]),_:1},8,["model","rules","disabled"])]),_:1})]),l.value.id?u("",!0):(r(),d("div",dt,[i(me,{type:"primary",loading:v(le),onClick:v(te)},{default:c(()=>e[18]||(e[18]=[y("立即创建",-1)])),_:1,__:[18]},8,["loading","onClick"])]))]),h.value?(r(),f(Se,{key:0,ref_key:"materialPickerRef",ref:N,mode:"page",limit:l.value.attachment_type===v(s).IMAGE?g.value:1,type:l.value.attachment_type,onClose:e[6]||(e[6]=n=>h.value=!1),onSelect:X},null,8,["limit","type"])):u("",!0)],64)}}});const cl=Ie(pt,[["__scopeId","data-v-df4b2ee9"]]);export{cl as default};
