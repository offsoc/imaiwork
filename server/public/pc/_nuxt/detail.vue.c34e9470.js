import{d as N,A as L,aF as z,k as c,l as g,q as t,s as l,H as S,m as o,Z as e,v as m,t as d,I as O,L as G,cP as Q,G as V,av as H,cT as J,cU as Z,au as W,ay as X,ef as Y,r as ee,o as te,J as B,K as U,aI as ae,bK as oe,y as se,ax as le,cQ as ne}from"./entry.46557796.js";import{E as re,a as pe}from"./index.5f8d7d98.js";import{E as ie}from"./el-empty.db5857ba.js";import{_ as de}from"./index.vue.383c1815.js";/* empty css                        *//* empty css               *//* empty css                 *//* empty css                     */import{u as fe}from"./usePaging.3ef28349.js";import{a as F,b as ue}from"./sph.47a77ad4.js";const _e={class:"export-data"},me={class:"flex"},ce=N({__name:"index",props:{params:{type:Object,default:()=>({})},pageSize:{type:Number,default:25},fetchFun:{type:Function,required:!0},exportFun:{type:Function,default:()=>{}}},setup(C){const y=L(),u=C,x=L(),a=z({page_type:0,page_start:1,page_end:200,file_name:"",status:""}),b={page_start:[{required:!0,message:"请输入起始页码"},{type:"number",message:"页码必须是整数"},{validator:(f,n,s)=>{if(n<=0)return s(new Error("页码必须大于0"));s()}}],page_end:[{required:!0,message:"请输入结束页码"},{type:"number",message:"页码必须是整数"},{validator:(f,n,s)=>{if(n<=0)return s(new Error("页码必须大于0"));s()}}]},_=z({count:0,sum_page:0,page_size:0,max_page:0,all_max_size:0}),v=async()=>{const f=await u.fetchFun({...u.params,page_size:u.pageSize,export:1});Object.assign(_,f),a.file_name=f.file_name,a.page_end=f.page_end,a.page_start=f.page_start},h=async()=>{var f,n;await((f=y.value)==null?void 0:f.validate()),V.loading("正在导出中...");try{const s=u.exportFun?await u.exportFun({...u.params,...a,page_size:u.pageSize,export:2}):await u.fetchFun({...u.params,...a,page_size:u.pageSize,export:2});(n=x.value)==null||n.close(),V.closeLoading(),s!=null&&s.url&&window.open(s.url)}catch{V.closeLoading()}};return(f,n)=>{const s=H,r=J,E=Z,w=W,k=X;return c(),g("div",_e,[t(Q,{ref_key:"popupRef",ref:x,title:"导出设置",width:"500px","confirm-button-text":"确认导出",async:!0,onOpen:v,onConfirm:h},{trigger:l(()=>[S(f.$slots,"trigger")]),default:l(()=>[o("div",null,[t(k,{ref_key:"formRef",ref:y,model:e(a),"label-width":"120px",rule:b},{default:l(()=>[t(s,{label:"数据量："},{default:l(()=>[m(" 预计导出"+d(e(_).count)+"条数据， 共"+d(e(_).sum_page)+"页，每页"+d(e(_).page_size)+"条数据 ",1)]),_:1}),t(s,{label:"导出限制："},{default:l(()=>[m(" 每次导出最大允许"+d(e(_).max_page)+"页，共"+d(e(_).all_max_size)+"条数据 ",1)]),_:1}),t(s,{prop:"page_type",label:"导出范围：",required:""},{default:l(()=>[t(E,{modelValue:e(a).page_type,"onUpdate:modelValue":n[0]||(n[0]=i=>e(a).page_type=i)},{default:l(()=>[t(r,{label:0},{default:l(()=>n[4]||(n[4]=[m("全部导出",-1)])),_:1,__:[4]}),t(r,{label:1},{default:l(()=>n[5]||(n[5]=[m("分页导出",-1)])),_:1,__:[5]})]),_:1},8,["modelValue"])]),_:1}),e(a).page_type==1?(c(),O(s,{key:0,label:"分页范围："},{default:l(()=>[o("div",me,[t(s,{prop:"page_start"},{default:l(()=>[t(w,{style:{width:"140px"},modelValue:e(a).page_start,"onUpdate:modelValue":n[1]||(n[1]=i=>e(a).page_start=i),modelModifiers:{number:!0},placeholder:""},null,8,["modelValue"])]),_:1}),n[6]||(n[6]=o("span",{class:"flex-none ml-2 mr-2"},"页，至",-1)),t(s,{prop:"page_end"},{default:l(()=>[t(w,{style:{width:"140px"},modelValue:e(a).page_end,"onUpdate:modelValue":n[2]||(n[2]=i=>e(a).page_end=i),modelModifiers:{number:!0},placeholder:""},null,8,["modelValue"])]),_:1})])]),_:1})):G("",!0),S(f.$slots,"form-item",{formData:e(a)}),t(s,{label:"导出文件名称：",prop:"file_name"},{default:l(()=>[t(w,{modelValue:e(a).file_name,"onUpdate:modelValue":n[3]||(n[3]=i=>e(a).file_name=i),placeholder:"请输入导出文件名称"},null,8,["modelValue"])]),_:1})]),_:3},8,["model"])])]),_:3},512)])}}}),ge={class:"h-full flex flex-col gap-[10px]"},xe={class:"bg-app-bg-2 rounded-[20px] p-[18px] flex justify-between gap-x-4"},we={class:"flex flex-col gap-y-3"},ye={class:"flex"},be={class:"flex flex-wrap gap-2"},ve={class:"flex"},he={class:"flex flex-wrap gap-2"},Ee={class:"text-[#ffffffcc]"},ke={class:"text-[#ffffffcc]"},Ve={class:"grow min-h-0 bg-app-bg-2 rounded-[20px] flex flex-col"},Fe={class:"flex-shrink-0 flex items-center justify-between px-[14px] h-[88px] border-b border-[#ffffff1a]"},ze={key:0,class:"flex items-center gap-1"},Ce={class:"grow min-h-0"},Re={class:"flex justify-center items-center h-full"},Te={class:"flex justify-center p-4"},Oe=N({__name:"detail",emits:["back"],setup(C,{emit:y}){const u=y,x=Y(),a=ee({}),b=z({task_id:x.id}),{pager:_,getLists:v}=fe({fetchFun:F,params:b}),h=s=>({1:"线索有效",2:"线索无效",3:"内含有效线索"})[s],f=async()=>{const s=await ue({id:x.id});a.value=s};return te(async()=>{await f(),await v()}),(s,r)=>{var R,T,D,$,j,q,I;const E=se,w=le,k=ce,i=re,M=ie,P=pe,A=de,K=ne;return c(),g("div",ge,[o("div",xe,[o("div",we,[o("div",ye,[r[2]||(r[2]=o("span",{class:"text-[#ffffff80] flex-shrink-0"},"执行设备：",-1)),o("span",be,[(c(!0),g(B,null,U((R=e(a))==null?void 0:R.device_codes,p=>(c(),g("span",{class:"px-[10px] py-[4px] rounded-md text-[#ffffffcc] shadow-[0_0_0_1px_var(--app-border-color-2)]",key:p},d(p),1))),128))])]),o("div",ve,[r[3]||(r[3]=o("span",{class:"text-[#ffffff80] flex-shrink-0"},"线索词：",-1)),o("span",he,[(c(!0),g(B,null,U((T=e(a))==null?void 0:T.keywords,p=>(c(),g("span",{class:"px-[10px] py-[4px] rounded-md text-[#ffffffcc] text-[11px] shadow-[0_0_0_1px_var(--app-border-color-2)]",key:p},d(p),1))),128))])]),o("div",null,[r[4]||(r[4]=o("span",{class:"text-[#ffffff80]"},"关键词执行数量：",-1)),o("span",Ee,d(((D=e(a))==null?void 0:D.number_of_implemented_keywords)||0)+" / "+d((($=e(a))==null?void 0:$.implementation_keywords_number)||0),1)]),o("div",null,[r[5]||(r[5]=o("span",{class:"text-[#ffffff80]"},"已获客数量：",-1)),o("span",ke,d(((j=e(a))==null?void 0:j.crawl_number)||0),1)])]),r[6]||(r[6]=o("div",null,null,-1))]),o("div",Ve,[o("div",Fe,[o("div",{class:"flex items-center gap-2 cursor-pointer",onClick:r[0]||(r[0]=p=>u("back"))},[t(E,{name:"el-icon-ArrowLeft",color:"#ffffff"}),r[7]||(r[7]=o("div",{class:"text-white"},"返回",-1))]),((q=e(a))==null?void 0:q.status)==3||((I=e(a))==null?void 0:I.status)==4?(c(),g("div",ze,[t(k,{params:e(b),"fetch-fun":e(F),"export-fun":e(F)},{trigger:l(()=>[t(w,{type:"primary",class:"!rounded-full !h-10 w-[98px]"},{default:l(()=>r[8]||(r[8]=[m("导出",-1)])),_:1,__:[8]})]),_:1},8,["params","fetch-fun","export-fun"])])):G("",!0)]),o("div",Ce,[ae((c(),O(P,{height:"100%",data:e(_).lists,"header-row-style":{height:"62px"},"row-style":{height:"50px"}},{empty:l(()=>[o("div",Re,[t(M,{description:"暂无数据"})])]),default:l(()=>[t(i,{prop:"username",label:"用户名称","min-width":"120","show-overflow-tooltip":""},{default:l(({row:p})=>[m(d(p.username||"-"),1)]),_:1}),t(i,{prop:"name",label:"线索词","min-width":"120"},{default:l(({row:p})=>[m(d(p.exec_keyword||"-"),1)]),_:1}),t(i,{prop:"address",label:"地区","min-width":"80"},{default:l(({row:p})=>[m(d(p.address||"-"),1)]),_:1}),t(i,{prop:"crawl_content",label:"获取内容","min-width":"200","show-overflow-tooltip":""},{default:l(({row:p})=>[m(d(p.crawl_content||"-"),1)]),_:1}),t(i,{prop:"device_code",label:"执行设备",width:"180"}),t(i,{prop:"reg_content",label:"提取内容","min-width":"200","show-overflow-tooltip":""},{default:l(({row:p})=>[m(d(p.reg_content||"-"),1)]),_:1}),t(i,{prop:"clue_type_name",label:"线索类型",width:"100"}),t(i,{label:"线索检验",width:"100"},{default:l(({row:p})=>[m(d(h(p.status)),1)]),_:1}),t(i,{prop:"tokens",label:"算力消耗","min-width":"80"}),t(i,{prop:"create_time",label:"执行时间",width:"180"})]),_:1},8,["data"])),[[K,e(_).loading]])]),o("div",Te,[t(A,{modelValue:e(_),"onUpdate:modelValue":r[1]||(r[1]=p=>oe(_)?_.value=p:null),layout:"prev, pager, next",onChange:e(v)},null,8,["modelValue","onChange"])])])])}}});export{Oe as _,ce as a};
