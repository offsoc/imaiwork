import{g as M,E as D}from"./index.e8be04c0.js";import{E as K}from"./index.a9d48d33.js";import{d as q,z as O,A as G,c as m,r as x,k as g,l as _,q as F,s as U,H,Z as d,bM as w,I as J,m as h,J as W,K as Z,t as Q,L as X,B as Y,C as ee,E as te,G as f,R as le,F as ae,M as se,_ as oe}from"./entry.2beb4577.js";/* empty css                  *//* empty css                    */import"./cloneDeep.a23e4277.js";const re={class:"kn-upload w-full h-full"},ie={class:"file-list p-4"},ne={class:"flex-1"},de=q({__name:"upload-file",props:{type:{type:String,default:"image"},modelValue:{type:[Array,Object],default:()=>[]},accept:{type:String},multiple:{type:Boolean,default:!1},limit:{type:Number,default:1},data:{type:Object,default:()=>({})},disabled:{type:Boolean,default:!1},listType:{type:String,default:"text"},returnType:{type:String,default:"array"},showFileList:{type:Boolean,default:!0},showProgress:{type:Boolean,default:!1},size:{type:Number,default:10},drag:{type:Boolean,default:!1}},emits:["update:modelValue","on-progress"],setup(r,{expose:L,emit:V}){const u=r,v=V,C=O(),i=G(),R=m(()=>`${Y()}${ee()}/knowledge/fileUpload`),T=m(()=>({token:C.token,version:te()})),$=m(()=>({...u.data})),a=x([]),y=m(()=>u.returnType==="object"||!u.limit?1:u.limit),c=x(!1),z=()=>{var e;(e=i.value)==null||e.clearFiles(),c.value=!1},b=e=>{const l=t=>{var o,n,s,p,S,E,B,k;return{name:t.name||((n=(o=t.response)==null?void 0:o.data)==null?void 0:n.name),id:t.id||((s=t.response)==null?void 0:s.data.id),index_id:t.index_id,file_id:t.file_id||((S=(p=t.response)==null?void 0:p.data)==null?void 0:S.file_id),file_url:t.file_url||((B=(E=t.response)==null?void 0:E.data)==null?void 0:B.uri),...(k=t.response)==null?void 0:k.data}};if(e){const t=u.returnType==="object"?{}:a.value.filter(o=>o.id!==e.id).map(l);v("update:modelValue",t)}else{const t=u.returnType==="object"?l(a.value[0]):a.value.map(l);v("update:modelValue",t)}},A=e=>{const{size:l}=u,t=e.size/1024/1024,o=l<1?"KB":"MB",n=l<1?l*1e3:l;return e.type.startsWith("image/")&&t>10?(f.msgError("图片只限制10mb以内"),!1):t>l?(f.msgError(`上传文件超过${n}${o}`),!1):!0},I=(e,l,t)=>{t.every(n=>n.status=="success")&&(c.value=!1),e.code==le.SUCCESS?(l.url=e.data.uri,b()):(e.msg&&f.msgError(`上传失败：${e.msg}`),i.value.handleRemove(l))},j=e=>{if(y.value==1){i.value.clearFiles();const l=e[0];l.uid=M(),i.value.handleStart(l),i.value.submit()}else f.msgError(`超出上传上限${y.value}，请重新上传`)},N=(e,l)=>{var t;f.msgError(`${l.name}文件上传失败`),(t=i.value)==null||t.abort(l)},P=(e,l,t)=>{c.value=!0,a.value=ae(t),v("on-progress",{fileList:a.value,percent:e.percent})};return L({setFileList:e=>{Array.isArray(e)?a.value=e:a.value=[e]},clear:()=>{var e;(e=i.value)==null||e.clearFiles(),a.value=[]}}),(e,l)=>{const t=D,o=K,n=se;return g(),_("div",re,[F(t,{"file-list":d(a),"onUpdate:fileList":l[0]||(l[0]=s=>w(a)?a.value=s:null),class:"w-full h-full",ref_key:"uploadRefs",ref:i,accept:r.accept,drag:r.drag,action:d(R),multiple:r.multiple,limit:d(y),disabled:r.disabled,"show-file-list":r.showFileList,"list-type":r.listType,headers:d(T),data:d($),"on-exceed":j,"on-error":N,"on-success":I,"before-upload":A,"on-remove":b,"on-progress":P},{default:U(()=>[H(e.$slots,"default",{},void 0,!0)]),_:3},8,["file-list","accept","drag","action","multiple","limit","disabled","show-file-list","list-type","headers","data"]),r.showProgress&&d(a).length?(g(),J(n,{key:0,modelValue:d(c),"onUpdate:modelValue":l[1]||(l[1]=s=>w(c)?c.value=s:null),title:"上传进度","close-on-click-modal":!1,width:"500px",modal:!1,onClose:z},{default:U(()=>[h("div",ie,[(g(!0),_(W,null,Z(d(a),(s,p)=>(g(),_("div",{key:p,class:"mb-5"},[h("div",null,Q(s.name),1),h("div",ne,[F(o,{percentage:parseInt(s.percentage)},null,8,["percentage"])])]))),128))])]),_:1},8,["modelValue"])):X("",!0)])}}});const _e=oe(de,[["__scopeId","data-v-cc63c606"]]);export{_e as default};
