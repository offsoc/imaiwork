import{E as ue,a as me}from"./el-breadcrumb.23df9e4a.js";import{d as pe,bP as fe,r as u,o as ge,bb as ve,k as r,l as m,m as t,q as o,s as a,t as d,Z as p,cr as ye,aI as L,J as S,K as M,I as y,a0 as x,v as w,L as b,aJ as U,aH as D,G as $,y as xe,ax as we,u as ke,_ as be}from"./entry.f4f46cb5.js";import{E as he}from"./index.03679949.js";import{E as Ee}from"./el-empty.28f9091a.js";import{E as Ce,a as De}from"./el-collapse.019657db.js";import{E as $e}from"./index.bad4fd13.js";import{_ as Ae}from"./index.2589bc04.js";/* empty css               *//* empty css                     */import{av as Re,aw as Z,ax as Se,ay as Fe,az as ze}from"./person_wechat.703f63bb.js";import{_ as Te}from"./trigger-event-edit.vue.2b7f752e.js";import{_ as Be}from"./follow-remind-edit.vue.624fabb9.js";import{_ as je}from"./stage-edit.vue.82ae4df1.js";import"./index.dd562d66.js";import"./index.ed825429.js";import"./strings.87cef2c7.js";import"./_baseIteratee.0f37ae7b.js";import"./toNumber.d5c70aa7.js";import"./clamp.6295a89e.js";import"./index.d4d0dc47.js";/* empty css                  */import"./el-input-number.1ee836d6.js";import"./index.87d72f66.js";import"./el-time-picker.87d58762.js";import"./customParseFormat.6a4fc492.js";import"./panel-time-pick.d45c81c7.js";import"./debounce.640f3738.js";const Ie={class:"h-full flex flex-col relative"},Le={class:"flex items-center justify-between bg-white p-4 rounded-xl flex-shrink-0"},Me={class:"grow min-h-0 bg-white rounded-xl mt-4 flex flex-col py-4"},Ne={class:"flex-shrink-1 min-h-0"},Pe={class:"px-4"},Ve={class:"stage-list flex flex-col gap-y-4 py-2"},qe={class:"flex px-4 justify-between items-center"},Je={class:"flex items-center"},Ge={class:"ml-6"},He={class:"ml-4"},Ke={class:"ml-4 flex gap-x-2"},Oe={class:"bg-[#F7F7F7] rounded-lg p-4 mx-2 mb-2"},Ue={class:"flex items-center gap-x-2"},Ze={class:"text-[#8A8C99]"},Qe={class:"mt-4"},We={key:0,class:"grid grid-cols-4 gap-4"},Xe=["onClick"],Ye={class:"flex items-center justify-between"},et={class:"text-[10px] bg-primary py-1 px-1.5 text-white rounded-tl-lg rounded-br-lg"},tt={class:"mr-1"},st={class:""},ot={key:0,class:"text-[#8A8C99] text-xs p-2"},lt={key:1,class:"flex items-center justify-center gap-x-4 py-4"},nt={class:"mt-4"},at={class:"flex items-center gap-x-2"},it={class:"text-[#8A8C99]"},rt={class:"mt-4"},ct={key:0,class:"grid grid-cols-4 gap-4"},dt=["onClick"],_t={class:"flex items-center justify-between"},ut={class:"text-[10px] bg-primary py-1 px-1.5 text-white rounded-tl-lg rounded-br-lg"},mt={class:"mr-1"},pt={class:"p-2"},ft={class:"text-xs"},gt={class:"text-primary mx-1"},vt={class:"text-primary mx-1"},yt={class:"text-xs mt-2 text-primary"},xt={class:"flex justify-end px-4 mt-4"},wt={key:0,class:"absolute w-full h-full flex items-center justify-center"},kt=pe({__name:"create-panel",emits:["back","delete"],setup(bt,{expose:Q,emit:W}){const N=W,X=fe(),P=ke(),g=u(X.query.id),v=u([]),A=u(!1),h=u(),Y=[{selector:".stage-list",options:{animation:150,handle:".move-icon",onEnd:async({newIndex:s,oldIndex:e})=>{const i=v.value[e],f=v.value[s];await Promise.all([Z({id:i.sub_stage_id,sort:f.sort}),Z({id:f.sub_stage_id,sort:i.sort})]);const c=[...v.value],_=c.splice(e,1)[0];c.splice(s,0,_),v.value=[],D(()=>{v.value=c})}}}],ee=async()=>{var s,e;A.value=!0,await D(),(s=h.value)==null||s.open(),(e=h.value)==null||e.setFormData({flow_id:g.value})},te=async(s,e)=>{var i,f;A.value=!0,await D(),(i=h.value)==null||i.open(),(f=h.value)==null||f.setFormData({flow_id:g.value,id:s.sub_stage_id,...s})},se=(s,e)=>{P.$confirm({message:"确定删除该客户流程吗？",onConfirm:async()=>{try{await Se({id:s}),v.value.splice(e,1),$.msgSuccess("删除成功")}catch(i){$.msgError(i)}}})},F=u(!1),z=u(),V=async s=>{var e,i;F.value=!0,await D(),(e=z.value)==null||e.open(s.trigger_id?"edit":"add"),(i=z.value)==null||i.setFormData({flow_id:g.value,...s})},T=u(!1),B=u(),q=async s=>{var e,i;T.value=!0,await D(),(e=B.value)==null||e.open(s.id?"edit":"add"),(i=B.value)==null||i.setFormData({flow_id:g.value,...s})},J=({id:s,confirmMessage:e,deleteApi:i})=>{P.$confirm({message:e,onConfirm:async()=>{try{await i({id:s}),$.msgSuccess("删除成功"),k()}catch(f){$.msgError(f)}}})},oe=async s=>{await J({id:s,confirmMessage:"确定删除该触发条件吗？",deleteApi:Fe})},le=async s=>{await J({id:s,confirmMessage:"确定删除该跟进提醒吗？",deleteApi:ze})},E=u(null),ne=s=>{E.value?E.value=null:E.value=s},C=u(null),ae=s=>{C.value?C.value=null:C.value=s},G=(s,e)=>{const{match_type:i,chat_match_mode:f,status:c}=e;if(s=="trigger")return i==1?"动作匹配":f==1?"模糊匹配":"精确匹配";if(s=="follow")return c==1?"未联系提醒":"停留提醒"},j=u(!1),H=u({}),k=async s=>{j.value=!0;try{const e=await Re({id:s||g.value});s&&(g.value=s),H.value=e,v.value=e.sub_stage_list}catch(e){$.msgError(e)}finally{j.value=!1}};return ge(async()=>{g.value&&await k()}),Q({getDetail:k}),(s,e)=>{const i=ue,f=me,c=xe,_=we,R=he,K=Ee,ie=Ce,re=De,ce=$e,de=Ae,_e=ve("draggable");return r(),m(S,null,[t("div",Ie,[t("div",Le,[t("div",null,[o(f,{"separator-icon":p(ye)},{default:a(()=>[o(i,null,{default:a(()=>[t("span",{class:"cursor-pointer text-[#8A8C99] hover:text-primary",onClick:e[0]||(e[0]=l=>N("back"))}," 任务管理 ")]),_:1}),o(i,null,{default:a(()=>[t("span",null,d(p(H).flow_name),1)]),_:1})]),_:1},8,["separator-icon"])]),o(_,{type:"danger",onClick:e[1]||(e[1]=l=>N("delete",p(g),!0))},{default:a(()=>[o(c,{name:"el-icon-Delete",size:16}),e[6]||(e[6]=t("span",null,"删除",-1))]),_:1})]),t("div",Me,[t("div",Ne,[o(ce,null,{default:a(()=>[o(re,null,{default:a(()=>[L((r(),m("div",Pe,[t("div",Ve,[(r(!0),m(S,null,M(p(v),(l,O)=>(r(),y(ie,{title:l.sub_stage_name},{title:a(()=>[t("div",qe,[t("div",Je,[t("span",{class:"move-icon cursor-move",onClick:e[2]||(e[2]=x(()=>{},["stop"]))},[o(c,{name:"local-icon-apps",color:"var(--color-primary)",size:20})]),t("span",Ge,d(l.sub_stage_name),1),t("div",He,[l.status==0?(r(),y(R,{key:0,type:"success","disable-transitions":""},{default:a(()=>[...e[7]||(e[7]=[w("关键阶段",-1)])]),_:1})):b("",!0),l.status==1?(r(),y(R,{key:1,type:"warning","disable-transitions":""},{default:a(()=>[...e[8]||(e[8]=[w("警示阶段",-1)])]),_:1})):b("",!0)]),t("div",Ke,[o(R,{type:"info",size:"small","disable-transitions":""},{default:a(()=>[w(" 触发条件 - "+d(l.trigger_count||0)+"个 ",1)]),_:2},1024),o(R,{type:"info",size:"small","disable-transitions":""},{default:a(()=>[w(" 自动跟进提醒 - "+d(l.remind||0)+"个 ",1)]),_:2},1024)])]),t("div",null,[o(_,{type:"primary",size:"small",onClick:x(n=>V({stage_id:l.sub_stage_id}),["stop"])},{default:a(()=>[o(c,{name:"local-icon-click",color:"#fff",size:16}),e[9]||(e[9]=t("span",{class:"ml-2"},"新增触发条件",-1))]),_:1},8,["onClick"]),o(_,{type:"primary",size:"small",onClick:x(n=>q({stage_id:l.sub_stage_id}),["stop"])},{default:a(()=>[o(c,{name:"local-icon-alarm",color:"#fff"}),e[10]||(e[10]=t("span",{class:"ml-2"},"新增跟进提醒",-1))]),_:1},8,["onClick"]),o(_,{type:"primary",size:"small",onClick:x(n=>te(l,O),["stop"])},{default:a(()=>[o(c,{name:"local-icon-edit",color:"#fff"}),e[11]||(e[11]=t("span",{class:"ml-2"},"编辑",-1))]),_:1},8,["onClick"]),o(_,{type:"danger",size:"small",onClick:x(n=>se(l.sub_stage_id,O),["stop"])},{default:a(()=>[o(c,{name:"local-icon-delete_bin",color:"#fff"}),e[12]||(e[12]=t("span",{class:"ml-2"},"删除",-1))]),_:1},8,["onClick"])])])]),default:a(()=>[t("div",Oe,[t("div",null,[t("div",Ue,[t("span",Ze,"标签触发条件配置（"+d(l.trigger_count)+"）",1),o(_,{link:"",onClick:n=>ne(l.sub_stage_id)},{default:a(()=>[o(c,{name:p(E)==l.sub_stage_id?"el-icon-ArrowRight":"el-icon-ArrowDown",color:"#8A8C99"},null,8,["name"])]),_:2},1032,["onClick"])]),L(t("div",Qe,[l.trigger_count>0?(r(),m("div",We,[(r(!0),m(S,null,M(l.triggerlist,n=>(r(),m("div",{class:"bg-white rounded-lg border border-primary-light-8 cursor-pointer",onClick:I=>V({trigger_id:n.id,...n})},[t("div",Ye,[t("div",et,d(G("trigger",n)),1),t("div",tt,[o(_,{link:"",onClick:x(I=>oe(n.id),["stop"])},{default:a(()=>[o(c,{name:"el-icon-Delete",color:"#8A8C99"})]),_:1},8,["onClick"])])]),t("div",st,[n.match_type==2?(r(),m("div",ot,d(n.chat_keywords),1)):(r(),m("div",lt,[o(c,{name:"local-icon-user_add",color:"var(--color-primary)"}),e[13]||(e[13]=t("span",{class:"text-primary text-xs"},"刚刚成为好友",-1))]))])],8,Xe))),256))])):(r(),y(K,{key:1,description:"暂无数据","image-size":60}))],512),[[U,p(E)!=l.sub_stage_id]])]),t("div",nt,[t("div",at,[t("span",it,"自动跟进提醒配置（"+d(l.remind_count)+"）",1),o(_,{link:"",onClick:n=>ae(l.sub_stage_id)},{default:a(()=>[o(c,{name:p(C)!=l.sub_stage_id?"el-icon-ArrowDown":"el-icon-ArrowRight",color:"#8A8C99"},null,8,["name"])]),_:2},1032,["onClick"])]),L(t("div",rt,[l.remind_count>0?(r(),m("div",ct,[(r(!0),m(S,null,M(l.remindlist,n=>(r(),m("div",{class:"bg-white rounded-lg border border-primary-light-8 cursor-pointer",onClick:I=>q({remind_id:n.id,...n})},[t("div",_t,[t("div",ut,d(G("follow",n)),1),t("div",mt,[o(_,{link:"",onClick:x(I=>le(n.id),["stop"])},{default:a(()=>[o(c,{name:"el-icon-Delete",color:"#8A8C99"})]),_:1},8,["onClick"])])]),t("div",pt,[t("div",ft,[e[14]||(e[14]=w(" 超过",-1)),t("span",gt,d(n.judgment),1),w("天后，"+d(n.judgment>0?"次日":"当天")+" ",1),t("span",vt,d(n.send_time),1),e[15]||(e[15]=w("跟进 ",-1))]),t("div",yt,d(n.content),1)])],8,dt))),256))])):(r(),y(K,{key:1,description:"暂无数据","image-size":60}))],512),[[U,p(C)!=l.sub_stage_id]])])])]),_:2},1032,["title"]))),256))])])),[[_e,Y]])]),_:1})]),_:1})]),t("div",xt,[o(_,{type:"primary",link:"",onClick:ee},{default:a(()=>[o(c,{name:"local-icon-add_box_fill",size:18}),e[16]||(e[16]=t("span",{class:"ml-2"},"新增阶段",-1))]),_:1})])]),p(j)?(r(),m("div",wt,[o(de)])):b("",!0)]),p(F)?(r(),y(Te,{key:0,ref_key:"triggerEventEditRef",ref:z,onClose:e[3]||(e[3]=l=>F.value=!1),onSuccess:k},null,512)):b("",!0),p(T)?(r(),y(Be,{key:1,ref_key:"followRemindEditRef",ref:B,onClose:e[4]||(e[4]=l=>T.value=!1),onSuccess:k},null,512)):b("",!0),p(A)?(r(),y(je,{key:2,ref_key:"stageEditRef",ref:h,onClose:e[5]||(e[5]=l=>A.value=!1),onSuccess:k},null,512)):b("",!0)],64)}}});const Qt=be(kt,[["__scopeId","data-v-79a518c7"]]);export{Qt as default};
