import{_ as de}from"./index.vue.f38ca415.js";import{_ as ue}from"./index.55703cf7.js";import{d as ie,at as pe,c as me,A as y,aF as ce,aj as j,cq as _e,G as g,b6 as fe,k as _,I as v,s as o,m as d,q as t,a3 as ge,Z as n,v as m,aI as A,l as L,K as N,J,cQ as be,cR as ve,aH as xe,bI as ye,c7 as G,au as Ve,av as he,cS as Ee,cT as ke,ax as we,y as ze,ay as Ce,cO as Ue,_ as Fe}from"./entry.d7219633.js";import{E as Ie,a as Re}from"./index.0a6eb9ae.js";import{E as Se,a as Te}from"./index.50778a9c.js";import{E as De}from"./index.f15af271.js";/* empty css                        *//* empty css               *//* empty css                  *//* empty css                     *//* empty css                 */import{h as Oe,i as qe,j as $e}from"./agent.a3fcedc5.js";import{FormFieldTypeEnum as W,CozeTypeEnum as Be}from"./index.11e2700c.js";import{_ as P}from"./coze_bg.94eef287.js";import je from"./agent-logo.64dfb3c9.js";import"./index.3adcf74a.js";import"./index.9efd0300.js";import"./cloneDeep.1f319c9b.js";/* empty css                  *//* empty css                    *//* empty css                  */import"./_baseIteratee.5c97421a.js";import"./debounce.085e8a4a.js";import"./index.ead96a32.js";import"./index.4953ba77.js";import"./strings.03d3529c.js";const Ae={class:"mt-10"},Le={class:"mt-[25px]"},Ne={class:"p-8"},Je={class:"flex w-full gap-x-4"},Ge={class:"w-[351px] flex-shrink-0 pt-6"},We={class:"flex-1"},Pe={class:"pt-6"},He={class:"absolute right-0 -top-[35px]"},Ke={class:"w-full border border-[var(--el-border-color)] rounded-lg"},Qe={class:"move-icon cursor-move"},Ye={class:"flex items-center justify-between w-full"},Ze={class:"mt-3 w-full border border-[var(--el-border-color)] rounded-lg"},Me={class:"move-icon cursor-move"},Xe={class:"flex justify-center mt-4"},et=ie({name:"CozeFlowEdit",__name:"coze-flow-edit",emits:["close","success"],setup(tt,{expose:H,emit:K}){const E=K,Q=pe(),Y=me(()=>{const{shop_logo:s}=Q.getWebsiteConfig||{};return s}),V=y(),h=y(),k=y(),w=y(),z=Object.values(W),C=()=>({id:"",name:"",type:Be.FLOW,introduced:"",bg_image:"",coze_id:"",stream:0,avatar:Y.value,permissions:0,output_key:"",outputs:[],inputs:[]}),a=ce(C()),Z={name:[{required:!0,message:"请输入智能体名称"}],introduced:[{required:!0,message:"请输入智能体介绍"}],coze_id:[{required:!0,message:"请输入Coze智能体ID"}],avatar:[{required:!0,message:"请上传智能体logo"}],inputs:[{required:!0,message:"请配置输入参数"}],outputs:[{required:!0,message:"请配置输出参数"}],output_key:[{required:!0,message:"请输入Output_key，按顺序用英文;隔开"}]},M=s=>{const{uri:e}=s.data;a.bg_image=e},X=async()=>{try{const s=await be(P,"coze_bg.png"),{uri:e}=await ve({file:s});a.bg_image=e}catch(s){console.error("默认背景上传失败:",s)}},U=s=>[{selector:"tbody",options:{animation:150,handle:".move-icon",onEnd:({newIndex:e,oldIndex:c})=>{const i=s.value,u=i.splice(c,1)[0];i.splice(e,0,u),s.value=[...i]}}}],ee=U(j(a,"inputs")),te=U(j(a,"outputs")),F=(s,e,c={})=>{const i={name:"",type:W.INPUT,fields:"",value:"",...c};s.push(i),xe(()=>{const u=e==="inputs"?k.value:w.value;u==null||u.setScrollTop(s.length*50)})},I=(s,e)=>{s.splice(e,1)},R=(s,e)=>{if(s.some(i=>!i.name||!i.fields))return g.msgError(`请填写完整的${e}参数`),!1;const c=s.map(i=>i.fields);return new Set(c).size!==c.length?(g.msgError(`${e}的字段名称不能重复`),!1):!0},{lockFn:le,isLock:oe}=_e(async()=>{var s;if(!a.avatar)return g.msgError("请上传智能体头像");if(await((s=h.value)==null?void 0:s.validate()),!!R(a.inputs,"输入配置")&&R(a.outputs,"输出配置")){a.bg_image||await X();try{await(a.id?Oe:qe)(a),g.msgSuccess(`${a.id?"编辑":"添加"}成功`),S(),E("success")}catch(e){g.msgError(e)}}}),ae=async()=>{var s;Object.assign(a,C()),(s=h.value)==null||s.clearValidate(),V.value.open()},S=()=>{E("close"),V.value.close()};return H({open:ae,getDetail:async s=>{try{const e=await $e({id:s});ye(e,a),a.outputs=G(e.outputs)?JSON.parse(e.outputs):[],a.inputs=G(e.inputs)?JSON.parse(e.inputs):[]}catch{g.msgError("获取详情失败")}}}),(s,e)=>{const c=de,i=ue,u=Ve,f=he,x=Ee,T=ke,b=we,D=ze,p=Ie,O=Se,q=Te,$=Re,se=De,ne=Ce,re=Ue,B=fe("draggable");return _(),v(re,{ref_key:"popupRef",ref:V,async:"",width:"1068px","confirm-button-text":"","cancel-button-text":"","header-class":"!p-0","footer-class":"!p-0",style:{padding:"0"},"show-close":!1},{default:o(()=>[d("div",null,[d("div",{class:"absolute w-6 h-6 right-4 top-4 z-10 cursor-pointer",onClick:S},[t(c)]),d("div",{class:"w-full h-[235px] bg-cover bg-no-repeat rounded-tl-[20px] rounded-tr-[20px] flex flex-col justify-center items-center",style:ge({backgroundImage:`url(${n(a).bg_image||n(P)})`,backgroundPositionY:"-80px"})},[d("div",Ae,[t(je,{modelValue:n(a).avatar,"onUpdate:modelValue":e[0]||(e[0]=l=>n(a).avatar=l)},null,8,["modelValue"])]),d("div",Le,[t(i,{limit:1,"show-progress":"","show-file-list":!1,onSuccess:M},{default:o(()=>e[7]||(e[7]=[d("div",{class:"w-[72px] h-[29px] flex items-center justify-center rounded-[32px] bg-[#00000066] text-white"}," 更换背景 ",-1)])),_:1,__:[7]})])],4),d("div",Ne,[e[17]||(e[17]=d("div",{class:"text-lg font-bold"},"新增Coze工作流",-1)),e[18]||(e[18]=d("div",{class:"text-xs text-[#0000004d] mt-2"},"快速搭建对话式智能体",-1)),t(ne,{ref_key:"formRef",ref:h,model:n(a),rules:Z,"label-position":"top"},{default:o(()=>[d("div",Je,[d("div",Ge,[t(f,{label:"智能体名称",prop:"name"},{default:o(()=>[t(u,{modelValue:n(a).name,"onUpdate:modelValue":e[1]||(e[1]=l=>n(a).name=l),class:"!h-10",placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),t(f,{label:"智能体介绍",prop:"introduced"},{default:o(()=>[t(u,{modelValue:n(a).introduced,"onUpdate:modelValue":e[2]||(e[2]=l=>n(a).introduced=l),type:"textarea",placeholder:"请输入智能体的说明",resize:"none",rows:6},null,8,["modelValue"])]),_:1}),t(f,{label:"Coze智能体ID",prop:"coze_id"},{default:o(()=>[t(u,{modelValue:n(a).coze_id,"onUpdate:modelValue":e[3]||(e[3]=l=>n(a).coze_id=l),class:"!h-10",placeholder:"请输入Coze智能体ID"},null,8,["modelValue"])]),_:1}),t(f,{label:"输出方式",prop:"stream"},{default:o(()=>[t(T,{modelValue:n(a).stream,"onUpdate:modelValue":e[4]||(e[4]=l=>n(a).stream=l)},{default:o(()=>[t(x,{value:1,disabled:""},{default:o(()=>e[8]||(e[8]=[m("流式输出",-1)])),_:1,__:[8]}),t(x,{value:0},{default:o(()=>e[9]||(e[9]=[m("直接返回",-1)])),_:1,__:[9]})]),_:1},8,["modelValue"])]),_:1})]),d("div",We,[t(se,null,{default:o(()=>[d("div",Pe,[t(f,{label:"输入配置（每个字段值不能重复）",prop:"inputs",class:"relative"},{default:o(()=>[d("div",He,[t(b,{type:"primary",size:"small",onClick:e[5]||(e[5]=l=>F(n(a).inputs,"inputs",{required:"true"}))},{default:o(()=>e[10]||(e[10]=[m(" 新增 ",-1)])),_:1,__:[10]})]),d("div",Ke,[A((_(),v($,{ref_key:"inputTableRef",ref:k,class:"inout-table",data:n(a).inputs,stripe:"","max-height":"200px","row-style":{height:"40px"},"header-cell-style":{height:"40px"}},{default:o(()=>[t(p,{width:"50px"},{default:o(()=>[d("div",Qe,[t(D,{name:"el-icon-Rank"})])]),_:1}),t(p,{label:"名称"},{default:o(({row:l})=>[t(u,{modelValue:l.name,"onUpdate:modelValue":r=>l.name=r,placeholder:"请输入",clearable:"",maxlength:"30"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(p,{label:"类型"},{default:o(({row:l})=>[t(q,{modelValue:l.type,"onUpdate:modelValue":r=>l.type=r,placeholder:"请选择"},{default:o(()=>[(_(!0),L(J,null,N(n(z),r=>(_(),v(O,{label:r,value:r,key:r},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),t(p,{label:"字段值"},{default:o(({row:l})=>[t(u,{modelValue:l.fields,"onUpdate:modelValue":r=>l.fields=r,placeholder:"请输入",clearable:"",maxlength:"30"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(p,{label:"是否必填"},{default:o(({row:l})=>[t(T,{modelValue:l.required,"onUpdate:modelValue":r=>l.required=r},{default:o(()=>[t(x,{value:"true"},{default:o(()=>e[11]||(e[11]=[m("是",-1)])),_:1,__:[11]}),t(x,{value:"false"},{default:o(()=>e[12]||(e[12]=[m("否",-1)])),_:1,__:[12]})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),t(p,{label:"操作",width:"80px"},{default:o(({$index:l})=>[t(b,{type:"danger",size:"small",onClick:r=>I(n(a).inputs,l)},{default:o(()=>e[13]||(e[13]=[m(" 删除 ",-1)])),_:2,__:[13]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[B,n(ee)]])])]),_:1}),t(f,{label:"输出配置（每个字段值不能重复）",prop:"outputs",class:"relative"},{default:o(()=>[d("div",Ye,[t(b,{type:"primary",size:"small",onClick:e[6]||(e[6]=l=>F(n(a).outputs,"outputs"))},{default:o(()=>e[14]||(e[14]=[m(" 新增 ",-1)])),_:1,__:[14]})]),d("div",Ze,[A((_(),v($,{ref_key:"outputTableRef",ref:w,data:n(a).outputs,stripe:"","max-height":"200px","row-style":{height:"40px"},"header-cell-style":{height:"40px"}},{default:o(()=>[t(p,{width:"50px"},{default:o(()=>[d("div",Me,[t(D,{name:"el-icon-Rank"})])]),_:1}),t(p,{label:"名称"},{default:o(({row:l})=>[t(u,{modelValue:l.name,"onUpdate:modelValue":r=>l.name=r,placeholder:"请输入",clearable:"",maxlength:"30"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(p,{label:"类型"},{default:o(({row:l})=>[t(q,{modelValue:l.type,"onUpdate:modelValue":r=>l.type=r,placeholder:"请选择"},{default:o(()=>[(_(!0),L(J,null,N(n(z),r=>(_(),v(O,{label:r,value:r,key:r},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:1}),t(p,{label:"字段值"},{default:o(({row:l})=>[t(u,{modelValue:l.fields,"onUpdate:modelValue":r=>l.fields=r,placeholder:"请输入",clearable:"",maxlength:"30"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),t(p,{label:"操作",width:"80px"},{default:o(({$index:l})=>[t(b,{type:"danger",size:"small",onClick:r=>I(n(a).outputs,l)},{default:o(()=>e[15]||(e[15]=[m(" 删除 ",-1)])),_:2,__:[15]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[B,n(te)]])])]),_:1})])]),_:1})])])]),_:1},8,["model"]),d("div",Xe,[t(b,{color:"#000000",class:"!rounded-full !h-[50px] w-[310px] shadow-[0_6px_12px_0px_#0065FB33]",loading:n(oe),onClick:n(le)},{default:o(()=>e[16]||(e[16]=[m(" 保存 ",-1)])),_:1,__:[16]},8,["loading","onClick"])])])])]),_:1},512)}}});const Ft=Fe(et,[["__scopeId","data-v-f53718af"]]);export{Ft as default};
