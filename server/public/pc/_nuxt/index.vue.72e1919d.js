import{d as G,bP as H,aF as J,r as V,A as P,o as W,k as o,l as y,Z as a,m as r,q as s,s as n,v as d,$ as Z,aI as z,I as v,t as Q,L as u,bM as X,J as Y,bO as C,aH as ee,G as E,ax as te,y as se,au as ae,cW as le,u as ne}from"./entry.ca4d3d61.js";import{E as oe,a as ie}from"./index.5f182cdf.js";import{E as re,a as ue}from"./index.9a4d38a6.js";import{E as pe}from"./el-switch.f1c6cc29.js";import{E as ce}from"./el-empty.355e6a02.js";import{_ as de}from"./index.vue.441733b3.js";/* empty css                  *//* empty css               *//* empty css                     *//* empty css                        *//* empty css                 */import{u as me}from"./usePaging.15b2220c.js";import{ap as _e,ak as fe,aq as ye}from"./person_wechat.703f63bb.js";import{PushTypeEnum as ve,SidebarTypeEnum as b}from"./index.a1206616.js";import he from"./create-panel.5b68b894.js";import{_ as ge}from"./send-record.vue.f14192be.js";const ke={key:0,class:"h-full flex flex-col bg-white rounded-xl"},Ee={class:"flex items-center justify-between p-4"},xe={class:"flex items-center gap-2"},Ce={class:"flex items-center gap-2"},be={class:"grow min-h-0 flex flex-col"},we={class:"grow min-h-0"},Se={class:"flex items-center gap-2 justify-center"},$e={key:0,class:"text-info"},Ve={key:1,class:"text-warning"},Pe={key:2,class:"text-success"},Te={class:"flex justify-end p-4"},We=G({__name:"index",setup(Re){const w=ne(),{query:h}=H(),m=J({status:"",push_name:"",push_type:ve.TASK}),{pager:_,getLists:i,resetParams:T}=me({fetchFun:_e,params:m}),p=V(h.is_create=="1"&&parseInt(h.type)==b.TASK),g=V(h.is_record=="1"&&parseInt(h.type)==b.TASK),R=P(),S=P(),B=()=>{p.value=!0,C({is_create:1})},A=async l=>{var e;p.value=!0,await ee(),(e=S.value)==null||e.getDetail(l),C({id:l,is_create:1})},I=async l=>{w.$confirm({message:`是否${l.status==1?"开启":"关闭"}该任务？`,onConfirm:async()=>{try{await fe({id:l.id,status:l.status==1?2:1,type:l.type}),i(),E.msgSuccess("操作成功")}catch(e){E.msgError(e)}}})},K=async l=>{w.$confirm({message:"是否删除该SOP任务？",onConfirm:async()=>{try{await ye({id:l}),i(),E.msgSuccess("删除成功")}catch(e){E.msgError(e)}}})},D=l=>{g.value=!0,C({id:l,is_record:1})},$=()=>{p.value=!1,g.value=!1,window.history.replaceState("","",`?type=${b.TASK}`),i()};return W(()=>{p.value||i()}),(l,e)=>{const f=te,k=oe,N=ie,q=se,L=ae,c=re,O=pe,U=ce,j=ue,F=de,M=le;return o(),y(Y,null,[!a(p)&&!a(g)?(o(),y("div",ke,[r("div",Ee,[s(f,{type:"primary",onClick:B},{default:n(()=>[...e[7]||(e[7]=[d("添加任务",-1)])]),_:1}),r("div",xe,[r("div",Ce,[s(N,{modelValue:a(m).status,"onUpdate:modelValue":e[0]||(e[0]=t=>a(m).status=t),"empty-values":[null,void 0],class:"!w-[120px]",onChange:e[1]||(e[1]=t=>a(i)())},{default:n(()=>[s(k,{label:"全部",value:""}),s(k,{label:"未配置",value:"0"}),s(k,{label:"未开启",value:"1"}),s(k,{label:"已开启",value:"2"})]),_:1},8,["modelValue"])]),r("div",null,[s(L,{modelValue:a(m).push_name,"onUpdate:modelValue":e[3]||(e[3]=t=>a(m).push_name=t),class:"!w-[240px]",placeholder:"请输入任务名称",clearable:"",onClear:e[4]||(e[4]=t=>a(T)()),onKeyup:e[5]||(e[5]=Z(t=>a(i)(),["enter"]))},{append:n(()=>[s(f,{onClick:e[2]||(e[2]=t=>a(i)())},{default:n(()=>[s(q,{name:"el-icon-Search"})]),_:1})]),_:1},8,["modelValue"])])])]),r("div",be,[r("div",we,[z((o(),v(j,{data:a(_).lists,stripe:"",height:"100%","header-row-style":{height:"62px"},"row-style":{height:"60px"}},{empty:n(()=>[s(U,{description:"暂无数据"})]),default:n(()=>[e[11]||(e[11]=d(" > ",-1)),s(c,{label:"任务名称",prop:"push_name","min-width":"200"}),s(c,{label:"营销总天数",prop:"all_day","min-width":"120"},{default:n(({row:t})=>[d(Q(t.all_day?`${t.all_day}天`:"-"),1)]),_:1}),s(c,{label:"任务状态",width:"220"},{default:n(({row:t})=>[r("div",Se,[t.status==0?(o(),y("span",$e," 未配置 ")):u("",!0),t.status==1?(o(),y("span",Ve," 未开启 ")):u("",!0),t.status==2?(o(),y("span",Pe," 已开启 ")):u("",!0),t.status!=0?(o(),v(O,{key:3,"model-value":t.status,"active-value":2,"inactive-value":1,style:{"--el-switch-on-color":"var(--el-color-success)","--el-switch-off-color":"var(--el-color-warning)"},onChange:x=>I(t)},null,8,["model-value","onChange"])):u("",!0)])]),_:1}),s(c,{label:"推送时间",prop:"push_day",width:"160"}),s(c,{label:"创建时间",prop:"create_time",width:"180"}),s(c,{label:"操作",width:"160",fixed:"right"},{default:n(({row:t})=>[t.is_publish_edit==2?(o(),v(f,{key:0,type:"primary",link:"",onClick:x=>A(t.id)},{default:n(()=>[...e[8]||(e[8]=[d("编辑",-1)])]),_:1},8,["onClick"])):u("",!0),s(f,{type:"primary",link:"",onClick:x=>D(t.id)},{default:n(()=>[...e[9]||(e[9]=[d("详情",-1)])]),_:1},8,["onClick"]),s(f,{type:"danger",link:"",onClick:x=>K(t.id)},{default:n(()=>[...e[10]||(e[10]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[M,a(_).loading]])]),r("div",Te,[s(F,{modelValue:a(_),"onUpdate:modelValue":e[6]||(e[6]=t=>X(_)?_.value=t:null),onChange:a(i)},null,8,["modelValue","onChange"])])])])):u("",!0),a(p)?(o(),v(he,{key:1,ref_key:"createPanelRef",ref:S,onBack:$},null,512)):u("",!0),a(g)?(o(),v(ge,{key:2,ref_key:"recordRef",ref:R,onBack:$},null,512)):u("",!0)],64)}}});export{We as _};
