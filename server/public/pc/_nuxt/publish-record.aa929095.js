import{d as J,ef as Z,aF as X,r as d,o as ee,l as te,m as l,q as a,s as o,aI as le,Z as s,I as f,bK as oe,L as h,J as ae,cP as se,cQ as ne,k as c,$ as ie,v as _,t as r,bz as v,aH as re,G as y,y as pe,ax as ue,au as me,b5 as de,u as ce,_ as _e}from"./entry.46557796.js";import{E as fe}from"./index.304400de.js";import{a as ve,E as ye}from"./index.5f8d7d98.js";import{E as xe}from"./el-empty.db5857ba.js";import{_ as ge}from"./index.vue.383c1815.js";import{_ as be}from"./index.vue.520aef1d.js";import{E as he}from"./el-date-picker.9a9f22f5.js";/* empty css                     *//* empty css                        *//* empty css               *//* empty css                 */import{u as ke}from"./usePaging.3ef28349.js";import{j as Ee,k as Ce,r as De}from"./redbook.f03a8b74.js";import{PublishTaskTypeEnum as we}from"./index.83df7a87.js";import"./_baseIteratee.6084bee0.js";import"./debounce.22e3311f.js";import"./index.1d76ef55.js";import"./index.52e544f1.js";import"./index.c76cd001.js";import"./strings.1c189114.js";import"./customParseFormat.df9b4c29.js";import"./panel-time-pick.003e480c.js";import"./index.08e202f9.js";const $e={class:"h-full flex flex-col"},Pe={class:"grow min-h-0 bg-app-bg-2 rounded-[20px] flex flex-col"},Te={class:"flex-shrink-0 px-[14px]"},Ve={class:"flex items-center justify-between h-[88px] gap-[14px]"},Ye={class:"flex items-center gap-[14px]"},Be={class:"grow min-h-0"},Re={class:""},Ie={class:"flex justify-center p-4"},Me={class:"text-[#BFBFBF] mt-1"},je={class:"mt-4"},Fe={class:"flex justify-center mt-4 px-2"},Se=J({__name:"publish-record",props:{type:{default:we.VIDEO}},emits:["back","copy"],setup(V,{emit:Y}){const B=V,R=Y,$=ce(),I=Z(),E=X({id:I.publish_id,material_title:"",material_type:B.type}),{pager:x,getLists:p,resetPage:M}=ke({fetchFun:Ee,params:E}),j={0:"未发布",1:"已发布",2:"发布失败",3:"发布中",4:"发布成功"},F=n=>{$.$confirm({title:"未通过原因",message:n,theme:"dark"})},g=d("retry"),i=d({id:"",retry_time:""}),b=d(),C=n=>v(n.publish_end).isAfter(v());d(!1),d();const k=d(!1),P=d(),S=n=>{const e=new Date(b.value.publish_start).getTime()-864e5,D=new Date(b.value.publish_end).getTime();return n.getTime()<e||n.getTime()>D},T=async(n,e)=>{b.value=n,g.value=e,i.value.id=n.id,i.value.retry_time=n.publish_time,k.value=!0,await re(),P.value.open()},L=n=>{$.$confirm({message:"确定删除该记录吗？",onConfirm:async()=>{try{await Ce(n.id),y.msgSuccess("删除成功"),p()}catch{y.msgWarning("删除失败")}}})},N=async()=>{if(!i.value.retry_time){y.msgWarning(`请选择${g.value=="retry"?"重试":"更改"}时间`);return}if(v(i.value.retry_time).isBefore(v())){y.msgWarning("重试时间不能小于当前时间");return}try{await De(i.value),y.msgSuccess(`${g.value=="retry"?"重试":"更改"}成功`),i.value={id:"",retry_time:""},k.value=!1,p()}catch(n){y.msgError(n||`${g.value=="retry"?"重试":"更改"}失败`)}};return ee(()=>{p()}),(n,e)=>{const D=pe,u=ue,A=me,q=de,H=fe,m=ye,K=xe,O=ve,U=ge,W=be,Q=he,z=se,G=ne;return c(),te(ae,null,[l("div",$e,[l("div",Pe,[l("div",Te,[a(H,null,{default:o(()=>[l("div",Ve,[l("div",{class:"flex items-center gap-2 cursor-pointer",onClick:e[0]||(e[0]=t=>R("back"))},[a(D,{name:"el-icon-ArrowLeft",color:"#ffffff"}),e[10]||(e[10]=l("div",{class:"text-white"},"返回",-1))]),l("div",Ye,[a(A,{modelValue:s(E).material_title,"onUpdate:modelValue":e[2]||(e[2]=t=>s(E).material_title=t),"prefix-icon":"el-icon-Search",class:"!w-[240px] search-name-input",placeholder:"请输入标题",clearable:"",onClear:e[3]||(e[3]=t=>s(p)()),onKeydown:e[4]||(e[4]=ie(t=>s(p)(),["enter"]))},{append:o(()=>[a(u,{onClick:e[1]||(e[1]=t=>s(p)())},{default:o(()=>e[11]||(e[11]=[_(" 搜索 ",-1)])),_:1,__:[11]})]),_:1},8,["modelValue"]),l("div",null,[a(q,{content:"刷新"},{default:o(()=>[a(u,{circle:"",color:"#1f1f1f",icon:"el-icon-Refresh",class:"!w-10 !h-10",onClick:e[5]||(e[5]=t=>s(M)())})]),_:1})])])])]),_:1})]),l("div",Be,[le((c(),f(O,{data:s(x).lists,height:"100%","header-row-style":{height:"62px"},"row-style":{height:"60px"}},{empty:o(()=>[a(K,{description:"暂无数据"})]),default:o(()=>[a(m,{prop:"material_title",label:"标题","min-width":"120px"},{default:o(({row:t})=>[l("div",null,r(t.material_title||"-"),1)]),_:1}),a(m,{prop:"poi",label:"POI名称","min-width":"120px"},{default:o(({row:t})=>[l("div",null,r(t.poi||"-"),1)]),_:1}),a(m,{prop:"publish_time",label:"发布时间点",width:"180px"},{default:o(({row:t})=>[l("div",null,r(t.publish_time||"-"),1)]),_:1}),a(m,{prop:"exec_time",label:"执行时间点",width:"180px"},{default:o(({row:t})=>[l("div",null,r(t.exec_time||"-"),1)]),_:1}),a(m,{label:"发布状态",width:"120px"},{default:o(({row:t})=>[_(r(j[t.status]||"-"),1)]),_:1}),a(m,{prop:"remark",label:"失败原因","min-width":"100px","show-overflow-tooltip":""},{default:o(({row:t})=>[l("div",null,r(t.remark||"-"),1)]),_:1}),a(m,{label:"操作",width:"160px",fixed:"right"},{default:o(({row:t})=>[l("div",Re,[t.status==2?(c(),f(u,{key:0,type:"primary",link:"",class:"",onClick:w=>F(t.remark)},{default:o(()=>e[12]||(e[12]=[_("查看原因",-1)])),_:2,__:[12]},1032,["onClick"])):h("",!0),t.status==0&&C(t)?(c(),f(u,{key:1,type:"primary",link:"",onClick:w=>T(t,"changeDate")},{default:o(()=>e[13]||(e[13]=[_("更改时间",-1)])),_:2,__:[13]},1032,["onClick"])):h("",!0),t.status==2&&C(t)?(c(),f(u,{key:2,type:"primary",link:"",onClick:w=>T(t,"retry")},{default:o(()=>e[14]||(e[14]=[_("重试",-1)])),_:2,__:[14]},1032,["onClick"])):h("",!0),t.status==1||!C(t)?(c(),f(u,{key:3,type:"danger",link:"",onClick:w=>L(t)},{default:o(()=>e[15]||(e[15]=[_("删除",-1)])),_:2,__:[15]},1032,["onClick"])):h("",!0)])]),_:1})]),_:1},8,["data"])),[[G,s(x).loading]])]),l("div",Ie,[a(U,{modelValue:s(x),"onUpdate:modelValue":e[6]||(e[6]=t=>oe(x)?x.value=t:null),layout:"prev, pager, next",onChange:s(p)},null,8,["modelValue","onChange"])])])]),s(k)?(c(),f(z,{key:0,ref_key:"datePopupRef",ref:P,width:"500px",title:s(g)=="retry"?"视频任务重试":"更改时间",async:"","cancel-button-text":"","confirm-button-text":"",style:{"background-color":"var(--app-bg-color-2)","box-shadow":"0px 0px 0px 1px var(--app-border-color-2)"},"show-close":!1},{default:o(()=>[l("div",null,[l("div",{class:"w-6 h-6 absolute top-4 right-4",onClick:e[7]||(e[7]=t=>k.value=!1)},[a(W)]),l("div",Me," 请选择重试的时间节点，当前可选时间范围周期为"+r(s(v)(s(b).publish_start).format("YYYY-MM-DD "))+"至"+r(s(v)(s(b).publish_end).format("YYYY-MM-DD ")),1),l("div",je,[a(Q,{class:"!w-full !h-[50px]","popper-class":"dark-date-picker-popper",modelValue:s(i).retry_time,"onUpdate:modelValue":e[8]||(e[8]=t=>s(i).retry_time=t),"value-format":"YYYY-MM-DD HH:mm:ss",type:"datetime",placeholder:"请选择重试时间","disabled-date":S},null,8,["modelValue"])]),l("div",Fe,[a(u,{type:"primary",class:"!rounded-full w-[318px] !h-[50px]",onClick:e[9]||(e[9]=t=>N())},{default:o(()=>e[16]||(e[16]=[_(" 确定 ",-1)])),_:1,__:[16]})])])]),_:1},8,["title"])):h("",!0)],64)}}});const rt=_e(Se,[["__scopeId","data-v-caa942e3"]]);export{rt as default};
