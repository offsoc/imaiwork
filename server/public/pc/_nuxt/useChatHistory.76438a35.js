import{aF as v,r as i,c as d,cz as y,cA as C,G as h}from"./entry.ee599c70.js";import{useChatStore as m}from"./chat.9f80db84.js";import{useChatManager as S}from"./useChatManager.8e64d27e.js";function T(){const a=m(),{taskId:f,fetchChatHistory:g}=S(),r=v({page_no:1,page_size:40}),o=i(!1),n=i(!1),t=i([]),c=d(()=>f.value),l=async()=>{o.value=!0;try{const{lists:e,count:s}=await y(r);n.value=!(e.length<(r.page_size||s)),t.value=t.value.concat(e)}finally{o.value=!1}},u=e=>{a.clearChat(),a.resetRoute()};return{chatHistory:t,currentSessionId:c,isLoading:o,isFinished:n,fetchChatHistory:l,createNewSession:u,switchToSession:async e=>{c.value!==e&&(a.setTaskId(e),await g())},deleteSession:async e=>{try{t.value=t.value.filter(s=>s.task_id!==e),await C({task_id:e}),h.msgSuccess("删除成功"),c.value===e&&u()}catch(s){h.msgError(s)}},saveCurrentSession:()=>{a.chatContentList.length},loadHistory:async()=>{!n.value||o.value||(r.page_no++,l())}}}export{T as useChatHistory};
