import{d as B,aF as $,r as w,cq as A,o as H,k as f,l as c,m as l,q as o,s as a,Z as s,v as d,L as V,bK as D,J as q,K,Y as O,bz as J,u as M,G as p,bI as Y,cT as Z,y as P,b5 as Q,cU as X,au as h,cD as ee,d1 as le,ax as te,_ as oe}from"./entry.d9d53b29.js";import{E as ne}from"./el-switch.d7a8c51d.js";import{E as se}from"./el-time-select.34911787.js";import{E as ae}from"./index.050c9b6b.js";/* empty css                     *//* empty css               *//* empty css                  */import{s as ie,r as re}from"./agent.a3fcedc5.js";import{validateSchedule as de}from"./utils.dc4516f5.js";import"./customParseFormat.b95a1bc9.js";import"./index.79f7263c.js";import"./index.8a3302e5.js";import"./strings.fbd015b4.js";import"./debounce.39f38609.js";import"./_baseIteratee.73cb21ab.js";import"./index.4538c991.js";const me={class:"h-full flex flex-col py-6"},ue={class:"grow min-h-0"},pe={class:"px-[30px] flex flex-col gap-4"},_e={class:"flex flex-col"},ve={class:"mt-2"},fe={class:"flex items-center gap-2"},ce={class:"flex items-center gap-2"},ge={class:"flex flex-col"},xe={class:"mt-2"},ke={class:"flex flex-col"},be={class:"mt-2"},ye={key:0,class:"mt-2"},we={class:"flex flex-col"},Ve={class:"mt-2"},Ee={key:0,class:"mt-2"},Ce={class:"flex flex-col"},Se={class:"flex items-center justify-between gap-2"},Ue={class:"flex flex-col"},Ie={class:"flex items-center justify-between gap-2"},Te={key:0,class:"mt-2"},We={class:"flex flex-wrap items-center gap-3 mt-3"},Re=["onClick"],Fe={class:"mt-3"},je={class:"flex items-center justify-center mt-4"},ze=B({__name:"index",props:{agentId:{}},emits:["close"],setup(I,{emit:Ne}){const E=I,t=$({multiple_type:0,number_chat_rounds:3,voice_enable:0,image_enable:0,image_reply:"",stop_enable:0,stop_keywords:"",paragraph_enable:0,working_enable:0,non_working_reply:"",working_time:{1:[],2:[],3:[],4:[],5:[],6:[],7:[]}}),v=w([]),r=w([]),C=w([]),T=()=>{r.value.length===0?r.value.push({start_time:"09:00",end_time:"09:15"}):r.value.push({start_time:r.value.at(-1).end_time,end_time:J(r.value.at(-1).end_time,"HH:mm").add(15,"minute").format("HH:mm")})},W=i=>{M().$confirm({title:"提示",message:"确定删除该时间段吗？",onConfirm:()=>{r.value.splice(i,1)}})},R=async()=>{if(t.image_enable==1&&!t.image_reply){p.msgWarning("请输入图片消息回复内容");return}if(t.stop_enable==1&&!t.stop_keywords){p.msgWarning("请输入停止回复关键词");return}if(t.working_enable==1){if(v.value.length===0){p.msgWarning("请选择接管日期");return}if(r.value.length===0){p.msgWarning("请设置接管时间");return}const{valid:i,indexes:e,errorType:u}=de(r.value);if(!i){C.value=e,p.msgWarning(u);return}if(!t.non_working_reply){p.msgWarning("请输入在接管时间外的自动回复内容");return}const g=r.value.map(m=>`${m.start_time}-${m.end_time}`);Object.keys(t.working_time).forEach(m=>{v.value.includes(Number(m))?t.working_time[m]=g:t.working_time[m]=[]})}try{await ie({...t,robot_id:E.agentId}),p.msgSuccess("保存成功")}catch(i){p.msgError(i||"保存失败")}},{lockFn:F,isLock:j}=A(R),z=async()=>{try{const i=await re({id:E.agentId});i&&Y(i,t),i.working_time&&Object.keys(i.working_time).forEach(e=>{i.working_time[e].length>0&&(v.value.push(Number(e)),r.value=i.working_time[e].map(u=>({start_time:u.split("-")[0],end_time:u.split("-")[1]})))})}catch(i){console.error("获取回复策略失败:",i)}};return H(()=>{z()}),(i,e)=>{const u=Z,g=P,m=Q,N=X,x=ne,b=h,_=ee,G=le,S=se,U=te,L=ae;return f(),c("div",me,[l("div",ue,[o(L,null,{default:a(()=>[l("div",pe,[l("div",_e,[e[13]||(e[13]=l("div",null,"短时间内多条信息回复策略",-1)),l("div",ve,[o(N,{modelValue:s(t).multiple_type,"onUpdate:modelValue":e[0]||(e[0]=n=>s(t).multiple_type=n)},{default:a(()=>[o(u,{value:0},{default:a(()=>e[10]||(e[10]=[d("逐条回复",-1)])),_:1,__:[10]}),o(u,{value:1},{default:a(()=>[o(m,{content:"当用户在两分钟以外，没有继续发送消息，则将多条信息合并回复"},{default:a(()=>[l("div",fe,[e[11]||(e[11]=l("span",null,"合并回复",-1)),o(g,{name:"el-icon-WarningFilled",color:"#9E9E9E"})])]),_:1})]),_:1}),o(u,{value:2},{default:a(()=>[o(m,{content:"当用户在两分钟以外，没有继续发送消息，只回复最后一条信息"},{default:a(()=>[l("div",ce,[e[12]||(e[12]=l("span",null," 只回复最后一条 ",-1)),o(g,{name:"el-icon-WarningFilled",color:"#9E9E9E"})])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),l("div",ge,[e[14]||(e[14]=l("div",null,"语音消息回复策略（目前只支持微信）",-1)),l("div",xe,[o(x,{modelValue:s(t).voice_enable,"onUpdate:modelValue":e[1]||(e[1]=n=>s(t).voice_enable=n),"active-value":1,"inactive-value":0},null,8,["modelValue"])])]),l("div",ke,[e[15]||(e[15]=l("div",null,"智能体被调用时，接收到图片进行固定回复",-1)),l("div",be,[o(x,{modelValue:s(t).image_enable,"onUpdate:modelValue":e[2]||(e[2]=n=>s(t).image_enable=n),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),s(t).image_enable==1?(f(),c("div",ye,[o(b,{modelValue:s(t).image_reply,"onUpdate:modelValue":e[3]||(e[3]=n=>s(t).image_reply=n),type:"textarea",placeholder:"点击输入您要回复的内容",resize:"none",rows:4},null,8,["modelValue"])])):V("",!0)]),l("div",we,[e[16]||(e[16]=l("div",{class:""},"智能体被调用时，接收到某些信息后停止对该条信息进行回复",-1)),l("div",Ve,[o(x,{modelValue:s(t).stop_enable,"onUpdate:modelValue":e[4]||(e[4]=n=>s(t).stop_enable=n),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),s(t).stop_enable==1?(f(),c("div",Ee,[o(b,{modelValue:s(t).stop_keywords,"onUpdate:modelValue":e[5]||(e[5]=n=>s(t).stop_keywords=n),type:"textarea",placeholder:"点击输入您要检测的词语",resize:"none",rows:4},null,8,["modelValue"])])):V("",!0)]),l("div",Ce,[e[18]||(e[18]=l("div",null,[l("div",null,"分段回复")],-1)),l("div",Se,[e[17]||(e[17]=l("div",{class:"text-xs"}," 用户在聊天界面看到的 AI 回复 不是一次性的大段话，而是按段落逐条展示 ",-1)),o(x,{modelValue:s(t).paragraph_enable,"onUpdate:modelValue":e[6]||(e[6]=n=>s(t).paragraph_enable=n),"active-value":1,"inactive-value":0},null,8,["modelValue"])])]),l("div",Ue,[e[30]||(e[30]=l("div",null,"接管时间(AI回复)",-1)),l("div",Ie,[e[19]||(e[19]=l("div",{class:"text-xs text-error"},[d(" 提醒：用户可以设置 AI 在指定的时间段内接管对话，超出接管时间的消息，则会自动发送用户预先设定的固定回复。"),l("span",{class:"font-bold"},"（一小时内仅剩生效一次）")],-1)),o(x,{modelValue:s(t).working_enable,"onUpdate:modelValue":e[7]||(e[7]=n=>s(t).working_enable=n),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),s(t).working_enable==1?(f(),c("div",Te,[o(G,{modelValue:s(v),"onUpdate:modelValue":e[8]||(e[8]=n=>D(v)?v.value=n:null)},{default:a(()=>[o(_,{value:1},{default:a(()=>e[20]||(e[20]=[d("周一",-1)])),_:1,__:[20]}),o(_,{value:2},{default:a(()=>e[21]||(e[21]=[d("周二",-1)])),_:1,__:[21]}),o(_,{value:3},{default:a(()=>e[22]||(e[22]=[d("周三",-1)])),_:1,__:[22]}),o(_,{value:4},{default:a(()=>e[23]||(e[23]=[d("周四",-1)])),_:1,__:[23]}),o(_,{value:5},{default:a(()=>e[24]||(e[24]=[d("周五",-1)])),_:1,__:[24]}),o(_,{value:6},{default:a(()=>e[25]||(e[25]=[d("周六",-1)])),_:1,__:[25]}),o(_,{value:7},{default:a(()=>e[26]||(e[26]=[d("周日",-1)])),_:1,__:[26]})]),_:1},8,["modelValue"]),l("div",We,[(f(!0),c(q,null,K(s(r),(n,y)=>(f(),c("div",{key:y},[l("div",{class:O(["time-select-wrapper",{"!border-error":s(C).includes(y)}])},[o(S,{modelValue:n.start_time,"onUpdate:modelValue":k=>n.start_time=k,class:"!w-[80px]","prefix-icon":"",start:"00:00",step:"00:15",end:"23:59","max-time":n.end_time},null,8,["modelValue","onUpdate:modelValue","max-time"]),e[27]||(e[27]=l("div",{class:""},"至",-1)),o(S,{modelValue:n.end_time,"onUpdate:modelValue":k=>n.end_time=k,class:"!w-[80px]","prefix-icon":"",start:"00:00",step:"00:15",end:"23:59","min-time":n.start_time},null,8,["modelValue","onUpdate:modelValue","min-time"]),l("div",{class:"ml-2 w-4 h-4 flex-shrink-0 bg-app-bg-1 rounded-full flex items-center justify-center cursor-pointer",onClick:k=>W(y)},[o(g,{name:"el-icon-Close",color:"#ffffff",size:10})],8,Re)],2)]))),128)),o(U,{type:"primary",size:"small",onClick:T},{default:a(()=>e[28]||(e[28]=[d("新增时间段",-1)])),_:1,__:[28]})]),l("div",Fe,[e[29]||(e[29]=l("div",{class:"mb-3"},"固定回复内容",-1)),o(b,{modelValue:s(t).non_working_reply,"onUpdate:modelValue":e[9]||(e[9]=n=>s(t).non_working_reply=n),type:"textarea",placeholder:"请输入在接管时间外的自动回复内容",resize:"none",rows:5},null,8,["modelValue"])])])):V("",!0)])])]),_:1})]),l("div",je,[o(U,{type:"primary",class:"w-[318px] !rounded-full !h-[50px]",loading:s(j),onClick:s(F)},{default:a(()=>e[31]||(e[31]=[d(" 保存 ",-1)])),_:1,__:[31]},8,["loading","onClick"])])])}}});const Xe=oe(ze,[["__scopeId","data-v-43506809"]]);export{Xe as default};
