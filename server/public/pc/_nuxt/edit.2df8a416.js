import{E as I,a as L}from"./el-tabs.0dd2047f.js";import{d as $,bM as G,r as u,cd as n,aF as K,A as P,c as U,dk as j,cq as H,D as M,o as J,k as p,l as _,m,q as c,s as f,J as Z,K as O,I as v,Z as i,bK as b,v as V,L as R,aq as Q,t as W,aH as X,bI as Y,G as C,y as tt,ax as et,_ as ot}from"./entry.46557796.js";import{z as it,A as rt,B as mt}from"./agent.a3fcedc5.js";import{KnbTypeEnum as k}from"./index.5bd136e1.js";import{_ as at}from"./index.vue.efc0d5c6.js";import nt from"./index.9e80bf22.js";import st from"./index.1596846f.js";import pt from"./index.9c3ee75b.js";import lt from"./index.c08628a2.js";import ct from"./index.c8d85753.js";import dt from"./index.7f604310.js";import{_ as _t}from"./index.vue.b46c5f1f.js";import"./strings.1c189114.js";import"./index.6e98cf6f.js";import"./index.c84588fb.js";import"./index.fdfb054e.js";import"./index.6c2ab172.js";import"./cloneDeep.18da6720.js";/* empty css                  *//* empty css                    *//* empty css                  */import"./index.52e544f1.js";import"./index.304400de.js";import"./index.c76cd001.js";import"./debounce.22e3311f.js";import"./_baseIteratee.6084bee0.js";import"./index.1d76ef55.js";/* empty css                  *//* empty css               *//* empty css                     */import"./agent_bg.eed26119.js";import"./agent-logo.704f11e1.js";import"./el-slider.239593a3.js";import"./el-input-number.2848ce7e.js";import"./index.08e202f9.js";import"./el-switch.03413428.js";import"./knowledge_base.519704cc.js";import"./index.66741974.js";import"./index.5f8d7d98.js";import"./el-empty.db5857ba.js";/* empty css                        *//* empty css                 */import"./menu-edit.4465b625.js";import"./index.vue.520aef1d.js";import"./el-image.663be0a1.js";import"./el-image-viewer.4c392e93.js";import"./throttle.f2fe0ca7.js";import"./position.bb07cf08.js";import"./web.vue.c377cc75.js";import"./index.816355b6.js";import"./index.vue.383c1815.js";/* empty css                   */import"./useCopy.84a3fbb4.js";import"./usePaging.3ef28349.js";import"./index.7b82a5b7.js";import"./create-popup.vue.7437ca78.js";import"./usage-setting.vue.c7443b57.js";import"./poster-setting.vue.529cf78e.js";import"./vue-qr.823db51d.js";import"./js.vue.f5978794.js";import"./code-view.vue.53e3943b.js";import"./index.vue.6f8ad13e.js";import"./index.3864ff87.js";import"./katex.ff257f19.js";import"./gzh.vue.1d0a8f88.js";import"./gzh-config.vue.6c5a4f6e.js";import"./api.vue.216ad9c0.js";import"./call-code.vue.229f47d2.js";import"./el-collapse.849b2f00.js";import"./index.89b03c7c.js";import"./keywords-edit.vue.057a7218.js";import"./add-content.34d91834.js";import"./el-alert.ec09dd2d.js";import"./index.vue.4fd7b3ea.js";import"./index.vue.7b7084b3.js";import"./arrow_down.70a5466c.js";import"./dom.7f5b5a10.js";import"./index.cf59f1a8.js";import"./emoji.vue.a9dcd8db.js";import"./useHandle.beb30b0b.js";import"./person_wechat.8bcf26fc.js";import"./mini-program-card.vue.7cccd646.js";import"./material-picker.vue.dbd2148f.js";import"./index.vue.94992955.js";import"./sidebar.22f9e609.js";import"./useMaterial.f57939ae.js";import"./container.79644375.js";import"./upload.cf61b504.js";import"./preview.vue.ec784ac8.js";import"./link-card.vue.fa6a35e1.js";import"./file-card.vue.6c632466.js";import"./workflow-edit.vue.acbe937d.js";import"./import-data.vue.3b75ca00.js";import"./el-steps.abe8cd06.js";import"./el-time-select.b40e90ae.js";import"./customParseFormat.df9b4c29.js";import"./utils.dc4516f5.js";import"./chatting.db6ea2ec.js";import"./cloneDeep.2c9fdb34.js";import"./chat.1328a2b2.js";import"./useChatManager.10039942.js";const ut={class:"h-full flex flex-col p-4"},ft={class:"bg-white rounded-[20px] px-[50px]"},bt={class:"grow min-h-0 bg-white rounded-[20px] mt-4 flex"},kt={class:"flex-1 flex flex-col w-full"},gt={class:"px-[14px] h-[72px] flex items-center justify-between flex-shrink-0 border-b-[1px] border-[#0000000d]"},xt={key:0},yt={class:"grow min-h-0"},ht={key:0,class:"w-[400px] flex flex-col border-l-[1px] border-[#0000000d]"},wt={class:"h-[72px] flex items-center gap-x-2 justify-between flex-shrink-0 border-b-[1px] border-[#0000000d] px-5"},vt={class:"flex-1 overflow-hidden text-ellipsis whitespace-nowrap"},Vt={class:"grow min-h-0"},Rt=$({__name:"edit",emits:["back"],setup(Ct,{emit:E}){const N=E,S=G(),l=Number(S.query.id),s=u("base"),g=u([{label:"人设",name:"base",component:n(at)},{label:"知识库",name:"knb",component:n(nt)},{label:"拟人化",name:"humanize",component:n(st)},{label:"界面配置",name:"interface",component:n(pt)},{label:"发布",name:"publish",component:n(lt)},{label:"技能",name:"skill",component:n(ct)},{label:"调用设置",name:"call",component:n(dt)}]),t=K({id:l,kb_type:k.RAG,kb_ids:"",icons:"",image:"",bg_image:"",name:"",intro:"",model_id:"",model_sub_id:"",roles_prompt:"",search_mode:"similar",search_tokens:3e3,search_similar:.4,ranking_status:0,ranking_score:.5,context_num:3,is_public:0,is_enable:1,optimize_ask:0,optimize_m_id:"",optimize_s_id:"",search_empty_type:1,search_empty_text:"",top_p:.9,temperature:.6,presence_penalty:.2,frequency_penalty:.2,logprobs:0,top_logprobs:10,welcome_introducer:"",copyright:"",menus:[],flow_status:0,flow_config:{workflow_id:"",bot_id:"",app_id:"",api_token:""},threshold:.5}),x=u(),y=P(),A=U(()=>{var o;return(o=g.value.find(e=>e.name===s.value))==null?void 0:o.component}),D=async()=>{var o;await X(),(o=y.value)==null||o.startNewChat()},T=async()=>{if(l)try{const o=await it({id:l});Y(o,t),t.kb_type==k.RAG&&o.kb_ids.length>0&&(t.kb_ids=o.kb_ids[0]),t.presence_penalty=Number(t.presence_penalty),t.frequency_penalty=Number(t.frequency_penalty),t.top_p=Number(t.top_p),t.temperature=Number(t.temperature)}catch(o){console.error("获取智能体详情失败:",o)}},h=async o=>{var e,d;try{await((d=(e=x.value)==null?void 0:e.validate)==null?void 0:d.call(e));const a={...t,kb_ids:t.kb_type==k.RAG&&typeof t.kb_ids=="string"?[t.kb_ids]:t.kb_ids};t.id?await rt(a):await mt(a),o||C.msgSuccess(`${t.id?"编辑":"添加"}成功`)}catch(a){o||C.msgError(typeof a=="string"?a:"请填写相关信息")}},q=j(()=>h(!0),300),{lockFn:B,isLock:z}=H(()=>h(!1));return M(t,()=>{q()},{deep:!0}),J(()=>{T()}),(o,e)=>{const d=I,a=L,F=tt,w=et;return p(),_("div",ut,[m("div",ft,[c(a,{modelValue:i(s),"onUpdate:modelValue":e[0]||(e[0]=r=>b(s)?s.value=r:null)},{default:f(()=>[(p(!0),_(Z,null,O(i(g),r=>(p(),v(d,{key:r.name,label:r.label,name:r.name},null,8,["label","name"]))),128))]),_:1},8,["modelValue"])]),m("div",bt,[m("div",kt,[m("div",gt,[m("div",{class:"flex items-center gap-2 cursor-pointer",onClick:e[1]||(e[1]=r=>N("back"))},[c(F,{name:"el-icon-ArrowLeft"}),e[4]||(e[4]=m("div",null,"返回",-1))]),["skill","publish","call"].includes(i(s))?R("",!0):(p(),_("div",xt,[c(w,{type:"primary",class:"!rounded-full !w-[68px]",loading:i(z),onClick:i(B)},{default:f(()=>e[5]||(e[5]=[V(" 保存 ",-1)])),_:1,__:[5]},8,["loading","onClick"])]))]),m("div",yt,[(p(),v(Q(i(A)),{ref_key:"formRef",ref:x,modelValue:i(t),"onUpdate:modelValue":e[2]||(e[2]=r=>b(t)?t.value=r:null),"agent-id":i(l)},null,8,["modelValue","agent-id"]))])]),["publish"].includes(i(s))?R("",!0):(p(),_("div",ht,[m("div",wt,[m("div",vt,W(i(t).name),1),c(w,{onClick:D},{default:f(()=>e[6]||(e[6]=[V("新建对话",-1)])),_:1,__:[6]})]),m("div",Vt,[c(_t,{ref_key:"chatRef",ref:y,modelValue:i(t),"onUpdate:modelValue":e[3]||(e[3]=r=>b(t)?t.value=r:null),"agent-id":i(l)},null,8,["modelValue","agent-id"])])]))])])}}});const ho=ot(Rt,[["__scopeId","data-v-20f2ac9c"]]);export{ho as default};
