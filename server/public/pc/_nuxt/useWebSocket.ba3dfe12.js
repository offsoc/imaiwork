import{r as v,bx as H,dY as b}from"./entry.d7219633.js";function k(g,y={}){const a=v(null),l=v(!1),n=v(0),{maxRetries:f=5,retryBaseDelay:R=1e3,heartbeatInterval:h=3e4,heartbeatMessage:C={type:"ping"},manualHeartbeat:w=!1,manual:E=!1}=y,u=new Map;let c=null,r=null;const i=()=>{typeof window<"u"&&!a.value&&(a.value=new WebSocket(g),a.value.onopen=()=>{l.value=!0,n.value=0,d(),o("open")},a.value.onmessage=e=>{try{const t=JSON.parse(e.data);o("message",t),O()}catch{o("error",{error:"消息解析失败",code:b.PARSE_ERROR})}},a.value.onclose=e=>{l.value=!1,m(),!e.wasClean&&n.value<f&&S(),o("close",e)},a.value.onerror=e=>{var t;o("error",{error:"连接失败",code:b.CONNECT_ERROR}),(t=a.value)==null||t.close()})},o=(e,t)=>{const s=u.get(e);s&&s(t)},d=()=>{r=setInterval(()=>{var e;l.value&&(w?o("heartbeat"):(e=a.value)==null||e.send(JSON.stringify(C)))},h)},O=()=>{r&&(clearInterval(r),d())},S=()=>{const e=R*Math.pow(2,n.value);n.value+=1,c=setTimeout(()=>{n.value<=f&&i()},e)},m=()=>{r&&clearInterval(r),c&&clearTimeout(c),r=null,c=null},N=e=>{var t;l.value&&((t=a.value)==null||t.send(JSON.stringify(e)))},p=(e,t)=>{var s;(s=a.value)==null||s.close(e,t),m()},T=(e,t)=>{u.set(e,t)};return E||i(),H(()=>{p(1e3,"Component unmounted"),u.clear()}),{socket:a,isConnected:l,retryCount:n,send:N,close:p,on:T,reconnect:i}}export{k as u};
