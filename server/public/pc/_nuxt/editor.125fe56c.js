import{d as S,bM as T,a as G,z as L,aG as R,dt as U,aF as $,A as H,cq as O,G as k,dq as Y,aH as g,o as Z,k as _,l as y,m as l,q as s,s as n,v,Z as o,av as b,Y as J,L as K,ax as Q,au as W,ay as X,_ as ee}from"./entry.d9d53b29.js";import{_ as te}from"./index.5be3fdec.js";import{m as oe,a as le}from"./mind_map.667e7a11.js";import{u as se}from"./useMindMap.d85e9900.js";import{m as ae}from"./common.1373bb04.js";import{ScenePromptEnum as h}from"./chatEnum.1c450e0f.js";import{E as ne}from"./index.050c9b6b.js";import"./index.3864ff87.js";import"./index.937f4495.js";import"./katex.0065138a.js";const re={class:"flex h-full w-full flex-col items-center"},ie={class:"relative flex w-full grow overflow-hidden"},de={class:"absolute right-2 top-2 z-[888]"},pe={class:"w-[350px] flex-shrink-0 justify-center min-h-0 bg-white pt-4"},ue={class:"h-full grow"},me={class:"flex h-full flex-col px-5 pt-2 gap-y-4"},ce={class:"flex items-center justify-between gap-x-2"},fe={class:"grow w-3/5 p-4 justify-center lg:border-l border-token-border-medium overflow-hidden relative"},_e={class:"flex-grow pb-5 h-full"},ye={class:"grow overflow-hidden relative"},ve={key:0,class:"absolute top-0 left-0 w-full h-full flex flex-col items-center justify-center bg-white z-[88888]"},xe=S({__name:"editor",setup(we){var x;const d=T(),M=G(),p=L(),{userTokens:E}=R(p),C=(x=p.getTokenByScene(U.MIND_MAP))==null?void 0:x.score,t=$({id:"",reply:"",ask:"",prompt_id:h.AI_MIND_MAP}),u=H(null),{markmap:i,toolbarContainer:I,isFullscreen:V,mindMapInit:F,mindMapFit:N,mindMapExportAsPNG:z}=se(),A=async()=>{t.reply=ae,i.value&&i.value.destroy(),await g(),c()},P=()=>{z(u.value)},{lockFn:j,isLock:m}=O(async()=>{if(E.value<=C.value){k.msgPowerInsufficient();return}i.value&&i.value.destroy();try{const a=t.id?await oe({id:t.id,message:t.ask}):await Y({message:t.ask,prompt_id:h.AI_MIND_MAP});t.reply=a.reply,t.id=a.id,M.replace({path:d.path,query:{id:a.id}}),p.getUser(),c()}catch(a){k.msgError(a||"发生错误")}}),q=async()=>{const a=await le({id:d.query.id});Object.keys(t).forEach(e=>{t[e]=a[e]}),c()},c=async()=>{F(u.value),await g(),N(t.reply.replace(/```markdown/g,"").replace(/```/g,""))};return Z(()=>{d.query.id&&q()}),(a,e)=>{const f=Q,w=W,B=X,D=te;return _(),y("div",re,[l("div",ie,[l("div",de,[s(f,{type:"primary",round:"",class:"flex w-full items-center justify-center gap-1.5",disabled:o(m)||!o(t).reply,onClick:e[0]||(e[0]=r=>P())},{default:n(()=>e[5]||(e[5]=[v(" 导出思维导图 ",-1)])),_:1,__:[5]},8,["disabled"])]),l("div",pe,[l("div",ue,[s(o(ne),null,{default:n(()=>[l("div",me,[s(B,{model:o(t),"label-position":"top"},{default:n(()=>[s(o(b),{label:"输入内容即可生成思维导图"},{default:n(()=>[s(w,{modelValue:o(t).ask,"onUpdate:modelValue":e[1]||(e[1]=r=>o(t).ask=r),type:"textarea",rows:15,resize:"none",placeholder:""},null,8,["modelValue"]),s(f,{class:"w-full !h-10 mt-4",round:"",type:"primary",disabled:!o(t).ask,loading:o(m),onClick:e[2]||(e[2]=r=>o(j)())},{default:n(()=>e[6]||(e[6]=[v("立即生成 ",-1)])),_:1,__:[6]},8,["disabled","loading"])]),_:1}),s(o(b),null,{label:n(()=>[l("div",ce,[e[8]||(e[8]=l("span",null,"内容大纲",-1)),s(f,{type:"primary",link:"",onClick:e[3]||(e[3]=r=>A())},{default:n(()=>e[7]||(e[7]=[v("试试示例",-1)])),_:1,__:[7]})])]),default:n(()=>[s(w,{modelValue:o(t).reply,"onUpdate:modelValue":e[4]||(e[4]=r=>o(t).reply=r),type:"textarea",disabled:"",rows:25,resize:"none",placeholder:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])])]),_:1})])]),l("div",fe,[l("div",_e,[l("div",{class:J(["h-full flex flex-col gap-y-2",{"fixed top-0 left-0 w-full z-[8888] bg-white":o(V)}])},[l("div",ye,[l("div",{ref_key:"toolbarContainer",ref:I},null,512),(_(),y("svg",{ref_key:"mindMapContainer",ref:u,class:"w-full h-full"},null,512))])],2)]),o(m)?(_(),y("div",ve,[s(D),e[9]||(e[9]=l("div",{class:"text-sm text-gray-500 mt-10"},"正在生成思维导图...",-1))])):K("",!0)])])])}}});const Ne=ee(xe,[["__scopeId","data-v-80a11269"]]);export{Ne as default};
