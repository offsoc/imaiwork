import{d as ie,bM as ae,ed as re,c as g,aF as de,r as C,cq as ce,G as b,b6 as pe,k as r,l as p,m as e,q as i,s as u,v as x,Z as l,I as L,t as d,L as m,J as f,K as y,Y as z,aI as A,B as ue,C as me,aH as fe,bQ as xe,y as _e,ax as ve,au as ge,b5 as be,u as ye,_ as he}from"./entry.d7219633.js";import{_ as ke}from"./index.55703cf7.js";import{E as we,a as Le}from"./index.50778a9c.js";import{E as Ee}from"./el-slider.0a90f692.js";import{E as Ie}from"./index.4953ba77.js";import{E as Ve}from"./index.f15af271.js";/* empty css                  *//* empty css               *//* empty css                     */import"./el-input-number.368c2208.js";import{b as Se,u as Te}from"./knowledge_base.519704cc.js";import{p as Fe}from"./common.1373bb04.js";import{KnTypeEnum as je}from"./index.5bd136e1.js";import"./index.3adcf74a.js";import"./index.9efd0300.js";import"./cloneDeep.1f319c9b.js";/* empty css                  *//* empty css                    *//* empty css                  */import"./strings.03d3529c.js";import"./debounce.085e8a4a.js";import"./_baseIteratee.5c97421a.js";import"./index.ead96a32.js";import"./index.2311001e.js";const Be={class:"h-full bg-white rounded-[20px] overflow-x-auto dynamic-scroller"},Ce={class:"h-full flex flex-col min-w-[1000px]"},ze={class:"flex-shrink-0 flex items-center justify-between px-[14px] h-[88px] border-b border-[#0000000d]"},Ae={class:"flex items-center gap-1"},Ne={class:"px-5"},Oe={class:"flex-shrink-0 flex items-center justify-center h-[100px] border-b border-[#0000000d] gap-x-[150px]"},Me={class:"flex flex-col items-center gap-2"},Re={class:"grow min-h-0 flex flex-col p-5"},Ue={class:"w-[556px] mx-auto"},Pe={class:"mt-3"},$e={class:"flex flex-col items-center justify-center"},qe={class:"text-xs text-[#0000004d] mt-3 w-[80%] leading-6 break-all"},De={class:"mt-3 rounded-xl border border-[#efefef] p-[14px]"},Ke={class:"flex items-center gap-x-3"},Qe={class:"rounded-md border border-[rgba(0,0,0,0.1)] w-10 h-10 flex items-center justify-center"},Ge={class:"mt-6 grid grid-cols-3 gap-3"},We={class:""},He={class:"mt-3"},Je={class:"font-bold"},Ye={class:""},Ze={class:"mt-3"},Xe={class:""},et={class:"mt-3"},tt={key:0,class:"mt-3"},st={class:"text-[#00000080] flex items-center gap-x-2"},lt={class:"leading-[0]"},ot={class:"mt-3"},nt={class:"mt-3 rounded-xl border border-[#efefef] p-[14px]"},it={class:"flex items-center gap-x-3"},at={class:"rounded-md border border-[rgba(0,0,0,0.1)] w-10 h-10 flex items-center justify-center"},rt={class:"text-[11px] text-[#00000080] mt-1"},dt={class:"h-11 rounded-md border border-[#efefef] mt-6 bg-[#f6f6f6] flex items-center gap-x-3 px-3"},ct={class:"w-5 h-5 rounded flex items-center justify-center bg-[#0000000d]"},pt={class:"flex-1"},ut={key:0,class:"text-[11px] leading-6 mt-6 text-[#00000080]"},mt={class:"flex justify-center mt-10"},N=20,O=10,M=".pdf,.docx,.doc,.txt,.md,.pptx,.ppt,.xlsx,.xls,.png,.jpg,.jpeg,.bmp,.gif",ft=ie({__name:"rag-panel",props:{knName:{default:""},knId:{default:""},indexId:{default:""},categoryId:{default:""}},emits:["back"],setup(R,{emit:U}){const h=R,E=U,I=ae(),P=ye(),$=re(),v=g(()=>I.query.kn_type==je.RAG),q=g(()=>v.value?`${ue()}${me()}/knowledge/fileUpload`:""),s=de({segmentationIdentifier:[],segmentationMaxLength:1024,segmentationOverlapLength:100,similarityThreshold:.5,fileLists:[]}),k=[{step:1,title:"上传文件"},{step:2,title:"文本分段与清洗"},{step:3,title:"处理并完成"}],n=C(Number($.step)||1),V=g(()=>n.value===k.length),D=async()=>{n.value===1||n.value===3?S():(n.value--,n.value===1&&(await fe(),T.value.setFileList(s.fileLists)),xe({...I.query,step:n.value}))},K=()=>{P.$confirm({message:"确定要取消吗？",onConfirm:S})},Q=async()=>{let a=!1;if(n.value===1)a=await J();else if(n.value===2)a=await Y();else if(V.value)return;a&&n.value++},S=()=>{E("back"),n.value=1},T=C(null),G=g(()=>O-s.fileLists.length),W=a=>{s.fileLists.push(a.data)},H=a=>{if(a.response){const{data:t}=a.response,c=s.fileLists.findIndex(_=>_.id===t.id);c!==-1&&s.fileLists.splice(c,1)}},J=async()=>{try{return s.fileLists.length===0?(b.msgWarning("请上传文件"),!1):!0}catch(a){b.msgError(a)}return!0},Y=async()=>s.segmentationIdentifier.length===0?(b.msgWarning("请选择分段标识符"),!1):(await Z(),!0),{lockFn:Z,isLock:F}=ce(async()=>new Promise(async(a,t)=>{try{v.value?await Se({id:h.knId,index_id:h.indexId,category_id:h.categoryId,chunk_size:s.segmentationMaxLength,documents:s.fileLists,overlap_size:s.segmentationOverlapLength,rerank_min_score:s.similarityThreshold,separator:s.segmentationIdentifier,strategy:2}):await Te({name:s.fileLists[0].name,file_id:s.fileLists[0].id}),a(!0)}catch(c){b.msgError(c),t(!1)}}));return window.onbeforeunload=()=>"请勿刷新页面",(a,t)=>{const c=_e,_=ve,X=ke,ee=we,te=Le,j=ge,se=be,le=Ee,oe=Ie,ne=Ve,B=pe("number-input");return r(),p("div",Be,[e("div",Ce,[e("div",ze,[e("div",{class:"flex items-center gap-2 cursor-pointer",onClick:D},[i(c,{name:"el-icon-ArrowLeft"}),t[5]||(t[5]=e("div",null,"返回上一步",-1))]),e("div",Ae,[i(_,{class:"!rounded-full !h-10 w-[98px]",disabled:l(F),onClick:K},{default:u(()=>t[6]||(t[6]=[x("取消",-1)])),_:1,__:[6]},8,["disabled"]),l(n)!=3?(r(),L(_,{key:0,type:"primary",class:"!rounded-full !h-10 w-[98px]",loading:l(F),onClick:Q},{default:u(()=>[x(d(l(V)?"提交":"下一步"),1)]),_:1},8,["loading"])):m("",!0)])]),e("div",Ne,[e("div",Oe,[(r(),p(f,null,y(k,(o,w)=>e("div",{key:w,class:"relative"},[e("div",Me,[e("div",{class:z(["w-6 h-6 rounded-full flex items-center justify-center",[l(n)>=o.step?"bg-primary text-white":"bg-[#0000000d]"]])},d(w+1),3),e("div",null,d(o.title),1),w!=k.length-1?(r(),p("div",{key:0,class:z(["absolute w-[120px] h-[1px] left-[calc(100%+15px)] top-[10px]",[l(n)>o.step?"bg-primary":"bg-[#0000000d]"]])},null,2)):m("",!0)])])),64))])]),e("div",Re,[i(ne,null,{default:u(()=>[e("div",Ue,[l(n)==1?(r(),p(f,{key:0},[t[8]||(t[8]=e("div",{class:"text-[#00000080]"},"上传文件",-1)),e("div",Pe,[i(X,{class:"w-full",ref_key:"uploadRef",ref:T,drag:"",multiple:"",type:"file","list-type":"text","show-file-list":"",action:l(q),data:{indexid:a.indexId},"max-size":N,limit:l(G),accept:M,onRemove:H,onSuccess:W},{default:u(()=>[e("div",$e,[i(c,{name:"local-icon-file_add",size:28}),t[7]||(t[7]=e("div",{class:"text-xs mt-3"},"点击或将文件拖拽到这里上传",-1)),e("div",qe," 支持"+d(M)+"格式，文件最大限制"+d(N)+"MB,最多支持（"+d(l(s).fileLists.length)+"/ "+d(O)+"）个 ",1)])]),_:1},8,["action","data","limit"])])],64)):m("",!0),l(n)==2?(r(),p(f,{key:1},[t[15]||(t[15]=e("div",{class:"text-[#00000080]"},"分段设置",-1)),e("div",De,[e("div",Ke,[e("div",Qe,[i(c,{name:"local-icon-fodder",size:24})]),t[9]||(t[9]=e("div",null,[e("div",{class:"font-bold"},"通用"),e("div",{class:"text-[11px] text-[#00000080] mt-1"}," 通用文本分块模式，检索和搜索的块是相同的 ")],-1))]),e("div",Ge,[e("div",We,[t[10]||(t[10]=e("div",{class:"text-[#00000080]"},"分段标识符",-1)),e("div",He,[i(te,{class:"!h-11",modelValue:l(s).segmentationIdentifier,"onUpdate:modelValue":t[0]||(t[0]=o=>l(s).segmentationIdentifier=o),multiple:"",clearable:"","collapse-tags":"","collapse-tags-tooltip":"",placeholder:"请选择分段标识符"},{default:u(()=>[(r(!0),p(f,null,y(l(Fe),o=>(r(),L(ee,{key:o.value,label:`${o.label}：${o.value}`,value:o.value},{default:u(()=>[e("span",null,d(o.label)+"：",1),e("span",Je,d(o.value),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])])]),e("div",Ye,[t[11]||(t[11]=e("div",{class:"text-[#00000080]"},"分段最大长度",-1)),e("div",Ze,[A(i(j,{class:"!h-11",modelValue:l(s).segmentationMaxLength,"onUpdate:modelValue":t[1]||(t[1]=o=>l(s).segmentationMaxLength=o),type:"number"},null,8,["modelValue"]),[[B,{decimalPlaces:0,min:1,max:1024}]])])]),e("div",Xe,[t[12]||(t[12]=e("div",{class:"text-[#00000080]"},"分段重叠长度",-1)),e("div",et,[A(i(j,{class:"!h-11",modelValue:l(s).segmentationOverlapLength,"onUpdate:modelValue":t[2]||(t[2]=o=>l(s).segmentationOverlapLength=o),type:"number"},null,8,["modelValue"]),[[B,{decimalPlaces:0,min:1,max:2048}]])])])]),l(v)?(r(),p("div",tt,[e("div",st,[t[14]||(t[14]=x(" 相似度阈值 ",-1)),i(se,{"popper-class":"w-[200px]"},{content:u(()=>t[13]||(t[13]=[e("div",null," 设定最低分数标准，只有达到或超过这个阈值的检索结果才会被考虑用于后续的排序和生成过程 ",-1)])),default:u(()=>[e("div",lt,[i(c,{name:"el-icon-QuestionFilled",color:"#858585"})])]),_:1})]),e("div",ot,[i(le,{modelValue:l(s).similarityThreshold,"onUpdate:modelValue":t[3]||(t[3]=o=>l(s).similarityThreshold=o),min:0,max:1,step:.01,size:"small","show-input":""},null,8,["modelValue"])])])):m("",!0)])],64)):m("",!0),l(n)==3?(r(),p(f,{key:2},[t[19]||(t[19]=e("div",{class:"text-[#00000080]"},"处理完成",-1)),e("div",nt,[e("div",it,[e("div",at,[i(c,{name:"local-icon-upload",size:24})]),e("div",null,[t[16]||(t[16]=e("div",{class:"font-bold"},"文档已上传",-1)),e("div",rt," 文档已上传至知识库：【"+d(a.knName)+"】，你可以在知识库的文档列表中找到它。 ",1)])]),(r(!0),p(f,null,y(l(s).fileLists,o=>(r(),p("div",dt,[e("div",ct,[i(c,{name:"local-icon-upload2"})]),e("div",pt,d(o.name),1),i(c,{name:"local-icon-success_fill",color:"var(--color-primary)"})]))),256)),l(v)?(r(),p("div",ut,[e("p",null,[t[17]||(t[17]=x(" 分段模式： ",-1)),(r(!0),p(f,null,y(l(s).segmentationIdentifier,o=>(r(),L(oe,{class:"mx-1",key:o,type:"success",size:"small"},{default:u(()=>[x(d(o),1)]),_:2},1024))),128))]),e("p",null,"最大分段长度："+d(l(s).segmentationMaxLength),1),e("p",null,"分段重叠长度："+d(l(s).segmentationOverlapLength),1),e("p",null,"相似度阈值："+d(l(s).similarityThreshold),1)])):m("",!0)]),e("div",mt,[i(_,{type:"primary",class:"!rounded-full !h-[50px] w-[318px]",onClick:t[4]||(t[4]=o=>E("back"))},{default:u(()=>t[18]||(t[18]=[x(" 返回文档 ",-1)])),_:1,__:[18]})])],64)):m("",!0)])]),_:1})])])])}}});const Rt=he(ft,[["__scopeId","data-v-03f0d207"]]);export{Rt as default};
