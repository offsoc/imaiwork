import{d as G,bP as H,aF as J,r as $,A as O,o as Z,k as o,l as y,Z as a,m as r,q as s,s as l,v as d,$ as z,aI as Q,I as k,t as V,L as p,bM as X,J as Y,bO as C,aH as ee,G as x,ax as te,y as se,au as ae,cW as ne,u as le}from"./entry.ca4d3d61.js";import{E as oe,a as ie}from"./index.5f182cdf.js";import{E as re,a as pe}from"./index.9a4d38a6.js";import{E as ue}from"./el-switch.f1c6cc29.js";import{E as ce}from"./el-empty.355e6a02.js";import{_ as de}from"./index.vue.441733b3.js";/* empty css                  *//* empty css               *//* empty css                     *//* empty css                        *//* empty css                 */import{u as me}from"./usePaging.15b2220c.js";import{ap as _e,ak as fe,aq as ye}from"./person_wechat.703f63bb.js";import{PushTypeEnum as ve,SidebarTypeEnum as b,SendWayMap as he}from"./index.a1206616.js";import ge from"./create-panel.c5174042.js";import{_ as ke}from"./send-record.vue.f14192be.js";const xe={key:0,class:"h-full flex flex-col bg-white rounded-xl"},Ee={class:"flex items-center justify-between p-4"},Ce={class:"flex items-center gap-2"},be={class:"flex items-center gap-2"},we={class:"grow min-h-0 flex flex-col"},Se={class:"grow min-h-0"},Pe={class:"flex items-center gap-2 justify-center"},$e={key:0,class:"text-info"},Oe={key:1,class:"text-warning"},Ve={key:2,class:"text-success"},Te={class:"flex justify-end p-4"},Ze=G({__name:"index",setup(Re){const w=le(),{query:v}=H(),m=J({status:"",push_name:"",push_type:ve.AUTO_SOP}),{pager:_,getLists:i,resetParams:T}=me({fetchFun:_e,params:m}),u=$(v.is_create=="1"&&parseInt(v.type)==b.AUTO_SOP),h=$(v.is_record=="1"&&parseInt(v.type)==b.AUTO_SOP),S=O(),R=O(),B=async n=>{u.value=!0,C({is_create:1})},U=async n=>{var e;u.value=!0,await ee(),(e=S.value)==null||e.getDetail(n),C({id:n,is_create:1})},A=async n=>{w.$confirm({message:`是否${n.status==1?"开启":"关闭"}该任务？`,onConfirm:async()=>{try{await fe({id:n.id,status:n.status==1?2:1,type:n.type,stage_id:n.stage_id,flow_id:n.flow_id}),i(),x.msgSuccess("操作成功")}catch(e){x.msgError(e)}}})},I=async n=>{w.$confirm({message:"是否删除该SOP任务？",onConfirm:async()=>{try{await ye({id:n}),i(),x.msgSuccess("删除成功")}catch(e){x.msgError(e)}}})},D=n=>{h.value=!0,C({id:n,is_record:1})},P=()=>{u.value=!1,h.value=!1,window.history.replaceState("","",`?type=${b.AUTO_SOP}`),i()};return Z(()=>{u.value||i()}),(n,e)=>{const f=te,g=oe,N=ie,q=se,L=ae,c=re,j=ue,F=ce,M=pe,K=de,W=ne;return o(),y(Y,null,[!a(u)&&!a(h)?(o(),y("div",xe,[r("div",Ee,[s(f,{type:"primary",onClick:e[0]||(e[0]=t=>B())},{default:l(()=>[...e[8]||(e[8]=[d("添加自动SOP",-1)])]),_:1}),r("div",Ce,[r("div",be,[s(N,{modelValue:a(m).status,"onUpdate:modelValue":e[1]||(e[1]=t=>a(m).status=t),"empty-values":[null,void 0],class:"!w-[120px]",onChange:e[2]||(e[2]=t=>a(i)())},{default:l(()=>[s(g,{label:"全部",value:""}),s(g,{label:"未配置",value:"0"}),s(g,{label:"未开启",value:"1"}),s(g,{label:"已开启",value:"2"})]),_:1},8,["modelValue"])]),r("div",null,[s(L,{modelValue:a(m).push_name,"onUpdate:modelValue":e[4]||(e[4]=t=>a(m).push_name=t),class:"!w-[240px]",clearable:"",placeholder:"请输入任务名称",onClear:e[5]||(e[5]=t=>a(T)()),onKeyup:e[6]||(e[6]=z(t=>a(i)(),["enter"]))},{append:l(()=>[s(f,{onClick:e[3]||(e[3]=t=>a(i)())},{default:l(()=>[s(q,{name:"el-icon-Search"})]),_:1})]),_:1},8,["modelValue"])])])]),r("div",we,[r("div",Se,[Q((o(),k(M,{data:a(_).lists,stripe:"",height:"100%","header-row-style":{height:"62px"},"row-style":{height:"60px"}},{empty:l(()=>[s(F,{description:"暂无数据"})]),default:l(()=>[s(c,{label:"任务名称",prop:"push_name","min-width":"200"}),s(c,{label:"营销总天数",prop:"all_day",width:"100"},{default:l(({row:t})=>[d(V(t.all_day)+"天 ",1)]),_:1}),s(c,{prop:"type",label:"营销类型","min-width":"120"},{default:l(({row:t})=>[d(V(a(he)[t.type]),1)]),_:1}),s(c,{label:"任务状态",width:"220px"},{default:l(({row:t})=>[r("div",Pe,[t.status==0?(o(),y("span",$e," 未配置 ")):p("",!0),t.status==1?(o(),y("span",Oe," 未开启 ")):p("",!0),t.status==2?(o(),y("span",Ve," 已开启 ")):p("",!0),t.status!=0?(o(),k(j,{key:3,"model-value":t.status,"active-value":2,"inactive-value":1,style:{"--el-switch-on-color":"var(--el-color-success)","--el-switch-off-color":"var(--el-color-warning)"},onChange:E=>A(t)},null,8,["model-value","onChange"])):p("",!0)])]),_:1}),s(c,{label:"创建时间",prop:"create_time",width:"200px"}),s(c,{label:"操作",width:"160",fixed:"right"},{default:l(({row:t})=>[s(f,{type:"primary",link:"",onClick:E=>U(t.id)},{default:l(()=>[...e[9]||(e[9]=[d("编辑",-1)])]),_:1},8,["onClick"]),s(f,{type:"primary",link:"",onClick:E=>D(t.id)},{default:l(()=>[...e[10]||(e[10]=[d("详情",-1)])]),_:1},8,["onClick"]),s(f,{type:"danger",link:"",onClick:E=>I(t.id)},{default:l(()=>[...e[11]||(e[11]=[d("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[W,a(_).loading]])]),r("div",Te,[s(K,{modelValue:a(_),"onUpdate:modelValue":e[7]||(e[7]=t=>X(_)?_.value=t:null),onChange:a(i)},null,8,["modelValue","onChange"])])])])):p("",!0),a(u)?(o(),k(ge,{key:1,ref_key:"createPanelRef",ref:S,onBack:P},null,512)):p("",!0),a(h)?(o(),k(ke,{key:2,ref_key:"sendRecordRef",ref:R,onBack:P},null,512)):p("",!0)],64)}}});export{Ze as _};
