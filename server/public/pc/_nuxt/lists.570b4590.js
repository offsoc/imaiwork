import{d as S,aF as U,r as k,G as p,o as q,k as f,l as E,m as s,q as o,s as a,v,Z as c,dA as K,aI as H,I as T,bK as J,cO as Z,L as z,J as Q,aH as X,ax as Y,dB as ee,cT as oe,y as te,au as se,cP as ae,u as ne,_ as le}from"./entry.d7219633.js";import{E as ie,a as ce}from"./index.0a6eb9ae.js";import{E as de}from"./index.1f8dde63.js";import{E as re}from"./el-empty.77af023a.js";import{_ as ue}from"./index.vue.5e2341cc.js";/* empty css                        *//* empty css                        *//* empty css               *//* empty css                   *//* empty css                 *//* empty css                     */import{u as pe}from"./usePaging.3c53b51c.js";import{ac as me,ad as _e,I as fe}from"./person_wechat.8bcf26fc.js";import ve from"./useWeChatWs.2a9fe923.js";import{MsgTypeEnum as n}from"./index.cf59f1a8.js";import"./index.f15af271.js";import"./_baseIteratee.5c97421a.js";import"./debounce.085e8a4a.js";import"./index.ead96a32.js";import"./index.50778a9c.js";import"./index.4953ba77.js";import"./strings.03d3529c.js";import"./useWebSocket.ba3dfe12.js";const ge={class:"h-full flex flex-col bg-white rounded-lg"},he={class:"flex items-center justify-between flex-shrink-0 p-4"},ye={class:"flex items-center justify-end gap-2 grow"},Ce={class:"grow min-h-0 flex flex-col overflow-hidden"},xe={class:"grow min-h-0"},we={key:0,class:"flex items-center gap-2"},ke={key:1,class:"flex items-center gap-2"},Ee={class:"flex flex-col gap-2"},be=["onClick"],De=["onClick"],Ie={class:"flex justify-end p-4"},Te={class:"flex flex-col gap-y-4"},Ae=S({__name:"lists",setup(Ve){const b=ne(),h=U({device_status:""}),{pager:m,getLists:d}=pe({fetchFun:me,params:h}),g=k(!1),D=k(),_=k(""),{on:y,send:A,isConnected:V,addDeviceLoading:I,actionType:C}=ve();y("message",t=>{const{MsgType:e}=t;e===n.CleanCache&&p.msgSuccess("清除缓存成功"),(e==n.WeChatOfflineNotice||e==n.WeChatOnlineNotice)&&d()}),y("success",t=>{t.type==="add-device"&&(g.value=!1,d())}),y("action",async t=>{const{type:e,accessToken:i,deviceId:r,wechatId:w}=t;e===n.CleanCache&&(x(n.CleanCache,{deviceId:r,accessToken:i,wechatId:w}),C.value=void 0)});function x(t,e={}){if(![n.AddDevice,n.Auth,n.CleanCache].includes(t))return;const r={DeviceId:e.deviceId,AccessToken:e.accessToken,WeChatId:e.wechatId,TaskId:e.TaskId||Date.now()};A({MsgType:t,Content:r})}const B=async()=>{var t;_.value="",g.value=!0,await X(),(t=D.value)==null||t.open()},P=async()=>{if(!V.value){p.msgError("网络连接失败，请检查网络");return}if(!_.value)return p.msgError("请输入您的设备授权码");C.value=n.AddDevice,I.value=!0,x(n.AddDevice,{deviceId:_.value})},R=async t=>{b.$confirm({message:"确定要移除设备吗？此操作不可逆！",onConfirm:async()=>{p.loading("移除中...");try{await _e({id:t.id,device_code:t.device_code}),await fe({device_code:t.device_code,is_used:!1}),p.msgSuccess("移除成功"),d()}catch(e){p.msgError(e||"移除失败")}finally{p.closeLoading()}}})},L=async t=>{b.$confirm({message:"确定要清除该设备的缓存吗？",onConfirm:async()=>{C.value=n.CleanCache,x(n.Auth,{deviceId:t.device_code})}})};return q(()=>{d()}),(t,e)=>{const i=Y,r=ee,w=oe,u=ie,N=te,$=de,j=re,M=ce,W=ue,F=se,G=ae;return f(),E(Q,null,[s("div",ge,[s("div",he,[o(i,{type:"primary",onClick:B},{default:a(()=>e[4]||(e[4]=[v("新增设备",-1)])),_:1,__:[4]}),s("div",ye,[o(w,{modelValue:h.device_status,"onUpdate:modelValue":e[0]||(e[0]=l=>h.device_status=l),onChange:c(d)},{default:a(()=>[o(r,{label:"全部",value:""}),o(r,{label:"在线",value:1}),o(r,{label:"离线",value:0})]),_:1},8,["modelValue","onChange"]),o(i,{icon:c(K),onClick:c(d)},null,8,["icon","onClick"])])]),s("div",Ce,[s("div",xe,[H((f(),T(M,{data:c(m).lists,stripe:"",height:"100%","header-row-style":{height:"62px"},"row-style":{height:"60px"}},{empty:a(()=>[o(j,{description:"暂无数据"})]),default:a(()=>[o(u,{prop:"device_model",label:"设备型号","min-width":"120"}),o(u,{prop:"status",label:"状态",width:"80"},{default:a(({row:l})=>[l.device_status===1?(f(),E("div",we,e[5]||(e[5]=[s("div",{class:"w-2 h-2 bg-success rounded-full"},null,-1),v(" 在线 ",-1)]))):(f(),E("div",ke,e[6]||(e[6]=[s("div",{class:"w-2 h-2 bg-danger rounded-full"},null,-1),v(" 离线 ",-1)])))]),_:1}),o(u,{prop:"device_code",label:"设备码","min-width":"160"}),o(u,{prop:"wechat_id",label:"微信ID",width:"180"}),o(u,{prop:"sdk_version",label:"SDK版本","min-width":"160"}),o(u,{prop:"create_time",label:"创建时间",width:"180"}),o(u,{label:"操作",width:"100",fixed:"right"},{default:a(({row:l})=>[o($,{"show-arrow":!1,"popper-class":"!w-[120px] !min-w-[120px] !p-[6px] !rounded-xl"},{reference:a(()=>[o(i,{link:""},{default:a(()=>[o(N,{name:"el-icon-MoreFilled"})]),_:1})]),default:a(()=>[s("div",Ee,[s("div",{class:"px-2 py-1 hover:bg-primary-light-9 rounded-lg cursor-pointer",onClick:O=>R(l)},[o(i,{link:"",icon:"el-icon-Close",class:"w-full !justify-start"},{default:a(()=>e[7]||(e[7]=[v("移除设备",-1)])),_:1,__:[7]})],8,be),s("div",{class:"px-2 py-1 hover:bg-primary-light-9 rounded-lg cursor-pointer",onClick:O=>L(l)},[o(i,{link:"",icon:"el-icon-Delete",class:"w-full !justify-start"},{default:a(()=>e[8]||(e[8]=[v("清除缓存",-1)])),_:1,__:[8]})],8,De)])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[G,c(m).loading]])]),s("div",Ie,[o(W,{modelValue:c(m),"onUpdate:modelValue":e[1]||(e[1]=l=>J(m)?m.value=l:null),onChange:c(d)},null,8,["modelValue","onChange"])])])]),g.value?(f(),T(Z,{key:0,ref_key:"addDevicePopupRef",ref:D,title:"添加设备",async:"","confirm-button-text":"确认绑定","confirm-loading":c(I),onClose:e[3]||(e[3]=l=>g.value=!1),onConfirm:P},{default:a(()=>[s("div",Te,[o(F,{modelValue:_.value,"onUpdate:modelValue":e[2]||(e[2]=l=>_.value=l),placeholder:"请输入您的设备授权码",clearable:"",class:"!h-[48px]"},null,8,["modelValue"])])]),_:1},8,["confirm-loading"])):z("",!0)],64)}}});const eo=le(Ae,[["__scopeId","data-v-0a2fce30"]]);export{eo as default};
