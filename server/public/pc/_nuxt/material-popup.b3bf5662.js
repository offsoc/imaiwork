import{d as ne,r as v,aF as ae,A as ie,c as re,l as n,q as r,s as h,cV as ce,Z as l,I as y,L as c,J as T,k as o,m as a,c$ as de,$ as ue,v as O,bM as pe,aI as U,K as fe,t as me,a0 as _e,G as D,y as ve,au as he,ax as ye,ba as xe,cW as ge,aH as we,_ as be}from"./entry.ee599c70.js";import{_ as Ee}from"./index.vue.d98c851e.js";import{E as ke,a as Ve}from"./el-tabs.68bb8047.js";import{E as Ie}from"./el-image.c8eee104.js";import{_ as Ce}from"./index.vue.79d745ab.js";import{E as Te}from"./el-empty.76498597.js";import{_ as De}from"./index.vue.6e4dda8f.js";import{E as $e}from"./el-image-viewer.4443ea01.js";import{u as Le}from"./usePaging.5914886e.js";import{g as Me,b as Pe}from"./redbook.418b34fe.js";import{k as Be}from"./digital_human.b276942f.js";import{MaterialTypeEnum as d}from"./index.db2ee73f.js";import{E as Re}from"./index.364e6819.js";import"./raf.09011a0b.js";import"./strings.32bdf471.js";import"./clamp.05cad4d6.js";import"./toNumber.0872a42f.js";import"./index.6ab00366.js";import"./throttle.108b0b49.js";import"./debounce.f4735d5c.js";const je={class:"rounded-xl overflow-hidden flex flex-col -my-2"},Ae={class:"flex items-center justify-between h-[50px] px-4"},Oe={class:"flex items-center gap-x-2"},Ue={class:"w-6 h-6 flex items-center justify-center rounded-md border border-[#ffffff1a]"},Ge={class:"px-4 my-4"},Ne={class:"flex items-center rounded-full h-[50px] border border-[#2a2a2a] px-[5px]"},Se={key:0,class:"px-4"},ze=["infinite-scroll-disabled"],Fe={class:"h-full"},Ke={key:0},qe={class:"grid grid-cols-3 gap-2 p-2"},He=["onClick"],We={class:"card-gradient cursor-pointer bg-black w-full relative h-[210px] flex flex-col overflow-hidden rounded-xl"},Je={class:"w-full px-3 absolute z-[22] top-2 pr-[50px]"},Ze={class:"line-clamp-1 text-white break-all"},Qe=["src"],Xe=["src"],Ye={class:"absolute top-2 right-2 z-[1000] w-6 h-6 rounded-full"},et={key:2,class:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"},tt=["onClick"],ot={key:0,class:"text-white text-center text-xs w-full py-4"},lt={key:1,class:"h-full flex items-center justify-center"},st={key:1,class:"flex justify-center my-2 px-2"},nt=ne({__name:"material-popup",props:{type:{default:d.IMAGE},limit:{default:9},multiple:{type:Boolean,default:!0},showTab:{type:Boolean,default:!0}},emits:["close","confirm"],setup(k,{expose:G,emit:N}){const i=k,$=N,L=v(),p=v("material"),_=ae({name:"",page_no:1}),u=v([]),x=ie(),m=v(!1),M=v([]),P=re(()=>!f.isLoad||f.loading),S={material:t=>Me({...t,m_type:i.type}),dh:t=>Pe({...t,status:6}),dh_v2:t=>Be({...t,type:0,status:1})},{pager:f,getLists:B,resetPage:z}=Le({fetchFun:t=>S[p.value](t),params:_,isScroll:!0}),F=t=>{p.value=t.paneName,u.value=[],g()},g=()=>{_.page_no=1,z()},R=t=>u.value.some(e=>e.id==t.id),K=t=>{if(R(t))u.value=u.value.filter(e=>e.id!==t.id);else{if(u.value.length>=i.limit){D.msgWarning(`最多只能选择${i.limit}个素材`);return}u.value.push(t)}i.multiple||A()},j=t=>{const{automatic_clip:e,clip_result_url:b,result_url:V,video_result_url:I,content:E}=t;return p.value==="material"?E||"":e===1?b||"":p.value==="dh_v2"?V||"":I||""},A=()=>{if(u.value.length===0){D.msgError("请选择素材");return}const t=u.value.map(e=>({url:i.type===d.VIDEO?j(e):e.content,name:e.name,pic:e.pic}));$("confirm",t),w()},q=async t=>{if(m.value=!0,i.type===d.IMAGE){M.value=[t.content];return}if(i.type===d.VIDEO){await we();const e=j(t);e&&x.value?(x.value.setUrl(e),x.value.open()):(D.msgError("视频地址无效，无法预览"),m.value=!1)}},H=async()=>{P.value||(_.page_no+=1,await B())},W=async()=>{var t;(t=L.value)==null||t.open(),f.lists.length===0&&B()},w=()=>{$("close")};return G({open:W,close:w}),(t,e)=>{const b=ve,V=Ee,I=he,E=ye,C=ke,J=Ve,Z=xe,Q=Ie,X=Ce,Y=Te,ee=De,te=$e,oe=ge,le=Re;return o(),n(T,null,[r(ce,{ref_key:"popupRef",ref:L,width:"528px",style:{padding:"0","background-color":"var(--app-bg-color-2)","box-shadow":"0px 0px 0px 1px var(--app-border-color-2)"},"cancel-button-text":"","confirm-button-text":"","show-close":!1,onClose:w},{default:h(()=>[a("div",je,[a("div",Ae,[a("div",Oe,[a("div",Ue,[r(b,{name:"local-icon-windows",size:14})]),e[4]||(e[4]=a("div",{class:"text-[20px] text-white font-bold"},"素材库",-1))]),a("div",{class:"w-6 h-6 cursor-pointer",onClick:w},[r(V,{theme:l(de).DARK},null,8,["theme"])])]),a("div",Ge,[a("div",Ne,[r(I,{modelValue:l(_).name,"onUpdate:modelValue":e[0]||(e[0]=s=>l(_).name=s),class:"flex-1 search-input",clearable:"","prefix-icon":"el-icon-Search",placeholder:"请输入素材名称","input-style":"color: #ffffff",onClear:g,onKeyup:ue(g,["enter"])},null,8,["modelValue"]),r(E,{type:"primary",class:"!text-white !rounded-full !w-[116px] !h-10",onClick:g},{default:h(()=>[...e[5]||(e[5]=[O(" 搜索 ",-1)])]),_:1})])]),k.showTab?(o(),n("div",Se,[r(J,{modelValue:l(p),"onUpdate:modelValue":e[1]||(e[1]=s=>pe(p)?p.value=s:null),class:"!text-white",onTabClick:F},{default:h(()=>[r(C,{name:"material",label:"素材库"},null,8,["name"]),i.type===l(d).VIDEO?(o(),y(C,{key:0,name:"dh",label:"数字人v1"},null,8,["name"])):c("",!0),i.type===l(d).VIDEO?(o(),y(C,{key:1,name:"dh_v2",label:"数字人v2"},null,8,["name"])):c("",!0)]),_:1},8,["modelValue"])])):c("",!0),U((o(),n("div",{class:"h-[600px] overflow-y-auto relative dynamic-scroller","infinite-scroll-immediate":!1,"infinite-scroll-disabled":l(P),"infinite-scroll-distance":10},[U((o(),n("div",Fe,[l(f).lists.length>0?(o(),n("div",Ke,[a("div",qe,[(o(!0),n(T,null,fe(l(f).lists,s=>(o(),n("div",{key:s.id,onClick:se=>K(s)},[a("div",We,[a("div",Je,[r(Z,{content:s.name},{default:h(()=>[a("div",Ze,me(s.name),1)]),_:2},1032,["content"])]),i.type===l(d).IMAGE?(o(),y(Q,{key:0,src:s.content,class:"w-full h-full rounded-xl","preview-teleported":"",fit:"cover"},null,8,["src"])):c("",!0),i.type===l(d).VIDEO?(o(),n(T,{key:1},[s.pic?(o(),n("img",{key:0,src:s.pic,class:"w-full h-full rounded-xl object-cover"},null,8,Qe)):(o(),n("video",{key:1,src:s.content||s.video_result_url,class:"w-full h-full rounded-xl object-cover"},null,8,Xe))],64)):c("",!0),a("div",Ye,[r(b,{name:"local-icon-success_fill",size:20,color:R(s)?"var(--color-primary)":"#ffffff1a"},null,8,["color"])]),i.type===l(d).VIDEO?(o(),n("div",et,[a("div",{onClick:_e(se=>q(s),["stop"])},[r(X)],8,tt)])):c("",!0)])],8,He))),128))]),l(f).isLoad?c("",!0):(o(),n("div",ot,"暂无更多了~"))])):(o(),n("div",lt,[r(Y,{description:"暂无数据"})]))])),[[oe,l(f).loading]])],8,ze)),[[le,H]]),k.multiple?(o(),n("div",st,[r(E,{type:"primary",class:"!rounded-full w-[318px] !h-[50px]",onClick:A},{default:h(()=>[...e[6]||(e[6]=[O(" 确定 ",-1)])]),_:1})])):c("",!0)])]),_:1},512),l(m)?(o(),y(ee,{key:0,ref_key:"previewVideoRef",ref:x,onClose:e[2]||(e[2]=s=>m.value=!1)},null,512)):c("",!0),l(m)&&i.type===l(d).IMAGE?(o(),y(te,{key:1,"initial-index":0,"url-list":l(M),onClose:e[3]||(e[3]=s=>m.value=!1)},null,8,["url-list"])):c("",!0)],64)}}});const It=be(nt,[["__scopeId","data-v-16d7004d"]]);export{It as default};
