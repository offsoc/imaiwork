import{Q as te,S,b1 as le,d7 as ne,ao as oe,b6 as se,d as A,b0 as D,a_ as q,bC as B,W as ae,r as F,X as re,V as ie,c as T,k as y,I as N,s as p,Z as o,a1 as ue,Y as Z,aq as de,L as z,l as C,J as Q,K as X,aa as me,am as pe,aF as ce,cx as fe,o as ve,m as n,q as s,v as b,bM as _e,u as ge,G as w,bK as be,cZ as ye,y as xe,ba as ke,c_ as Ve,au as Ee,cJ as we,d8 as Se,ax as Te,_ as Ce}from"./entry.ee599c70.js";import{E as Ie}from"./el-switch.7d8162d3.js";import{c as he}from"./customParseFormat.9ef22f33.js";import{a as J}from"./index.8fd3c68c.js";import{E as Ue}from"./index.e69b4eeb.js";/* empty css                     *//* empty css               *//* empty css                  */import{s as $e,r as Ne}from"./agent.e14901d7.js";import"./index.684b3e96.js";import"./strings.32bdf471.js";import"./_baseIteratee.6942dcd2.js";import"./toNumber.0872a42f.js";import"./clamp.05cad4d6.js";import"./index.0e845cb8.js";const Be=te({format:{type:String,default:"HH:mm"},modelValue:{type:S(String)},disabled:Boolean,editable:{type:Boolean,default:!0},effect:{type:S(String),default:"light"},clearable:{type:Boolean,default:!0},size:le,placeholder:String,start:{type:String,default:"09:00"},end:{type:String,default:"18:00"},step:{type:String,default:"00:30"},minTime:{type:S(String)},maxTime:{type:S(String)},includeEndTime:Boolean,name:String,prefixIcon:{type:S([String,Object]),default:()=>ne},clearIcon:{type:S([String,Object]),default:()=>oe},popperClass:{type:String,default:""},popperStyle:{type:S([String,Object])},...se}),V=_=>{const x=(_||"").split(":");if(x.length>=2){let a=Number.parseInt(x[0],10);const l=Number.parseInt(x[1],10),u=_.toUpperCase();return u.includes("AM")&&a===12?a=0:u.includes("PM")&&a!==12&&(a+=12),{hours:a,minutes:l}}return null},P=(_,x)=>{const a=V(_);if(!a)return-1;const l=V(x);if(!l)return-1;const u=a.minutes+a.hours*60,f=l.minutes+l.hours*60;return u===f?0:u>f?1:-1},K=_=>`${_}`.padStart(2,"0"),I=_=>`${K(_.hours)}:${K(_.minutes)}`,Fe=(_,x)=>{const a=V(_);if(!a)return"";const l=V(x);if(!l)return"";const u={hours:a.hours,minutes:a.minutes};return u.minutes+=l.minutes,u.hours+=l.hours,u.hours+=Math.floor(u.minutes/60),u.minutes=u.minutes%60,I(u)},ze=A({name:"ElTimeSelect"}),He=A({...ze,props:Be,emits:[D,"blur","focus","clear",q],setup(_,{expose:x}){const a=_;B.extend(he);const{Option:l}=J,u=ae("input"),f=F(),h=re(),{lang:U}=ie(),H=T(()=>a.modelValue),W=T(()=>{const t=V(a.start);return t?I(t):null}),E=T(()=>{const t=V(a.end);return t?I(t):null}),j=T(()=>{const t=V(a.step);return t?I(t):null}),O=T(()=>{const t=V(a.minTime||"");return t?I(t):null}),R=T(()=>{const t=V(a.maxTime||"");return t?I(t):null}),d=T(()=>{var t;const r=[],c=(v,g)=>{r.push({value:v,disabled:P(g,O.value||"-1:-1")<=0||P(g,R.value||"100:100")>=0})};if(a.start&&a.end&&a.step){let v=W.value,g;for(;v&&E.value&&P(v,E.value)<=0;)g=B(v,"HH:mm").locale(U.value).format(a.format),c(g,v),v=Fe(v,j.value);if(a.includeEndTime&&E.value&&((t=r[r.length-1])==null?void 0:t.value)!==E.value){const k=B(E.value,"HH:mm").locale(U.value).format(a.format);c(k,E.value)}}return r});return x({blur:()=>{var t,r;(r=(t=f.value)==null?void 0:t.blur)==null||r.call(t)},focus:()=>{var t,r;(r=(t=f.value)==null?void 0:t.focus)==null||r.call(t)}}),(t,r)=>(y(),N(o(J),{ref_key:"select",ref:f,"model-value":o(H),disabled:o(h),clearable:t.clearable,"clear-icon":t.clearIcon,size:t.size,effect:t.effect,placeholder:t.placeholder,"default-first-option":"",filterable:t.editable,"empty-values":t.emptyValues,"value-on-clear":t.valueOnClear,"popper-class":t.popperClass,"popper-style":t.popperStyle,"onUpdate:modelValue":c=>t.$emit(o(q),c),onChange:c=>t.$emit(o(D),c),onBlur:c=>t.$emit("blur",c),onFocus:c=>t.$emit("focus",c),onClear:()=>t.$emit("clear")},{prefix:p(()=>[t.prefixIcon?(y(),N(o(ue),{key:0,class:Z(o(u).e("prefix-icon"))},{default:p(()=>[(y(),N(de(t.prefixIcon)))]),_:1},8,["class"])):z("v-if",!0)]),default:p(()=>[(y(!0),C(Q,null,X(o(d),c=>(y(),N(o(l),{key:c.value,label:c.value,value:c.value,disabled:c.disabled},null,8,["label","value","disabled"]))),128))]),_:1},8,["model-value","disabled","clearable","clear-icon","size","effect","placeholder","filterable","empty-values","value-on-clear","popper-class","popper-style","onUpdate:modelValue","onChange","onBlur","onFocus","onClear"]))}});var We=me(He,[["__file","time-select.vue"]]);const je=pe(We);const Oe={class:"h-full flex flex-col py-6"},Re={class:"grow min-h-0"},Le={class:"px-[30px] flex flex-col gap-4"},Pe={class:"flex flex-col"},Ae={class:"mt-2"},Ge={class:"flex items-center gap-2"},Me={class:"flex items-center gap-2"},De={class:"flex flex-col"},qe={class:"mt-2"},Je={class:"flex flex-col"},Ke={class:"mt-2"},Ze={key:0,class:"mt-2"},Qe={class:"flex flex-col"},Xe={class:"mt-2"},Ye={key:0,class:"mt-2"},et={class:"flex flex-col"},tt={class:"flex items-center justify-between gap-2"},lt={class:"flex flex-col"},nt={class:"flex items-center justify-between gap-2"},ot={key:0,class:"mt-2"},st={class:"flex flex-wrap items-center gap-3 mt-3"},at=["onClick"],rt={class:"mt-3"},it={class:"flex items-center justify-center mt-4"},ut=A({__name:"index",props:{agentId:{}},emits:["close"],setup(_,{emit:x}){const a=_,l=ce({multiple_type:0,number_chat_rounds:3,voice_enable:0,image_enable:0,image_reply:"",stop_enable:0,stop_keywords:"",paragraph_enable:0,working_enable:0,non_working_reply:"",working_time:{1:[],2:[],3:[],4:[],5:[],6:[],7:[]}}),u=F([]),f=F([]),h=F([]),U=()=>{f.value.length===0?f.value.push({start_time:"09:00",end_time:"09:15"}):f.value.push({start_time:f.value.at(-1).end_time,end_time:B(f.value.at(-1).end_time,"HH:mm").add(15,"minute").format("HH:mm")})},H=d=>{ge().$confirm({title:"提示",message:"确定删除该时间段吗？",onConfirm:()=>{f.value.splice(d,1)}})},W=async()=>{if(l.image_enable==1&&!l.image_reply){w.msgWarning("请输入图片消息回复内容");return}if(l.stop_enable==1&&!l.stop_keywords){w.msgWarning("请输入停止回复关键词");return}if(l.working_enable==1){if(u.value.length===0){w.msgWarning("请选择接管日期");return}if(f.value.length===0){w.msgWarning("请设置接管时间");return}const{valid:d,indexes:e,errorType:m}=E(f.value);if(!d){h.value=e,w.msgWarning(m);return}if(!l.non_working_reply){w.msgWarning("请输入在接管时间外的自动回复内容");return}const t=f.value.map(r=>`${r.start_time}-${r.end_time}`);Object.keys(l.working_time).forEach(r=>{u.value.includes(Number(r))?l.working_time[r]=t:l.working_time[r]=[]})}try{await $e({...l,robot_id:a.agentId}),w.msgSuccess("保存成功")}catch(d){w.msgError(d||"保存失败")}};function E(d){const e=m=>{const[t,r]=(m||"").split(":").map(Number);return t*60+r};for(let m=0;m<d.length;m++){const t=d[m];if(!t||t.start_time==null||t.start_time===""||t.end_time==null||t.end_time==="")return{valid:!1,errorType:"选择时间不能为空",indexes:[m]};const r=e(t.start_time),c=e(t.end_time);if(r>=c)return{valid:!1,errorType:"选择时间冲突",indexes:[m]};if(m>0){const v=d[m-1],g=e(v.end_time);if(r<g)return{valid:!1,errorType:"选择时间冲突",indexes:[m-1,m]}}}return{valid:!0,indexes:[]}}const{lockFn:j,isLock:O}=fe(W),R=async()=>{try{const d=await Ne({id:a.agentId});d&&be(d,l),d.working_time&&Object.keys(d.working_time).forEach(e=>{d.working_time[e].length>0&&(u.value.push(Number(e)),f.value=d.working_time[e].map(m=>({start_time:m.split("-")[0],end_time:m.split("-")[1]})))})}catch(d){console.error("获取回复策略失败:",d)}};return ve(()=>{R()}),(d,e)=>{const m=ye,t=xe,r=ke,c=Ve,v=Ie,g=Ee,k=we,Y=Se,G=je,M=Te,ee=Ue;return y(),C("div",Oe,[n("div",Re,[s(ee,null,{default:p(()=>[n("div",Le,[n("div",Pe,[e[13]||(e[13]=n("div",null,"短时间内多条信息回复策略",-1)),n("div",Ae,[s(c,{modelValue:o(l).multiple_type,"onUpdate:modelValue":e[0]||(e[0]=i=>o(l).multiple_type=i)},{default:p(()=>[s(m,{value:0},{default:p(()=>[...e[10]||(e[10]=[b("逐条回复",-1)])]),_:1}),s(m,{value:1},{default:p(()=>[s(r,{content:"当用户在两分钟以外，没有继续发送消息，则将多条信息合并回复"},{default:p(()=>[n("div",Ge,[e[11]||(e[11]=n("span",null,"合并回复",-1)),s(t,{name:"el-icon-WarningFilled",color:"#9E9E9E"})])]),_:1})]),_:1}),s(m,{value:2},{default:p(()=>[s(r,{content:"当用户在两分钟以外，没有继续发送消息，只回复最后一条信息"},{default:p(()=>[n("div",Me,[e[12]||(e[12]=n("span",null," 只回复最后一条 ",-1)),s(t,{name:"el-icon-WarningFilled",color:"#9E9E9E"})])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),n("div",De,[e[14]||(e[14]=n("div",null,"语音消息回复策略（目前只支持微信）",-1)),n("div",qe,[s(v,{modelValue:o(l).voice_enable,"onUpdate:modelValue":e[1]||(e[1]=i=>o(l).voice_enable=i),"active-value":1,"inactive-value":0},null,8,["modelValue"])])]),n("div",Je,[e[15]||(e[15]=n("div",null,"智能体被调用时，接收到图片进行固定回复",-1)),n("div",Ke,[s(v,{modelValue:o(l).image_enable,"onUpdate:modelValue":e[2]||(e[2]=i=>o(l).image_enable=i),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),o(l).image_enable==1?(y(),C("div",Ze,[s(g,{modelValue:o(l).image_reply,"onUpdate:modelValue":e[3]||(e[3]=i=>o(l).image_reply=i),type:"textarea",placeholder:"点击输入您要回复的内容",resize:"none",rows:4},null,8,["modelValue"])])):z("",!0)]),n("div",Qe,[e[16]||(e[16]=n("div",{class:""},"智能体被调用时，接收到某些信息后停止对该条信息进行回复",-1)),n("div",Xe,[s(v,{modelValue:o(l).stop_enable,"onUpdate:modelValue":e[4]||(e[4]=i=>o(l).stop_enable=i),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),o(l).stop_enable==1?(y(),C("div",Ye,[s(g,{modelValue:o(l).stop_keywords,"onUpdate:modelValue":e[5]||(e[5]=i=>o(l).stop_keywords=i),type:"textarea",placeholder:"点击输入您要检测的词语",resize:"none",rows:4},null,8,["modelValue"])])):z("",!0)]),n("div",et,[e[18]||(e[18]=n("div",null,[n("div",null,"分段回复")],-1)),n("div",tt,[e[17]||(e[17]=n("div",{class:"text-xs"}," 用户在聊天界面看到的 AI 回复 不是一次性的大段话，而是按段落逐条展示 ",-1)),s(v,{modelValue:o(l).paragraph_enable,"onUpdate:modelValue":e[6]||(e[6]=i=>o(l).paragraph_enable=i),"active-value":1,"inactive-value":0},null,8,["modelValue"])])]),n("div",lt,[e[30]||(e[30]=n("div",null,"接管时间(AI回复)",-1)),n("div",nt,[e[19]||(e[19]=n("div",{class:"text-xs text-error"},[b(" 提醒：用户可以设置 AI 在指定的时间段内接管对话，超出接管时间的消息，则会自动发送用户预先设定的固定回复。"),n("span",{class:"font-bold"},"（一小时内仅剩生效一次）")],-1)),s(v,{modelValue:o(l).working_enable,"onUpdate:modelValue":e[7]||(e[7]=i=>o(l).working_enable=i),"active-value":1,"inactive-value":0},null,8,["modelValue"])]),o(l).working_enable==1?(y(),C("div",ot,[s(Y,{modelValue:o(u),"onUpdate:modelValue":e[8]||(e[8]=i=>_e(u)?u.value=i:null)},{default:p(()=>[s(k,{value:1},{default:p(()=>[...e[20]||(e[20]=[b("周一",-1)])]),_:1}),s(k,{value:2},{default:p(()=>[...e[21]||(e[21]=[b("周二",-1)])]),_:1}),s(k,{value:3},{default:p(()=>[...e[22]||(e[22]=[b("周三",-1)])]),_:1}),s(k,{value:4},{default:p(()=>[...e[23]||(e[23]=[b("周四",-1)])]),_:1}),s(k,{value:5},{default:p(()=>[...e[24]||(e[24]=[b("周五",-1)])]),_:1}),s(k,{value:6},{default:p(()=>[...e[25]||(e[25]=[b("周六",-1)])]),_:1}),s(k,{value:7},{default:p(()=>[...e[26]||(e[26]=[b("周日",-1)])]),_:1})]),_:1},8,["modelValue"]),n("div",st,[(y(!0),C(Q,null,X(o(f),(i,L)=>(y(),C("div",{key:L},[n("div",{class:Z(["time-select-wrapper",{"!border-error":o(h).includes(L)}])},[s(G,{modelValue:i.start_time,"onUpdate:modelValue":$=>i.start_time=$,class:"!w-[80px]","prefix-icon":"",start:"00:00",step:"00:15",end:"23:59","max-time":i.end_time},null,8,["modelValue","onUpdate:modelValue","max-time"]),e[27]||(e[27]=n("div",{class:""},"至",-1)),s(G,{modelValue:i.end_time,"onUpdate:modelValue":$=>i.end_time=$,class:"!w-[80px]","prefix-icon":"",start:"00:00",step:"00:15",end:"23:59","min-time":i.start_time},null,8,["modelValue","onUpdate:modelValue","min-time"]),n("div",{class:"ml-2 w-4 h-4 flex-shrink-0 bg-app-bg-1 rounded-full flex items-center justify-center cursor-pointer",onClick:$=>H(L)},[s(t,{name:"el-icon-Close",color:"#ffffff",size:10})],8,at)],2)]))),128)),s(M,{type:"primary",size:"small",onClick:U},{default:p(()=>[...e[28]||(e[28]=[b("新增时间段",-1)])]),_:1})]),n("div",rt,[e[29]||(e[29]=n("div",{class:"mb-3"},"固定回复内容",-1)),s(g,{modelValue:o(l).non_working_reply,"onUpdate:modelValue":e[9]||(e[9]=i=>o(l).non_working_reply=i),type:"textarea",placeholder:"请输入在接管时间外的自动回复内容",resize:"none",rows:5},null,8,["modelValue"])])])):z("",!0)])])]),_:1})]),n("div",it,[s(M,{type:"primary",class:"w-[318px] !rounded-full !h-[50px]",loading:o(O),onClick:o(j)},{default:p(()=>[...e[31]||(e[31]=[b(" 保存 ",-1)])]),_:1},8,["loading","onClick"])])])}}});const St=Ce(ut,[["__scopeId","data-v-6aa2388d"]]);export{St as default};
