import{d as D,r as p,G as y,aF as v,bz as x,k as h,l as b,q as f,s as C,m as R,Z as u}from"./entry.d9d53b29.js";import{k as X,l as L,m as d,n as V}from"./drawing.7058a163.js";import{drawTypeEnumMap as E,DrawTypeEnum as _,ModelEnum as c}from"./index.fb0aa6a9.js";import Y from"./useCreateForm.dcfd1ba7.js";import I from"./useDrawingTask.6ee58e89.js";import B from"./result-content.ff67a2a6.js";import{E as H}from"./index.050c9b6b.js";const N={class:"h-full relative w-full"},S={class:"px-[10px]"},O=D({__name:"index",setup(j){let o;(s=>{s[s.TXT2IMAGE=E[_.TXT2IMAGE]]="TXT2IMAGE",s[s.IMAGE2IMAGE=E[_.IMAGE2IMAGE]]="IMAGE2IMAGE"})(o||(o={}));const{onEvent:T,setFormData:w}=Y(),g=p([]),i=p(!1);T("update:formData",async s=>{if(i.value){y.msgWarning("请等待上一次任务完成");return}i.value=!0;const{type:l,type_name:M,model:m,resolution:k,model_name:G,params:r}=s,a=v({date:x().format("YYYY-MM-DD HH:mm"),prompt:r.prompt,images:[],formData:s,tags:[G,k,M]});g.value.unshift(a);try{if(m==c.HIDREAMAI){a.images=new Array(parseInt(r.img_count)).fill({url:"",loading:!0,progress:0,status:0,error:!1});const{result:t}=l==o.TXT2IMAGE?await X(r):await L(r),{processDrawingTask:e}=I({type:l,task_id:t.task_id,dataLists:a.images});await e({callback:n=>{a.images=n}})}else if(m==c.GENERAL){a.images=[{url:"",loading:!0,progress:0,status:0,error:!1}];const{result:t}=await d(r);a.images=[t.image_urls].map(e=>({url:e,loading:!1,progress:100,status:1,error:!1}))}else if(m==c.SEEDREAM){if(a.images=[{url:"",loading:!0,progress:0,status:0,error:!1}],l==o.TXT2IMAGE){const{result:t}=await d(r);a.images=[t.image_urls].map(e=>({url:e,loading:!1,progress:100,status:1,error:!1}))}if(l==o.IMAGE2IMAGE){const{result:t}=await V(r),{processDrawingTask:e}=I({type:7,model:m,task_id:t.task_id,dataLists:a.images});await e({callback:n=>{a.images=n}})}}}catch{a.images=a.images.map(e=>({...e,loading:!1,progress:0,status:4,error:!0}))}finally{i.value=!1}});const A=s=>{w(s)};return(s,l)=>(h(),b("div",N,[f(u(H),null,{default:C(()=>[R("div",S,[f(B,{"result-lists":u(g),"is-all-tasks-completed":u(i),onRetry:A},null,8,["result-lists","is-all-tasks-completed"])])]),_:1})]))}});export{O as _};
