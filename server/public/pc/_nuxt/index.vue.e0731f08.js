import{d as Z,bM as W,aF as X,r as E,o as ee,k as o,l as u,Z as l,m as n,q as s,s as a,$ as te,v as m,aI as se,I as _,t as h,Y as ae,L as c,a0 as U,bK as le,J as oe,bQ as I,aH as ne,G as v,ax as ie,au as re,y as de,b5 as ce,av as ue,cQ as me,u as pe}from"./entry.d9d53b29.js";import{E as fe}from"./index.050c9b6b.js";import{E as _e,a as ve}from"./index.9a037d22.js";import{E as ye,a as ke}from"./index.79f7263c.js";import{a as be,_ as ge}from"./detail.vue.be1781a9.js";import{_ as he}from"./index.vue.930f6062.js";/* empty css                     *//* empty css                        *//* empty css               *//* empty css                  *//* empty css                 */import{u as xe}from"./usePaging.64764a63.js";import{d as Ee,a as O,e as Ce,f as Te,r as $e}from"./sph.47a77ad4.js";import{SidebarTypeEnum as w}from"./index.4596121c.js";import Se from"./create-panel.1921ced4.js";import{_ as we}from"./edit.vue.e8bdee47.js";const Ve={key:0,class:"h-full flex flex-col bg-app-bg-2 rounded-[20px]"},Be={class:"flex-shrink-0 px-[14px]"},Re={class:"flex items-center justify-end h-[88px]"},Ue={class:"flex items-center gap-[14px]"},Ie={class:"grow min-h-0 overflow-hidden flex flex-col"},Oe={class:"grow min-h-0"},ze=["onClick"],je={class:"text-white"},Fe={class:"flex items-center justify-center gap-2"},Me={key:1},Pe={key:2},Ae={key:3},De={key:4},Ne={key:5},Ge={class:"flex justify-end items-center"},Le={class:"leading-6"},qe={class:"flex justify-center p-4"},dt=Z({__name:"index",setup(Ke){const{query:x}=W(),V=pe(),C=X({name:"",page_size:20,status:""}),{pager:y,getLists:r,resetPage:z}=xe({fetchFun:Ee,params:C}),T=E(!1),$=E(),j=async i=>{try{await Te({id:i.id,status:i.status==1?2:1}),v.msgSuccess("操作成功"),r()}catch(t){v.msgError(t||"操作失败")}},k=E(x.is_create=="1"&&parseInt(x.type)==w.AUTO_GET_CUSTOMER),B=()=>{k.value=!0,I({is_create:1})},F=async i=>{T.value=!0,await ne(),$.value.open(),$.value.setFormData(i)},b=E(x.is_detail=="1"&&parseInt(x.type)==w.AUTO_GET_CUSTOMER),M=i=>{b.value=!0,I({is_detail:1,id:i.id})},P=i=>{V.$confirm({title:"任务异常情况",message:"提醒：重新启动只会启动异常设备<br /><br />1. 设备启动未执行任务<br />2. 设备断开重连<br />",confirmButtonText:"重新启动",theme:"dark",onConfirm:async()=>{try{await $e({id:i.id}),v.msgSuccess("重试成功"),r()}catch(t){v.msgError(t||"重试失败")}}})},A=async i=>{V.$confirm({message:"是否删除该任务？",theme:"dark",onConfirm:async()=>{try{await Ce({id:i}),v.msgSuccess("删除成功"),r()}catch(t){v.msgError(t||"删除失败")}}})},R=()=>{k.value=!1,b.value=!1,window.history.replaceState("","",`?type=${w.AUTO_GET_CUSTOMER}`),r()};return ee(()=>{!k.value&&!b.value&&r()}),(i,t)=>{const d=ie,D=re,S=de,N=ce,G=fe,p=_e,g=ye,L=ke,q=ue,K=be,Q=ve,H=he,J=me;return o(),u(oe,null,[!l(k)&&!l(b)?(o(),u("div",Ve,[n("div",Be,[s(G,null,{default:a(()=>[n("div",Re,[n("div",Ue,[s(D,{modelValue:l(C).name,"onUpdate:modelValue":t[1]||(t[1]=e=>l(C).name=e),"prefix-icon":"el-icon-Search",class:"!w-[240px] search-name-input",placeholder:"请输入任务名称",clearable:"",onClear:t[2]||(t[2]=e=>l(r)()),onKeydown:t[3]||(t[3]=te(e=>l(r)(),["enter"]))},{append:a(()=>[s(d,{text:"",onClick:t[0]||(t[0]=e=>l(r)())},{default:a(()=>t[8]||(t[8]=[m(" 搜索 ",-1)])),_:1,__:[8]})]),_:1},8,["modelValue"]),s(d,{type:"primary",class:"!rounded-full !h-10",onClick:B},{default:a(()=>[s(S,{name:"local-icon-add_circle",color:"#ffffff"}),t[9]||(t[9]=n("span",{class:"ml-2"},"发布获客任务 ",-1))]),_:1,__:[9]}),n("div",null,[s(N,{content:"刷新"},{default:a(()=>[s(d,{circle:"",color:"#1f1f1f",icon:"el-icon-Refresh",class:"!w-10 !h-10",onClick:t[4]||(t[4]=e=>l(z)())})]),_:1})])])])]),_:1})]),n("div",Ie,[n("div",Oe,[se((o(),_(Q,{height:"100%",data:l(y).lists,"header-row-style":{height:"62px"},"row-style":{height:"50px"}},{empty:a(()=>[n("div",Le,[s(d,{type:"primary",class:"!rounded-full !h-10",onClick:B},{default:a(()=>[s(S,{name:"local-icon-add_circle",color:"#ffffff"}),t[14]||(t[14]=n("span",{class:"ml-2"},"发布获客任务 ",-1))]),_:1,__:[14]})])]),default:a(()=>[s(p,{prop:"name",label:"任务名称",width:"240",fixed:"left"},{default:a(({row:e})=>[n("div",{class:"flex items-center justify-center gap-2 cursor-pointer",onClick:f=>F(e)},[n("div",je,h(e.name),1),s(S,{name:"local-icon-edit",color:"#ffffff"})],8,ze)]),_:1}),s(p,{label:"线索词","min-width":"200","show-overflow-tooltip":""},{default:a(({row:e})=>[m(h(e.keywords.join("；")),1)]),_:1}),s(p,{prop:"crawl_number",label:"已获线索数",width:"120"}),s(p,{label:"任务状态",width:"120"},{default:a(({row:e})=>[n("div",Fe,[e.status!=0?(o(),u("div",{key:0,class:ae(["w-[6px] h-[6px] rounded-full",{"bg-primary":e.status==1,"bg-info":e.status==2,"bg-success":e.status==3,"bg-warning":e.status==4}])},null,2)):c("",!0),e.status==0?(o(),u("div",Me,"未执行")):e.status==1?(o(),u("div",Pe,"进行中")):e.status==2?(o(),u("div",Ae,"已暂停")):e.status==3?(o(),u("div",De,"已完成")):e.status==4?(o(),u("div",Ne,"已结束")):c("",!0)])]),_:1}),s(p,{label:"当前执行进度","min-width":"120"},{default:a(({row:e})=>[m(h(e.number_of_implemented_keywords||0)+" / "+h(e.implementation_keywords_number||0),1)]),_:1}),s(p,{prop:"create_time",label:"创建时间",width:"180"}),s(p,{label:"操作",width:"240",fixed:"right",align:"right"},{default:a(({row:e})=>[n("div",Ge,[e.status==1||e.status==2?(o(),_(d,{key:0,class:"!border-app-border-2",color:"#181818",size:"small",onClick:U(f=>j(e),["stop"])},{default:a(()=>[m(h(e.status==1?"暂停":"继续"),1)]),_:2},1032,["onClick"])):c("",!0),e.status==1?(o(),_(d,{key:1,class:"!border-app-border-2",color:"#181818",size:"small",onClick:U(f=>P(e),["stop"])},{default:a(()=>t[10]||(t[10]=[m("重试",-1)])),_:2,__:[10]},1032,["onClick"])):c("",!0),e.status==3||e.status==4?(o(),_(K,{key:2,class:"mx-3",params:{task_id:e.id},"fetch-fun":l(O),"export-fun":l(O)},{trigger:a(()=>[s(d,{class:"!border-app-border-2",color:"#181818",size:"small"},{default:a(()=>t[11]||(t[11]=[m("导出",-1)])),_:1,__:[11]})]),"form-item":a(({formData:f})=>[s(q,{label:"线索有效性："},{default:a(()=>[s(L,{modelValue:f.status,"onUpdate:modelValue":Y=>f.status=Y,class:"!w-[260px] !h-10",placeholder:"请选择",filterable:"",clearable:"","empty-values":[void 0,null],"show-arrow":!1},{default:a(()=>[s(g,{label:"全部",value:""}),s(g,{label:"未校验",value:"0"}),s(g,{label:"已通过校验",value:"1"}),s(g,{label:"未通过校验",value:"2"}),s(g,{label:"待执行",value:"4"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1032,["params","fetch-fun","export-fun"])):c("",!0),s(d,{class:"!border-app-border-2",color:"#181818",size:"small",onClick:f=>M(e)},{default:a(()=>t[12]||(t[12]=[m("详情",-1)])),_:2,__:[12]},1032,["onClick"]),s(d,{type:"danger",link:"",size:"small",onClick:f=>A(e.id)},{default:a(()=>t[13]||(t[13]=[m("删除",-1)])),_:2,__:[13]},1032,["onClick"])])]),_:1})]),_:1},8,["data"])),[[J,l(y).loading]])]),n("div",qe,[s(H,{modelValue:l(y),"onUpdate:modelValue":t[5]||(t[5]=e=>le(y)?y.value=e:null),layout:"prev, pager, next",onChange:l(r)},null,8,["modelValue","onChange"])])]),l(T)?(o(),_(we,{key:0,ref_key:"editPopupRef",ref:$,onClose:t[6]||(t[6]=e=>T.value=!1),onSuccess:t[7]||(t[7]=e=>l(r)())},null,512)):c("",!0)])):c("",!0),l(k)?(o(),_(Se,{key:1,onBack:R})):c("",!0),l(b)?(o(),_(ge,{key:2,ref:"detailRef",onBack:R},null,512)):c("",!0)],64)}}});export{dt as _};
