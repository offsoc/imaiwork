import{d as K,A as O,x as P,r as b,bb as W,k as d,l as u,aI as I,Z as l,q as o,s as v,m as t,v as $,t as k,J as S,K as T,Y as q,c$ as Y,bM as Z,L as Q,bG as X,G as ee,u as te,y as ae,ba as se,au as oe,ax as le,cW as ne}from"./entry.f4f46cb5.js";import{E as ce}from"./index.b2901b1d.js";import{_ as re}from"./index.vue.fd4cab65.js";import{E as ie}from"./index.bad4fd13.js";/* empty css                  *//* empty css                    *//* empty css                     */import{r as B,a as de,b as ue}from"./file-reader.fae79fc4.js";import{s as pe}from"./text-splitter.ed74dd16.js";import me from"./data-item.699d43f2.js";import{isSameFile as fe}from"./hook.050168d8.js";const _e={class:"h-full flex flex-col px-3 pb-3"},ve={class:"flex-shrink-0"},he={class:"text-[#00000080] flex items-center gap-2 justify-center"},xe={class:"text-[#00000080] mt-2"},be={key:0,class:"grow min-h-0 mt-3 flex gap-x-2"},ge={class:"w-1/4 h-full flex flex-col bg-[#F6F6F6] rounded-xl border border-[#efefef]"},we={class:"flex-shrink-1 min-h-0 mb-3"},ke={class:"p-3 flex flex-col gap-y-2"},Ee=["onClick"],ye={class:"ml-2 line-clamp-1 flex-1 break-all"},Fe=["onClick"],Ce={class:"flex-shrink-0 border-t border-[#EFEFEF] pt-3 mx-3"},Le={class:"flex items-center gap-x-2"},Ve={class:"cursor-pointer"},De={class:"mt-4 flex items-center gap-x-2"},Ie={class:"flex-1 flex flex-col bg-[#F6F6F6] rounded-xl border border-[#efefef]"},$e={class:"px-3 mt-3"},Se={class:"grow min-h-0"},Te={class:"px-3"},Je=K({__name:"doc",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(N){const E=O(),n=P(N,"modelValue"),y=[".txt",".docx",".pdf",".md"],g=y.join(", "),p=b([]),h=b(!1),i=b(0),x=b(512),U=async({raw:e})=>{var a,s;try{if(e){h.value=!0;const c="."+((a=e.name.split(".").pop())==null?void 0:a.toLowerCase());if(!y.includes(c))throw`不支持的文件类型，请上传 ${g} 格式的文件`;const{uri:w}=await X({file:e});await fe(e,p.value);const f=await z(e);if(!f)throw"解析结果为空，已自动忽略";n.value.push({name:e.name,size:e.size,path:w,data:[]}),e.data=f,h.value=!1,p.value.push(e),C(p.value.length-1),F()}}catch(c){ee.msgError(c)}finally{h.value=!1,(s=E.value)==null||s.clearFiles()}},F=()=>{n.value.forEach(e=>{e.data.length=0;const a=p.value.findIndex(c=>c.name==e.name);pe({text:p.value[a].data,chunkLen:x.value}).forEach(c=>{e.data.push({q:c,a:""})})})},z=async e=>{const a=e.name.substring(e.name.lastIndexOf(".")+1);let s="";switch(a){case"md":case"txt":s=await B(e);break;case"pdf":s=await ue(e);break;case"doc":case"docx":s=await de(e);break;default:s=await B(e);break}return s},A=async e=>{te().$confirm({message:"确定要删除该段落吗？",onConfirm:()=>{n.value.splice(e,1),p.value.splice(e,1)}})},R=async e=>{n.value[i.value].data.splice(e,1)},C=e=>{i.value=e};return(e,a)=>{var L;const s=ae,c=ce,w=re,f=ie,j=se,G=oe,M=le,H=ne,J=W("number-input");return d(),u("div",_e,[I((d(),u("div",ve,[o(c,{ref_key:"uploadRef",ref:E,drag:"","show-progress":"",multiple:"","auto-upload":!1,"show-file-list":!1,accept:l(g),limit:50,"on-change":U},{default:v(()=>[t("div",he,[o(s,{name:"local-icon-upload"}),a[1]||(a[1]=$(" 拖拽文件至此，或点击",-1)),a[2]||(a[2]=t("span",{class:"text-primary"}," 选择文件 ",-1))]),t("div",xe,"支持 "+k(l(g))+" 文件",1)]),_:1},8,["accept"])])),[[H,l(h)]]),n.value.length>0?(d(),u("div",be,[t("div",ge,[t("div",we,[o(f,null,{default:v(()=>[t("div",ke,[(d(!0),u(S,null,T(n.value,(m,r)=>(d(),u("div",{key:r,class:q(["flex items-center p-2 rounded-lg mt-1 cursor-pointer",[l(i)==r?"bg-[#0065fb0d] shadow-[0_0_0_1px_var(--color-primary)]":"bg-[#f6f6f6] shadow-[0_0_0_1px_#EFEFEF]"]]),onClick:_=>C(r)},[t("div",{class:q(["w-5 h-5 rounded bg-[#0000000d] flex items-center justify-center",{"bg-primary text-white":l(i)==r}])},[o(s,{name:"local-icon-upload2"})],2),t("div",ye,k(m.name),1),t("div",{class:"flex-shrink-0 ml-2 w-4 h-4",onClick:_=>A(r)},[o(w,{theme:l(Y).LIGHT,"icon-size":12},null,8,["theme"])],8,Fe)],10,Ee))),128))])]),_:1})]),t("div",Ce,[t("div",Le,[a[3]||(a[3]=t("div",null,"分段长度",-1)),o(j,{"popper-class":"w-[400px]",content:"按结束符号进行分段。我们建议您的文档应合理的使用标点符号，以确保每个完整的句子长度不要超过该值中文文档建议400~1000英文文档建议600~1200",placement:"top"},{default:v(()=>[t("span",Ve,[o(s,{name:"local-icon-privacy",color:"#00000080"})])]),_:1})]),t("div",De,[I(o(G,{modelValue:l(x),"onUpdate:modelValue":a[0]||(a[0]=m=>Z(x)?x.value=m:null),type:"number",class:"w-[100px]"},null,8,["modelValue"]),[[J,{min:0,decimal:0}]]),o(M,{type:"primary",class:"!rounded-full !h-[38px]",onClick:F},{default:v(()=>[...a[4]||(a[4]=[$("重新预览",-1)])]),_:1})])])]),t("div",Ie,[t("div",$e,"分段预览（"+k((L=n.value[l(i)])==null?void 0:L.data.length)+"组）",1),t("div",Se,[o(f,null,{default:v(()=>{var m;return[t("div",Te,[(d(!0),u(S,null,T((m=n.value[l(i)])==null?void 0:m.data,(r,_)=>{var V;return d(),u("div",{key:_,class:"rounded-xl p-[10px] mt-2 break-all bg-white"},[o(me,{data:r.q,"onUpdate:data":D=>r.q=D,index:_,name:(V=n.value[l(i)])==null?void 0:V.name,onDelete:D=>R(_)},null,8,["data","onUpdate:data","index","name","onDelete"])])}),128))])]}),_:1})])])])):Q("",!0)])}}});export{Je as _};
