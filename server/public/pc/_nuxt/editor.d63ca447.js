import{bw as at,ey as $e,d as D,c as C,k as i,I as k,Z as l,s as p,l as y,K as q,J as N,au as te,r as x,v as U,t as O,$ as Ve,bK as ve,aH as Q,ax as Ce,aB as Re,ap as st,af as ke,e as nt,aF as ie,A as le,ez as rt,o as je,q as a,m as s,L as Y,av as Oe,ay as Fe,cP as it,bM as ut,a as dt,z as mt,aG as pt,eA as we,cq as ct,dk as ft,D as _t,b6 as vt,aI as gt,ex as bt,bR as yt,eB as ht,eC as xt,ew as Vt,y as kt,u as wt,G as Ee}from"./entry.d9d53b29.js";import{E as Et}from"./el-avatar.24f27c8b.js";import{_ as St}from"./index.vue.05ad31fd.js";import{_ as Tt}from"./index.ece7f347.js";import{E as ge,a as be}from"./index.79f7263c.js";import{E as ze}from"./index.8a3302e5.js";import{E as It}from"./el-slider.48c81ee5.js";import{E as $t,a as Ct}from"./index.9a037d22.js";import{E as Ue}from"./el-switch.d7a8c51d.js";import{E as Rt}from"./index.050c9b6b.js";import{_ as jt}from"./chatting.6f3b345e.js";/* empty css                  *//* empty css               *//* empty css                     */import{l as Ot}from"./lodash.3bfc5c53.js";import{c as Se}from"./cloneDeep.df46b56a.js";import"./el-input-number.3a2d39dc.js";/* empty css                        *//* empty css                 */import{u as Ft}from"./useDictOptions.794690b5.js";import{k as zt}from"./knowledge_base.519704cc.js";import{FieldTypeMap as Ut}from"./formEnums.87727bf8.js";import{s as Nt}from"./dom.7f5b5a10.js";import"./index.d23c2db7.js";import"./index.cce223cb.js";/* empty css                  *//* empty css                    *//* empty css                  */import"./strings.fbd015b4.js";import"./debounce.39f38609.js";import"./_baseIteratee.73cb21ab.js";import"./index.4538c991.js";import"./index.vue.287e2e78.js";import"./index.3864ff87.js";import"./katex.0065138a.js";import"./el-image.239907bf.js";import"./el-image-viewer.291603f7.js";import"./throttle.cbb177ea.js";import"./position.0f08d59c.js";import"./useCopy.6d9f93e9.js";import"./cloneDeep.abc20796.js";import"./index.890e9d1e.js";/* empty css                   */import"./index.3c330aca.js";const ue=()=>({name:"field",label:"字段值",type:"string",tip:"字段值允许包含数字、字母、下划线_、美元符号$，但不能以数字开头，且在同一个表单中必须唯一",setter:{name:"String",props:{placeholder:"请输入字段值"}},rules:[{required:!0,message:"请输入字段值"},{pattern:/^[a-zA-Z_$][a-zA-Z0-9_$]*$/,message:"字段值格式不正确"}]}),oe=()=>({name:"title",label:"字段标题",type:"string",setter:{name:"String",props:{placeholder:"请输入字段标题"}},rules:[{required:!0,message:"请输入字段标题"}]}),Ne=()=>({name:"options",label:"选项",type:"array",setter:{name:"Tags",props:{placeholder:"添加选项",type:"tags",options:[]}},getValue(o){return o.options},setValue(o,f){o.options=f},defaultValue:[]}),ae=()=>({name:"isRequired",label:"是否必填",type:"boolean",setter:{name:"Bool"},defaultValue:!1}),Lt={name:"WidgetFile",title:"文件上传",props:[{name:"field",label:"字段值",type:"string",setter:{name:"String",props:{disabled:!0}},defaultValue:"file"},oe(),ae()],sort:5},At=Object.freeze(Object.defineProperty({__proto__:null,default:Lt},Symbol.toStringTag,{value:"Module"}));var P=(o=>(o.INPUT="WidgetInput",o.TEXTAREA="WidgetTextarea",o.SELECT="WidgetSelect",o.MULTIPLE="WidgetMultiple",o.FILE="WidgetFile",o))(P||{});const de={WidgetInput:"单行文本",WidgetTextarea:"多行文本",WidgetSelect:"下拉选择（单选）",WidgetMultiple:"下拉选择（多选）",WidgetFile:"文件上传"},Pt={name:P.INPUT,title:de[P.INPUT],props:[ue(),oe(),{name:"placeholder",label:"占位文字",type:"string",setter:{name:"String",props:{placeholder:"请输入"}}},{name:"maxlength",label:"最大输入长度",type:"number",setter:{name:"Number",props:{min:0}},defaultValue:200},ae()],sort:1},Dt=Object.freeze(Object.defineProperty({__proto__:null,default:Pt},Symbol.toStringTag,{value:"Module"})),Mt={name:P.MULTIPLE,title:de[P.MULTIPLE],props:[ue(),oe(),{name:"placeholder",label:"占位文字",type:"string",setter:{name:"String",props:{placeholder:"请输入"}}},Ne(),ae()],sort:4},Bt=Object.freeze(Object.defineProperty({__proto__:null,default:Mt},Symbol.toStringTag,{value:"Module"})),Wt={name:P.SELECT,title:de[P.SELECT],props:[ue(),oe(),{name:"placeholder",label:"占位文字",type:"string",setter:{name:"String",props:{placeholder:"请输入"}}},Ne(),ae()],sort:3},qt=Object.freeze(Object.defineProperty({__proto__:null,default:Wt},Symbol.toStringTag,{value:"Module"})),Jt={name:P.TEXTAREA,title:de[P.TEXTAREA],props:[ue(),oe(),{name:"placeholder",label:"占位文字",type:"string",setter:{name:"String",props:{placeholder:"请输入"}}},{name:"rows",label:"默认行数",type:"number",setter:{name:"Number",props:{min:0}},defaultValue:4},{name:"maxlength",label:"最大输入长度",type:"number",setter:{name:"Number",props:{min:0}},defaultValue:200},ae()],sort:2},Gt=Object.freeze(Object.defineProperty({__proto__:null,default:Jt},Symbol.toStringTag,{value:"Module"})),Kt={string:"",boolean:!1,number:0,array:()=>[],object:()=>({})};function Xt(o,f={}){if(!at(o))return o;for(const v of o)if(v.name){let _=null;v.defaultValue!==void 0?_=v.defaultValue:_=Kt[v.type]??null,f[v.name]=$e(_)?_():_}return f}const Zt=o=>{if(typeof o!="string")return o;let f;const v=`return function() {
    const self = this
    try {
      return (${o}).apply(self, arguments)
    } catch(e) {
      console.log(e)
    }
  }`;try{f=new Function(v)()}catch(_){console.error(_)}return f},Ht=D({__name:"bool",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(o,{emit:f}){const v=o,_=f,c=C({get(){return v.modelValue},set(h){_("update:modelValue",h)}});return(h,n)=>(i(),k(l(Ue),{modelValue:c.value,"onUpdate:modelValue":n[0]||(n[0]=r=>c.value=r)},null,8,["modelValue"]))}}),Qt=D({__name:"select",props:{modelValue:{},options:{}},emits:["update:modelValue"],setup(o,{emit:f}){const v=o,_=f,c=C({get(){return v.modelValue},set(n){_("update:modelValue",n)}}),h=C(()=>v.options.map(n=>Ot.isObject(n)?n:{label:n,value:n}));return(n,r)=>(i(),k(l(be),{modelValue:c.value,"onUpdate:modelValue":r[0]||(r[0]=w=>c.value=w),teleported:!0,style:{width:"100%"}},{default:p(()=>[(i(!0),y(N,null,q(h.value,(w,R)=>(i(),k(l(ge),{key:R,label:w.label,value:w.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]))}}),Yt=D({__name:"string",props:{modelValue:{}},emits:["update:modelValue"],setup(o,{emit:f}){const v=o,_=f,c=C({get(){return v.modelValue},set(h){_("update:modelValue",h)}});return(h,n)=>(i(),k(l(te),{modelValue:c.value,"onUpdate:modelValue":n[0]||(n[0]=r=>c.value=r)},null,8,["modelValue"]))}}),el=D({__name:"number",props:{modelValue:{}},emits:["update:modelValue"],setup(o,{emit:f}){const v=o,_=f,c=C({get(){return v.modelValue},set(h){_("update:modelValue",h)}});return(h,n)=>{const r=te;return i(),k(r,{modelValue:c.value,"onUpdate:modelValue":n[0]||(n[0]=w=>c.value=w),type:"number"},null,8,["modelValue"])}}}),tl={class:"flex items-center flex-wrap gap-2"},ll=["onClick"],ol=D({__name:"tags",props:{modelValue:{}},emits:["update:modelValue"],setup(o,{emit:f}){const v=o,_=f,c=x(""),h=x(!1),n=x(),r=C({get(){return v.modelValue||[]},set(g){_("update:modelValue",g)}}),w=()=>{h.value=!0,Q(()=>{n.value.input.focus()})},R=g=>{const S=r.value;S.splice(S.indexOf(g),1),r.value=S},e=()=>{const g=r.value;c.value&&(g.push(c.value),r.value=g),h.value=!1,c.value=""},I=x(-1),J=x(""),E=g=>{I.value=g,J.value=r.value[g]},u=()=>{I.value=-1};return(g,S)=>{const L=ze,$=Ce;return i(),y("div",tl,[(i(!0),y(N,null,q(r.value,(j,T)=>(i(),y("div",{onClick:V=>E(T)},[l(I)!=T?(i(),k(L,{key:j,closable:"","disable-transitions":!0,onClose:V=>R(j)},{default:p(()=>[U(O(j),1)]),_:2},1032,["onClose"])):(i(),k(l(te),{key:1,modelValue:r.value[T],"onUpdate:modelValue":V=>r.value[T]=V,class:"!w-28",ref_for:!0,ref_key:"InputRef",ref:n,size:"small",maxlength:"30",onKeyup:Ve(u,["enter"]),onBlur:u},null,8,["modelValue","onUpdate:modelValue"]))],8,ll))),256)),l(h)?(i(),k(l(te),{key:0,class:"!w-28",ref_key:"InputRef",ref:n,modelValue:l(c),"onUpdate:modelValue":S[0]||(S[0]=j=>ve(c)?c.value=j:null),size:"small",maxlength:"30",onKeyup:Ve(e,["enter"]),onBlur:e},null,8,["modelValue"])):(i(),k($,{key:1,size:"small",onClick:w},{default:p(()=>S[1]||(S[1]=[U(" + 添加 ",-1)])),_:1,__:[1]}))])}}}),al=Object.freeze(Object.defineProperty({__proto__:null,Bool:Ht,Number:el,Select:Qt,String:Yt,Tags:ol},Symbol.toStringTag,{value:"Module"})),sl=new Map(Object.entries(al));function nl(o){return sl.get(o)||null}function rl(o){const f=Le(o),v=nl(f);return v||null}function Te(o,f){return st(o)?null:Re(o)?f?o.name===f?o.props:null:o.props:null}function Le(o){return Re(o)?o.name:o}const il="on",Ie="get:",ul=D({props:{modelValue:{type:Object,required:!0},setterName:{type:String},propsItem:{type:Object,required:!0}},emits:["update:modelValue"],setup(o,{emit:f}){const v=C(()=>{const n=o.modelValue[o.propsItem.name];return o.propsItem.getValue?o.propsItem.getValue(o.modelValue)??n:n}),_=n=>{const r=o.modelValue;r[o.propsItem.name]=n,o.propsItem.setValue&&o.propsItem.setValue(o.modelValue,n),f("update:modelValue",o.modelValue)},c=C(()=>{const n=Te(o.propsItem.setter,o.setterName);for(const r in n)ke(n[r])&&r.startsWith(Ie)&&(n[r.replace(Ie,"")]=n[r](o.modelValue));return n}),h=C(()=>{const n={},r=Te(o.propsItem.setter,o.setterName);for(const w in r){const R=r[w];w.startsWith(il)&&ke(R)&&(n[w]=function(e){R(e,o.modelValue)})}return n});return()=>{if(!o.setterName)return null;const n=rl(o.setterName);return n?nt(n,{modelValue:v.value,"onUpdate:modelValue":_,...c.value,...h.value}):null}}}),dl={class:"w-full"},ml={class:"flex-1"},pl={class:"form-tips"},cl=D({__name:"container",props:{modelValue:{}},emits:["update:modelValue"],setup(o,{expose:f,emit:v}){const _=Object.values(Object.assign({"./material/file.ts":At,"./material/input.ts":Dt,"./material/multiple.ts":Bt,"./material/select.ts":qt,"./material/textarea.ts":Gt})).map(u=>(u==null?void 0:u.default)||(u==null?void 0:u.meta)).sort((u,g)=>u.sort-g.sort),c=o,h=v,n=ie({}),r=C({get(){return c.modelValue},set(u){h("update:modelValue",u)}}),w=C(()=>!!Object.keys(r.value.props).length),R=le(),e=C({get(){const u=_.findIndex(g=>g.name===r.value.name);return I.value=_[u],u!==-1?u:-1},set(u){var S,L,$,j;I.value=_[u];const g=rt();r.value=n[(S=I.value)==null?void 0:S.name]||{name:(L=I.value)==null?void 0:L.name,title:($=I.value)==null?void 0:$.title,id:g,props:Xt(((j=I.value)==null?void 0:j.props)||{})}}}),I=x(),J=u=>{e.value!==u&&(n[c.modelValue.name]=c.modelValue,e.value=u)},E=u=>u?$e(u)?u(r):u.type=="JSFunction"?Zt(u.value)(r):!0:!0;return je(()=>{r.value.name||J(0)}),f({async validate(){var g;return await((g=R.value)==null?void 0:g.validate())}}),(u,g)=>{const S=ge,L=be,$=Oe,j=Fe;return l(w)?(i(),k(j,{key:0,ref_key:"formRef",ref:R,"label-width":"105px","label-position":"top",model:l(r).props},{default:p(()=>{var T;return[a($,{label:"类型",prop:"name"},{default:p(()=>[s("div",dl,[a(L,{class:"!w-full",modelValue:l(e),"onUpdate:modelValue":g[0]||(g[0]=V=>ve(e)?e.value=V:null),placeholder:"请选择",onChange:J},{default:p(()=>[(i(!0),y(N,null,q(l(_),(V,K)=>(i(),k(S,{key:K,label:V.title,value:K},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])])]),_:1}),(i(!0),y(N,null,q((T=l(I))==null?void 0:T.props,V=>(i(),y(N,{key:V.name+l(r).id},[E(V.condition)?(i(),k($,{key:0,label:V.label,prop:V.name,rules:V.rules},{default:p(()=>[s("div",ml,[(i(),k(l(ul),{key:V.name+l(r).id,modelValue:l(r).props,"onUpdate:modelValue":g[1]||(g[1]=K=>l(r).props=K),"setter-name":l(Le)(V.setter),"props-item":V},null,8,["modelValue","setter-name","props-item"])),s("div",pl,O(V.tip),1)])]),_:2},1032,["label","prop","rules"])):Y("",!0)],64))),128))]}),_:1},8,["model"])):Y("",!0)}}}),fl={class:"edit-popup"},_l=D({__name:"index",emits:["add","edit","close"],setup(o,{expose:f,emit:v}){const _=v,c=x({name:"",id:"",title:"",props:{}}),h=le(),n=le(),r=x("add"),w=C(()=>r.value=="edit"?"编辑表单项":"添加表单项"),R=async()=>{var u;await((u=h.value)==null?void 0:u.validate());const E=Se(c.value);r.value=="add"?_("add",E):_("edit",E)},e=()=>{var E;_("close"),(E=n.value)==null||E.close()};return f({open:(E="add")=>{var u;r.value=E,E==="add"&&(c.value={name:"",id:"",title:"",props:{}}),(u=n.value)==null||u.open()},close:e,setFormData:E=>{c.value=Se(E)}}),(E,u)=>(i(),y("div",fl,[a(it,{ref_key:"popupRef",ref:n,title:l(w),async:!0,width:"550px","destroy-on-close":"",onConfirm:R,onCancel:e},{default:p(()=>[a(cl,{ref_key:"formRef",ref:h,modelValue:l(c),"onUpdate:modelValue":u[0]||(u[0]=g=>ve(c)?c.value=g:null)},null,8,["modelValue"])]),_:1},8,["title"])]))}}),vl={class:"flex h-screen w-full flex-col items-center"},gl={class:"relative flex h-14 w-full items-center justify-between gap-2 border-b border-token-border-medium px-3 flex-shrink-0"},bl={class:"flex items-center gap-2"},yl={class:"flex items-center gap-2"},hl={key:1,class:"w-8 h-8"},xl={class:"text-base"},Vl={class:"text-sm text-[#b4b4b4]"},kl={class:"relative flex w-full grow flex-col lg:flex-row overflow-hidden"},wl={class:"w-full flex-1 lg:flex-auto lg:w-1/2 justify-center bg-white min-h-0"},El={class:"h-full grow"},Sl={class:"flex h-full flex-col px-2 pt-2"},Tl={class:"flex w-full items-center justify-center gap-4"},Il={class:"h-20 w-20 mt-10 relative"},$l={key:0,class:"absolute w-full h-full top-0"},Cl=["src"],Rl={key:1,class:"flex h-full w-full items-center justify-center rounded-full border-2 border-dashed border-token-border-medium"},jl={key:2,class:"absolute w-full h-full flex items-center justify-center top-0 rounded-full z-20 bg-primary-light-1"},Ol={class:"px-2"},Fl={class:"w-full flex flex-col gap-y-1"},zl=["onClick"],Ul={class:"grid grid-cols-3 gap-x-8"},Nl={class:"relative"},Ll={class:"absolute right-0 top-1"},Al={class:"relative"},Pl={class:"absolute right-0 top-1"},Dl={class:"relative"},Ml={class:"absolute right-0 top-1"},Bl={class:"w-full"},Wl={class:"flex justify-end mb-2"},ql={class:"move-icon cursor-move"},Jl={class:"mt-2 flex flex-wrap gap-2"},Gl=["onClick"],Kl={class:"w-full px-5 lg:w-1/2 grow justify-center lg:border-l border-token-border-medium bg-token-main-surface-secondary pt-4 lg:flex"},Xl={class:"flex-grow h-full"},Zl={class:"h-full flex flex-col"},Hl={class:"grow pt-10 min-h-0"},Ql={key:0,class:"flex items-center justify-center flex-col absolute h-full w-full"},Yl={class:"mb-3"},eo={key:1,class:"w-12 h-12"},to={class:"text-center text-2xl font-semibold"},lo={class:"text-base"},oo={class:"mx-3 mt-12 flex max-w-3xl flex-wrap items-stretch justify-center gap-4"},ao={key:0,class:"relative flex w-40 flex-col gap-2 rounded-2xl border border-token-border-light px-3 pb-4 pt-3 text-start align-top text-[15px] shadow-[0_0_2px_0_rgba(0,0,0,0.05),0_4px_6px_0_rgba(0,0,0,0.02)] transition hover:bg-token-main-surface-secondary"},so={class:"line-clamp-3 text-balance text-gray-600 break-all"},no={key:1,class:"h-full flex flex-col justify-end px-10 pb-5 md:max-w-3xl lg:max-w-[40rem] xl:max-w-[48rem] mx-auto"},ro={class:"grow flex items-center justify-center"},io={class:"w-12 h-12"},uo={class:"relative flex h-full items-center justify-center rounded-full bg-white"},ta=D({__name:"editor",setup(o){const f=ut(),v=dt(),_=wt(),c=mt(),{userInfo:h}=pt(c),n=x(!1),r=x(!1),w=d=>{r.value=!0,d===100&&(r.value=!1)},R=d=>{const{data:{uri:t}}=d;e.logo=t},e=ie({id:"",assistants_id:"",logo:"",name:"",description:"",instructions:"",preliminary_ask:[{value:""}],vector_file_id:"",template_info:{ST:0,NT:0,limit:0,form:[]},form_info:"",type:1}),{optionsData:I}=Ft({knowledgeBaseList:{api:zt,params:{page_size:999},transformData:d=>d.lists}}),J=[{selector:"tbody",options:{animation:150,handle:".move-icon",onEnd:({newIndex:d,oldIndex:t})=>{const b=e.template_info.form,F=b.splice(t,1)[0];b.splice(d,0,F),e.template_info.form=[],Q(()=>{e.template_info.form=b})}}}],E=(d,t)=>{if(e.preliminary_ask.length>5)return;const b=e.preliminary_ask.length-1;e.preliminary_ask.length===1&&!e.preliminary_ask[0].value||(e.preliminary_ask[t].value&&e.preliminary_ask[b].value!=""?e.preliminary_ask.push({value:""}):e.preliminary_ask[t].value||u(t))},u=d=>{if(e.preliminary_ask.length===1)return;const t=e.preliminary_ask.length-1;e.preliminary_ask[t].value!=""&&e.preliminary_ask.push({value:""}),e.preliminary_ask.splice(d,1)},g=le(),S=d=>{var t;e.form_info=Nt((t=g.value)==null?void 0:t.textarea,`\${${d}}`)},L=x(!1),$=le(),j=x(0),T=C({get(){return!!f.query.id},set(d){T.value=d}}),V=async(d,t)=>{var b;L.value=!0,await Q(),t?(j.value=d,$.value.open("edit"),(b=$.value)==null||b.setFormData(t)):$.value.open("add")},K=we(d=>{var F;const t=!!e.template_info.form.find(G=>G.props.field===d.props.field);if(!!e.template_info.form.find(G=>G.name==="WidgetFile"))return Ee.msgError("只能添加一个上传文件字段");if(t)return Ee.msgError("字段值重复，请修改字段值");e.template_info.form.push(d),(F=$.value)==null||F.close()}),Ae=we(d=>{var t;e.value.template_info.form[j.value]=d,(t=$.value)==null||t.close()}),Pe=d=>{_.$confirm({message:"确定要删除此字段吗？",onConfirm:async()=>{const t=e.template_info.form[d].props.field;e.form_info=De(e.form_info,t),e.template_info.form.splice(d,1)}})},De=(d,t)=>{let b=new RegExp(`\\$\\{${t}\\}`,"g");return d.replace(b,"")},Me=async()=>{n.value=!0;const d=await bt({id:f.query.id});Object.keys(e).forEach(t=>{e[t]=d[t]}),e.template_info=JSON.parse(e.template_info),e.preliminary_ask=JSON.parse(e.preliminary_ask),await Q(),n.value=!1},X=x(!1),ee=x(!1),ye=x(""),Z=ie({id:"",assistants_id:""}),he=async(d="auto")=>{if(ye.value=d,ee.value=d=="handle",e.name==""){yt.error("请输入机器人名称");return}if(!X.value){X.value=d=="auto"?We.value:!0;try{if(T.value)(Z.assistants_id||Z.id)&&(e.id=Z.id,e.assistants_id=Z.assistants_id),await ht({...e,template_info:JSON.stringify(e.template_info),preliminary_ask:JSON.stringify(e.preliminary_ask)});else{const t=await xt({...e,template_info:JSON.stringify(e.template_info),preliminary_ask:JSON.stringify(e.preliminary_ask)});Z.id=t.id,Z.assistants_id=t.assistants_id,v.replace({path:f.path,query:{id:t.id}}),T.value=!0}d=="handle"?setTimeout(()=>{X.value=!1,ee.value=!1},1500):(ee.value=!1,X.value=!1)}catch{ee.value=!1,X.value=!1}}},{lockFn:Be,isLock:We}=ct(he),qe=ft(()=>{ee.value||Be()},ye.value=="auto"?3e3:1500);_t(e,d=>{n.value||qe()});const se=x([]);let Je=null;const me=x(!1),pe=x(null),ce=x(!1);x("");const ne=x([]),Ge=async d=>{if(me.value)return;se.value.push({type:1,message:d,fileLists:ne.value,from_avatar:h.value.avatar});const t=ie({type:2,loading:!0,reply:"",error:"",from_avatar:e.logo});se.value.push(t);try{await Vt({message:d,assistants_id:e.assistants_id,file_id:ne.value.map(b=>b.file_id),is_debug:1},{onstart(b){Je=b,ce.value=!0},onmessage(b){b.trim().split("data:").forEach((F,G)=>{if(F!=="")try{const M=JSON.parse(F),{object:re,content:B}=M;if(B&&re==="load"&&(t.reply+=B),re==="finish"){t.loading=!1;return}}catch{}})},onclose(){t.loading=!1,xe(),setTimeout(async()=>{await Q(),pe.value.scrollToBottom()},600)}})}catch{t.loading=!1,t.error="发生错误",xe()}Q(()=>{pe.value.scrollToBottom()})},xe=()=>{ne.value=[],me.value=!1,ce.value=!1},Ke=d=>{ne.value=d};return je(()=>{T.value&&Me()}),(d,t)=>{const b=kt,F=Et,G=St,M=Ce,re=Tt,B=te,A=Oe,Xe=ge,Ze=be,fe=ze,_e=It,W=$t,He=Ue,Qe=Ct,Ye=Fe,et=Rt,tt=jt,lt=_l,ot=vt("draggable");return i(),y(N,null,[s("div",vl,[s("div",gl,[s("div",bl,[s("div",{class:"cursor-pointer leading-[0] p-2 hover:bg-token-sidebar-surface-secondary rounded-md",onClick:t[0]||(t[0]=m=>d.$router.back())},[a(b,{name:"el-icon-ArrowLeftBold",size:20})]),s("div",yl,[l(e).logo?(i(),k(F,{key:0,size:32,src:l(e).logo},null,8,["src"])):(i(),y("div",hl,[a(G)])),s("div",null,[s("div",xl,O(l(e).name||"机器人名称"),1),s("div",Vl,O(l(e).description||"机器人简介"),1)])])]),s("div",null,[a(M,{type:"primary",round:"",disabled:!l(T),loading:l(X),class:"flex w-full items-center justify-center gap-1.5",onClick:t[1]||(t[1]=m=>he("handle"))},{default:p(()=>[U(O(l(T)?"更新":"创建"),1)]),_:1},8,["disabled","loading"])])]),s("div",kl,[s("div",wl,[s("div",El,[a(et,null,{default:p(()=>[s("div",Sl,[s("div",Tl,[a(re,{limit:1,"show-file-list":!1,multiple:!1,onOnProgress:w,onSuccess:R},{default:p(()=>[s("button",Il,[l(e).logo?(i(),y("div",$l,[s("img",{src:l(e).logo,class:"rounded-full w-full h-full"},null,8,Cl)])):(i(),y("div",Rl,[a(b,{name:"el-icon-Plus",size:"24"})])),l(r)?(i(),y("div",jl,[a(b,{name:"local-icon-loading2","custom-class":"animate-spin"})])):Y("",!0)])]),_:1})]),s("div",Ol,[a(Ye,{model:l(e),"label-position":"top"},{default:p(()=>[a(A,{label:"名称",prop:"name"},{default:p(()=>[a(B,{modelValue:l(e).name,"onUpdate:modelValue":t[2]||(t[2]=m=>l(e).name=m),placeholder:"为您的机器人命名"},null,8,["modelValue"])]),_:1}),a(A,{label:"简介",prop:"description"},{default:p(()=>[a(B,{modelValue:l(e).description,"onUpdate:modelValue":t[3]||(t[3]=m=>l(e).description=m),placeholder:"添加有关于此机器人的功能简短描述"},null,8,["modelValue"])]),_:1}),a(A,{label:"指令",prop:"instructions"},{default:p(()=>[a(B,{modelValue:l(e).instructions,"onUpdate:modelValue":t[4]||(t[4]=m=>l(e).instructions=m),type:"textarea",resize:"none",rows:8,maxlength:"2000",placeholder:"此机器人能做些什么?它的行为是怎么样的？它应该避免些什么?"},null,8,["modelValue"])]),_:1}),a(A,{label:"对话开场白"},{default:p(()=>[s("div",Fl,[(i(!0),y(N,null,q(l(e).preliminary_ask,(m,z)=>(i(),y("div",{class:"w-full",key:z},[a(B,{modelValue:m.value,"onUpdate:modelValue":H=>m.value=H,placeholder:"",maxlength:"50",onInput:H=>E(H,z)},{append:p(()=>[s("div",{onClick:H=>u(z)},[a(b,{name:"el-icon-Close"})],8,zl)]),_:2},1032,["modelValue","onUpdate:modelValue","onInput"])]))),128))])]),_:1}),a(A,{label:"关联知识库"},{default:p(()=>[a(Ze,{modelValue:l(e).vector_file_id,"onUpdate:modelValue":t[5]||(t[5]=m=>l(e).vector_file_id=m),placeholder:"请选择需要关联的知识库"},{default:p(()=>[(i(!0),y(N,null,q(l(I).knowledgeBaseList,(m,z)=>(i(),k(Xe,{label:m.name,value:`${m.id}`},null,8,["label","value"]))),256))]),_:1},8,["modelValue"])]),_:1}),s("div",Ul,[s("div",Nl,[s("div",Ll,[a(fe,{size:"small"},{default:p(()=>[U(O(l(e).template_info.ST),1)]),_:1})]),a(A,{label:"采样温度"},{default:p(()=>[a(_e,{modelValue:l(e).template_info.ST,"onUpdate:modelValue":t[6]||(t[6]=m=>l(e).template_info.ST=m),step:.01,size:"small",max:2},null,8,["modelValue"])]),_:1})]),s("div",Al,[s("div",Pl,[a(fe,{size:"small"},{default:p(()=>[U(O(l(e).template_info.NT),1)]),_:1})]),a(A,{label:"核取温度"},{default:p(()=>[a(_e,{modelValue:l(e).template_info.NT,"onUpdate:modelValue":t[7]||(t[7]=m=>l(e).template_info.NT=m),step:.01,size:"small",max:2},null,8,["modelValue"])]),_:1})]),s("div",Dl,[s("div",Ml,[a(fe,{size:"small"},{default:p(()=>[U(O(l(e).template_info.limit),1)]),_:1})]),a(A,{label:"生成条数",prop:"name"},{default:p(()=>[a(_e,{modelValue:l(e).template_info.limit,"onUpdate:modelValue":t[8]||(t[8]=m=>l(e).template_info.limit=m),max:5,size:"small"},null,8,["modelValue"])]),_:1})])]),a(A,{label:"填写表单"},{default:p(()=>[s("div",Bl,[s("div",Wl,[a(M,{type:"primary",size:"small",onClick:t[9]||(t[9]=m=>V())},{default:p(()=>t[12]||(t[12]=[U("添加",-1)])),_:1,__:[12]})]),gt((i(),k(Qe,{data:l(e).template_info.form,size:"small",style:{height:"200px"},"empty-text":"暂无表单数据"},{default:p(()=>[a(W,{width:"50"},{default:p(()=>[s("div",ql,[a(b,{name:"el-icon-Rank"})])]),_:1}),a(W,{label:"字段值",prop:"props[field]","show-overflow-tooltip":""}),a(W,{label:"字段名称",prop:"props[title]","show-overflow-tooltip":""}),a(W,{label:"占位文字",prop:"props[placeholder]","show-overflow-tooltip":""}),a(W,{label:"填写类型","show-overflow-tooltip":""},{default:p(({row:m})=>[U(O(l(Ut)[m.name]),1)]),_:1}),a(W,{label:"输入长度",prop:"props[maxlength]"}),a(W,{label:"是否必填"},{default:p(({row:m})=>[a(He,{modelValue:m.props.isRequired,"onUpdate:modelValue":z=>m.props.isRequired=z},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(W,{label:"操作",width:"120px",fixed:"right"},{default:p(({row:m,$index:z})=>[a(M,{type:"primary",size:"small",link:"",onClick:H=>V(z,m)},{default:p(()=>t[13]||(t[13]=[U("编辑",-1)])),_:2,__:[13]},1032,["onClick"]),a(M,{type:"danger",size:"small",link:"",onClick:H=>Pe(z)},{default:p(()=>t[14]||(t[14]=[U("删除",-1)])),_:2,__:[14]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ot,J]])])]),_:1}),a(A,{label:"表单词提问配置"},{default:p(()=>[a(B,{modelValue:l(e).form_info,"onUpdate:modelValue":t[10]||(t[10]=m=>l(e).form_info=m),type:"textarea",ref_key:"elInputRef",ref:g,rows:6,resize:"none"},null,8,["modelValue"]),s("div",Jl,[(i(!0),y(N,null,q(l(e).template_info.form,m=>(i(),y("div",{onClick:z=>S(m.props.field)},[a(M,null,{default:p(()=>[U(O(m.props.title),1)]),_:2},1024)],8,Gl))),256))])]),_:1})]),_:1},8,["model"])])])]),_:1})])]),s("div",Kl,[s("div",Xl,[s("div",Zl,[t[16]||(t[16]=s("div",{class:"relative mb-2 flex-shrink-0"},[s("div",{class:"flex justify-center text-[18px]"},"预览测试")],-1)),s("div",Hl,[l(T)?(i(),k(tt,{key:0,ref_key:"chattingRef",ref:pe,"is-stop":l(ce),"is-preview":!0,"content-list":l(se),"send-disabled":l(me),onContentPost:Ge,"onUpdate:fileLists":Ke},{default:p(()=>[l(se).length?Y("",!0):(i(),y("div",Ql,[s("div",Yl,[l(e).logo?(i(),k(F,{key:0,size:48,src:l(e).logo},null,8,["src"])):(i(),y("div",eo,[a(G,{"icon-size":28})]))]),s("div",to,O(l(e).name),1),s("div",lo,O(l(e).description),1),s("div",null,[s("div",oo,[(i(!0),y(N,null,q(l(e).preliminary_ask,(m,z)=>(i(),y(N,null,[m.value?(i(),y("button",ao,[s("div",so,O(m.value),1)])):Y("",!0)],64))),256))])])]))]),_:1},8,["is-stop","content-list","send-disabled"])):(i(),y("div",no,[s("div",ro,[s("div",io,[s("div",uo,[a(b,{name:"local-icon-app",size:"32"})])])]),t[15]||(t[15]=s("div",{class:"flex items-end gap-1.5 md:gap-2"},[s("div",{class:"flex items-center justify-center w-full flex-col gap-1.5 rounded-[26px] p-1.5 transition-colors bg-[#f4f4f4] h-14 text-tx-primary text-lg"}," 从定义您的 GPT 开始。 ")],-1))]))])])])])])]),l(L)?(i(),k(lt,{key:0,ref_key:"formDesignerRef",ref:$,onClose:t[11]||(t[11]=m=>L.value=!1),onAdd:l(K),onEdit:l(Ae)},null,8,["onAdd","onEdit"])):Y("",!0)],64)}}});export{ta as default};
