import{d as z,A as B,x as R,r as v,k as d,l as m,m as t,q as c,s as g,v as T,t as b,Z as i,J as L,K as S,Y as V,L as M,G,u as J,y as K}from"./entry.f4f46cb5.js";import{E as O}from"./index.b2901b1d.js";import{_ as P}from"./index.vue.fd4cab65.js";import{E as Y}from"./index.bad4fd13.js";/* empty css                  *//* empty css                    *//* empty css                     */import{r as $,a as Z,b as H}from"./file-reader.fae79fc4.js";import{s as Q}from"./text-splitter.ed74dd16.js";import{isSameFile as W}from"./hook.050168d8.js";import X from"./data-item.699d43f2.js";import"./index.26e6fbc6.js";import"./cloneDeep.3fe36a61.js";const ee={class:"h-full flex flex-col px-3 pb-3"},te={class:"flex-shrink-0"},ae={class:"text-[#00000080] flex items-center gap-2 justify-center"},se={class:"text-[#00000080] mt-2"},oe={key:0,class:"grow min-h-0 mt-3 flex gap-x-2"},ne={class:"w-1/4 h-full flex flex-col bg-[#F6F6F6] rounded-xl border border-[#efefef]"},le={class:"flex-shrink-1 min-h-0 mb-3"},re={class:"p-3 flex flex-col gap-y-2"},ce=["onClick"],ie={class:"ml-2 line-clamp-1 flex-1"},de=["onClick"],me={class:"flex-1 flex flex-col bg-[#F6F6F6] rounded-xl border border-[#efefef]"},pe={class:"px-3 mt-3"},ue={class:"grow min-h-0"},fe={class:"px-3"},Le=z({__name:"qa",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(q){const w=B(),o=R(q,"modelValue"),k=[".txt",".docx",".pdf",".md"],h=k.join(", "),x=v([]),y=v(!1),l=v(0),N=async({raw:e})=>{var a,s;try{if(e){const r="."+((a=e.name.split(".").pop())==null?void 0:a.toLowerCase());if(!k.includes(r))throw`不支持的文件类型，请上传 ${h} 格式的文件`;y.value=!0,await W(e,x.value);const f=await A(e);if(!f)throw"解析结果为空，已自动忽略";const p=I(f);o.value.push({name:e.name,size:e.size,path:"",data:p}),e.data=p,x.value.push(e),C(x.value.length-1)}}catch(r){G.msgError(r)}finally{y.value=!1,(s=w.value)==null||s.clearFiles()}},A=async e=>{const a=e.name.substring(e.name.lastIndexOf(".")+1);let s="";switch(a){case"md":case"txt":s=await $(e);break;case"pdf":s=await H(e);break;case"doc":case"docx":s=await Z(e);break;default:s=await $(e);break}return s},I=e=>{const a=[];return Q({text:e,chunkLen:1e3}).forEach(r=>{a.push({q:r,a:""})}),a},U=async e=>{J().$confirm({message:"确定要删除该段落吗？",onConfirm:()=>{o.value.splice(e,1)}})},j=async e=>{o.value[l.value].data.splice(e,1)},C=e=>{l.value=e};return(e,a)=>{var F;const s=K,r=O,f=P,p=Y;return d(),m("div",ee,[t("div",te,[c(r,{ref_key:"uploadRef",ref:w,drag:"","show-progress":"",multiple:"","auto-upload":!1,"show-file-list":!1,accept:i(h),limit:50,"on-change":N},{default:g(()=>[t("div",ae,[c(s,{name:"local-icon-upload"}),a[0]||(a[0]=T(" 拖拽文件至此，或点击",-1)),a[1]||(a[1]=t("span",{class:"text-primary"}," 选择文件 ",-1))]),t("div",se,"支持 "+b(i(h))+" 文件",1)]),_:1},8,["accept"])]),o.value.length>0?(d(),m("div",oe,[t("div",ne,[t("div",le,[c(p,null,{default:g(()=>[t("div",re,[(d(!0),m(L,null,S(o.value,(_,n)=>(d(),m("div",{key:n,class:V(["flex items-center p-2 rounded-lg mt-1 cursor-pointer",[i(l)==n?"bg-[#0065fb0d] shadow-[0_0_0_1px_var(--color-primary)]":"bg-[#f6f6f6] shadow-[0_0_0_1px_#EFEFEF]"]]),onClick:u=>C(n)},[t("div",{class:V(["w-5 h-5 rounded bg-[#0000000d] flex items-center justify-center",{"bg-primary text-white":i(l)==n}])},[c(s,{name:"local-icon-upload2"})],2),t("div",ie,b(_.name),1),t("div",{onClick:u=>U(n)},[c(f)],8,de)],10,ce))),128))])]),_:1})])]),t("div",me,[t("div",pe,"分段预览（"+b((F=o.value[i(l)])==null?void 0:F.data.length)+"组）",1),t("div",ue,[c(p,null,{default:g(()=>{var _;return[t("div",fe,[(d(!0),m(L,null,S((_=o.value[i(l)])==null?void 0:_.data,(n,u)=>{var E;return d(),m("div",{key:u,class:"rounded-xl p-[10px] mt-2 break-all bg-white"},[c(X,{data:n.q,"onUpdate:data":D=>n.q=D,index:u,name:(E=o.value[i(l)])==null?void 0:E.name,onDelete:D=>j(u)},null,8,["data","onUpdate:data","index","name","onDelete"])])}),128))])]}),_:1})])])])):M("",!0)])}}});export{Le as default};
