import{_ as w}from"./chatting.70e44c5d.js";import{d as I,z as S,aG as R,D as i,bA as b,k as x,I as N,s as y,m as T,Z as n,G as z,aH as A}from"./entry.2beb4577.js";import{useChatManager as B}from"./useChatManager.a2897f2d.js";import{useChatStore as D}from"./chat.a6df5aaa.js";const U=I({__name:"standard-agent-chat",props:{agentId:{},agentName:{},taskId:{},detail:{}},emits:["new-conversation","update:isReceiving"],setup(m,{emit:l}){const t=m,o=l,f=S(),{userTokens:u}=R(f),s=D(),{chattingRef:r,chatContentList:p,isStopChat:g,isReceiving:c,initialize:h,sendMessage:_,stopStream:d,fetchChatHistory:k}=B();i(c,e=>o("update:isReceiving",e));const C=async e=>{if(u.value<=0){z.msgPowerInsufficient();return}const a=!t.taskId;await _(e,!1,()=>{a&&setTimeout(()=>{o("new-conversation",{task_id:s.taskId,title:e})},500)})};return i(()=>t.taskId,async e=>{var a;s.clearChat(),await A(),s.setAgent({id:t.agentId,name:t.agentName||""}),d(),e&&(s.setTaskId(e||""),await k(),(a=r.value)==null||a.resetScroll())},{immediate:!0,deep:!0}),i(()=>t.detail,e=>{s.setAgent({id:t.agentId,name:t.agentName||""}),s.setDetail({logo:e.image,name:e.name}),h()}),b(()=>{s.clearChat()}),(e,a)=>{const v=w;return x(),N(v,{ref_key:"chattingRef",ref:r,"is-new-chat":!1,"is-stop":n(g),"is-disabled-humanize":!0,"content-list":n(p),"send-disabled":n(c),"is-upload-file":!1,"is-network":!1,onContentPost:C,onClose:n(d)},{content:y(()=>[...a[0]||(a[0]=[T("div",{class:"h-full"},null,-1)])]),_:1},8,["is-stop","content-list","send-disabled","onClose"])}}});export{U as _};
