import{d as Z,bP as j,r as p,c as P,aF as Y,cx as H,k as d,I as Q,s as r,q as l,Z as a,v as b,l as u,m as _,J as W,K as X,Y as ee,t as x,L as oe,cV as te,cb as C,G as V,cZ as ae,c_ as se,av as le,au as ne,y as re,ay as ce}from"./entry.f4f46cb5.js";import{E as de}from"./index.bad4fd13.js";import{E as ie}from"./el-empty.28f9091a.js";/* empty css                     */import{d as pe,e as ue,f as me,h as fe}from"./service.9c966dd0.js";const _e={key:0,class:"h-[300px] w-full -mx-4"},ye={class:"grid grid-cols-3 gap-4 px-4 mt-4"},ve=["onClick"],ge={class:"leading-6"},ke={class:"font-bold"},Ee={key:0,class:"absolute -top-2 -right-2 z-[1000] w-6 h-6 bg-white rounded-full"},he={key:1,class:"flex items-center justify-center w-full"},Re=Z({__name:"material-edit",props:{type:{type:Number,default:""},appType:{type:String,default:""},account:{type:String,default:""}},emits:["close","success"],setup(F,{expose:R,emit:S}){const i=F,g=S;j();const y=p(),m=p("add"),I=P(()=>m.value==="add"?"新增关键词回复":"编辑关键词回复"),k=p(),t=Y({id:"",match_type:0,keyword:"",reply:[],account:"",type:""}),L={keyword:[{required:!0,message:"请输入匹配内容"}],reply:[{required:!0,message:"请选择名片"}]},f=p([]),N=async()=>{const{lists:o}=await fe({type:i.appType,account:i.account,page_size:1e3});f.value=o},E=(o,e)=>(o=C(o)?JSON.parse(o):o,o[e]||""),c=p([]),D=o=>{c.value.includes(o)?c.value=c.value.filter(s=>s!==o):c.value.push(o);const e=f.value.filter(s=>c.value.includes(s.id));t.reply=e.map(s=>({...C(s.content)?JSON.parse(s.content):s,type:i.type,id:s.id}))},T=o=>{var e;m.value=o?"edit":"add",t.account=i.account,t.type=i.appType,(e=y.value)==null||e.open(),N()},$=()=>{g("close")},z=async()=>{var o;await k.value.validate();try{t.id?await pe(t):await ue(t),V.msgSuccess(`${m.value==="add"?"新增":"编辑"}成功`),(o=y.value)==null||o.close(),g("success")}catch(e){V.msgError(e||`${m.value==="add"?"新增":"编辑"}失败`)}},{lockFn:B,isLock:J}=H(z),K=async o=>{const e=await me({id:o});h(e)},h=async o=>{for(const e in t)o[e]!=null&&o[e]!=null&&(t[e]=o[e]);c.value=t.reply.map(e=>e.id)};return R({open:T,setFormData:h,getDetail:K}),(o,e)=>{const s=ae,w=se,v=le,q=ne,A=re,G=de,M=ie,O=ce;return d(),Q(te,{ref_key:"popupRef",ref:y,async:"",width:"600px",title:a(I),"confirm-loading":a(J),onConfirm:a(B),onClose:$},{default:r(()=>[l(O,{ref_key:"formRef",ref:k,model:a(t),rules:L,"label-position":"top"},{default:r(()=>[l(v,{label:"匹配方式",prop:"match_type"},{default:r(()=>[l(w,{modelValue:a(t).match_type,"onUpdate:modelValue":e[0]||(e[0]=n=>a(t).match_type=n)},{default:r(()=>[l(s,{value:0},{default:r(()=>[...e[2]||(e[2]=[b("模糊匹配",-1)])]),_:1}),l(s,{value:1},{default:r(()=>[...e[3]||(e[3]=[b("精确匹配",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(v,{label:"匹配内容",prop:"keyword"},{default:r(()=>[l(q,{modelValue:a(t).keyword,"onUpdate:modelValue":e[1]||(e[1]=n=>a(t).keyword=n),placeholder:"点击输入提问案例"},null,8,["modelValue"])]),_:1}),l(v,{label:"选择名片",prop:"reply"},{default:r(()=>[a(f).length?(d(),u("div",_e,[l(G,null,{default:r(()=>[_("div",ye,[(d(!0),u(W,null,X(a(f),(n,U)=>(d(),u("div",{class:ee(["w-full h-[72px] border border-[#E0E0E0] rounded p-2 flex items-center gap-2 cursor-pointer relative",{"border-primary bg-primary-light-9":a(c).includes(n.id)}]),key:U,onClick:we=>D(n.id)},[_("div",ge,[_("div",ke,x(E(n.content,"name")),1),_("div",null,x(E(n.content,"code")),1)]),a(c).includes(n.id)?(d(),u("div",Ee,[l(A,{name:"el-icon-SuccessFilled",color:"var(--color-primary)",size:24})])):oe("",!0)],10,ve))),128))])]),_:1})])):(d(),u("div",he,[l(M,{description:"暂无名片数据"})]))]),_:1})]),_:1},8,["model"])]),_:1},8,["title","confirm-loading","onConfirm"])}}});export{Re as _};
