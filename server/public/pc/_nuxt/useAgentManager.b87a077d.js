import{bM as b,r as p,aF as w,o as q,ct as k,cu as x,G as E,u as I}from"./entry.d9d53b29.js";import{u as L}from"./usePaging.64764a63.js";import{a as O,y as P,z as D,j as C}from"./agent.a3fcedc5.js";import{AgentTypeEnum as o,CozeTypeEnum as R}from"./index.994fc688.js";function j(){const r=b(),T=I(),c=r.query.agent_id,l=r.query.coze_id,s=Number(r.query.type),_=p({}),u=p(!0),n=p(null),N=async()=>{const a={[o.AGENT]:D,[o.COZE_AGENT]:C,[o.COZE_FLOW]:C};a[s]&&(_.value=await a[s]({id:c}))},f=w({page_no:1,page_size:20}),{pager:i,getLists:y,resetPage:v}=L({fetchFun:async a=>{let e;return s===o.AGENT?(e=await k({...a,robot_id:c,chat_type:9006}),e.lists=e.lists.map(t=>({id:t.task_id,title:t.message,...t}))):(e=await O({...a,bot_id:l,type:s===o.COZE_AGENT?R.AGENT:R.FLOW}),e.lists=e.lists.map(t=>({id:t.conversation_id,title:t.content||t.message,...t}))),e},params:f,isScroll:!0}),G=()=>{i.isLoad&&!i.loading&&(f.page_no++,y())},A=a=>{const e=s==o.AGENT?"task_id":"conversation_id";!a[e]||n.value==a[e]||(n.value=a[e])},h=()=>{n.value&&(n.value=null)},z=a=>{const{id:e,conversation_id:t}=a||{},g=s===o.AGENT?e:t;T.$confirm({message:e?"确定要删除该对话吗？":"确定要清除所有对话吗？",onConfirm:async()=>{try{s===o.AGENT?await x({robot_id:c,task_id:e,chat_type:9006}):await P({bot_id:l,conversation_id:t||"0"}),E.msgSuccess("删除成功");const d=i.lists.findIndex(m=>s===o.AGENT?m.id==e:m.conversation_id==t);d!==-1&&i.lists.splice(d,1),(!g||g==n.value)&&(h(),g||v())}catch(d){E.msgError(d||"删除失败")}}})};return q(async()=>{u.value=!0;try{await N(),await y(),n.value=r.query.conversation_id||r.query.task_id||null,!n.value&&i.lists.length>0&&A(i.lists[0])}finally{u.value=!1}}),{agentId:c,cozeId:l,agentType:s,detail:_,loading:u,chatRecordPager:i,currentRecordId:n,loadRecordMore:G,resetChatRecordPager:v,handleSelectRecord:A,handleCreateRecord:h,handleDeleteRecord:z}}export{j as useAgentManager};
