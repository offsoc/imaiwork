import{z as l,aG as O,em as u,en as C,ea as s,cb as _,G as f}from"./entry.2beb4577.js";import{u as g}from"./useWebSocket.a6ad43de.js";const T="1.0.0";function w(p){const v=l(),{userInfo:I}=O(v),S=`wss://${location.host}/wss`,{on:t,send:m,isConnected:d,reconnect:N}=g(S,{...p}),r=(e,o)=>{const c=i.get(e);c&&c(o)},i=new Map,R=(e,o)=>{i.set(e,o)},E=e=>{if(!d.value){f.msgError(C[s.CONNECT_ERROR]);return}const{appType:o}=e;return m({type:e.type,content:{...e.content,userId:I.value.id,deviceId:e.deviceId||void 0,accountType:e.accountType},deviceId:e.deviceId||"",messageId:Date.now(),appVersion:T,appType:o})};return t("open",()=>{r("open"),E({type:u.BIND_WS,content:{type:u.BIND_WS}})}),t("close",()=>{r("close",{error:C[s.CONNECT_ERROR],code:s.CONNECT_ERROR})}),t("error",e=>{r("error",e)}),t("message",e=>{let{type:o,code:c,content:n,deviceId:a}=e;if(n=_(n)?JSON.parse(n):n,c==s.SUCCESS)switch(c){case s.SUCCESS:case s.INIT_COMPLETE:case s.CHECK_INIT:case s.DEVICE_ONLINE:r("success",{...e,content:n});break;default:r("error",{error:n.msg,code:s.PUSH_MESSAGE_ERROR,deviceCode:a});break}else r("error",{error:n.msg,type:o,code:c,deviceCode:a})}),{on:t,send:E,reconnect:N,isConnected:d,onEvent:R}}export{w as u};
