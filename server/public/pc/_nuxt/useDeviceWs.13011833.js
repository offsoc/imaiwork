import{z as _,aG as l,eg as u,eh as S,dY as s,c7 as O,G as f}from"./entry.d7219633.js";import{u as g}from"./useWebSocket.ba3dfe12.js";const T="1.0.0";function D(p){const C=_(),{userInfo:v}=l(C),R=`wss://${location.host}/wss`,{on:n,send:I,isConnected:d,reconnect:m}=g(R,{...p}),c=(e,o)=>{const t=i.get(e);t&&t(o)},i=new Map,N=(e,o)=>{i.set(e,o)},E=e=>{if(!d.value){f.msgError(S[s.CONNECT_ERROR]);return}const{appType:o}=e;return I({type:e.type,content:{...e.content,userId:v.value.id,deviceId:e.deviceId||void 0,accountType:e.accountType},deviceId:e.deviceId||"",messageId:Date.now(),appVersion:T,appType:o})};return n("open",()=>{c("open"),E({type:u.BIND_WS,content:{type:u.BIND_WS}})}),n("close",()=>{c("close",{error:S[s.CONNECT_ERROR],code:s.CONNECT_ERROR})}),n("error",e=>{c("error",e)}),n("message",e=>{let{type:o,code:t,content:r,deviceId:a}=e;if(r=O(r)?JSON.parse(r):r,t==s.SUCCESS)switch(t){case s.SUCCESS:case s.INIT_COMPLETE:case s.CHECK_INIT:c("success",{...e,content:r});break;default:c("error",{error:r.msg,code:s.PUSH_MESSAGE_ERROR,deviceCode:a});break}else c("error",{error:r.msg,type:o,code:s.PUSH_MESSAGE_ERROR,deviceCode:a})}),{on:n,send:E,reconnect:m,isConnected:d,onEvent:N}}export{D as u};
