import{Q as Ie,S as ee,U as Ce,aV as ae,d as oe,cj as te,ck as xe,cl as Ne,V as Ee,W as ze,cm as Oe,r as h,cn as Le,c as m,co as Re,A as Te,D as B,aH as $e,o as Se,bh as z,k as O,I as se,s as u,q as r,bi as Ve,m as f,Y as i,Z as a,a3 as ne,cp as Ye,a0 as Ae,L as y,a1 as w,a6 as Me,l as F,J as De,cq as Pe,cr as Xe,H as S,v as Be,t as Fe,cs as He,a7 as qe,aq as We,ct as Ze,cu as Ke,cv as je,aa as Ge,aY as Je,aZ as I,cw as Qe,am as Ue}from"./entry.f4f46cb5.js";import{t as H}from"./throttle.a2681779.js";const ea=Ie({urlList:{type:ee(Array),default:()=>Ce([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},scale:{type:Number,default:1},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:ee(String)}}),aa={close:()=>!0,error:k=>k instanceof Event,switch:k=>ae(k),rotate:k=>ae(k)},ta=oe({name:"ElImageViewer"}),sa=oe({...ta,props:ea,emits:aa,setup(k,{expose:le,emit:C}){var q;const l=k,x={CONTAIN:{name:"contain",icon:te(xe)},ORIGINAL:{name:"original",icon:te(Ne)}};let V,W="";const{t:re}=Ee(),s=ze("image-viewer"),{nextZIndex:ie}=Oe(),Y=h(),Z=h(),K=Le(),A=m(()=>{const{scale:e,minScale:n,maxScale:t}=l;return Re(e,n,t)}),_=h(!0),N=h(!1),c=h(l.initialIndex),L=Te(x.CONTAIN),o=h({scale:A.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),ce=h((q=l.zIndex)!=null?q:ie()),ue=m(()=>{const{urlList:e}=l;return e.length<=1}),j=m(()=>c.value===0),G=m(()=>c.value===l.urlList.length-1),R=m(()=>l.urlList[c.value]),de=m(()=>[s.e("btn"),s.e("prev"),s.is("disabled",!l.infinite&&j.value)]),fe=m(()=>[s.e("btn"),s.e("next"),s.is("disabled",!l.infinite&&G.value)]),ve=m(()=>{const{scale:e,deg:n,offsetX:t,offsetY:v,enableTransition:g}=o.value;let d=t/e,b=v/e;const E=n*Math.PI/180,Q=Math.cos(E),U=Math.sin(E);d=d*Q+b*U,b=b*Q-t/e*U;const X={transform:`scale(${e}) rotate(${n}deg) translate(${d}px, ${b}px)`,transition:g?"transform .3s":""};return L.value.name===x.CONTAIN.name&&(X.maxWidth=X.maxHeight="100%"),X}),me=m(()=>`${c.value+1} / ${l.urlList.length}`);function T(){ge(),V==null||V(),document.body.style.overflow=W,C("close")}function pe(){const e=H(t=>{switch(Je(t)){case I.esc:l.closeOnPressEscape&&T();break;case I.space:M();break;case I.left:D();break;case I.up:p("zoomIn");break;case I.right:P();break;case I.down:p("zoomOut");break}}),n=H(t=>{const v=t.deltaY||t.deltaX;p(v<0?"zoomIn":"zoomOut",{zoomRate:l.zoomRate,enableTransition:!1})});K.run(()=>{z(document,"keydown",e),z(document,"wheel",n)})}function ge(){K.stop()}function be(){_.value=!1}function we(e){N.value=!0,_.value=!1,C("error",e),e.target.alt=re("el.image.error")}function ke(e){if(_.value||e.button!==0||!Y.value)return;o.value.enableTransition=!1;const{offsetX:n,offsetY:t}=o.value,v=e.pageX,g=e.pageY,d=H(E=>{o.value={...o.value,offsetX:n+E.pageX-v,offsetY:t+E.pageY-g}}),b=z(document,"mousemove",d);z(document,"mouseup",()=>{b()}),e.preventDefault()}function J(){o.value={scale:A.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function M(){if(_.value||N.value)return;const e=Qe(x),n=Object.values(x),t=L.value.name,g=(n.findIndex(d=>d.name===t)+1)%e.length;L.value=x[e[g]],J()}function $(e){N.value=!1;const n=l.urlList.length;c.value=(e+n)%n}function D(){j.value&&!l.infinite||$(c.value-1)}function P(){G.value&&!l.infinite||$(c.value+1)}function p(e,n={}){if(_.value||N.value)return;const{minScale:t,maxScale:v}=l,{zoomRate:g,rotateDeg:d,enableTransition:b}={zoomRate:l.zoomRate,rotateDeg:90,enableTransition:!0,...n};switch(e){case"zoomOut":o.value.scale>t&&(o.value.scale=Number.parseFloat((o.value.scale/g).toFixed(3)));break;case"zoomIn":o.value.scale<v&&(o.value.scale=Number.parseFloat((o.value.scale*g).toFixed(3)));break;case"clockwise":o.value.deg+=d,C("rotate",o.value.deg);break;case"anticlockwise":o.value.deg-=d,C("rotate",o.value.deg);break}o.value.enableTransition=b}function he(e){var n;((n=e.detail)==null?void 0:n.focusReason)==="pointer"&&e.preventDefault()}function _e(){l.closeOnPressEscape&&T()}function ye(e){if(e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}return B(()=>A.value,e=>{o.value.scale=e}),B(R,()=>{$e(()=>{const e=Z.value;e!=null&&e.complete||(_.value=!0)})}),B(c,e=>{J(),C("switch",e)}),Se(()=>{pe(),V=z("wheel",ye,{passive:!1}),W=document.body.style.overflow,document.body.style.overflow="hidden"}),le({setActiveItem:$}),(e,n)=>(O(),se(a(je),{to:"body",disabled:!e.teleported},{default:u(()=>[r(Ve,{name:"viewer-fade",appear:""},{default:u(()=>[f("div",{ref_key:"wrapper",ref:Y,tabindex:-1,class:i(a(s).e("wrapper")),style:ne({zIndex:ce.value})},[r(a(Ye),{loop:"",trapped:"","focus-trap-el":Y.value,"focus-start-el":"container",onFocusoutPrevented:he,onReleaseRequested:_e},{default:u(()=>[f("div",{class:i(a(s).e("mask")),onClick:Ae(t=>e.hideOnClickModal&&T(),["self"])},null,10,["onClick"]),y(" CLOSE "),f("span",{class:i([a(s).e("btn"),a(s).e("close")]),onClick:T},[r(a(w),null,{default:u(()=>[r(a(Me))]),_:1})],2),y(" ARROW "),a(ue)?y("v-if",!0):(O(),F(De,{key:0},[f("span",{class:i(a(de)),onClick:D},[r(a(w),null,{default:u(()=>[r(a(Pe))]),_:1})],2),f("span",{class:i(a(fe)),onClick:P},[r(a(w),null,{default:u(()=>[r(a(Xe))]),_:1})],2)],64)),e.$slots.progress||e.showProgress?(O(),F("div",{key:1,class:i([a(s).e("btn"),a(s).e("progress")])},[S(e.$slots,"progress",{activeIndex:c.value,total:e.urlList.length},()=>[Be(Fe(a(me)),1)])],2)):y("v-if",!0),y(" ACTIONS "),f("div",{class:i([a(s).e("btn"),a(s).e("actions")])},[f("div",{class:i(a(s).e("actions__inner"))},[S(e.$slots,"toolbar",{actions:p,prev:D,next:P,reset:M,activeIndex:c.value,setActiveItem:$},()=>[r(a(w),{onClick:t=>p("zoomOut")},{default:u(()=>[r(a(He))]),_:1},8,["onClick"]),r(a(w),{onClick:t=>p("zoomIn")},{default:u(()=>[r(a(qe))]),_:1},8,["onClick"]),f("i",{class:i(a(s).e("actions__divider"))},null,2),r(a(w),{onClick:M},{default:u(()=>[(O(),se(We(a(L).icon)))]),_:1}),f("i",{class:i(a(s).e("actions__divider"))},null,2),r(a(w),{onClick:t=>p("anticlockwise")},{default:u(()=>[r(a(Ze))]),_:1},8,["onClick"]),r(a(w),{onClick:t=>p("clockwise")},{default:u(()=>[r(a(Ke))]),_:1},8,["onClick"])])],2)],2),y(" CANVAS "),f("div",{class:i(a(s).e("canvas"))},[N.value&&e.$slots["viewer-error"]?S(e.$slots,"viewer-error",{key:0,activeIndex:c.value,src:a(R)}):(O(),F("img",{ref_key:"imgRef",ref:Z,key:a(R),src:a(R),style:ne(a(ve)),class:i(a(s).e("img")),crossorigin:e.crossorigin,onLoad:be,onError:we,onMousedown:ke},null,46,["src","crossorigin"]))],2),S(e.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var na=Ge(sa,[["__file","image-viewer.vue"]]);const ra=Ue(na);export{ra as E};
