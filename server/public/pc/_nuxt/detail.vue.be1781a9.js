import{d as N,A as D,aF as C,k as x,l as w,q as e,s as a,H as L,m as l,Z as t,v as m,t as i,I as G,L as M,cP as X,G as F,av as P,cT as Y,cU as ee,au as te,ay as ae,ef as oe,r as le,o as se,J as B,K as O,aI as ne,bK as re,y as pe,ax as ie,cQ as de}from"./entry.d9d53b29.js";import{E as fe,a as ue}from"./index.79f7263c.js";import{E as me,a as _e}from"./index.9a037d22.js";import{E as ce}from"./el-empty.03c7f5cd.js";import{_ as xe}from"./index.vue.930f6062.js";/* empty css                  *//* empty css               *//* empty css                     *//* empty css                        *//* empty css                 */import{u as ge}from"./usePaging.64764a63.js";import{a as z,b as we}from"./sph.47a77ad4.js";const be={class:"export-data"},ye={class:"flex"},ve=N({__name:"index",props:{params:{type:Object,default:()=>({})},pageSize:{type:Number,default:25},fetchFun:{type:Function,required:!0},exportFun:{type:Function,default:()=>{}}},setup(R){const v=D(),f=R,b=D(),o=C({page_type:0,page_start:1,page_end:200,file_name:"",status:""}),h={page_start:[{required:!0,message:"请输入起始页码"},{type:"number",message:"页码必须是整数"},{validator:(d,r,s)=>{if(r<=0)return s(new Error("页码必须大于0"));s()}}],page_end:[{required:!0,message:"请输入结束页码"},{type:"number",message:"页码必须是整数"},{validator:(d,r,s)=>{if(r<=0)return s(new Error("页码必须大于0"));s()}}]},u=C({count:0,sum_page:0,page_size:0,max_page:0,all_max_size:0}),E=async()=>{const d=await f.fetchFun({...f.params,page_size:f.pageSize,export:1});Object.assign(u,d),o.file_name=d.file_name,o.page_end=d.page_end,o.page_start=d.page_start},k=async()=>{var d,r;await((d=v.value)==null?void 0:d.validate()),F.loading("正在导出中...");try{const s=f.exportFun?await f.exportFun({...f.params,...o,page_size:f.pageSize,export:2}):await f.fetchFun({...f.params,...o,page_size:f.pageSize,export:2});(r=b.value)==null||r.close(),F.closeLoading(),s!=null&&s.url&&window.open(s.url)}catch{F.closeLoading()}};return(d,r)=>{const s=P,p=Y,V=ee,y=te,g=ae;return x(),w("div",be,[e(X,{ref_key:"popupRef",ref:b,title:"导出设置",width:"500px","confirm-button-text":"确认导出",async:!0,onOpen:E,onConfirm:k},{trigger:a(()=>[L(d.$slots,"trigger")]),default:a(()=>[l("div",null,[e(g,{ref_key:"formRef",ref:v,model:t(o),"label-width":"120px",rule:h},{default:a(()=>[e(s,{label:"数据量："},{default:a(()=>[m(" 预计导出"+i(t(u).count)+"条数据， 共"+i(t(u).sum_page)+"页，每页"+i(t(u).page_size)+"条数据 ",1)]),_:1}),e(s,{label:"导出限制："},{default:a(()=>[m(" 每次导出最大允许"+i(t(u).max_page)+"页，共"+i(t(u).all_max_size)+"条数据 ",1)]),_:1}),e(s,{prop:"page_type",label:"导出范围：",required:""},{default:a(()=>[e(V,{modelValue:t(o).page_type,"onUpdate:modelValue":r[0]||(r[0]=c=>t(o).page_type=c)},{default:a(()=>[e(p,{label:0},{default:a(()=>r[4]||(r[4]=[m("全部导出",-1)])),_:1,__:[4]}),e(p,{label:1},{default:a(()=>r[5]||(r[5]=[m("分页导出",-1)])),_:1,__:[5]})]),_:1},8,["modelValue"])]),_:1}),t(o).page_type==1?(x(),G(s,{key:0,label:"分页范围："},{default:a(()=>[l("div",ye,[e(s,{prop:"page_start"},{default:a(()=>[e(y,{style:{width:"140px"},modelValue:t(o).page_start,"onUpdate:modelValue":r[1]||(r[1]=c=>t(o).page_start=c),modelModifiers:{number:!0},placeholder:""},null,8,["modelValue"])]),_:1}),r[6]||(r[6]=l("span",{class:"flex-none ml-2 mr-2"},"页，至",-1)),e(s,{prop:"page_end"},{default:a(()=>[e(y,{style:{width:"140px"},modelValue:t(o).page_end,"onUpdate:modelValue":r[2]||(r[2]=c=>t(o).page_end=c),modelModifiers:{number:!0},placeholder:""},null,8,["modelValue"])]),_:1})])]),_:1})):M("",!0),L(d.$slots,"form-item",{formData:t(o)}),e(s,{label:"导出文件名称：",prop:"file_name"},{default:a(()=>[e(y,{modelValue:t(o).file_name,"onUpdate:modelValue":r[3]||(r[3]=c=>t(o).file_name=c),placeholder:"请输入导出文件名称"},null,8,["modelValue"])]),_:1})]),_:3},8,["model"])])]),_:3},512)])}}}),he={class:"h-full flex flex-col gap-[10px]"},Ee={class:"bg-app-bg-2 rounded-[20px] p-[18px] flex justify-between gap-x-4"},ke={class:"flex flex-col gap-y-3"},Ve={class:"flex"},Fe={class:"flex flex-wrap gap-2"},ze={class:"flex"},Ce={class:"flex flex-wrap gap-2"},Re={class:"text-[#ffffffcc]"},Se={class:"text-[#ffffffcc]"},Te={class:"grow min-h-0 bg-app-bg-2 rounded-[20px] flex flex-col"},Ie={class:"flex-shrink-0 flex items-center justify-between px-[14px] h-[88px] border-b border-[#ffffff1a]"},Ue={key:0,class:"flex items-center gap-1"},$e={class:"grow min-h-0"},je={class:"flex justify-center items-center h-full"},qe={class:"flex justify-center p-4"},Je=N({__name:"detail",emits:["back"],setup(R,{emit:v}){const f=v,b=oe(),o=le({}),h=C({task_id:b.id}),{pager:u,getLists:E}=ge({fetchFun:z,params:h}),k=s=>({1:"线索有效",2:"线索无效",3:"内含有效线索"})[s],d=async()=>{const s=await we({id:b.id});o.value=s};return se(async()=>{await d(),await E()}),(s,p)=>{var S,T,I,U,$,j,q;const V=pe,y=ie,g=fe,c=ue,A=P,K=ve,_=me,Q=ce,H=_e,J=xe,Z=de;return x(),w("div",he,[l("div",Ee,[l("div",ke,[l("div",Ve,[p[2]||(p[2]=l("span",{class:"text-[#ffffff80] flex-shrink-0"},"执行设备：",-1)),l("span",Fe,[(x(!0),w(B,null,O((S=t(o))==null?void 0:S.device_codes,n=>(x(),w("span",{class:"px-[10px] py-[4px] rounded-md text-[#ffffffcc] shadow-[0_0_0_1px_var(--app-border-color-2)]",key:n},i(n),1))),128))])]),l("div",ze,[p[3]||(p[3]=l("span",{class:"text-[#ffffff80] flex-shrink-0"},"线索词：",-1)),l("span",Ce,[(x(!0),w(B,null,O((T=t(o))==null?void 0:T.keywords,n=>(x(),w("span",{class:"px-[10px] py-[4px] rounded-md text-[#ffffffcc] text-[11px] shadow-[0_0_0_1px_var(--app-border-color-2)]",key:n},i(n),1))),128))])]),l("div",null,[p[4]||(p[4]=l("span",{class:"text-[#ffffff80]"},"关键词执行数量：",-1)),l("span",Re,i(((I=t(o))==null?void 0:I.number_of_implemented_keywords)||0)+" / "+i(((U=t(o))==null?void 0:U.implementation_keywords_number)||0),1)]),l("div",null,[p[5]||(p[5]=l("span",{class:"text-[#ffffff80]"},"已获客数量：",-1)),l("span",Se,i((($=t(o))==null?void 0:$.crawl_number)||0),1)])]),p[6]||(p[6]=l("div",null,null,-1))]),l("div",Te,[l("div",Ie,[l("div",{class:"flex items-center gap-2 cursor-pointer",onClick:p[0]||(p[0]=n=>f("back"))},[e(V,{name:"el-icon-ArrowLeft",color:"#ffffff"}),p[7]||(p[7]=l("div",{class:"text-white"},"返回",-1))]),((j=t(o))==null?void 0:j.status)==3||((q=t(o))==null?void 0:q.status)==4?(x(),w("div",Ue,[e(K,{params:t(h),"fetch-fun":t(z),"export-fun":t(z)},{trigger:a(()=>[e(y,{type:"primary",class:"!rounded-full !h-10 w-[98px]"},{default:a(()=>p[8]||(p[8]=[m("导出",-1)])),_:1,__:[8]})]),"form-item":a(({formData:n})=>[e(A,{label:"线索有效性："},{default:a(()=>[e(c,{modelValue:n.status,"onUpdate:modelValue":W=>n.status=W,class:"!w-[260px] !h-10",placeholder:"请选择",filterable:"",clearable:"","empty-values":[void 0,null],"show-arrow":!1},{default:a(()=>[e(g,{label:"全部",value:""}),e(g,{label:"未校验",value:"0"}),e(g,{label:"已通过校验",value:"1"}),e(g,{label:"未通过校验",value:"2"}),e(g,{label:"待执行",value:"4"})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:1},8,["params","fetch-fun","export-fun"])])):M("",!0)]),l("div",$e,[ne((x(),G(H,{height:"100%",data:t(u).lists,"header-row-style":{height:"62px"},"row-style":{height:"50px"}},{empty:a(()=>[l("div",je,[e(Q,{description:"暂无数据"})])]),default:a(()=>[e(_,{prop:"username",label:"用户名称","min-width":"120","show-overflow-tooltip":""},{default:a(({row:n})=>[m(i(n.username||"-"),1)]),_:1}),e(_,{prop:"name",label:"线索词","min-width":"120"},{default:a(({row:n})=>[m(i(n.exec_keyword||"-"),1)]),_:1}),e(_,{prop:"address",label:"地区","min-width":"80"},{default:a(({row:n})=>[m(i(n.address||"-"),1)]),_:1}),e(_,{prop:"crawl_content",label:"获取内容","min-width":"200","show-overflow-tooltip":""},{default:a(({row:n})=>[m(i(n.crawl_content||"-"),1)]),_:1}),e(_,{prop:"device_code",label:"执行设备",width:"180"}),e(_,{prop:"reg_content",label:"提取内容","min-width":"200","show-overflow-tooltip":""},{default:a(({row:n})=>[m(i(n.reg_content||"-"),1)]),_:1}),e(_,{prop:"clue_type_name",label:"线索类型",width:"100"}),e(_,{label:"线索检验",width:"100"},{default:a(({row:n})=>[m(i(k(n.status)),1)]),_:1}),e(_,{prop:"tokens",label:"算力消耗","min-width":"80"}),e(_,{prop:"create_time",label:"执行时间",width:"180"})]),_:1},8,["data"])),[[Z,t(u).loading]])]),l("div",qe,[e(J,{modelValue:t(u),"onUpdate:modelValue":p[1]||(p[1]=n=>re(u)?u.value=n:null),layout:"prev, pager, next",onChange:t(E)},null,8,["modelValue","onChange"])])])])}}});export{Je as _,ve as a};
