import{d as re,r as D,aF as P,c as _,cx as se,k as u,I as f,s as n,m as s,q as o,v as L,t as E,l as c,K as C,Z as i,L as y,J as v,cV as ne,aH as ue,y as pe,av as de,au as me,ay as ce,_ as _e}from"./entry.ee599c70.js";import{_ as ge}from"./index.c972ba3d.js";import{E as fe,a as ve}from"./index.8fd3c68c.js";/* empty css                  *//* empty css               *//* empty css                     */import{MaterialTypeEnum as r}from"./index.cf59f1a8.js";import{useCate as ke,useFile as xe}from"./useMaterial.fcddf625.js";import"./index.c8874308.js";import"./index.6fe7ec27.js";import"./cloneDeep.d0528121.js";/* empty css                  *//* empty css                    *//* empty css                  */import"./index.e69b4eeb.js";import"./index.684b3e96.js";import"./strings.32bdf471.js";import"./_baseIteratee.6942dcd2.js";import"./toNumber.0872a42f.js";import"./clamp.05cad4d6.js";import"./index.0e845cb8.js";import"./usePaging.5914886e.js";import"./person_wechat.703f63bb.js";const ye={class:"w-full h-[60px] flex flex-col items-center justify-center"},be={class:"text-[#575757] text-xs leading-5 mt-2"},Ie={class:"grid grid-cols-5 gap-2 w-full mt-4"},Ve=["src"],he=["src"],Ee=["onClick"],Fe={class:"w-full h-[60px] flex flex-col items-center justify-center"},Me={class:"text-[#575757] text-xs leading-5 mt-2"},we={class:"link-upload-box relative"},De={class:"w-[150px] h-[150px] flex flex-col items-center justify-center relative"},Pe=["src"],Le=re({__name:"upload",emits:["close","success"],setup(Ce,{expose:N,emit:O}){const F=O,{currentCate:p,cateLists:A,getCateLists:G}=ke(),{handleAddMaterial:R,handleEditMaterial:U}=xe(),b=D(),I=()=>({id:"",group_ids:[],urls:[],link:"",link_title:"",link_desc:"",mini_program_name:"",mini_program_appid:"",mini_program_path:"",pic:""});let e=P(I());const q=P({group_ids:[{required:!0,message:"请选择分组",trigger:"change"}],urls:[{required:!0,message:"请上传素材",trigger:"change",type:"array"}],link:[{required:!0,message:"请输入链接地址",trigger:"blur"}],link_title:[{required:!0,message:"请输入链接标题",trigger:"blur"}],link_desc:[{required:!0,message:"请输入链接描述",trigger:"blur"}],pic:[{required:!0,message:"请上传封面图",trigger:"change"}],mini_program_name:[{required:!0,message:"请输入小程序标题",trigger:"blur"}],mini_program_appid:[{required:!0,message:"请输入小程序APPID",trigger:"blur"}],mini_program_path:[{required:!0,message:"请输入小程序路径",trigger:"blur"}]}),k=_(()=>!!e.id),j=_(()=>`${k.value?"编辑":"上传"}${x.value}素材`),x=_(()=>({[r.IMAGE]:"图片",[r.VIDEO]:"视频",[r.LINK]:"链接",[r.MINI_PROGRAM]:"小程序",[r.FILE]:"文件"})[p.value]||""),S=_(()=>[r.IMAGE,r.VIDEO].includes(p.value)),T=_(()=>[r.LINK,r.MINI_PROGRAM].includes(p.value)),$=_(()=>({[r.IMAGE]:"image",[r.VIDEO]:"video"})[p.value]),z=_(()=>p.value===r.IMAGE?"支持JPG、PNG格式":"支持MP4、MOV格式"),M=_(()=>({[r.IMAGE]:9,[r.VIDEO]:9,[r.FILE]:9}[p.value]||0)-e.urls.length),K=_(()=>A.value.filter(l=>l.id!==0)),w=l=>{const{data:{uri:t,name:d}}=l;e.urls.push({url:t,name:d})},B=l=>{e.pic=l.data.uri},J=l=>{const t=l.data.uri;e.urls=e.urls.filter(d=>d.url!==t)},H=l=>{e.urls.splice(l,1)},W=()=>{const l={group_ids:e.group_ids,ext_info:{link:e.link,link_desc:e.link_desc}};return k.value?(l.id=e.id,l.file_name=e.link_title,l.file_url=e.pic):l.files=[{url:e.pic,name:e.link_title}],l},Z=()=>{const l={group_ids:e.group_ids,ext_info:{mini_program_appid:e.mini_program_appid,mini_program_path:e.mini_program_path}};return k.value?(l.id=e.id,l.file_name=e.mini_program_name,l.file_url=e.pic):l.files=[{url:e.pic,name:e.mini_program_name}],l},Q=async()=>{var t,d;await((t=b.value)==null?void 0:t.validate());let l={id:e.id,files:e.urls,group_ids:e.group_ids,ext_info:{}};switch(p.value){case r.LINK:l=W();break;case r.MINI_PROGRAM:l=Z();break}await(k.value?U(l):R(l)),F("success"),(d=V.value)==null||d.close()},{isLock:X,lockFn:Y}=se(Q),V=D(),ee=()=>{var l;Object.assign(e,I()),ue(()=>{var t;(t=b.value)==null||t.clearValidate()}),(l=V.value)==null||l.open()},le=()=>{F("close")};return N({open:ee,setFormData:l=>{Object.assign(e,I()),Object.assign(e,l)}}),G(),(l,t)=>{const d=pe,h=ge,m=de,g=me,te=fe,ie=ve,oe=ce;return u(),f(ne,{ref_key:"popupRef",ref:V,async:"",width:"500px",title:j.value,"confirm-loading":i(X),onConfirm:i(Y),onClose:le},{default:n(()=>[s("div",null,[o(oe,{ref_key:"formRef",ref:b,model:i(e),rules:q,"label-width":"100px","label-position":"top"},{default:n(()=>[S.value?(u(),f(m,{key:0,label:"",prop:"urls"},{default:n(()=>[o(h,{drag:"","show-progress":"",limit:M.value,type:$.value,"show-file-list":!1,class:"w-full",onSuccess:w},{default:n(()=>[s("div",ye,[o(d,{name:"local-icon-upload_cloud",size:40}),s("div",be,[s("div",null,[L(" 将"+E(x.value)+"拖拽到此处 或 ",1),t[8]||(t[8]=s("span",{class:"text-primary"},"点击上传",-1))]),s("div",null,E(z.value),1)])])]),_:1},8,["limit","type"]),s("div",Ie,[(u(!0),c(v,null,C(i(e).urls,(a,ae)=>(u(),c("div",{key:a.url,class:"h-[90px] bg-[#F7F7F7] rounded-lg p-1 relative"},[i(p)===i(r).IMAGE?(u(),c("img",{key:0,src:a.url,class:"w-full h-full object-cover rounded-lg",alt:"上传的图片"},null,8,Ve)):i(p)===i(r).VIDEO?(u(),c("video",{key:1,src:a.url,class:"w-full h-full object-cover rounded-lg"},null,8,he)):y("",!0),s("div",{class:"absolute -top-2 -right-2 cursor-pointer",onClick:Oe=>H(ae)},[o(d,{name:"local-icon-close_circle_fill",size:20,color:"#D43030"})],8,Ee)]))),128))])]),_:1})):i(p)===i(r).LINK?(u(),c(v,{key:1},[o(m,{label:"链接地址",prop:"link"},{default:n(()=>[o(g,{modelValue:i(e).link,"onUpdate:modelValue":t[0]||(t[0]=a=>i(e).link=a),placeholder:"请输入链接地址"},null,8,["modelValue"])]),_:1}),o(m,{label:"链接标题",prop:"link_title"},{default:n(()=>[o(g,{modelValue:i(e).link_title,"onUpdate:modelValue":t[1]||(t[1]=a=>i(e).link_title=a),placeholder:"请输入链接标题"},null,8,["modelValue"])]),_:1}),o(m,{label:"链接描述",prop:"link_desc"},{default:n(()=>[o(g,{modelValue:i(e).link_desc,"onUpdate:modelValue":t[2]||(t[2]=a=>i(e).link_desc=a),type:"textarea",resize:"none",placeholder:"请输入链接描述",rows:5},null,8,["modelValue"])]),_:1})],64)):i(p)===i(r).MINI_PROGRAM?(u(),c(v,{key:2},[o(m,{label:"小程序标题",prop:"mini_program_name"},{default:n(()=>[o(g,{modelValue:i(e).mini_program_name,"onUpdate:modelValue":t[3]||(t[3]=a=>i(e).mini_program_name=a),placeholder:"请输入小程序标题"},null,8,["modelValue"])]),_:1}),o(m,{label:"小程序APPID",prop:"mini_program_appid"},{default:n(()=>[o(g,{modelValue:i(e).mini_program_appid,"onUpdate:modelValue":t[4]||(t[4]=a=>i(e).mini_program_appid=a),placeholder:"请输入小程序APPID"},null,8,["modelValue"])]),_:1}),o(m,{label:"小程序路径",prop:"mini_program_path"},{default:n(()=>[o(g,{modelValue:i(e).mini_program_path,"onUpdate:modelValue":t[5]||(t[5]=a=>i(e).mini_program_path=a),placeholder:"请输入小程序路径"},null,8,["modelValue"])]),_:1})],64)):i(p)===i(r).FILE?(u(),f(m,{key:3,label:"",prop:"urls"},{default:n(()=>[o(h,{limit:M.value,drag:"",type:"file",class:"w-full","list-type":"text",onSuccess:w,onRemove:J},{default:n(()=>[s("div",Fe,[o(d,{name:"local-icon-upload_cloud",size:40}),s("div",Me,[s("div",null,[L(" 将"+E(x.value)+"拖拽到此处 或 ",1),t[9]||(t[9]=s("span",{class:"text-primary"},"点击上传",-1))]),t[10]||(t[10]=s("div",null,"支持txt、docx、xml、excel等格式",-1))])])]),_:1},8,["limit"])]),_:1})):y("",!0),T.value?(u(),f(m,{key:4,label:"封面图",prop:"pic"},{default:n(()=>[s("div",we,[o(h,{limit:1,drag:"","show-progress":"","show-file-list":!1,onSuccess:B},{default:n(()=>[s("div",De,[i(e).pic?(u(),c("img",{key:0,src:i(e).pic,class:"w-full h-full object-cover rounded-lg",alt:"封面图"},null,8,Pe)):(u(),c(v,{key:1},[o(d,{name:"local-icon-upload_cloud",size:28}),t[11]||(t[11]=s("div",{class:"text-[#575757] text-xs leading-5 mt-2"},[s("div",null,[s("span",{class:"text-primary"},"点击上传")]),s("div",null,"支持JPG、PNG格式")],-1))],64))])]),_:1}),i(e).pic?(u(),c("div",{key:0,class:"absolute -top-2 -right-2 cursor-pointer",onClick:t[6]||(t[6]=a=>i(e).pic="")},[o(d,{name:"local-icon-close_circle_fill",size:20,color:"#D43030"})])):y("",!0)])]),_:1})):y("",!0),o(m,{label:`选择该${x.value}的分组`,prop:"group_ids"},{default:n(()=>[o(ie,{modelValue:i(e).group_ids,"onUpdate:modelValue":t[7]||(t[7]=a=>i(e).group_ids=a),placeholder:"请选择",multiple:"",filterable:"",clearable:""},{default:n(()=>[(u(!0),c(v,null,C(K.value,a=>(u(),f(te,{key:a.id,label:a.group_name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])])]),_:1},8,["title","confirm-loading","onConfirm"])}}});const ol=_e(Le,[["__scopeId","data-v-35d574b6"]]);export{ol as default};
