import{d as w,z as E,r as m,G as y,aF as T,bC as h,k as v,l as x,q as c,s as D,m as A,Z as l}from"./entry.ca4d3d61.js";import{k as M,m as C}from"./drawing.7058a163.js";import{ModelEnum as i,drawTypeEnumMap as I,DrawTypeEnum as b}from"./index.fb0aa6a9.js";import R from"./useCreateForm.21a97685.js";import H from"./useDrawingTask.ee2b609a.js";import S from"./result-content.b90f64a7.js";import{E as V}from"./index.8b07fb5c.js";const Y={class:"h-full relative w-full"},B={class:"px-[10px]"},X=w({__name:"index",setup(F){const{onEvent:u,setFormData:p}=R(),d=E(),n=m([]),o=m(!1),f=async(a,s)=>{s.images=new Array(parseInt(a.img_count)).fill({url:"",loading:!0,progress:0,status:0,error:!1});const{result:r}=await M(a),{processDrawingTask:e}=H({type:I[b.TXT2IMAGE],task_id:r.task_id,dataLists:s.images});await e({callback:t=>{s.images=t}})},g=async(a,s)=>{s.images=[{url:"",loading:!0,progress:0,status:0,error:!1}];const{result:r}=await C(a);s.images=[r.image_urls].map(e=>({url:e,loading:!1,progress:100,status:1,error:!1}))};u("update:formData",async a=>{if(o.value){y.msgWarning("请等待上一次任务完成");return}o.value=!0;const{model:s,model_name:r,params:e}=a,t=T({date:h().format("YYYY-MM-DD HH:mm"),prompt:e.poster_description,images:[],formData:a,tags:[r,e.poster_type,e.poster_color,e.poster_title,e.poster_subtitle]});n.value.unshift(t);try{s==i.HIDREAMAI?await f(e,t):(s==i.GENERAL||s==i.SEEDREAM)&&await g(e,t),d.getUser()}catch{t.images=t.images.map(k=>({...k,loading:!1,progress:0,status:4,error:!0}))}finally{o.value=!1}});const _=a=>{p(a)};return(a,s)=>(v(),x("div",Y,[c(l(V),null,{default:D(()=>[A("div",B,[c(S,{"result-lists":l(n),"is-all-tasks-completed":l(o),onRetry:_},null,8,["result-lists","is-all-tasks-completed"])])]),_:1})]))}});export{X as _};
