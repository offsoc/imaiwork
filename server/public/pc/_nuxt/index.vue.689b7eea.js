import{d as J,bP as W,aF as Y,r as k,o as Z,k as n,l as r,Z as l,m as o,q as s,s as a,$ as Q,v as m,aI as X,I as h,t as x,Y as ee,L as c,bM as te,J as se,bO as U,aH as ae,G as B,ax as le,au as oe,y as ne,ba as ie,av as re,cW as de,u as ue}from"./entry.ee599c70.js";import{E as ce}from"./index.e69b4eeb.js";import{E as pe,a as me}from"./index.ef8eb140.js";import{E as fe,a as _e}from"./index.8fd3c68c.js";import{a as ve,_ as ye}from"./detail.vue.8a819bf4.js";import{_ as ge}from"./index.vue.33025166.js";/* empty css                     *//* empty css                        *//* empty css               *//* empty css                  *//* empty css                 */import{u as he}from"./usePaging.5914886e.js";import{d as be,a as I,e as ke}from"./sph.d6d2831a.js";import{SidebarTypeEnum as $}from"./index.22c5df69.js";import xe from"./create-panel.7fcb49e3.js";import{_ as Ee}from"./edit.vue.023309c8.js";const Ce={key:0,class:"h-full flex flex-col bg-app-bg-2 rounded-[20px]"},we={class:"flex-shrink-0 px-[14px]"},Te={class:"flex items-center justify-end h-[88px]"},$e={class:"flex items-center gap-[14px]"},Se={class:"grow min-h-0 overflow-hidden flex flex-col"},Ve={class:"grow min-h-0"},Ue=["onClick"],Be={class:"text-white"},Ie={class:"flex items-center justify-center gap-2"},Oe={key:1},Re={key:2},Pe={key:3},je={key:4},Fe={key:5},ze={class:"flex justify-end items-center"},Ae={class:"leading-6"},De={class:"flex justify-center p-4"},lt=J({__name:"index",setup(Me){const{query:b}=W(),O=ue(),E=Y({name:"",page_size:20,status:""}),{pager:f,getLists:i,resetPage:R}=he({fetchFun:be,params:E}),C=k(!1),w=k(),_=k(b.is_create=="1"&&parseInt(b.type)==$.AUTO_GET_CUSTOMER),S=()=>{_.value=!0,U({is_create:1})},P=async p=>{C.value=!0,await ae(),w.value.open(),w.value.setFormData(p)},v=k(b.is_detail=="1"&&parseInt(b.type)==$.AUTO_GET_CUSTOMER),j=p=>{v.value=!0,U({is_detail:1,id:p.id})},F=async p=>{O.$confirm({message:"是否删除该任务？",theme:"dark",onConfirm:async()=>{try{await ke({id:p}),B.msgSuccess("删除成功"),i()}catch(t){B.msgError(t||"删除失败")}}})},V=()=>{_.value=!1,v.value=!1,window.history.replaceState("","",`?type=${$.AUTO_GET_CUSTOMER}`),i()};return Z(()=>{!_.value&&!v.value&&i()}),(p,t)=>{const d=le,z=oe,T=ne,A=ie,D=ce,u=pe,y=fe,M=_e,N=re,G=ve,L=me,q=ge,K=de;return n(),r(se,null,[!l(_)&&!l(v)?(n(),r("div",Ce,[o("div",we,[s(D,null,{default:a(()=>[o("div",Te,[o("div",$e,[s(z,{modelValue:l(E).name,"onUpdate:modelValue":t[1]||(t[1]=e=>l(E).name=e),"prefix-icon":"el-icon-Search",class:"!w-[240px] search-name-input",placeholder:"请输入任务名称",clearable:"",onClear:t[2]||(t[2]=e=>l(i)()),onKeydown:t[3]||(t[3]=Q(e=>l(i)(),["enter"]))},{append:a(()=>[s(d,{text:"",onClick:t[0]||(t[0]=e=>l(i)())},{default:a(()=>[...t[8]||(t[8]=[m(" 搜索 ",-1)])]),_:1})]),_:1},8,["modelValue"]),s(d,{type:"primary",class:"!rounded-full !h-10",onClick:S},{default:a(()=>[s(T,{name:"local-icon-add_circle",color:"#ffffff"}),t[9]||(t[9]=o("span",{class:"ml-2"},"发布获客任务 ",-1))]),_:1}),o("div",null,[s(A,{content:"刷新"},{default:a(()=>[s(d,{circle:"",color:"#1f1f1f",icon:"el-icon-Refresh",class:"!w-10 !h-10",onClick:t[4]||(t[4]=e=>l(R)())})]),_:1})])])])]),_:1})]),o("div",Se,[o("div",Ve,[X((n(),h(L,{height:"100%",data:l(f).lists,"header-row-style":{height:"62px"},"row-style":{height:"50px"}},{empty:a(()=>[o("div",Ae,[s(d,{type:"primary",class:"!rounded-full !h-10",onClick:S},{default:a(()=>[s(T,{name:"local-icon-add_circle",color:"#ffffff"}),t[13]||(t[13]=o("span",{class:"ml-2"},"发布获客任务 ",-1))]),_:1})])]),default:a(()=>[s(u,{prop:"name",label:"任务名称",width:"240",fixed:"left"},{default:a(({row:e})=>[o("div",{class:"flex items-center justify-center gap-2 cursor-pointer",onClick:g=>P(e)},[o("div",Be,x(e.name),1),s(T,{name:"local-icon-edit",color:"#ffffff"})],8,Ue)]),_:1}),s(u,{label:"线索词","min-width":"200","show-overflow-tooltip":""},{default:a(({row:e})=>[m(x(e.keywords.join("；")),1)]),_:1}),s(u,{prop:"crawl_number",label:"已获线索数",width:"120"}),s(u,{label:"任务状态",width:"120"},{default:a(({row:e})=>[o("div",Ie,[e.status!=0?(n(),r("div",{key:0,class:ee(["w-[6px] h-[6px] rounded-full",{"bg-primary":e.status==1,"bg-info":e.status==2,"bg-success":e.status==3,"bg-warning":e.status==4}])},null,2)):c("",!0),e.status==0?(n(),r("div",Oe,"未执行")):e.status==1?(n(),r("div",Re,"进行中")):e.status==2?(n(),r("div",Pe,"已暂停")):e.status==3?(n(),r("div",je,"已完成")):e.status==4?(n(),r("div",Fe,"已结束")):c("",!0)])]),_:1}),s(u,{label:"当前执行进度","min-width":"120"},{default:a(({row:e})=>[m(x(e.number_of_implemented_keywords||0)+" / "+x(e.implementation_keywords_number||0),1)]),_:1}),s(u,{prop:"create_time",label:"创建时间",width:"180"}),s(u,{label:"操作",width:"180",fixed:"right",align:"right"},{default:a(({row:e})=>[o("div",ze,[e.status!=0?(n(),h(G,{key:0,class:"mx-3",params:{task_id:e.id},"fetch-fun":l(I),"export-fun":l(I)},{trigger:a(()=>[s(d,{class:"!border-app-border-2",color:"#181818",size:"small"},{default:a(()=>[...t[10]||(t[10]=[m("导出",-1)])]),_:1})]),"form-item":a(({formData:g})=>[s(N,{label:"线索有效性："},{default:a(()=>[s(M,{modelValue:g.status,"onUpdate:modelValue":H=>g.status=H,class:"!w-[260px] !h-10",placeholder:"请选择",filterable:"",clearable:"","empty-values":[void 0,null],"show-arrow":!1},{default:a(()=>[s(y,{label:"全部",value:""}),s(y,{label:"未校验",value:"0"}),s(y,{label:"已通过校验",value:"1"}),s(y,{label:"未通过校验",value:"2"}),s(y,{label:"待执行",value:"4"})]),_:1},8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:1},8,["params","fetch-fun","export-fun"])):c("",!0),s(d,{class:"!border-app-border-2",color:"#181818",size:"small",onClick:g=>j(e)},{default:a(()=>[...t[11]||(t[11]=[m("详情",-1)])]),_:1},8,["onClick"]),s(d,{type:"danger",link:"",size:"small",onClick:g=>F(e.id)},{default:a(()=>[...t[12]||(t[12]=[m("删除",-1)])]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[K,l(f).loading]])]),o("div",De,[s(q,{modelValue:l(f),"onUpdate:modelValue":t[5]||(t[5]=e=>te(f)?f.value=e:null),layout:"prev, pager, next",onChange:l(i)},null,8,["modelValue","onChange"])])]),l(C)?(n(),h(Ee,{key:0,ref_key:"editPopupRef",ref:w,onClose:t[6]||(t[6]=e=>C.value=!1),onSuccess:t[7]||(t[7]=e=>l(i)())},null,512)):c("",!0)])):c("",!0),l(_)?(n(),h(xe,{key:1,onBack:V})):c("",!0),l(v)?(n(),h(ye,{key:2,ref:"detailRef",onBack:V},null,512)):c("",!0)],64)}}});export{lt as _};
