import{d as K,as as C,aG as W,x as q,r as J,c as Y,l as v,q as i,s as u,Z as o,m as e,I as D,L as I,J as L,K as Z,k as p,al as H,c$ as Q,dx as X,cY as ee,u as te,y as ae,_ as oe}from"./entry.f4f46cb5.js";import{_ as le}from"./index.71dc546d.js";import{E as se}from"./index.25e18e1c.js";import{E as ie}from"./el-image.01a57254.js";import{_ as re}from"./index.vue.fd4cab65.js";/* empty css                   */import"./el-image-viewer.c352c3bd.js";import{u as ne}from"./useTemplate.afda57ca.js";import{PublishTaskTypeEnum as r,MaterialActionType as _}from"./index.db2ee73f.js";import"./index.b2901b1d.js";import"./index.26e6fbc6.js";import"./cloneDeep.3fe36a61.js";/* empty css                  *//* empty css                    *//* empty css                  */import"./throttle.a2681779.js";import"./debounce.640f3738.js";import"./toNumber.d5c70aa7.js";const ce={class:"flex flex-col gap-y-2"},ue={class:"flex items-center justify-center rounded p-1 bg-[#ffffff0d]"},pe={class:"type-menu-item"},de={class:"flex items-center justify-center rounded p-1 bg-[#ffffff0d]"},fe={class:"grid grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-2"},me={class:"w-8 h-8 rounded-xl flex items-center justify-center border border-dashed border-[#ffffff1a] hover:border-[#ffffff33] cursor-pointer mb-4"},ve=["src","onClick"],_e=["onClick"],he={class:"absolute bottom-2 w-full z-[33] px-2"},ge=["onClick"],xe=K({__name:"material-picker",props:C({type:{default:r.VIDEO},accept:{default:""},materialList:{default:()=>[]},maxVideoCount:{default:30},maxImageCount:{default:18},maxSize:{default:100},videoMinResolution:{default:null},videoMaxResolution:{default:null},videoMinDuration:{default:0},videoMaxDuration:{default:99999}},{materialList:{},materialListModifiers:{}}),emits:C(["update:materialList","previewVideo","importMaterial","changeMaterial"],["update:materialList"]),setup(g,{emit:V}){const P=g,n=V,{type:c,accept:x,maxVideoCount:T,maxImageCount:R,maxSize:M,videoMinResolution:z,videoMaxResolution:A,videoMinDuration:$,videoMaxDuration:S}=W(P),a=q(g,"materialList"),l=J(),b=Y(()=>c.value==r.VIDEO?{type:"video",accept:x.value,limit:T.value,maxSize:M.value,videoMinWidth:z.value,videoMaxWidth:A.value,minDuration:$.value,maxDuration:S.value}:{type:"image",accept:x.value,limit:R.value,maxSize:M.value}),O=async s=>{const{uri:t}=s.data;if(c.value==r.VIDEO){const{file:d}=await X(t),m=await ee({file:d});l.value>-1?(a.value[l.value].url=t,a.value[l.value].pic=m.uri):a.value.push({url:t,pic:m.uri})}else l.value>-1?a.value[l.value].url=t:a.value.push({url:t});n("update:materialList",a.value),n("changeMaterial",{type:l.value==-1?_.ADD:_.REPLACE}),l.value=-1},j=()=>{n("importMaterial",{index:l.value,type:_.REPLACE})},y=s=>{l.value=s},B=s=>{te().$confirm({message:"确定要删除该素材吗？",theme:"dark",onConfirm:()=>{(c.value==r.VIDEO||c.value==r.IMAGE)&&a.value.splice(s,1),n("update:materialList",a.value),n("changeMaterial",{type:_.DELETE})}})},N=s=>{n("previewVideo",s)},{DefineTemplate:F,UseTemplate:k}=ne();return(s,t)=>{const d=ae,m=le,w=se,G=ie,U=re;return p(),v(L,null,[i(o(F),null,{default:u(()=>[e("div",ce,[e("div",{class:"type-menu-item",onClick:j},[e("span",ue,[i(d,{name:"local-icon-import",color:"#ffffff"})]),t[1]||(t[1]=e("span",{class:"text-[#ffffffcc]"}," 素材库导入 ",-1))]),i(m,H({class:"w-full","show-progress":""},o(b),{"show-file-list":!1,onSuccess:O}),{default:u(()=>[e("div",pe,[e("span",de,[i(d,{name:"local-icon-upload",color:"#ffffff"})]),t[2]||(t[2]=e("span",{class:"text-[#ffffffcc]"}," 本地上传",-1))])]),_:1},16)])]),_:1}),e("div",fe,[a.value.length<o(b).limit?(p(),D(w,{key:0,trigger:"click",width:"212","popper-class":"!rounded-xl !bg-app-bg-2 !border-app-border-2 !p-2 choose-type-popover","show-arrow":!1},{reference:u(()=>[e("div",{class:"material-item p-[6px] cursor-pointer hover:!border-[#ffffff33]",onClick:t[0]||(t[0]=f=>y(-1))},[e("div",me,[i(d,{name:"el-icon-Plus",color:"#ffffff"})]),t[3]||(t[3]=e("div",{class:"absolute bottom-2 w-full z-[33] px-2"},[e("div",{class:"change-material-btn"},"添加素材")],-1))])]),default:u(()=>[i(o(k))]),_:1})):I("",!0),(p(!0),v(L,null,Z(a.value,(f,h)=>(p(),v("div",{key:h,class:"material-item"},[o(c)==o(r).VIDEO?(p(),v("video",{key:0,src:f.url,class:"w-full h-full object-cover rounded-md",onClick:E=>N(f)},null,8,ve)):o(c)==o(r).IMAGE?(p(),D(G,{key:1,src:f.url,class:"w-full h-full rounded-md",fit:"cover","preview-teleported":"","preview-src-list":[f.url]},null,8,["src","preview-src-list"])):I("",!0),e("div",{class:"absolute top-1 right-1 z-[22] w-4 h-4 rounded-full",onClick:E=>B(h)},[i(U,{"icon-size":10,theme:o(Q).DARK},null,8,["theme"])],8,_e),i(w,{trigger:"click",width:"212","popper-class":"!rounded-xl !bg-app-bg-2 !border-app-border-2 !p-2 choose-type-popover","show-arrow":!1},{reference:u(()=>[e("div",he,[e("div",{class:"change-material-btn cursor-pointer",style:{"backdrop-filter":"blur(6px)"},onClick:E=>y(h)}," 替换 ",8,ge)])]),default:u(()=>[i(o(k))]),_:2},1024)]))),128))])],64)}}});const Oe=oe(xe,[["__scopeId","data-v-6f9e395d"]]);export{Oe as default};
