import{E as te,a as oe}from"./index.5f182cdf.js";import{d as K,r as u,A as le,k as a,I as k,s as f,m as s,q as l,Z as t,y as q,cV as se,aF as ae,l as c,bM as ne,$ as ie,v as re,aI as N,J as L,K as ce,t as G,L as _,c$ as pe,dP as de,dx as ue,cY as me,G as H,aH as O,cy as fe,u as _e,ax as ve,au as ye,ba as we,cW as he,_ as ge}from"./entry.ca4d3d61.js";import{_ as be}from"./index.28cc44d7.js";import{E as xe}from"./index.8b07fb5c.js";import{E as ke}from"./el-image.a5590741.js";import{_ as Ee}from"./index.vue.9b80d373.js";import{_ as Ve}from"./handle-menu.vue.911b3ba2.js";import{_ as Ce}from"./index.vue.fa049f69.js";/* empty css                  *//* empty css               *//* empty css                     */import"./el-image-viewer.c57baf7b.js";import{u as Ie}from"./usePaging.15b2220c.js";import{g as $e,s as Me,t as Le}from"./redbook.418b34fe.js";import{_ as Re}from"./empty.vue.31b43025.js";import Se from"./edit.c959cd3c.js";import{MaterialTypeEnum as p}from"./index.db2ee73f.js";import{E as Pe}from"./index.b6d81f77.js";import"./index.ab577458.js";import"./strings.5c02160d.js";import"./_baseIteratee.37ea2cef.js";import"./toNumber.33289b44.js";import"./clamp.ba5ce84b.js";import"./index.d577d4c6.js";import"./index.803eaa3c.js";import"./index.62355f5a.js";import"./cloneDeep.d975dd37.js";/* empty css                  *//* empty css                    *//* empty css                  */import"./index.655612b0.js";/* empty css                   */import"./useTemplate.afda57ca.js";import"./throttle.da389ed1.js";import"./debounce.bdbfd9e6.js";import"./index.vue.c578915d.js";const Ue={class:"-my-4"},Ae={class:"w-full h-[200px] flex items-center justify-center"},Te=["src"],ze=K({__name:"index",emits:["close"],setup(W,{expose:n,emit:h}){const R=h,m=u(""),E=u(),d=le(),S=()=>{d.value.open()},V=g=>{m.value=g},y=()=>{R("close")};return n({open:S,setUrl:V}),(g,w)=>{const b=q,P=se;return a(),k(P,{ref_key:"audioPlayerRef",ref:d,width:"800px","confirm-button-text":"","cancel-button-text":"",style:{"background-color":"var(--app-bg-color-2)"},"show-close":!1,onClose:y},{default:f(()=>[s("div",Ue,[s("div",{class:"absolute right-4 top-4 w-6 h-6 rounded-full bg-[rgba(255,255,255,0.05)] flex items-center justify-center cursor-pointer hover:bg-[rgba(255,255,255,0.1)]",onClick:y},[l(b,{name:"el-icon-Close",color:"#8B9199"})]),w[0]||(w[0]=s("div",{class:"flex items-center gap-2"},[s("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},[s("path",{opacity:"0.1",d:"M6 0.5H18C21.0376 0.5 23.5 2.96243 23.5 6V18C23.5 21.0376 21.0376 23.5 18 23.5H6C2.96243 23.5 0.5 21.0376 0.5 18V6C0.5 2.96243 2.96243 0.5 6 0.5Z",stroke:"white"}),s("path",{d:"M8 10V14",stroke:"white","stroke-width":"1.2"}),s("path",{d:"M16 10V14",stroke:"white","stroke-width":"1.2"}),s("path",{d:"M12 8V16",stroke:"white","stroke-width":"1.2"})]),s("div",{class:"text-white text-[20px] font-bold"},"预览")],-1)),s("div",Ae,[s("audio",{class:"w-full",ref_key:"audioRef",ref:E,src:t(m),controls:"",autoplay:""},null,8,Te)])])]),_:1},512)}}}),De=""+new URL("audio_bg.a2f033ba.png",import.meta.url).href,Be={class:"h-full flex flex-col bg-app-bg-2 rounded-[20px]"},Fe={class:"flex-shrink-0 px-[14px] border-[0] border-b-[1px] border-app-border-1"},je={class:"flex items-center justify-end h-[88px]"},Oe={class:"flex items-center gap-[14px]"},Ne=["infinite-scroll-disabled"],Ge={class:"h-full p-4"},He={key:0},Ke={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 xl:grid-cols-5 2xl:grid-cols-6 gap-4 cursor-pointer"},qe={class:"w-full px-3 absolute z-[22] top-2"},We={class:"line-clamp-1 text-white"},Ze={class:"absolute bottom-2 w-full text-center px-3 text-[#ffffff80] line-clamp-1 z-[22]"},Je=["src"],Xe=["src"],Ye={key:1,src:De,class:"w-full h-full object-cover"},Qe={class:"absolute top-[50%] left-[50%] -translate-x-[50%] -translate-y-[50%] z-[1000]"},et=["onClick"],tt={class:"absolute right-2 top-2 z-[1000] w-9 h-9 invisible group-hover:visible"},ot={key:0,class:"text-white text-center text-xs w-full py-4"},lt={key:1,class:"h-full flex items-center justify-center"},st=K({__name:"index",setup(W){const n=ae({name:"",page_no:1,page_size:20,m_type:"",field:"",order_by:""}),h=u(""),R=r=>{r==1?(n.order_by="desc",n.field="create_time"):r==2?(n.order_by="asc",n.field="create_time"):r==3?(n.order_by="asc",n.field="size"):(n.order_by="desc",n.field="size"),d()},{pager:m,getLists:E,resetPage:d}=Ie({fetchFun:$e,params:n,isScroll:!0}),S=()=>{n.page_no++,E()},V=u(),y=u(!1),g=async r=>{try{const{name:e,size:i,response:C,raw:{type:v}}=r,{uri:I}=C.data,D=v.includes("video"),$=v.includes("image"),B=v.includes("audio"),x={name:e.split(".")[0],size:i,type:de.XHS,sort:0,pic:"",m_type:$?p.IMAGE:B?p.MUSIC:p.VIDEO,content:I,duration:0};if(D)try{const{duration:M,file:F}=await ue(I),j=await me({file:F});x.duration=M,x.pic=j.uri}catch{}if(await Me(x),y.value)return;y.value=!0,V.value=setTimeout(()=>{d(),clearTimeout(V.value),y.value=!1},500)}catch(e){H.msgError(e)}},w=u(!1),b=u(),P=[{label:"重命名",icon:"local-icon-edit3",click:async r=>{w.value=!0,await O(),b.value.open(),b.value.setFormData(r)}},{label:"下载素材",icon:"local-icon-download",click:({content:r})=>{fe(r)}},{label:"删除素材",icon:"local-icon-delete",click:({id:r})=>{_e().$confirm({message:"确定删除该素材吗？",theme:"dark",onConfirm:async()=>{try{await Le({id:r});const e=m.lists.findIndex(i=>i.id==r);m.lists.splice(e,1)}catch(e){H.msgWarning(e)}}})}}],U=u(!1),A=u(!1),T=u(),z=u(),Z=async r=>{const{m_type:e,content:i}=r;e==p.VIDEO?(U.value=!0,await O(),T.value.open(),T.value.setUrl(i)):(A.value=!0,await O(),z.value.open(),z.value.setUrl(i))};return E(),(r,e)=>{const i=te,C=oe,v=ve,I=ye,D=q,$=be,B=we,x=xe,M=ke,F=Ee,j=Ve,J=Ce,X=ze,Y=he,Q=Pe;return a(),c(L,null,[s("div",Be,[s("div",Fe,[l(x,null,{default:f(()=>[s("div",je,[s("div",Oe,[l(C,{modelValue:t(n).m_type,"onUpdate:modelValue":e[0]||(e[0]=o=>t(n).m_type=o),class:"!w-[100px]","popper-class":"dark-select-popper",clearable:"","show-arrow":!1,"empty-values":[null,void 0],"value-on-clear":null,onChange:t(d)},{default:f(()=>[l(i,{label:"全部",value:""}),l(i,{label:"视频",value:t(p).VIDEO},null,8,["value"]),l(i,{label:"图片",value:t(p).IMAGE},null,8,["value"]),l(i,{label:"音频",value:t(p).MUSIC},null,8,["value"])]),_:1},8,["modelValue","onChange"]),l(C,{modelValue:t(h),"onUpdate:modelValue":e[1]||(e[1]=o=>ne(h)?h.value=o:null),class:"!w-[140px]","popper-class":"dark-select-popper",clearable:"","show-arrow":!1,"empty-values":[null,void 0],"value-on-clear":null,onChange:R},{default:f(()=>[l(i,{label:"全部",value:""}),l(i,{label:"最新开始排序",value:"1"}),l(i,{label:"最早开始排序",value:"2"}),l(i,{label:"文件从大到小",value:"3"}),l(i,{label:"文件从小到大",value:"4"})]),_:1},8,["modelValue"]),l(I,{modelValue:t(n).name,"onUpdate:modelValue":e[3]||(e[3]=o=>t(n).name=o),"prefix-icon":"el-icon-Search",class:"!w-[240px] search-name-input",placeholder:"请输入任务名称",clearable:"",onClear:e[4]||(e[4]=o=>t(d)()),onKeydown:e[5]||(e[5]=ie(o=>t(d)(),["enter"]))},{append:f(()=>[l(v,{text:"",onClick:e[2]||(e[2]=o=>t(d)())},{default:f(()=>[...e[11]||(e[11]=[re(" 搜索 ",-1)])]),_:1})]),_:1},8,["modelValue"]),l($,{type:"file",accept:"video/*,image/*,.mp3,.wav,.m4a","show-progress":"","show-file-list":!1,onChange:g},{default:f(()=>[l(v,{type:"primary",class:"!rounded-full !h-10 !px-4"},{default:f(()=>[l(D,{name:"local-icon-add_circle",color:"#ffffff"}),e[12]||(e[12]=s("span",{class:"ml-2"},"上传素材",-1))]),_:1})]),_:1}),l(B,{content:"刷新"},{default:f(()=>[l(v,{circle:"",color:"#1f1f1f",icon:"el-icon-Refresh",class:"!w-10 !h-10",onClick:e[6]||(e[6]=o=>t(d)())})]),_:1})])])]),_:1})]),N((a(),c("div",{class:"grow min-h-0 overflow-y-auto flex flex-col dynamic-scroller","infinite-scroll-immediate":!1,"infinite-scroll-disabled":!t(m).isLoad,"infinite-scroll-distance":10},[N((a(),c("div",Ge,[t(m).lists.length?(a(),c("div",He,[s("div",Ke,[(a(!0),c(L,null,ce(t(m).lists,(o,ee)=>(a(),c("div",{class:"material-item card-gradient group",key:ee},[s("div",qe,[s("div",We,G(o.name),1)]),s("div",Ze,G(o.create_time),1),t(p).IMAGE==o.m_type?(a(),k(M,{key:0,class:"w-full h-full",fit:"cover",lazy:"","preview-teleported":"",src:o.content,"preview-src-list":[o.content]},null,8,["src","preview-src-list"])):_("",!0),t(p).VIDEO==o.m_type||t(p).MUSIC==o.m_type?(a(),c(L,{key:1},[t(p).VIDEO==o.m_type?(a(),c(L,{key:0},[o.pic?(a(),c("img",{key:0,src:o.pic,class:"w-full h-full object-cover"},null,8,Je)):(a(),c("video",{key:1,src:o.content,class:"w-full h-full object-cover"},null,8,Xe))],64)):_("",!0),t(p).MUSIC==o.m_type?(a(),c("img",Ye)):_("",!0),s("div",Qe,[s("div",{class:"w-12 h-12",onClick:at=>Z(o)},[l(F)],8,et)])],64)):_("",!0),s("div",tt,[l(j,{theme:t(pe).DARK,data:o,"menu-list":P},null,8,["theme","data"])])]))),128))]),t(m).isLoad?_("",!0):(a(),c("div",ot,"暂无更多了~"))])):(a(),c("div",lt,[l($,{type:"file",accept:"video/*,image/*","show-progress":"","show-file-list":!1,onChange:g},{default:f(()=>[l(Re,{"btn-text":"上传素材",msg:"快去上传你的素材吧"})]),_:1})]))])),[[Y,t(m).loading]])],8,Ne)),[[Q,S]])]),t(U)?(a(),k(J,{key:0,ref_key:"previewVideoRef",ref:T,onClose:e[7]||(e[7]=o=>U.value=!1)},null,512)):_("",!0),t(A)?(a(),k(X,{key:1,ref_key:"previewAudioRef",ref:z,onClose:e[8]||(e[8]=o=>A.value=!1)},null,512)):_("",!0),t(w)?(a(),k(Se,{key:2,ref_key:"editPopupRef",ref:b,onClose:e[9]||(e[9]=o=>w.value=!1),onSuccess:e[10]||(e[10]=o=>t(d)())},null,512)):_("",!0)],64)}}});const Ot=ge(st,[["__scopeId","data-v-bf8d6543"]]);export{Ot as default};
