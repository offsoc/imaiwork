import{d as oe,bO as le,aG as ne,c as D,r as u,aF as ae,A as ie,cx as re,k as n,l as r,m as e,Z as l,I as b,s as m,v as F,L as T,q as d,bM as K,t as c,J as C,K as N,Y as de,aI as ce,aH as pe,G as x,cb as ue,ax as me,au as _e,y as fe,ba as xe,cW as ve,_ as ge}from"./entry.2beb4577.js";import{E as he}from"./el-slider.bc047fea.js";import{E as ye}from"./index.47b30189.js";import{E as be}from"./el-empty.bc763313.js";import"./el-input-number.7f732a46.js";/* empty css                     */import{u as ke}from"./usePaging.85211d66.js";import{m as we,n as Ee,o as Fe,p as Te,q as Ce,r as He}from"./knowledge_base.519704cc.js";import{KnTypeEnum as $}from"./index.5bd136e1.js";import{_ as Le}from"./setting-popup.vue.043c8876.js";import"./debounce.dd7f88c1.js";import"./toNumber.c824a4a2.js";import"./clamp.a46ea567.js";import"./index.ed72cac8.js";import"./index.vue.478e85a5.js";import"./index.4d719c96.js";import"./index.dcd97a19.js";import"./strings.a9740cf6.js";import"./_baseIteratee.70cb6d8d.js";import"./index.9d200730.js";import"./el-switch.be9dc874.js";/* empty css                  *//* empty css               */import"./lodash.bdfbd34d.js";import"./index.66741974.js";const Ve={class:"h-full bg-white rounded-[20px] px-[30px] flex flex-col"},Be={class:"grow min-h-0 mt-[30px] overflow-x-scroll dynamic-scroller pb-5"},Re={class:"flex gap-x-5 min-w-[800px] h-full"},Se={class:"h-full flex flex-col flex-1 gap-y-6"},Ie={class:"px-[14px] bg-[#F6F6F6] border border-[#E5E5E5] rounded-xl"},Pe={class:"flex items-center justify-between h-[50px] border-b border-[#0000000d]"},je={class:"py-[14px]"},qe={class:"flex justify-between items-center"},De={class:"text-[#00000080]"},Ke={key:0,class:"px-4"},Ne={class:"absolute -top-[33px] left-[90px]"},$e={class:"absolute top-0 right-0"},Oe={class:"grow min-h-0 flex flex-col"},ze={class:"grow min-h-0 mt-6 bg-[#F6F6F6] border border-[#E5E5E5] rounded-xl flex flex-col"},Ge={class:"grow min-h-0"},Je=["onClick"],Ae={class:"line-clamp-1"},Me={class:"flex-shrink-0"},Ue={key:1,class:"flex items-center justify-center h-full"},We={class:"flex-1 bg-[#F6F6F6] rounded-xl border border-[#E5E5E5] flex flex-col py-[15px]"},Qe={class:"px-[15px]"},Ye={class:"grow min-h-0 mt-[15px]"},Ze={class:"flex flex-col gap-y-3 px-[15px]"},Xe={class:"px-[14px] py-[12px]"},et={class:"line-clamp-4 text-[11px] leading-5 mt-[6px] break-all text-[#00000080]"},tt={class:"line-clamp-4 text-[11px] leading-5 mt-[6px] break-all text-[#00000080]"},st={class:"flex items-center gap-x-3 px-[13px] border-t border-[#0000000d] h-[50px]"},ot={class:"w-5 h-5 rounded bg-[#0000000d] flex items-center justify-center"},lt={class:"flex-1 line-clamp-1"},nt={key:1,class:"flex items-center justify-center h-full"},O=200,at=oe({__name:"index",setup(it){const H=le(),L=H.params.id,{kn_type:V,index_id:v}=ne(H.query),_=D(()=>V.value==$.RAG),z=D(()=>V.value==$.VECTOR),i=u(""),g=u(.5),k=u({}),B=ae({indexid:v==null?void 0:v.value,page_no:1}),{pager:h,getLists:R,resetPage:S}=ke({fetchFun:s=>_.value?we(s):Ee({kb_id:L,...s}),params:B,isScroll:!0}),y=u(!1),w=ie(),G=async()=>{y.value=!0,await pe(),w.value.open(),w.value.setFormData(k.value)},J=s=>{k.value=s,y.value=!1},p=u([]),f=u(!1),A=async()=>{if(i.value.length===0){x.msgWarning("请输入源文本");return}f.value=!0;try{if(_.value){const s=await Fe({prompt:i.value,indexid:v.value,rerank_min_score:g.value});p.value=s,S()}else{const s=await Te({kb_id:L,question:i.value,...k.value});p.value=s,S()}}catch(s){x.msgError(s)}finally{f.value=!1}},{isLock:M,lockFn:U}=re(A),I=u(null),W=async s=>{var t;if(((t=I.value)==null?void 0:t.id)!=s.id){I.value=s;try{if(f.value=!0,_.value){const a=await Ce({id:s.id,page_type:0});p.value=a.lists,i.value=s.prompt}if(z.value){const a=await He({tr_id:s.id});p.value=a,i.value=s.ask}}catch(a){x.msgError(a)}finally{f.value=!1}}},Q=s=>{s=="bottom"&&h.isLoad&&!h.loading&&(B.page_no++,R())},Y=s=>{if(_.value){const{metadata:t}=s,{file_path:a}=ue(t)?JSON.parse(t):{};a?window.open(a,"_blank"):x.msgError("文件路径不存在")}else{const{source_path:t}=s;t?window.open(t,"_blank"):x.msgError("文件路径不存在")}};return R(),(s,t)=>{const a=me,Z=_e,X=he,P=fe,ee=xe,j=ye,q=be,te=ve;return n(),r(C,null,[e("div",Ve,[t[11]||(t[11]=e("div",{class:"flex-shrink-0 mt-[30px]"},[e("div",null,"搜索测试"),e("div",{class:"text-[#00000080] mt-[6px]"},"根据给定的查询文本测试知识的搜索效果。")],-1)),e("div",Be,[e("div",Re,[e("div",Se,[e("div",Ie,[e("div",Pe,[t[4]||(t[4]=e("div",null,"源文本",-1)),l(_)?T("",!0):(n(),b(a,{key:0,color:"#F6F6F6",class:"!border-[#0000001a]",onClick:G},{default:m(()=>[...t[3]||(t[3]=[F("向量检索",-1)])]),_:1}))]),e("div",je,[e("div",null,[d(Z,{modelValue:l(i),"onUpdate:modelValue":t[0]||(t[0]=o=>K(i)?i.value=o:null),placeholder:"请输入文本，建议使用简短的陈述句",type:"textarea",resize:"none",maxlength:O,rows:6},null,8,["modelValue"])]),e("div",qe,[e("div",De,c(l(i).length)+" / "+c(O),1),d(a,{type:"primary",class:"w-[84px]",loading:l(M),onClick:l(U)},{default:m(()=>[...t[5]||(t[5]=[F("测试",-1)])]),_:1},8,["loading","onClick"])])])]),l(_)?(n(),r("div",Ke,[t[7]||(t[7]=e("div",null,"相似度阈值",-1)),d(X,{modelValue:l(g),"onUpdate:modelValue":t[1]||(t[1]=o=>K(g)?g.value=o:null),min:0,max:1,step:.01,size:"small","show-input":""},null,8,["modelValue"]),e("div",Ne,[d(ee,{"popper-class":"w-[200px]"},{content:m(()=>[...t[6]||(t[6]=[e("div",null," 设定最低分数标准，只有达到或超过这个阈值的检索结果才会被考虑用于后续的排序和生成过程 ",-1)])]),default:m(()=>[e("div",$e,[d(P,{name:"el-icon-QuestionFilled",color:"#858585"})])]),_:1})])])):T("",!0),e("div",Oe,[t[9]||(t[9]=e("div",{class:"font-bold"},"记录",-1)),e("div",ze,[t[8]||(t[8]=e("div",{class:"flex-shrink-0 h-[50px] border-b border-[#0000000d] flex justify-between items-center px-[14px]"},[e("span",null,"测试文本"),e("span",null,"时间")],-1)),e("div",Ge,[l(h).lists.length?(n(),b(j,{key:0,onEndReached:Q},{default:m(()=>[e("div",null,[(n(!0),r(C,null,N(l(h).lists,(o,E)=>(n(),r("div",{class:de(["flex justify-between items-center px-[14px] h-[50px] border-b border-[#0000000d] cursor-pointer active:bg-primary-light-9",{"bg-[rgba(255,255,255,0.3)]":E%2===0}]),key:o,onClick:se=>W(o)},[e("div",Ae,c(o.prompt||o.ask),1),e("div",Me,c(o.create_time),1)],10,Je))),128))])]),_:1})):(n(),r("div",Ue,[d(q,{description:"暂无历史数据"})]))])])])]),ce((n(),r("div",We,[e("div",Qe,c(l(p).length)+" 个段落搜索",1),e("div",Ye,[l(p).length?(n(),b(j,{key:0},{default:m(()=>[e("div",Ze,[(n(!0),r(C,null,N(l(p),(o,E)=>(n(),r("div",{class:"bg-white rounded-md border border-[#efefef]",key:E},[e("div",Xe,[e("div",et," 问："+c(o.content||o.question),1),e("div",tt," 答："+c(o.answer||"-"),1)]),e("div",st,[e("div",ot,[d(P,{name:"local-icon-upload2"})]),e("div",lt,c(o.source),1),d(a,{type:"primary",class:"w-[80px]",onClick:se=>Y(o)},{default:m(()=>[...t[10]||(t[10]=[F("打开",-1)])]),_:1},8,["onClick"])])]))),128))])]),_:1})):(n(),r("div",nt,[d(q,{description:"暂无召回结果"})]))])])),[[te,l(f)]])])])]),l(y)?(n(),b(Le,{key:0,ref_key:"settingPopupRef",ref:w,onClose:t[2]||(t[2]=o=>y.value=!1),onConfirm:J},null,512)):T("",!0)],64)}}});const St=ge(at,[["__scopeId","data-v-12bef6f0"]]);export{St as default};
