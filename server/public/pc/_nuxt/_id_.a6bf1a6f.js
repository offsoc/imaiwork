import{E as De,a as Ae}from"./el-breadcrumb.9ec5a045.js";import{E as Re}from"./el-card.3b33bf82.js";import{d as Be,bM as Se,a as $e,r as u,c as O,aF as Le,eh as P,o as Pe,k as a,l as d,m as s,q as l,s as r,v as C,t as g,Z as n,J as I,K,Y as G,L as y,$ as Ie,aI as Te,I as w,a0 as T,bK as Ve,G as i,ei as V,aH as Ne,y as je,aw as Fe,ax as Oe,au as Ke,cQ as Ge,u as Ue}from"./entry.d9d53b29.js";import{E as qe}from"./index.890e9d1e.js";import{E as Me}from"./el-avatar.24f27c8b.js";import{E as ze}from"./index.8a3302e5.js";import{E as Je}from"./el-empty.03c7f5cd.js";import{E as p,a as He}from"./index.9a037d22.js";import{_ as Qe}from"./index.vue.930f6062.js";/* empty css                   *//* empty css               *//* empty css                 *//* empty css                     */import{u as We}from"./useSocialPlatform.2a31f125.js";import{u as Ye}from"./useDeviceWs.76b101b1.js";import{u as Ze}from"./useAddDeviceAccount.324bcf02.js";import{u as Xe}from"./usePaging.64764a63.js";import{g as U,m as et,n as tt}from"./service.12abd78a.js";import{g as ot}from"./device.317521e4.js";import{_ as st}from"./device-add.vue.f7048474.js";import{_ as nt}from"./device-progress.vue.28e01ddd.js";import"./index.050c9b6b.js";import"./_baseIteratee.73cb21ab.js";import"./debounce.39f38609.js";import"./index.4538c991.js";import"./index.79f7263c.js";import"./strings.fbd015b4.js";import"./useWebSocket.0bb77166.js";import"./index.cce223cb.js";/* empty css                    */const lt={class:"h-full flex flex-col p-4"},rt={class:"h-[71px] px-5 flex items-center justify-between border-b border-b-[#E8E8E8]"},at={class:"flex items-center gap-2"},it={class:"min-w-[170px] flex items-center gap-2 cursor-pointer"},ct={class:"text-[#36393F] text-lg font-bold"},dt={class:"flex flex-col"},ut={class:"flex flex-col gap-y-1 p-2 max-h-[300px] overflow-y-auto"},pt=["onClick"],mt={class:"flex justify-center py-3"},ft={key:0,class:"bg-[#F2F3F8] text-xs py-1 px-2 rounded-lg"},_t={class:"grow min-h-0 flex w-full"},vt={class:"w-[178px] bg-white border-r border-r-[#E8E8E8] flex-shrink-0"},gt={class:"flex flex-col gap-y-4 p-4"},yt=["onClick"],ht=["src"],xt={class:"flex-1 overflow-auto flex flex-col mt-4"},Et={class:"flex justify-between items-center px-4"},bt={class:"grow min-h-0 mt-4 w-full"},kt={class:"flex items-center justify-center gap-x-2"},Ct={class:"flex flex-col gap-2"},wt=["onClick"],Dt={class:"flex items-center justify-center"},At=["onClick"],Rt=["onClick"],Bt={key:0,class:"flex items-center justify-center h-full"},St={key:1,class:"flex items-center justify-center h-full"},$t={class:"flex justify-end p-4"},co=Be({__name:"[id]",setup(Lt){const q=Se(),M=$e(),z=Ue(),{socialPlatformList:J,currentSocialPlatform:D}=We(),A=u([]),N=u(null),h=u(!1),R=u(!1),H=O(()=>A.value.find(t=>t.device_code===c.device_code)),Q=O(()=>J.filter(t=>t.show)),{onEvent:W,send:j}=Ye(),{showAddDevice:B,addDeviceLoading:Y,progressValue:Z,handleAddAccount:X,refreshAccount:ee,handleAddDeviceConfirm:te,handleRefreshAccount:oe}=Ze({send:j,onEvent:W,onSuccess:t=>{const{msg:e,type:f,data:b}=t;switch(e&&i.msgSuccess(e),f){case V.GET_USER_INFO:h.value=!1,m();break;case V.GET_BUSINESS_CARD:ne(b.content);break;default:R.value=!1,i.closeLoading();break}},onError:t=>{R.value=!0,i.closeLoading(),i.msgError(t.error)}}),k=u(!1),se=async()=>{if(!k.value)try{k.value=!0;const{lists:t}=await U({status:1,device_code:c.device_code});if(t.length==0){i.msgError("暂无在线账号");return}$(t[0])}catch(t){i.msgError(t)}finally{k.value=!1}},ne=async t=>{const{account:e,account_no:f}=E.value;try{await et({account:e,account_no:f||e,type:D.value,content:JSON.stringify(t),m_type:5,sort:0}),m(),i.msgSuccess("添加成功")}catch(b){i.msgError(b)}E.value=null,i.closeLoading()},le=u(null),re=async()=>{const{lists:t}=await ot({page_size:999});A.value=[{device_model:"全部",device_code:""},...t]},ae=async()=>{B.value=!0,await Ne(),N.value.open()},ie=t=>{D.value=t},ce=t=>{c.device_code=t,m()},c=Le({type:P.REDBOOK,name:"",account:"",device_code:""}),{pager:x,getLists:m,resetParams:de}=Xe({fetchFun:U,params:c}),ue=t=>{M.push({path:"/app/service",query:{type:P.REDBOOK}})},S=u(),E=u(null),F=()=>{h.value=!0,X({device_code:c.device_code,type:c.type})},$=t=>{h.value=!0,ee.value=[{id:t.id,account:t.account,type:t.type}],oe(t.device_code,P.REDBOOK)},pe=()=>{E.value?$(E.value):F()},me=async t=>{E.value=t,i.loading("获取名片中...",S.value),j({type:V.GET_BUSINESS_CARD,deviceId:t.device_code,appType:t.type})},fe=t=>{z.$confirm({message:"删除账号时，当前执行的任务将中断并无法继续，确定要删除该账号吗？",onConfirm:async()=>{i.loading("删除中...",S.value);try{await tt({id:t.id}),i.msgSuccess("删除成功"),m()}catch(e){i.msgError(e)}finally{i.closeLoading()}}})};return Pe(async()=>{c.device_code=q.query.device_code,m()}),re(),(t,e)=>{const f=De,b=Ae,_e=Re,_=je,ve=Fe,L=Oe,ge=qe,ye=Ke,he=Me,xe=ze,Ee=Je,be=He,ke=Qe,Ce=Ge;return a(),d(I,null,[s("div",lt,[l(_e,{class:"!border-none !rounded-xl",shadow:"never"},{default:r(()=>[l(b,null,{default:r(()=>[l(f,null,{default:r(()=>[s("span",{class:"cursor-pointer text-[#8A8C99] hover:text-primary",onClick:e[0]||(e[0]=o=>t.$router.back())}," 智能体 ")]),_:1}),l(f,null,{default:r(()=>e[7]||(e[7]=[C("账号设置",-1)])),_:1,__:[7]})]),_:1})]),_:1}),s("div",{class:"grow min-h-0 bg-white rounded-lg mt-4 flex flex-col overflow-hidden",ref_key:"containerRef",ref:S},[s("div",rt,[s("div",null,[s("div",at,[l(ge,{"show-arrow":!1,"popper-class":"!p-0 !min-w-[200px]  !border-none !rounded-lg !shadow-[0_0_10px_1px_rgba(0,0,0,0.1)]"},{reference:r(()=>{var o;return[s("div",it,[l(_,{name:"el-icon-ArrowDownBold"}),s("span",ct,g((o=n(H))==null?void 0:o.device_model),1)])]}),default:r(()=>[s("div",dt,[s("div",ut,[(a(!0),d(I,null,K(n(A),(o,v)=>(a(),d("div",{class:G(["break-all hover:bg-primary-light-9 rounded-lg p-2 cursor-pointer",{"bg-primary-light-9 text-primary":n(c).device_code===o.device_code}]),key:v,onClick:we=>ce(o.device_code)},g(o.device_model),11,pt))),128))]),l(ve,{class:"!m-0"}),s("div",mt,[l(L,{type:"primary",link:"",onClick:ae},{default:r(()=>[l(_,{name:"el-icon-Plus"}),e[8]||(e[8]=s("span",null,"添加设备",-1))]),_:1,__:[8]})])])]),_:1}),n(c).device_code?(a(),d("span",ft,"设备ID："+g(n(c).device_code),1)):y("",!0)])])]),s("div",_t,[s("div",vt,[s("div",gt,[(a(!0),d(I,null,K(n(Q),(o,v)=>(a(),d("div",{key:v,class:G(["flex items-center gap-x-3 px-4 hover:bg-primary-light-9 py-1.5 rounded-lg cursor-pointer",{"bg-primary-light-9":n(D)===o.type}]),onClick:we=>ie(o.type)},[s("img",{src:o.icon,class:"w-6 h-6"},null,8,ht),s("div",null,g(o.name),1)],10,yt))),128))])]),s("div",xt,[s("div",Et,[s("div",null,[l(L,{link:"",onClick:se,loading:n(k)},{default:r(()=>[l(_,{name:"el-icon-Refresh"}),e[9]||(e[9]=s("span",null,"刷新数据",-1))]),_:1,__:[9]},8,["loading"])]),l(ye,{modelValue:n(c).account,"onUpdate:modelValue":e[1]||(e[1]=o=>n(c).account=o),placeholder:"搜索账号信息",class:"!w-[200px]","prefix-icon":"el-icon-Search",clearable:"",onClear:e[2]||(e[2]=o=>n(de)()),onKeyup:e[3]||(e[3]=Ie(o=>n(m)(),["enter"]))},null,8,["modelValue"])]),s("div",bt,[Te((a(),w(be,{ref_key:"tableRef",ref:le,data:n(x).lists,height:"100%",stripe:"","row-style":{height:"60px",cursor:"pointer"},"header-cell-style":{height:"63px"},onRowClick:ue},{empty:r(()=>[n(c).device_code?(a(),d("div",Bt,[e[15]||(e[15]=C(" 还没有账号，",-1)),l(L,{type:"primary",link:"",onClick:F},{default:r(()=>e[14]||(e[14]=[C("点击获取设备账号信息",-1)])),_:1,__:[14]})])):(a(),d("div",St,[l(Ee,{description:"暂无账号信息"})]))]),default:r(()=>[l(n(p),{label:"头像",width:"80"},{default:r(({row:o})=>[l(he,{src:o.avatar},null,8,["src"])]),_:1}),l(n(p),{label:"账号/昵称",prop:"account","min-width":"180"},{default:r(({row:o})=>[s("div",kt,[s("div",null,[s("div",null,g(o.account),1),s("div",null,"("+g(o.nickname)+")",1)]),o.status==1?(a(),w(xe,{key:0,type:"success"},{default:r(()=>e[10]||(e[10]=[C("当前账号",-1)])),_:1,__:[10]})):y("",!0)])]),_:1}),l(n(p),{label:"名片数量",prop:"business_card","min-width":"100"}),l(n(p),{label:"粉丝数量",prop:"fans","min-width":"100"}),l(n(p),{label:"点赞数量",prop:"thumbup_collect","min-width":"100"}),l(n(p),{label:"关注数量",prop:"followers","min-width":"100"}),l(n(p),{label:"更新时间",prop:"create_time",width:"180"}),l(n(p),{label:"操作",width:"120px",fixed:"right"},{default:r(({row:o})=>[s("div",Ct,[o.status==1?(a(),d("div",{key:0,class:"px-2 py-1 hover:bg-primary-light-9 rounded-lg cursor-pointer flex items-center gap-2",onClick:T(v=>$(o),["stop"])},[s("span",Dt,[l(_,{name:"el-icon-Refresh"})]),e[11]||(e[11]=s("span",null,"刷新数据",-1))],8,wt)):y("",!0),o.account_type==1&&o.status==1?(a(),d("div",{key:1,class:"px-2 py-1 hover:bg-primary-light-9 rounded-lg cursor-pointer flex items-center gap-2",onClick:T(v=>me(o),["stop"])},[l(_,{name:"el-icon-Postcard"}),e[12]||(e[12]=s("span",null,"名片获取",-1))],8,At)):y("",!0),s("div",{class:"px-2 py-1 hover:bg-primary-light-9 rounded-lg cursor-pointer flex items-center gap-2",onClick:T(v=>fe(o),["stop"])},[l(_,{name:"el-icon-Delete"}),e[13]||(e[13]=s("span",null,"账号移除",-1))],8,Rt)])]),_:1})]),_:1},8,["data"])),[[Ce,n(x).loading]])]),s("div",$t,[l(ke,{modelValue:n(x),"onUpdate:modelValue":e[4]||(e[4]=o=>Ve(x)?x.value=o:null),onChange:n(m)},null,8,["modelValue","onChange"])])])])],512)]),n(B)?(a(),w(st,{key:0,ref_key:"addDeviceRef",ref:N,"bind-loading":n(Y),onClose:e[5]||(e[5]=o=>B.value=!1),onConfirm:n(te)},null,8,["bind-loading","onConfirm"])):y("",!0),n(h)?(a(),w(nt,{key:1,"progress-value":n(Z),"progress-error":n(R),onClose:e[6]||(e[6]=o=>h.value=!1),onRetry:pe},null,8,["progress-value","progress-error"])):y("",!0)],64)}}});export{co as default};
