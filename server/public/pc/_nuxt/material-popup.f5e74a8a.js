import{d as oe,r as v,aF as le,A as se,l as a,q as i,s as x,cO as ne,Z as s,I as b,L as d,J as M,k as l,m as n,$ as ae,v as R,bK as ie,aI as U,K as re,t as ce,a0 as de,G as j,y as ue,au as pe,ax as fe,b5 as me,cP as _e,aH as ve,_ as xe}from"./entry.d7219633.js";import{_ as ye}from"./index.vue.f38ca415.js";import{E as he,a as we}from"./el-tabs.f915a42a.js";import{E as be}from"./el-image.37ed17f2.js";import{_ as ge}from"./index.vue.38c569b2.js";import{E as Ee}from"./el-empty.77af023a.js";import{_ as ke}from"./index.vue.c82b4b26.js";import{E as Ce}from"./el-image-viewer.960ba8e6.js";import{u as Ie}from"./usePaging.3c53b51c.js";import{g as Ve,b as Te}from"./redbook.f03a8b74.js";import{MaterialTypeEnum as y}from"./index.83df7a87.js";import{E as $e}from"./index.15764a88.js";import"./strings.03d3529c.js";import"./index.35988ce8.js";import"./position.cb246d7d.js";import"./throttle.70466628.js";import"./debounce.085e8a4a.js";const Pe={class:"rounded-xl overflow-hidden flex flex-col -my-2"},Le={class:"flex items-center justify-between h-[50px] px-4"},Be={class:"flex items-center gap-x-2"},Me={class:"w-6 h-6 flex items-center justify-center rounded-md border border-[#ffffff1a]"},Re={class:"px-4 my-4"},Ue={class:"flex items-center rounded-full h-[50px] border border-[#2a2a2a] px-[5px]"},je={key:0,class:"px-4"},De=["infinite-scroll-disabled"],Ne={class:"h-full"},ze={key:0},Ae={class:"grid grid-cols-3 gap-2 p-2"},Ge=["onClick"],Ke={class:"card-gradient cursor-pointer bg-black w-full relative h-[210px] flex flex-col overflow-hidden rounded-xl"},Se={class:"w-full px-3 absolute z-[22] top-2 pr-[50px]"},Fe={class:"line-clamp-1 text-white"},Oe=["src"],qe={class:"absolute top-2 right-2 z-[1000] w-6 h-6 rounded-full"},He={key:2,class:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"},Je=["onClick"],We={key:0,class:"text-white text-center text-xs w-full py-4"},Ze={key:1,class:"h-full flex items-center justify-center"},Qe={key:1,class:"flex justify-center my-2 px-2"},Xe=oe({__name:"material-popup",props:{type:{default:y.IMAGE},limit:{default:9},multiple:{type:Boolean,default:!0},showTab:{type:Boolean,default:!0}},emits:["close","confirm"],setup(D,{expose:N,emit:z}){const u=D,k=z,r=v("material"),C=v(),p=le({name:"",page_no:1}),{pager:f,getLists:I,resetPage:V}=Ie({fetchFun:t=>r.value==="material"?Ve({...t,m_type:u.type}):Te({...t,status:6}),params:p,isScroll:!0}),A=t=>{r.value=t.paneName,c.value.length=0,V()},c=v([]),g=()=>{p.page_no=1,V()},T=t=>c.value.some(e=>e.id==t.id),G=t=>{if(T(t))c.value=c.value.filter(e=>e.id!==t.id);else{if(c.value.length>=u.limit){j.msgWarning(`最多只能选择${u.limit}个素材`);return}c.value.push(t)}u.multiple||$()},$=()=>{if(c.value.length===0){j.msgError("请选择素材");return}let t=[];r.value=="material"&&(t=c.value.map(e=>e.content)),r.value=="dh"&&(t=c.value.map(e=>e.automatic_clip==1?e.clip_result_url:e.video_result_url)),k("confirm",t),h()},m=se(),_=v(!1),P=v([]),K=async t=>{if(_.value=!0,u.type==y.IMAGE){P.value=[t.content];return}if(await ve(),r.value=="material"){const{content:e}=t;m.value.setUrl(e)}if(r.value=="dh"){const{automatic_clip:e,clip_result_url:w,video_result_url:E}=t;e==1?m.value.setUrl(w):m.value.setUrl(E)}m.value.open()},S=async()=>{p.page_no+=1,await I()},F=async()=>{C.value.open(),I()},h=()=>{k("close")};return N({open:F,close:h}),(t,e)=>{const w=ue,E=ye,O=pe,L=fe,B=he,q=we,H=me,J=be,W=ge,Z=Ee,Q=ke,X=Ce,Y=_e,ee=$e;return l(),a(M,null,[i(ne,{ref_key:"popupRef",ref:C,width:"528px",style:{padding:"0","background-color":"var(--app-bg-color-2)","box-shadow":"0px 0px 0px 1px var(--app-border-color-2)"},"cancel-button-text":"","confirm-button-text":"","show-close":!1,onClose:h},{default:x(()=>[n("div",Pe,[n("div",Le,[n("div",Be,[n("div",Me,[i(w,{name:"local-icon-windows",size:14})]),e[8]||(e[8]=n("div",{class:"text-[20px] text-white font-bold"},"素材库",-1))]),n("div",{class:"w-6 h-6",onClick:h},[i(E)])]),n("div",Re,[n("div",Ue,[i(O,{modelValue:s(p).name,"onUpdate:modelValue":e[0]||(e[0]=o=>s(p).name=o),class:"flex-1 search-input",clearable:"","prefix-icon":"el-icon-Search",placeholder:"请输入素材名称","input-style":"color: #ffffff",onClear:e[1]||(e[1]=o=>g()),onKeyup:e[2]||(e[2]=ae(o=>g(),["enter"]))},null,8,["modelValue"]),i(L,{type:"primary",class:"!text-white !rounded-full !w-[116px] !h-10",onClick:e[3]||(e[3]=o=>g())},{default:x(()=>e[9]||(e[9]=[R(" 搜索 ",-1)])),_:1,__:[9]})])]),t.showTab?(l(),a("div",je,[i(q,{modelValue:s(r),"onUpdate:modelValue":e[4]||(e[4]=o=>ie(r)?r.value=o:null),class:"!text-white",onTabClick:A},{default:x(()=>[i(B,{name:"material",label:"素材库"},null,8,["name"]),s(y).VIDEO==t.type?(l(),b(B,{key:0,name:"dh",label:"数字人视频"},null,8,["name"])):d("",!0)]),_:1},8,["modelValue"])])):d("",!0),U((l(),a("div",{class:"h-[600px] overflow-y-auto relative dynamic-scroller","infinite-scroll-immediate":!1,"infinite-scroll-disabled":!s(f).isLoad,"infinite-scroll-distance":10},[U((l(),a("div",Ne,[s(f).lists.length>0?(l(),a("div",ze,[n("div",Ae,[(l(!0),a(M,null,re(s(f).lists,o=>(l(),a("div",{key:o.id,onClick:te=>G(o)},[n("div",Ke,[n("div",Se,[i(H,{content:o.name},{default:x(()=>[n("div",Fe,ce(o.name),1)]),_:2},1032,["content"])]),t.type==s(y).IMAGE?(l(),b(J,{key:0,src:o.content,class:"w-full h-full rounded-xl","preview-teleported":"",fit:"cover"},null,8,["src"])):(l(),a("video",{key:1,src:o.content||o.video_result_url,class:"w-full h-full rounded-xl object-cover"},null,8,Oe)),n("div",qe,[i(w,{name:"local-icon-success_fill",size:20,color:T(o)?"var(--color-primary)":"#ffffff1a"},null,8,["color"])]),t.type==s(y).VIDEO?(l(),a("div",He,[n("div",{onClick:de(te=>K(o),["stop"])},[i(W)],8,Je)])):d("",!0)])],8,Ge))),128))]),s(f).isLoad?d("",!0):(l(),a("div",We,"暂无更多了~"))])):(l(),a("div",Ze,[i(Z,{description:"暂无数据"})]))])),[[Y,s(f).loading]])],8,De)),[[ee,S]]),t.multiple?(l(),a("div",Qe,[i(L,{type:"primary",class:"!rounded-full w-[318px] !h-[50px]",onClick:e[5]||(e[5]=o=>$())},{default:x(()=>e[10]||(e[10]=[R(" 确定 ",-1)])),_:1,__:[10]})])):d("",!0)])]),_:1},512),s(_)?(l(),b(Q,{key:0,ref_key:"previewVideoRef",ref:m,onClose:e[6]||(e[6]=o=>_.value=!1)},null,512)):d("",!0),s(_)?(l(),b(X,{key:1,"initial-index":0,"url-list":s(P),onClose:e[7]||(e[7]=o=>_.value=!1)},null,8,["url-list"])):d("",!0)],64)}}});const vt=xe(Xe,[["__scopeId","data-v-62418d8b"]]);export{vt as default};
