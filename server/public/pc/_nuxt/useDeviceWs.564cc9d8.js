import{z as l,aG as O,em as p,en as u,ea as s,cb as _,G as f}from"./entry.ee599c70.js";import{u as T}from"./useWebSocket.95c6cc65.js";const g="1.0.0";function w(C){const v=l(),{userInfo:I}=O(v),S=`wss://${location.host}/wss`,{on:t,send:m,isConnected:d,reconnect:N}=T(S,{...C}),r=(e,o)=>{const n=i.get(e);n&&n(o)},i=new Map,R=(e,o)=>{i.set(e,o)},E=e=>{if(!d.value){f.msgError(u[s.CONNECT_ERROR]);return}const{appType:o}=e;return m({type:e.type,content:{...e.content,userId:I.value.id,deviceId:e.deviceId||void 0,accountType:e.accountType},deviceId:e.deviceId||"",messageId:Date.now(),appVersion:g,appType:o})};return t("open",()=>{r("open"),E({type:p.BIND_WS,content:{type:p.BIND_WS,sourceType:"pc"}})}),t("close",()=>{r("close",{error:u[s.CONNECT_ERROR],code:s.CONNECT_ERROR})}),t("error",e=>{r("error",e)}),t("message",e=>{let{type:o,code:n,content:c,deviceId:a}=e;if(c=_(c)?JSON.parse(c):c,n==s.SUCCESS)switch(n){case s.SUCCESS:case s.INIT_COMPLETE:case s.CHECK_INIT:case s.DEVICE_ONLINE:r("success",{...e,content:c});break;default:r("error",{error:c.msg,code:s.PUSH_MESSAGE_ERROR,deviceCode:a});break}else r("error",{error:c.msg,type:o,code:n,deviceCode:a})}),{on:t,send:E,reconnect:N,isConnected:d,onEvent:R}}export{w as u};
