import{d as ne,r as v,aF as ae,A as ie,c as re,l as n,q as r,s as h,cV as ce,Z as s,I as y,L as c,J as T,k as o,m as a,$ as de,v as U,bM as ue,aI as A,K as pe,t as fe,a0 as me,G as D,y as _e,au as ve,ax as he,ba as ye,cW as xe,aH as ge,_ as be}from"./entry.2beb4577.js";import{_ as we}from"./index.vue.478e85a5.js";import{E as Ee,a as ke}from"./el-tabs.8b676a95.js";import{E as Ve}from"./el-image.a83bf837.js";import{_ as Ie}from"./index.vue.4c207597.js";import{E as Ce}from"./el-empty.bc763313.js";import{_ as Te}from"./index.vue.8d512c7f.js";import{E as De}from"./el-image-viewer.d11cc27b.js";import{u as Le}from"./usePaging.85211d66.js";import{g as Me,b as Pe}from"./redbook.418b34fe.js";import{k as $e}from"./digital_human.b276942f.js";import{MaterialTypeEnum as d}from"./index.db2ee73f.js";import{E as Be}from"./index.abba0b88.js";import"./raf.c0777355.js";import"./strings.a9740cf6.js";import"./clamp.a46ea567.js";import"./toNumber.c824a4a2.js";import"./index.772967a0.js";import"./throttle.403d4771.js";import"./debounce.dd7f88c1.js";const je={class:"rounded-xl overflow-hidden flex flex-col -my-2"},Oe={class:"flex items-center justify-between h-[50px] px-4"},Re={class:"flex items-center gap-x-2"},Ue={class:"w-6 h-6 flex items-center justify-center rounded-md border border-[#ffffff1a]"},Ae={class:"px-4 my-4"},Ge={class:"flex items-center rounded-full h-[50px] border border-[#2a2a2a] px-[5px]"},Ne={key:0,class:"px-4"},Se=["infinite-scroll-disabled"],ze={class:"h-full"},Fe={key:0},Ke={class:"grid grid-cols-3 gap-2 p-2"},qe=["onClick"],He={class:"card-gradient cursor-pointer bg-black w-full relative h-[210px] flex flex-col overflow-hidden rounded-xl"},We={class:"w-full px-3 absolute z-[22] top-2 pr-[50px]"},Je={class:"line-clamp-1 text-white break-all"},Ze=["src"],Qe=["src"],Xe={class:"absolute top-2 right-2 z-[1000] w-6 h-6 rounded-full"},Ye={key:2,class:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"},et=["onClick"],tt={key:0,class:"text-white text-center text-xs w-full py-4"},ot={key:1,class:"h-full flex items-center justify-center"},lt={key:1,class:"flex justify-center my-2 px-2"},st=ne({__name:"material-popup",props:{type:{default:d.IMAGE},limit:{default:9},multiple:{type:Boolean,default:!0},showTab:{type:Boolean,default:!0}},emits:["close","confirm"],setup(k,{expose:G,emit:N}){const i=k,L=N,M=v(),p=v("material"),_=ae({name:"",page_no:1}),u=v([]),x=ie(),m=v(!1),P=v([]),$=re(()=>!f.isLoad||f.loading),S={material:t=>Me({...t,m_type:i.type}),dh:t=>Pe({...t,status:6}),dh_v2:t=>$e({...t,type:0,status:1})},{pager:f,getLists:B,resetPage:z}=Le({fetchFun:t=>S[p.value](t),params:_,isScroll:!0}),F=t=>{p.value=t.paneName,u.value=[],g()},g=()=>{_.page_no=1,z()},j=t=>u.value.some(e=>e.id==t.id),K=t=>{if(j(t))u.value=u.value.filter(e=>e.id!==t.id);else{if(u.value.length>=i.limit){D.msgWarning(`最多只能选择${i.limit}个素材`);return}u.value.push(t)}i.multiple||R()},O=t=>{const{automatic_clip:e,clip_result_url:w,result_url:V,video_result_url:I,content:E}=t;return p.value==="material"?E||"":e===1?w||"":p.value==="dh_v2"?V||"":I||""},R=()=>{if(u.value.length===0){D.msgError("请选择素材");return}const t=u.value.map(e=>({url:i.type===d.VIDEO?O(e):e.content,name:e.name,pic:e.pic}));L("confirm",t),b()},q=async t=>{if(m.value=!0,i.type===d.IMAGE){P.value=[t.content];return}if(i.type===d.VIDEO){await ge();const e=O(t);e&&x.value?(x.value.setUrl(e),x.value.open()):(D.msgError("视频地址无效，无法预览"),m.value=!1)}},H=async()=>{$.value||(_.page_no+=1,await B())},W=async()=>{var t;(t=M.value)==null||t.open(),f.lists.length===0&&B()},b=()=>{L("close")};return G({open:W,close:b}),(t,e)=>{const w=_e,V=we,I=ve,E=he,C=Ee,J=ke,Z=ye,Q=Ve,X=Ie,Y=Ce,ee=Te,te=De,oe=xe,le=Be;return o(),n(T,null,[r(ce,{ref_key:"popupRef",ref:M,width:"528px",style:{padding:"0","background-color":"var(--app-bg-color-2)","box-shadow":"0px 0px 0px 1px var(--app-border-color-2)"},"cancel-button-text":"","confirm-button-text":"","show-close":!1,onClose:b},{default:h(()=>[a("div",je,[a("div",Oe,[a("div",Re,[a("div",Ue,[r(w,{name:"local-icon-windows",size:14})]),e[4]||(e[4]=a("div",{class:"text-[20px] text-white font-bold"},"素材库",-1))]),a("div",{class:"w-6 h-6 cursor-pointer",onClick:b},[r(V)])]),a("div",Ae,[a("div",Ge,[r(I,{modelValue:s(_).name,"onUpdate:modelValue":e[0]||(e[0]=l=>s(_).name=l),class:"flex-1 search-input",clearable:"","prefix-icon":"el-icon-Search",placeholder:"请输入素材名称","input-style":"color: #ffffff",onClear:g,onKeyup:de(g,["enter"])},null,8,["modelValue"]),r(E,{type:"primary",class:"!text-white !rounded-full !w-[116px] !h-10",onClick:g},{default:h(()=>[...e[5]||(e[5]=[U(" 搜索 ",-1)])]),_:1})])]),k.showTab?(o(),n("div",Ne,[r(J,{modelValue:s(p),"onUpdate:modelValue":e[1]||(e[1]=l=>ue(p)?p.value=l:null),class:"!text-white",onTabClick:F},{default:h(()=>[r(C,{name:"material",label:"素材库"},null,8,["name"]),i.type===s(d).VIDEO?(o(),y(C,{key:0,name:"dh",label:"数字人v1"},null,8,["name"])):c("",!0),i.type===s(d).VIDEO?(o(),y(C,{key:1,name:"dh_v2",label:"数字人v2"},null,8,["name"])):c("",!0)]),_:1},8,["modelValue"])])):c("",!0),A((o(),n("div",{class:"h-[600px] overflow-y-auto relative dynamic-scroller","infinite-scroll-immediate":!1,"infinite-scroll-disabled":s($),"infinite-scroll-distance":10},[A((o(),n("div",ze,[s(f).lists.length>0?(o(),n("div",Fe,[a("div",Ke,[(o(!0),n(T,null,pe(s(f).lists,l=>(o(),n("div",{key:l.id,onClick:se=>K(l)},[a("div",He,[a("div",We,[r(Z,{content:l.name},{default:h(()=>[a("div",Je,fe(l.name),1)]),_:2},1032,["content"])]),i.type===s(d).IMAGE?(o(),y(Q,{key:0,src:l.content,class:"w-full h-full rounded-xl","preview-teleported":"",fit:"cover"},null,8,["src"])):c("",!0),i.type===s(d).VIDEO?(o(),n(T,{key:1},[l.pic?(o(),n("img",{key:0,src:l.pic,class:"w-full h-full rounded-xl object-cover"},null,8,Ze)):(o(),n("video",{key:1,src:l.content||l.video_result_url,class:"w-full h-full rounded-xl object-cover"},null,8,Qe))],64)):c("",!0),a("div",Xe,[r(w,{name:"local-icon-success_fill",size:20,color:j(l)?"var(--color-primary)":"#ffffff1a"},null,8,["color"])]),i.type===s(d).VIDEO?(o(),n("div",Ye,[a("div",{onClick:me(se=>q(l),["stop"])},[r(X)],8,et)])):c("",!0)])],8,qe))),128))]),s(f).isLoad?c("",!0):(o(),n("div",tt,"暂无更多了~"))])):(o(),n("div",ot,[r(Y,{description:"暂无数据"})]))])),[[oe,s(f).loading]])],8,Se)),[[le,H]]),k.multiple?(o(),n("div",lt,[r(E,{type:"primary",class:"!rounded-full w-[318px] !h-[50px]",onClick:R},{default:h(()=>[...e[6]||(e[6]=[U(" 确定 ",-1)])]),_:1})])):c("",!0)])]),_:1},512),s(m)?(o(),y(ee,{key:0,ref_key:"previewVideoRef",ref:x,onClose:e[2]||(e[2]=l=>m.value=!1)},null,512)):c("",!0),s(m)&&i.type===s(d).IMAGE?(o(),y(te,{key:1,"initial-index":0,"url-list":s(P),onClose:e[3]||(e[3]=l=>m.value=!1)},null,8,["url-list"])):c("",!0)],64)}}});const Vt=be(st,[["__scopeId","data-v-0fb5a8d0"]]);export{Vt as default};
