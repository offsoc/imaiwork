import{E as Le}from"./el-avatar.df0828d8.js";import{_ as Te}from"./index.vue.cb61de56.js";import{ef as je,eg as $e,aj as Se,eh as Me,ei as Be,r as de,D as Q,A as ee,c as ue,ej as I,Z as $,d as Fe,aF as Ve,k as m,l as h,I as ie,s as b,q as _,m as a,eb as De,t as F,L as E,Y,J as O,K as q,v as re,aI as Oe,u as We,G as He,ax as Ae,y as Re,ba as Ne,au as ze,aw as Pe,aH as Ue,_ as Ye}from"./entry.f4f46cb5.js";import{E as qe}from"./index.25e18e1c.js";import{E as Ge}from"./el-empty.28f9091a.js";/* empty css                   */import{s as Je,a as Xe}from"./vue-virtual-scroller.esm.9a67c6dc.js";/* empty css                             */import{s as Ke}from"./dom.7f5b5a10.js";import{_ as Ze}from"./emoji.vue.d23f13fc.js";import Qe from"./useHandle.560e2f4a.js";import{HandleEventEnum as N}from"./index.cf59f1a8.js";import"./index.bad4fd13.js";/* empty css                     */import"./person_wechat.703f63bb.js";function fe(e){return je()?($e(e),!0):!1}const pe=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const et=Object.prototype.toString,tt=e=>et.call(e)==="[object Object]",V=()=>{},Z=nt();function nt(){var e,t;return pe&&((e=window==null?void 0:window.navigator)==null?void 0:e.userAgent)&&(/iP(?:ad|hone|od)/.test(window.navigator.userAgent)||((t=window==null?void 0:window.navigator)==null?void 0:t.maxTouchPoints)>2&&/iPad|Macintosh/.test(window==null?void 0:window.navigator.userAgent))}function ot(...e){if(e.length!==1)return Se(...e);const t=e[0];return typeof t=="function"?Me(Be(()=>({get:t,set:V}))):de(t)}function G(e){return Array.isArray(e)?e:[e]}function st(e,t,r){return Q(e,t,{...r,immediate:!0})}const me=pe?window:void 0;function A(e){var t;const r=I(e);return(t=r==null?void 0:r.$el)!=null?t:r}function z(...e){const t=[],r=()=>{t.forEach(l=>l()),t.length=0},u=(l,d,v,x)=>(l.addEventListener(d,v,x),()=>l.removeEventListener(d,v,x)),g=ue(()=>{const l=G(I(e[0])).filter(d=>d!=null);return l.every(d=>typeof d!="string")?l:void 0}),C=st(()=>{var l,d;return[(d=(l=g.value)==null?void 0:l.map(v=>A(v)))!=null?d:[me].filter(v=>v!=null),G(I(g.value?e[1]:e[0])),G($(g.value?e[2]:e[1])),I(g.value?e[3]:e[2])]},([l,d,v,x])=>{if(r(),!(l!=null&&l.length)||!(d!=null&&d.length)||!(v!=null&&v.length))return;const c=tt(x)?{...x}:x;t.push(...l.flatMap(S=>d.flatMap(M=>v.map(W=>u(S,M,W,c)))))},{flush:"post"}),T=()=>{C(),r()};return fe(r),T}let ce=!1;function ae(e,t,r={}){const{window:u=me,ignore:g=[],capture:C=!0,detectIframe:T=!1,controls:l=!1}=r;if(!u)return l?{stop:V,cancel:V,trigger:V}:V;if(Z&&!ce){ce=!0;const i={passive:!0};Array.from(u.document.body.children).forEach(f=>f.addEventListener("click",V,i)),u.document.documentElement.addEventListener("click",V,i)}let d=!0;const v=i=>I(g).some(f=>{if(typeof f=="string")return Array.from(u.document.querySelectorAll(f)).some(k=>k===i.target||i.composedPath().includes(k));{const k=A(f);return k&&(i.target===k||i.composedPath().includes(k))}});function x(i){const f=I(i);return f&&f.$.subTree.shapeFlag===16}function c(i,f){const k=I(i),j=k.$.subTree&&k.$.subTree.children;return j==null||!Array.isArray(j)?!1:j.some(H=>H.el===f.target||f.composedPath().includes(H.el))}const S=i=>{const f=A(e);if(i.target!=null&&!(!(f instanceof Element)&&x(e)&&c(e,i))&&!(!f||f===i.target||i.composedPath().includes(f))){if("detail"in i&&i.detail===0&&(d=!v(i)),!d){d=!0;return}t(i)}};let M=!1;const W=[z(u,"click",i=>{M||(M=!0,setTimeout(()=>{M=!1},0),S(i))},{passive:!0,capture:C}),z(u,"pointerdown",i=>{const f=A(e);d=!v(i)&&!!(f&&!i.composedPath().includes(f))},{passive:!0}),T&&z(u,"blur",i=>{setTimeout(()=>{var f;const k=A(e);((f=u.document.activeElement)==null?void 0:f.tagName)==="IFRAME"&&!(k!=null&&k.contains(u.document.activeElement))&&t(i)},0)},{passive:!0})].filter(Boolean),R=()=>W.forEach(i=>i());return l?{stop:R,cancel:()=>{d=!1},trigger:i=>{d=!0,S(i),d=!1}}:R}const J=new WeakMap,lt={mounted(e,t){const r=!t.modifiers.bubble;let u;if(typeof t.value=="function")u=ae(e,t.value,{capture:r});else{const[g,C]=t.value;u=ae(e,g,Object.assign({capture:r},C))}J.set(e,u)},unmounted(e){const t=J.get(e);t&&typeof t=="function"?t():t==null||t.stop(),J.delete(e)}};function X(e){return typeof Window<"u"&&e instanceof Window?e.document.documentElement:typeof Document<"u"&&e instanceof Document?e.documentElement:e}function ve(e){const t=window.getComputedStyle(e);if(t.overflowX==="scroll"||t.overflowY==="scroll"||t.overflowX==="auto"&&e.clientWidth<e.scrollWidth||t.overflowY==="auto"&&e.clientHeight<e.scrollHeight)return!0;{const r=e.parentNode;return!r||r.tagName==="BODY"?!1:ve(r)}}function it(e){const t=e||window.event,r=t.target;return ve(r)?!1:t.touches.length>1?!0:(t.preventDefault&&t.preventDefault(),!1)}const K=new WeakMap;function rt(e,t=!1){const r=ee(t);let u=null,g="";Q(ot(e),l=>{const d=X(I(l));if(d){const v=d;if(K.get(v)||K.set(v,v.style.overflow),v.style.overflow!=="hidden"&&(g=v.style.overflow),v.style.overflow==="hidden")return r.value=!0;if(r.value)return v.style.overflow="hidden"}},{immediate:!0});const C=()=>{const l=X(I(e));!l||r.value||(Z&&(u=z(l,"touchmove",d=>{it(d)},{passive:!1})),l.style.overflow="hidden",r.value=!0)},T=()=>{const l=X(I(e));!l||!r.value||(Z&&(u==null||u()),l.style.overflow=g,K.delete(l),r.value=!1)};return fe(T),ue({get(){return r.value},set(l){l?C():T()}})}function ct(){let e=!1;const t=ee(!1);return(r,u)=>{if(t.value=u.value,e)return;e=!0;const g=rt(r,u.value);Q(t,C=>g.value=C)}}ct();const at={class:"h-full"},dt={class:"px-6 flex gap-x-4"},ut={class:"flex-1"},ft={class:"text-[#586B93] text-lg"},pt={class:"mt-2 flex flex-col gap-y-2"},mt={key:0},vt=["innerHTML"],ht=["onClick"],_t=["src"],gt={key:2,class:"w-fit h-full relative"},yt=["src"],kt=["onClick"],xt=["onClick"],Ct=["onClick"],wt={key:0,class:"flex-shrink-0"},bt=["src"],Et={class:"line-clamp-2"},It=["innerHTML"],Lt={class:"flex items-center justify-between my-[10px]"},Tt={class:"flex items-center gap-x-2"},jt={class:"text-[#9E9E9E] text-xs"},$t=["onClick"],St={class:"flex"},Mt={class:"flex items-center justify-center gap-x-1 bg-[#F7F7F7] rounded h-6 w-9 cursor-pointer"},Bt={class:"bg-[#F7F7F7] rounded"},Ft={key:0,class:"flex items-center gap-2 py-2 px-3 border-b border-gray-200"},Vt={class:"flex-1"},Dt={class:"text-[#586B93]"},Ot={key:1,class:"flex flex-col"},Wt=["onClick"],Ht={key:0},At={class:"text-[#586B93]"},Rt={class:"text-[#586B93]"},Nt=["innerHTML"],zt={key:1,class:"break-all"},Pt={class:"text-[#586B93]"},Ut=["innerHTML"],Yt={key:2,class:"relative py-2 px-3"},qt={class:"absolute bottom-3 right-6 flex items-center gap-x-2"},Gt={class:"rounded-lg hover:bg-token-sidebar-surface-secondary p-2 cursor-pointer"},Jt={key:1,class:"flex justify-center items-center h-full"},Xt=Fe({__name:"circle-lists",props:{circleList:{default:()=>[]}},emits:["bottom","previewVideo"],setup(e,{expose:t,emit:r}){const u=r,{triggerHandleEvent:g,previewImage:C,previewVideo:T,currentWechat:l,emojis:d}=Qe(),v=de(null),x=ee(),c=Ve({activeIndex:-1,replyToIndex:-1,content:{},type:"comment",placeholder:"发表评论",showEmoji:!1}),S=s=>!!(s&&s.Url),M=s=>!!s&&s.MediaId,W=s=>{s.Url&&window.open(s.Url,"_blank")},R=s=>{const o=s.target;o.scrollHeight-o.clientHeight-o.scrollTop<1&&u("bottom")},i=s=>{g("action",{type:N.Like,data:{...s,isLike:f(s)}})},f=s=>s.Likes.some(o=>{var y;return o.FriendId==((y=l.value)==null?void 0:y.wechat_id)}),k=s=>{g("action",{type:N.DeleteCircle,data:s})},j=()=>{c.showEmoji||(c.activeIndex=-1,c.replyToIndex=-1)},H=async()=>{var s;await Ue(),(s=x.value)==null||s.focus()},he=(s,o)=>{if(c.activeIndex===o&&c.type==="comment"){j();return}c.type="comment",c.placeholder="发表评论",c.activeIndex=o,c.replyToIndex=-1,H()},_e=(s,o,y)=>{var L;const w=s.Comments[y];if(w.FromWeChatId==((L=l.value)==null?void 0:L.wechat_id)){We().$confirm({message:"确定删除这条评论吗？",onConfirm:()=>{g("action",{type:N.DeleteComment,data:{...s,deleteComment:w}})}});return}if(c.activeIndex===o&&c.type==="reply"&&c.replyToIndex===y){j();return}c.type="reply",c.placeholder=`回复${w.FromName}:`,c.activeIndex=o,c.replyToIndex=y,H()},ge=(s,o)=>{const y=c.content[o];if(!y||!y.trim()){He.msgWarning("请输入内容");return}const w={...s,msg:y};c.type==="reply"&&(w.reply=s.Comments[c.replyToIndex]),g("action",{type:N.SendComment,data:w}),c.content[o]="",j()},ye=({emoji:s})=>{var o;if((o=x.value)!=null&&o.textarea){const y=Ke(x.value.textarea,s);c.content[c.activeIndex]=y}},P=s=>{const o=/\[(.*?)\]/g;return s.replace(o,y=>{const w=d.find(L=>L.name===y);return w?`<img src="${w.src}" class="w-[18px] h-[18px] inline-block mx-1 align-text-bottom" />`:y})},ke=s=>{const o=JSON.parse(s);return o.liveId?`
    <div class="">
        <div>
            <img src="${o.cover}" class="max-h-[300px] object-contain cursor-pointer" />
        </div>
        <div class="text-[#586B93] mt-1">公众号·${o.nickname}</div>
    </div>`:`
    <div class="">
        <div>
            <img src="${o.mediaList[0].thumb}" class="max-h-[300px] object-contain cursor-pointer" />
        </div>
        <div class="text-[#586B93] mt-1">视频号·${o.nickname}</div>
    </div>`};return t({}),(s,o)=>{const y=Le,w=Te,L=Ae,D=Re,te=Ne,xe=ze,Ce=qe,we=Pe,be=Ge;return m(),h("div",at,[e.circleList.length>0?(m(),ie($(Xe),{key:0,class:"dynamic-scroller h-full py-9",ref_key:"circleScrollbarRef",ref:v,items:e.circleList,"min-item-size":100,"key-field":"CircleId",onScroll:R},{default:b(({item:n,index:B,active:Ee})=>[_($(Je),{item:n,active:Ee,"size-dependencies":[n.Content.Text,n.Content.Images,n.Content.Video,n.Content.Link,n.Content.Ext,n.Likes,n.Comments],"data-index":B},{default:b(()=>{var ne,oe,se,le;return[a("div",dt,[a("div",null,[_(y,{shape:"square",size:42,icon:$(De)},null,8,["icon"])]),a("div",ut,[a("div",ft,F(n.WeChatId),1),a("div",pt,[n.Content.Text?(m(),h("div",mt,[a("span",{innerHTML:P(n.Content.Text)},null,8,vt)])):E("",!0),(ne=n.Content.Images)!=null&&ne.length&&!S(n.Content.Link)?(m(),h("div",{key:1,class:Y([n.Content.Images.length>1?"grid grid-cols-3 gap-1":" max-w-[50%]"])},[(m(!0),h(O,null,q(n.Content.Images,(p,U)=>(m(),h("div",{key:p.mediaId,class:Y(["leading-[0] cursor-pointer",[n.Content.Images.length>1?"h-[150px] w-full":""]]),onClick:Ie=>$(C)({...n,imageIdx:U})},[a("img",{src:p.ThumbImg,class:Y(["h-full w-auto max-h-[300px]",[n.Content.Images.length==1?"w-auto object-contain":"w-full object-cover"]])},null,10,_t)],10,ht))),128))],2)):E("",!0),M(n.Content.Video)?(m(),h("div",gt,[n.Content.Video.Url?(m(),h(O,{key:0},[n.Content.Video.Url?(m(),h("video",{key:0,class:"max-h-[400px]",src:n.Content.Video.Url},null,8,yt)):E("",!0),a("div",{class:"absolute top-[50%] left-[50%] translate-x-[-50%] translate-y-[-50%]",onClick:p=>u("previewVideo",n.Content.Video.Url)},[_(w)],8,kt)],64)):(m(),h("div",{key:1,class:"w-[200px] h-[200px] bg-gray-200 flex justify-center items-center cursor-pointer",onClick:p=>$(T)({data:n})},[_(L,null,{default:b(()=>[...o[2]||(o[2]=[re("点击获取视频",-1)])]),_:1})],8,xt))])):E("",!0),S(n.Content.Link)?(m(),h("div",{key:3,class:"flex items-center gap-x-2 p-2 bg-[#F7F7F7] cursor-pointer",onClick:p=>W(n.Content.Link)},[(oe=n.Content.Images)!=null&&oe.length?(m(),h("div",wt,[a("img",{class:"w-12 h-12 object-cover",src:n.Content.Images[0].ThumbImg},null,8,bt)])):E("",!0),a("div",Et,F(n.Content.Link.Description),1)],8,Ct)):E("",!0),n.Content.Ext?(m(),h("div",{key:4,innerHTML:ke(n.Content.Ext)},null,8,It)):E("",!0)]),a("div",Lt,[a("div",Tt,[a("div",jt,F(n.publishTime),1),n.WeChatId==$(l).wechat_id?(m(),ie(te,{key:0,placement:"right",content:"删除"},{default:b(()=>[a("div",{class:"leading-[0] cursor-pointer",onClick:p=>k(n)},[_(D,{name:"el-icon-Delete"})],8,$t)]),_:2},1024)):E("",!0)]),_(te,{trigger:"click",placement:"left","show-arrow":!1},{content:b(()=>[a("div",St,[_(L,{link:"",class:"!p-0",onClick:p=>i(n)},{default:b(()=>[f(n)?(m(),h(O,{key:0},[_(D,{name:"local-icon-heart_fill",color:"#F82B2B",size:18}),o[3]||(o[3]=a("span",{class:"text-white ml-2"},"取消",-1))],64)):(m(),h(O,{key:1},[_(D,{name:"local-icon-heart",color:"#ffffff",size:18}),o[4]||(o[4]=a("span",{class:"text-white ml-2"},"点赞",-1))],64))]),_:2},1032,["onClick"]),_(L,{link:"",class:"!p-0",onClick:p=>he(n,B)},{default:b(()=>[_(D,{name:"local-icon-comment",color:"#ffffff",size:18}),o[5]||(o[5]=a("span",{class:"text-white ml-2"},"评论",-1))]),_:1},8,["onClick"])])]),default:b(()=>[a("div",Mt,[(m(),h(O,null,q(2,p=>a("div",{class:"w-1 h-1 rounded-full bg-[#576B95]",key:p})),64))])]),_:2},1024)]),a("div",Bt,[(se=n.Likes)!=null&&se.length?(m(),h("div",Ft,[_(D,{name:"local-icon-heart",color:"#586B93"}),a("div",Vt,[a("span",Dt,F(n.Likes.map(p=>p.NickName).join("，")),1)])])):E("",!0),(le=n.Comments)!=null&&le.length?(m(),h("div",Ot,[(m(!0),h(O,null,q(n.Comments,(p,U)=>(m(),h("div",{key:p.CommentId,class:"cursor-pointer hover:bg-[#e5e5e5] px-3 min-h-8 flex items-center",onClick:Ie=>_e(n,B,U)},[p.ToWeChatId?(m(),h("div",Ht,[a("span",At,F(p.FromName),1),o[6]||(o[6]=a("span",{class:"mx-1"},"回复",-1)),a("span",Rt,F(p.ToWeChatId)+"：",1),a("span",{innerHTML:P(p.Content)},null,8,Nt)])):(m(),h("div",zt,[a("span",Pt,F(p.FromName)+":",1),a("span",{innerHTML:P(p.Content)},null,8,Ut)]))],8,Wt))),128))])):E("",!0),c.activeIndex===B?Oe((m(),h("div",Yt,[_(xe,{ref_key:"commentContentRef",ref:x,modelValue:c.content[B],"onUpdate:modelValue":p=>c.content[B]=p,type:"textarea",resize:"none",autosize:{minRows:3,maxRows:7},placeholder:c.placeholder},null,8,["modelValue","onUpdate:modelValue","placeholder"]),a("div",qt,[_(Ce,{placement:"bottom",width:"466",trigger:"click","show-arrow":!1,"popper-style":{padding:0},onShow:o[0]||(o[0]=p=>c.showEmoji=!0),onHide:o[1]||(o[1]=p=>c.showEmoji=!1)},{reference:b(()=>[a("div",Gt,[_(D,{name:"local-icon-phiz",size:24})])]),default:b(()=>[a("div",null,[_(Ze,{onChooseEmoji:ye})])]),_:1}),_(L,{color:"#24C168",class:"!text-white",onClick:p=>ge(n,B)},{default:b(()=>[...o[7]||(o[7]=[re("发送",-1)])]),_:1},8,["onClick"])])])),[[$(lt),[j,{ignore:[".el-loading-mask"]}]]]):E("",!0)]),_(we,{class:"!my-4"})])])]}),_:2},1032,["item","active","size-dependencies","data-index"])]),_:1},8,["items"])):(m(),h("div",Jt,[_(be,{description:"暂无动态"})]))])}}});const pn=Ye(Xt,[["__scopeId","data-v-65008b84"]]);export{pn as default};
