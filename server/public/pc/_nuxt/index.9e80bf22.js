import{d as D,as as G,at as j,c as $,r as R,x as J,D as P,k as i,l as _,m as t,q as o,s,v as d,Z as r,J as g,K as U,I as m,L as y,aw as Z,av as H,y as Q,b5 as W,cT as X,cU as Y,au as ee,ay as le,_ as te}from"./entry.46557796.js";import{E as oe,a as ae}from"./index.52e544f1.js";import{E as se}from"./el-slider.239593a3.js";import{E as ne}from"./el-input-number.2848ce7e.js";import{E as ue}from"./el-switch.03413428.js";import{E as ie}from"./index.304400de.js";/* empty css                  *//* empty css               *//* empty css                     */import{v as de,k as re}from"./knowledge_base.519704cc.js";import{searchOptions as me}from"./index.66741974.js";import{KnbTypeEnum as v}from"./index.5bd136e1.js";import"./index.c76cd001.js";import"./strings.1c189114.js";import"./debounce.22e3311f.js";import"./_baseIteratee.6084bee0.js";import"./index.1d76ef55.js";import"./index.08e202f9.js";const pe={class:"h-full flex flex-col py-6"},_e={class:"grow min-h-0"},ve={class:"px-[30px]"},fe={class:"flex items-center"},ce={class:"ml-1 cursor-pointer"},Ve={class:"flex items-center w-full gap-x-4"},xe={class:"flex-1"},be={class:"mt-4"},ke={class:"flex items-center"},ge={class:"ml-1 cursor-pointer"},ye={class:"flex items-center"},Ee={class:"ml-1 cursor-pointer"},we={class:"flex items-center w-full gap-x-4"},Re={class:"flex-1"},Ue={class:"flex items-center"},ze={class:"ml-1 cursor-pointer"},Ce={class:"flex items-center w-full gap-x-4"},Ie={class:"flex-1"},Se={class:"mt-4"},Te={class:"flex justify-between w-full gap-x-4"},qe={class:"flex items-center w-full gap-x-4"},Ke={class:"flex-1"},Ne={class:"mt-4"},Oe={class:"flex justify-between w-full gap-x-4"},Be=D({__name:"index",props:G({modelValue:{default:()=>({})}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(z,{expose:T}){const q=z,K=j(),N=$(()=>K.getAiModelConfig.channel||[]),C=R(),a=J(z,"modelValue"),O={kb_type:[{required:!0,message:"请选择知识库类型"}],kb_ids:[{required:!0,message:"请选择挂靠知识库"}],search_mode:[{required:!0,message:"请选择搜索模式"}],search_similar:[{required:!0,message:"请输入最低相似度"}],ranking_status:[{required:!0,message:"请选择重排开关"}],ranking_score:[{required:!0,message:"请输入重排分数"}],optimize_ask:[{required:!0,message:"请选择优化开关"}],optimize_m_id:[{required:!0,message:"请选择优化模型"}]},E=R([]),B=R(),w=async f=>{const e=a.value.kb_type==v.VECTOR?de:re;try{const{lists:u}=await e({page_size:25e3,name:f});E.value=u||[]}catch(u){console.error("获取知识库列表失败:",u),E.value=[]}},L=()=>{a.value.kb_ids=[],w()};return P(()=>q.modelValue.kb_type,()=>{w()},{immediate:!0}),T({validate:()=>new Promise((f,e)=>{var u;return(u=C.value)==null?void 0:u.validate().then(f).catch(e)})}),(f,e)=>{const u=Z,p=oe,c=ae,n=H,V=Q,x=W,b=se,k=ne,I=ue,S=X,A=Y,F=ee,M=le,h=ie;return i(),_("div",pe,[t("div",_e,[o(h,null,{default:s(()=>[t("div",ve,[o(M,{model:a.value,rules:O,ref_key:"formRef",ref:C,"label-position":"top"},{default:s(()=>[o(u,{"content-position":"left"},{default:s(()=>e[16]||(e[16]=[d("基础设置",-1)])),_:1,__:[16]}),o(n,{label:"知识库类型",prop:"kb_type"},{default:s(()=>[o(c,{modelValue:a.value.kb_type,"onUpdate:modelValue":e[0]||(e[0]=l=>a.value.kb_type=l),class:"!h-11 !w-[390px]",placeholder:"请选择知识库类型",onChange:L},{default:s(()=>[o(p,{label:"向量知识库",value:r(v).VECTOR},null,8,["value"]),o(p,{label:"RAG知识库",value:r(v).RAG},null,8,["value"])]),_:1},8,["modelValue"])]),_:1}),o(n,{label:"挂靠知识库",prop:"kb_ids"},{default:s(()=>[o(c,{modelValue:a.value.kb_ids,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.kb_ids=l),ref_key:"selectKbRef",ref:B,class:"!h-11 !w-[390px]",clearable:"",placeholder:"请选择挂靠知识库",remote:"",filterable:"",multiple:a.value.kb_type==r(v).VECTOR,"remote-method":w},{default:s(()=>[(i(!0),_(g,null,U(r(E),l=>(i(),m(p,{key:l.id,label:l.name,value:`${l.id}`},null,8,["label","value"]))),128))]),_:1},8,["modelValue","multiple"])]),_:1}),o(n,{prop:"search_tokens"},{label:s(({label:l})=>[t("span",fe,[e[18]||(e[18]=d(" 引用上限 ",-1)),o(x,{placement:"top"},{content:s(()=>e[17]||(e[17]=[t("p",null,"该参数表示单次文档从知识库检索最大的Tokens数量",-1),t("p",null,"说明: 引用越多意味着所需消耗的token越多",-1),t("p",null,"注意: 切记不要超出模型的最大token限制",-1)])),default:s(()=>[t("span",ce,[o(V,{name:"local-icon-privacy",color:"#00000080"})])]),_:1})])]),default:s(()=>[t("div",Ve,[t("div",xe,[o(b,{modelValue:a.value.search_tokens,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.search_tokens=l),min:100,max:2e4},null,8,["modelValue"])]),o(k,{modelValue:a.value.search_tokens,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.search_tokens=l),"controls-position":"right",min:100,max:2e4},{suffix:s(()=>e[19]||(e[19]=[t("span",null,"tokens",-1)])),_:1},8,["modelValue"])])]),_:1}),a.value.kb_type==r(v).VECTOR?(i(),_(g,{key:0},[t("div",be,[o(u,{"content-position":"left"},{default:s(()=>e[20]||(e[20]=[d("召回设置",-1)])),_:1,__:[20]})]),o(n,null,{label:s(({label:l})=>[t("span",ke,[e[22]||(e[22]=d(" 检索模式 ",-1)),o(x,{placement:"top"},{content:s(()=>e[21]||(e[21]=[t("p",null,"语义检索: 采用向量化模型进行向量检索",-1),t("p",null,"全文检索: 使用传统的数据库检索方式检索",-1),t("p",null,"混合检索: 语义检索+全文检索,具有更好的效果,建议搭配重排模型使用。",-1),t("p",null," 注意: 当您使用全文或混合检索时，是没有语义相似度的，建议您开启重排模型 ",-1)])),default:s(()=>[t("span",ge,[o(V,{name:"local-icon-privacy",color:"#00000080"})])]),_:1})])]),default:s(()=>[o(c,{class:"!h-11 !w-[390px]",modelValue:a.value.search_mode,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.search_mode=l),placeholder:"请选择搜索模式"},{default:s(()=>[(i(!0),_(g,null,U(r(me),l=>(i(),m(p,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(n,{prop:"context_num"},{label:s(({label:l})=>[t("span",ye,[e[24]||(e[24]=d(" 引用上下文 ",-1)),o(x,{placement:"top"},{content:s(()=>e[23]||(e[23]=[t("p",null,"上下文记忆功能，对话时让大模型知道您前 N次 的对话。",-1)])),default:s(()=>[t("span",Ee,[o(V,{name:"local-icon-privacy",color:"#00000080"})])]),_:1})])]),default:s(()=>[t("div",we,[t("div",Re,[o(b,{modelValue:a.value.context_num,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.context_num=l),min:0,max:8,step:1},null,8,["modelValue"])]),o(k,{modelValue:a.value.context_num,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.context_num=l),"controls-position":"right",min:0,max:8},{suffix:s(()=>e[25]||(e[25]=[d("条",-1)])),_:1},8,["modelValue"])])]),_:1}),o(n,null,{label:s(({label:l})=>[t("span",Ue,[e[27]||(e[27]=d(" 最低相似度 ",-1)),o(x,{placement:"top"},{content:s(()=>e[26]||(e[26]=[t("p",null,"语义检索的精度，提问检索的内容需要达到该精度才会被引用",-1),t("ol",{class:"list-decimal pl-4"},[t("li",null," 高语义相似度(>=0.8): 会检索相关性高的知识，会更准确，同时也容易未命中。 "),t("li",null," 低语义相似度(如0.4): 检索范围更大，更容易匹配知识，但可能回答会不准确。 "),t("li",null," 不同的向量模型检索相似度不一样，具体情况到 『知识库 - 搜索测试』进行调试。 "),t("li",null," 如果您使用的是『全文检索/混合检索』这个值则不会生效，仅对语义检索有效。 ")],-1)])),default:s(()=>[t("span",ze,[o(V,{name:"local-icon-privacy",color:"#00000080"})])]),_:1})])]),default:s(()=>[t("div",Ce,[t("div",Ie,[o(b,{modelValue:a.value.search_similar,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.search_similar=l),size:"small",disabled:a.value.search_mode!=="similar",min:0,max:1,step:.001},null,8,["modelValue","disabled"])]),o(k,{modelValue:a.value.search_similar,"onUpdate:modelValue":e[8]||(e[8]=l=>a.value.search_similar=l),disabled:a.value.search_mode!=="similar","controls-position":"right",min:0,max:1,step:.001},null,8,["modelValue","disabled"])])]),_:1}),t("div",Se,[o(u,{"content-position":"left"},{default:s(()=>e[28]||(e[28]=[d("重排设置",-1)])),_:1,__:[28]})]),t("div",null,[o(n,{label:"重排开关"},{default:s(()=>[t("div",Te,[e[29]||(e[29]=t("div",{class:"form-tips"}," 开启后，则会对从数据库检索的内容进行重新排序(取分数最高的N条数据作为引用) ",-1)),o(I,{modelValue:a.value.ranking_status,"onUpdate:modelValue":e[9]||(e[9]=l=>a.value.ranking_status=l),"active-value":1,"inactive-value":0},null,8,["modelValue"])])]),_:1}),a.value.ranking_status===1?(i(),m(n,{key:0,label:"重排分数"},{default:s(()=>[t("div",qe,[t("div",Ke,[o(b,{modelValue:a.value.ranking_score,"onUpdate:modelValue":e[10]||(e[10]=l=>a.value.ranking_score=l),size:"small",min:0,max:1,step:.001},null,8,["modelValue"])]),o(k,{modelValue:a.value.ranking_score,"onUpdate:modelValue":e[11]||(e[11]=l=>a.value.ranking_score=l),"controls-position":"right",min:0,max:1,step:.001},null,8,["modelValue"])]),e[30]||(e[30]=t("div",{class:"form-tips"},"表示如果数据重排后，分数没有达到该值则会过滤掉。",-1))]),_:1,__:[30]})):y("",!0)]),t("div",Ne,[o(u,{"content-position":"left"},{default:s(()=>e[31]||(e[31]=[d("问题优化",-1)])),_:1,__:[31]})]),t("div",null,[o(n,{label:"优化开关"},{default:s(()=>[t("div",Oe,[e[32]||(e[32]=t("div",{class:"form-tips"}," 综合历史记录和问题, 多维度的生成相似问题, 可增加知识库检索时的精准度。 ",-1)),o(I,{modelValue:a.value.optimize_ask,"onUpdate:modelValue":e[12]||(e[12]=l=>a.value.optimize_ask=l),"active-value":1,"inactive-value":0},null,8,["modelValue"])])]),_:1}),a.value.optimize_ask==1?(i(),m(n,{key:0,label:"优化模型",prop:"optimize_m_id"},{default:s(()=>[o(c,{modelValue:a.value.optimize_m_id,"onUpdate:modelValue":e[13]||(e[13]=l=>a.value.optimize_m_id=l),class:"!h-11 !w-[390px]",placeholder:"请选择优化模型"},{default:s(()=>[(i(!0),_(g,null,U(r(N),l=>(i(),m(p,{key:l.id,label:l.name,value:parseInt(l.id)},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):y("",!0)]),o(n,{label:"空搜索回复"},{default:s(()=>[t("div",null,[t("div",null,[o(A,{modelValue:a.value.search_empty_type,"onUpdate:modelValue":e[14]||(e[14]=l=>a.value.search_empty_type=l)},{default:s(()=>[o(S,{value:1},{default:s(()=>e[33]||(e[33]=[d(" AI回复",-1)])),_:1,__:[33]}),o(S,{value:2},{default:s(()=>e[34]||(e[34]=[d(" 自定义回复",-1)])),_:1,__:[34]})]),_:1},8,["modelValue"])]),e[35]||(e[35]=t("div",{class:"form-tips"},"当知识库检索为空时候如何进行回复",-1))])]),_:1}),a.value.search_empty_type===2?(i(),m(n,{key:0},{default:s(()=>[o(F,{modelValue:a.value.search_empty_text,"onUpdate:modelValue":e[15]||(e[15]=l=>a.value.search_empty_text=l),placeholder:"请输入回复内容，当搜索匹配不上内容时，直接回复填写的内容",type:"textarea",autosize:{minRows:6,maxRows:6},maxlength:1e3,"show-word-limit":"",resize:"none"},null,8,["modelValue"])]),_:1})):y("",!0)],64)):y("",!0)]),_:1},8,["model"])])]),_:1})])])}}});const ll=te(Be,[["__scopeId","data-v-a1d84197"]]);export{ll as default};
