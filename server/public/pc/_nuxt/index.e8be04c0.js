import{N as Y,O as ue,P as de,Q as A,S as v,T as k,U as W,d as D,V as ke,W as N,X as K,r as ce,c as G,k as y,I as L,s as R,l as S,J as Ee,K as $e,Y as m,Z as t,$ as pe,H as C,L as g,m as q,a0 as B,q as F,a1 as O,a2 as Ce,t as Z,a3 as Re,a4 as Pe,a5 as we,a6 as Fe,a7 as Se,a8 as Te,a9 as Ue,aa as H,ab as Le,A as J,ac as x,ad as De,ae as _e,af as Oe,ag as Be,D as ee,ah as je,b as qe,ai as Ne,aj as Ae,ak as te,al as se,am as Ke}from"./entry.2beb4577.js";import{E as He}from"./index.a9d48d33.js";import{c as ae}from"./cloneDeep.a23e4277.js";const fe=Symbol("uploadContextKey"),Me="ElUpload";class ze extends Error{constructor(r,a,c,i){super(r),this.name="UploadAjaxError",this.status=a,this.method=c,this.url=i}}function oe(o,r,a){let c;return a.response?c=`${a.response.error||a.response}`:a.responseText?c=`${a.responseText}`:c=`fail to ${r.method} ${o} ${a.status}`,new ze(c,a.status,r.method,o)}function Ie(o){const r=o.responseText||o.response;if(!r)return r;try{return JSON.parse(r)}catch{return r}}const Ve=o=>{typeof XMLHttpRequest>"u"&&Y(Me,"XMLHttpRequest is undefined");const r=new XMLHttpRequest,a=o.action;r.upload&&r.upload.addEventListener("progress",d=>{const f=d;f.percent=d.total>0?d.loaded/d.total*100:0,o.onProgress(f)});const c=new FormData;if(o.data)for(const[d,f]of Object.entries(o.data))ue(f)&&f.length?c.append(d,...f):c.append(d,f);c.append(o.filename,o.file,o.file.name),r.addEventListener("error",()=>{o.onError(oe(a,o,r))}),r.addEventListener("load",()=>{if(r.status<200||r.status>=300)return o.onError(oe(a,o,r));o.onSuccess(Ie(r))}),r.open(o.method,a,!0),o.withCredentials&&"withCredentials"in r&&(r.withCredentials=!0);const i=o.headers||{};if(i instanceof Headers)i.forEach((d,f)=>r.setRequestHeader(f,d));else for(const[d,f]of Object.entries(i))de(f)||r.setRequestHeader(d,String(f));return r.send(c),r},ve=["text","picture","picture-card"];let Xe=1;const Q=()=>Date.now()+Xe++,me=A({action:{type:String,default:"#"},headers:{type:v(Object)},method:{type:String,default:"post"},data:{type:v([Object,Function,Promise]),default:()=>W({})},multiple:Boolean,name:{type:String,default:"file"},drag:Boolean,withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},fileList:{type:v(Array),default:()=>W([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:ve,default:"text"},httpRequest:{type:v(Function),default:Ve},disabled:Boolean,limit:Number}),We=A({...me,beforeUpload:{type:v(Function),default:k},beforeRemove:{type:v(Function)},onRemove:{type:v(Function),default:k},onChange:{type:v(Function),default:k},onPreview:{type:v(Function),default:k},onSuccess:{type:v(Function),default:k},onProgress:{type:v(Function),default:k},onError:{type:v(Function),default:k},onExceed:{type:v(Function),default:k},crossorigin:{type:v(String)}}),Ge=A({files:{type:v(Array),default:()=>W([])},disabled:Boolean,handlePreview:{type:v(Function),default:k},listType:{type:String,values:ve,default:"text"},crossorigin:{type:v(String)}}),Je={remove:o=>!!o},Qe=D({name:"ElUploadList"}),Ye=D({...Qe,props:Ge,emits:Je,setup(o,{emit:r}){const a=o,{t:c}=ke(),i=N("upload"),d=N("icon"),f=N("list"),E=K(),h=ce(!1),b=G(()=>[i.b("list"),i.bm("list",a.listType),i.is("disabled",a.disabled)]),$=p=>{r("remove",p)};return(p,T)=>(y(),L(Ue,{tag:"ul",class:m(t(b)),name:t(f).b()},{default:R(()=>[(y(!0),S(Ee,null,$e(p.files,(s,n)=>(y(),S("li",{key:s.uid||s.name,class:m([t(i).be("list","item"),t(i).is(s.status),{focusing:h.value}]),tabindex:t(E)?void 0:0,"aria-disabled":t(E),role:"button",onKeydown:pe(e=>!t(E)&&$(s),["delete"]),onFocus:e=>h.value=!0,onBlur:e=>h.value=!1,onClick:e=>h.value=!1},[C(p.$slots,"default",{file:s,index:n},()=>[p.listType==="picture"||s.status!=="uploading"&&p.listType==="picture-card"?(y(),S("img",{key:0,class:m(t(i).be("list","item-thumbnail")),src:s.url,crossorigin:p.crossorigin,alt:""},null,10,["src","crossorigin"])):g("v-if",!0),s.status==="uploading"||p.listType!=="picture-card"?(y(),S("div",{key:1,class:m(t(i).be("list","item-info"))},[q("a",{class:m(t(i).be("list","item-name")),onClick:B(e=>p.handlePreview(s),["prevent"])},[F(t(O),{class:m(t(d).m("document"))},{default:R(()=>[F(t(Ce))]),_:1},8,["class"]),q("span",{class:m(t(i).be("list","item-file-name")),title:s.name},Z(s.name),11,["title"])],10,["onClick"]),s.status==="uploading"?(y(),L(t(He),{key:0,type:p.listType==="picture-card"?"circle":"line","stroke-width":p.listType==="picture-card"?6:2,percentage:Number(s.percentage),style:Re(p.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):g("v-if",!0)],2)):g("v-if",!0),q("label",{class:m(t(i).be("list","item-status-label"))},[p.listType==="text"?(y(),L(t(O),{key:0,class:m([t(d).m("upload-success"),t(d).m("circle-check")])},{default:R(()=>[F(t(Pe))]),_:1},8,["class"])):["picture-card","picture"].includes(p.listType)?(y(),L(t(O),{key:1,class:m([t(d).m("upload-success"),t(d).m("check")])},{default:R(()=>[F(t(we))]),_:1},8,["class"])):g("v-if",!0)],2),t(E)?g("v-if",!0):(y(),L(t(O),{key:2,class:m(t(d).m("close")),onClick:e=>$(s)},{default:R(()=>[F(t(Fe))]),_:2},1032,["class","onClick"])),g(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),g(" This is a bug which needs to be fixed "),g(" TODO: Fix the incorrect navigation interaction "),t(E)?g("v-if",!0):(y(),S("i",{key:3,class:m(t(d).m("close-tip"))},Z(t(c)("el.upload.deleteTip")),3)),p.listType==="picture-card"?(y(),S("span",{key:4,class:m(t(i).be("list","item-actions"))},[q("span",{class:m(t(i).be("list","item-preview")),onClick:e=>p.handlePreview(s)},[F(t(O),{class:m(t(d).m("zoom-in"))},{default:R(()=>[F(t(Se))]),_:1},8,["class"])],10,["onClick"]),t(E)?g("v-if",!0):(y(),S("span",{key:0,class:m(t(i).be("list","item-delete")),onClick:e=>$(s)},[F(t(O),{class:m(t(d).m("delete"))},{default:R(()=>[F(t(Te))]),_:1},8,["class"])],10,["onClick"]))],2)):g("v-if",!0)])],42,["tabindex","aria-disabled","onKeydown","onFocus","onBlur","onClick"]))),128)),C(p.$slots,"append")]),_:3},8,["class","name"]))}});var ne=H(Ye,[["__file","upload-list.vue"]]);const Ze=A({disabled:Boolean}),xe={file:o=>ue(o)},ye="ElUploadDrag",et=D({name:ye}),tt=D({...et,props:Ze,emits:xe,setup(o,{emit:r}){Le(fe)||Y(ye,"usage: <el-upload><el-upload-dragger /></el-upload>");const c=N("upload"),i=ce(!1),d=K(),f=b=>{if(d.value)return;i.value=!1,b.stopPropagation();const $=Array.from(b.dataTransfer.files),p=b.dataTransfer.items||[];$.forEach((T,s)=>{var n;const e=p[s],u=(n=e==null?void 0:e.webkitGetAsEntry)==null?void 0:n.call(e);u&&(T.isDirectory=u.isDirectory)}),r("file",$)},E=()=>{d.value||(i.value=!0)},h=b=>{b.currentTarget.contains(b.relatedTarget)||(i.value=!1)};return(b,$)=>(y(),S("div",{class:m([t(c).b("dragger"),t(c).is("dragover",i.value)]),onDrop:B(f,["prevent"]),onDragover:B(E,["prevent"]),onDragleave:B(h,["prevent"])},[C(b.$slots,"default")],42,["onDrop","onDragover","onDragleave"]))}});var st=H(tt,[["__file","upload-dragger.vue"]]);const at=A({...me,beforeUpload:{type:v(Function),default:k},onRemove:{type:v(Function),default:k},onStart:{type:v(Function),default:k},onSuccess:{type:v(Function),default:k},onProgress:{type:v(Function),default:k},onError:{type:v(Function),default:k},onExceed:{type:v(Function),default:k}}),ot=D({name:"ElUploadContent",inheritAttrs:!1}),nt=D({...ot,props:at,setup(o,{expose:r}){const a=o,c=N("upload"),i=K(),d=J({}),f=J(),E=e=>{if(e.length===0)return;const{autoUpload:u,limit:l,fileList:P,multiple:w,onStart:U,onExceed:M}=a;if(l&&P.length+e.length>l){M(e,P);return}w||(e=e.slice(0,1));for(const z of e){const j=z;j.uid=Q(),U(j),u&&h(j)}},h=async e=>{if(f.value.value="",!a.beforeUpload)return $(e);let u,l={};try{const w=a.data,U=a.beforeUpload(e);l=x(a.data)?ae(a.data):a.data,u=await U,x(a.data)&&De(w,l)&&(l=ae(a.data))}catch{u=!1}if(u===!1){a.onRemove(e);return}let P=e;u instanceof Blob&&(u instanceof File?P=u:P=new File([u],e.name,{type:e.type})),$(Object.assign(P,{uid:e.uid}),l)},b=async(e,u)=>Oe(e)?e(u):e,$=async(e,u)=>{const{headers:l,data:P,method:w,withCredentials:U,name:M,action:z,onProgress:j,onSuccess:ge,onError:be,httpRequest:he}=a;try{u=await b(u??P,e)}catch{a.onRemove(e);return}const{uid:I}=e,V={headers:l||{},withCredentials:U,file:e,data:u,method:w,filename:M,action:z,onProgress:_=>{j(_,e)},onSuccess:_=>{ge(_,e),delete d.value[I]},onError:_=>{be(_,e),delete d.value[I]}},X=he(V);d.value[I]=X,X instanceof Promise&&X.then(V.onSuccess,V.onError)},p=e=>{const u=e.target.files;u&&E(Array.from(u))},T=()=>{i.value||(f.value.value="",f.value.click())},s=()=>{T()};return r({abort:e=>{_e(d.value).filter(e?([l])=>String(e.uid)===l:()=>!0).forEach(([l,P])=>{P instanceof XMLHttpRequest&&P.abort(),delete d.value[l]})},upload:h}),(e,u)=>(y(),S("div",{class:m([t(c).b(),t(c).m(e.listType),t(c).is("drag",e.drag),t(c).is("disabled",t(i))]),tabindex:t(i)?void 0:0,"aria-disabled":t(i),role:"button",onClick:T,onKeydown:pe(B(s,["self"]),["enter","space"])},[e.drag?(y(),L(st,{key:0,disabled:t(i),onFile:E},{default:R(()=>[C(e.$slots,"default")]),_:3},8,["disabled"])):C(e.$slots,"default",{key:1}),q("input",{ref_key:"inputRef",ref:f,class:m(t(c).e("input")),name:e.name,disabled:t(i),multiple:e.multiple,accept:e.accept,type:"file",onChange:p,onClick:B(()=>{},["stop"])},null,42,["name","disabled","multiple","accept","onClick"])],42,["tabindex","aria-disabled","onKeydown"]))}});var le=H(nt,[["__file","upload-content.vue"]]);const re="ElUpload",ie=o=>{var r;(r=o.url)!=null&&r.startsWith("blob:")&&URL.revokeObjectURL(o.url)},lt=(o,r)=>{const a=Be(o,"fileList",void 0,{passive:!0}),c=s=>a.value.find(n=>n.uid===s.uid);function i(s){var n;(n=r.value)==null||n.abort(s)}function d(s=["ready","uploading","success","fail"]){a.value=a.value.filter(n=>!s.includes(n.status))}function f(s){a.value=a.value.filter(n=>n.uid!==s.uid)}const E=(s,n)=>{const e=c(n);e&&(console.error(s),e.status="fail",f(e),o.onError(s,e,a.value),o.onChange(e,a.value))},h=(s,n)=>{const e=c(n);e&&(o.onProgress(s,e,a.value),e.status="uploading",e.percentage=Math.round(s.percent))},b=(s,n)=>{const e=c(n);e&&(e.status="success",e.response=s,o.onSuccess(s,e,a.value),o.onChange(e,a.value))},$=s=>{de(s.uid)&&(s.uid=Q());const n={name:s.name,percentage:0,status:"ready",size:s.size,raw:s,uid:s.uid};if(o.listType==="picture-card"||o.listType==="picture")try{n.url=URL.createObjectURL(s)}catch(e){je(re,e.message),o.onError(e,n,a.value)}a.value=[...a.value,n],o.onChange(n,a.value)},p=async s=>{const n=s instanceof File?c(s):s;n||Y(re,"file to be removed not found");const e=u=>{i(u),f(u),o.onRemove(u,a.value),ie(u)};o.beforeRemove?await o.beforeRemove(n,a.value)!==!1&&e(n):e(n)};function T(){a.value.filter(({status:s})=>s==="ready").forEach(({raw:s})=>{var n;return s&&((n=r.value)==null?void 0:n.upload(s))})}return ee(()=>o.listType,s=>{s!=="picture-card"&&s!=="picture"||(a.value=a.value.map(n=>{const{raw:e,url:u}=n;if(!u&&e)try{n.url=URL.createObjectURL(e)}catch(l){o.onError(l,n,a.value)}return n}))}),ee(a,s=>{for(const n of s)n.uid||(n.uid=Q()),n.status||(n.status="success")},{immediate:!0,deep:!0}),{uploadFiles:a,abort:i,clearFiles:d,handleError:E,handleProgress:h,handleStart:$,handleSuccess:b,handleRemove:p,submit:T,revokeFileObjectURL:ie}},rt=D({name:"ElUpload"}),it=D({...rt,props:We,setup(o,{expose:r}){const a=o,c=K(),i=J(),{abort:d,submit:f,clearFiles:E,uploadFiles:h,handleStart:b,handleError:$,handleRemove:p,handleSuccess:T,handleProgress:s,revokeFileObjectURL:n}=lt(a,i),e=G(()=>a.listType==="picture-card"),u=G(()=>({...a,fileList:h.value,onStart:b,onProgress:s,onSuccess:T,onError:$,onRemove:p}));return qe(()=>{h.value.forEach(n)}),Ne(fe,{accept:Ae(a,"accept")}),r({abort:d,submit:f,clearFiles:E,handleStart:b,handleRemove:p}),(l,P)=>(y(),S("div",null,[t(e)&&l.showFileList?(y(),L(ne,{key:0,disabled:t(c),"list-type":l.listType,files:t(h),crossorigin:l.crossorigin,"handle-preview":l.onPreview,onRemove:t(p)},te({append:R(()=>[F(le,se({ref_key:"uploadRef",ref:i},t(u)),{default:R(()=>[l.$slots.trigger?C(l.$slots,"trigger",{key:0}):g("v-if",!0),!l.$slots.trigger&&l.$slots.default?C(l.$slots,"default",{key:1}):g("v-if",!0)]),_:3},16)]),_:2},[l.$slots.file?{name:"default",fn:R(({file:w,index:U})=>[C(l.$slots,"file",{file:w,index:U})])}:void 0]),1032,["disabled","list-type","files","crossorigin","handle-preview","onRemove"])):g("v-if",!0),!t(e)||t(e)&&!l.showFileList?(y(),L(le,se({key:1,ref_key:"uploadRef",ref:i},t(u)),{default:R(()=>[l.$slots.trigger?C(l.$slots,"trigger",{key:0}):g("v-if",!0),!l.$slots.trigger&&l.$slots.default?C(l.$slots,"default",{key:1}):g("v-if",!0)]),_:3},16)):g("v-if",!0),l.$slots.trigger?C(l.$slots,"default",{key:2}):g("v-if",!0),C(l.$slots,"tip"),!t(e)&&l.showFileList?(y(),L(ne,{key:3,disabled:t(c),"list-type":l.listType,files:t(h),crossorigin:l.crossorigin,"handle-preview":l.onPreview,onRemove:t(p)},te({_:2},[l.$slots.file?{name:"default",fn:R(({file:w,index:U})=>[C(l.$slots,"file",{file:w,index:U})])}:void 0]),1032,["disabled","list-type","files","crossorigin","handle-preview","onRemove"])):g("v-if",!0)]))}});var ut=H(it,[["__file","upload.vue"]]);const ft=Ke(ut);export{ft as E,Q as g};
