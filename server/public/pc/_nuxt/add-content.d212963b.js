import{E as fe,a as ve}from"./el-tabs.8b676a95.js";import{E as ye}from"./el-alert.6b601755.js";import{d as ke,z as ge,aG as he,c as xe,r as I,aF as Ee,A as V,bb as we,k as i,l as r,m as n,q as a,s as v,J as k,K as G,Z as e,bM as Ie,L as p,v as D,t as g,a0 as h,aI as be,Y as Me,I as F,aH as N,G as X,au as Pe,y as Ae,ax as Te,u as Re,_ as Ve}from"./entry.2beb4577.js";import{E as Ge}from"./index.e6c47712.js";import{_ as Ne}from"./index.vue.4c207597.js";import{_ as Ce}from"./index.3d6ad44d.js";import{E as Le}from"./index.47b30189.js";import{E as je}from"./el-image.a83bf837.js";import{_ as Oe}from"./index.vue.8d512c7f.js";/* empty css                   *//* empty css                     */import"./el-image-viewer.d11cc27b.js";import{_ as S,a as $e}from"./arrow_down.70a5466c.js";import{s as De}from"./dom.7f5b5a10.js";import{MaterialTypeEnum as t,HandleEventEnum as Fe}from"./index.cf59f1a8.js";import{_ as Xe}from"./emoji.vue.89f767e8.js";import Se from"./useHandle.78641a31.js";import{_ as z}from"./mini-program-card.vue.d62457a2.js";import{_ as ze}from"./material-picker.vue.52eb7e0c.js";import{_ as K}from"./link-card.vue.fc9ac89c.js";import{_ as B}from"./file-card.vue.8ffd7f8c.js";import"./raf.c0777355.js";import"./strings.a9740cf6.js";import"./clamp.a46ea567.js";import"./toNumber.c824a4a2.js";import"./index.772967a0.js";import"./index.e8be04c0.js";import"./index.a9d48d33.js";import"./cloneDeep.a23e4277.js";/* empty css                  *//* empty css                    *//* empty css                  */import"./throttle.403d4771.js";import"./debounce.dd7f88c1.js";import"./person_wechat.8bcf26fc.js";import"./index.vue.039c1a81.js";import"./sidebar.4417c5be.js";import"./useMaterial.857c0166.js";import"./usePaging.85211d66.js";import"./container.2d4ae2f0.js";import"./index.4d719c96.js";import"./index.dcd97a19.js";import"./_baseIteratee.70cb6d8d.js";import"./index.9d200730.js";/* empty css                  *//* empty css               */import"./el-empty.bc763313.js";import"./index.vue.5646543a.js";import"./upload.602501cc.js";import"./preview.vue.b2f4cd95.js";const Ke={class:"h-full flex gap-4 w-full"},Be={class:"grow min-h-0 flex flex-col"},Ue={class:"mt-2"},He={key:0,class:"relative"},qe={class:"absolute bottom-2 w-full px-2 flex items-center justify-between"},Je={class:"rounded-lg hover:bg-token-sidebar-surface-secondary p-2 cursor-pointer"},Ye={key:1,class:"w-full"},Ze={class:"h-[202px] border border-dashed border-[#dcdfe6] rounded-lg w-full flex flex-col items-center justify-center hover:border-primary"},Qe={class:"text-[#8A8A8A] mt-4"},We={key:1,class:"h-full w-full flex justify-center relative p-2"},et=["src"],tt=["src"],ot={class:"absolute right-2 top-2"},st={key:2,class:"h-[202px] border border-[#dcdfe6] rounded-lg p-2"},lt={key:0,class:"w-full h-full relative"},nt={class:"w-[50%] h-full mx-auto flex items-center justify-center"},it={key:0,class:"h-full bg-primary-light-7 p-2 rounded-xl w-full"},rt={key:1,class:"h-[70%] bg-primary-light-7 p-2 rounded-xl w-full"},at={key:2},ct={class:"absolute right-2 top-2"},dt={key:1,class:"h-full flex flex-col items-center justify-center"},pt={class:"flex justify-center mt-4"},mt={class:"grow min-h-0"},ut={class:"px-4"},_t={class:"material-list mt-4 flex flex-col gap-y-4"},ft={class:"text-white flex items-center gap-x-4 flex-1 w-0"},vt={class:"flex-shrink-0 w-[100px]"},yt={key:0,class:"text-ellipsis overflow-hidden whitespace-nowrap"},kt=["src"],gt=["src"],ht={key:3},xt=["src"],Et={key:4,class:"bg-white rounded-lg"},wt={key:5},It={class:"text-ellipsis overflow-hidden whitespace-nowrap"},bt={class:"flex items-center gap-x-2 flex-shrink-0"},Mt=["onClick"],Pt={class:"move-icon cursor-move leading-[0]"},At={key:0,class:"w-[400px] flex-shrink-0"},Tt={class:"phone-preview bg-primary-light-9 rounded-2xl px-10 py-[80px]"},Rt={class:"py-14 px-5 flex flex-col gap-y-2"},Vt={class:"flex-shrink-0"},Gt=["src"],Nt={key:0,class:"bg-white p-2 rounded-lg break-all"},Ct={key:1,class:"w-[120px] h-[120px]"},Lt={key:2,class:"w-[120px] h-[120px] relative"},jt=["src"],Ot=["onClick"],$t={key:3,class:"bg-primary-light-8 h-[200px] w-full p-2 rounded-lg"},Dt={key:4,class:"bg-primary-light-8 w-full p-2 rounded-lg"},Ft={key:5},Xt=ke({__name:"add-content",props:{type:{default:1},modelValue:{},showPreview:{type:Boolean,default:!0}},emits:["update:modelValue"],setup(C,{expose:U,emit:H}){const q=C,J=H,Y=ge(),{userInfo:Z}=he(Y),Q=Re(),_=xe({get(){return q.modelValue},set(c){J("update:modelValue",c)}}),m=I(t.TEXT),b=[{id:t.TEXT,key:"text",name:"文本",error_tips:"请输入文本内容"},{id:t.IMAGE,key:"image",name:"图片",error_tips:"请上传图片"},{id:t.VIDEO,key:"video",name:"视频",error_tips:"请上传视频"},{id:t.MINI_PROGRAM,key:"miniProgram",name:"小程序",error_tips:"请选择小程序"},{id:t.LINK,key:"link",name:"链接",error_tips:"请选择链接"},{id:t.FILE,key:"file",name:"文件",error_tips:"请选择文件"}],o=Ee({text:"",image:{},video:{},miniProgram:{},link:{},file:{}}),W=[{selector:".material-list",options:{animation:150,handle:".move-icon",onEnd:({newIndex:c,oldIndex:l})=>{const d=[..._.value],u=d.splice(l,1)[0];d.splice(c,0,u),_.value=[],N(()=>{_.value=d})}}}],{onHandleEvent:ee}=Se();ee("action",c=>{var d;const{type:l}=c;switch(l){case Fe.ChooseEmoji:(d=P.value)!=null&&d.textarea&&c.emoji&&(o.text=De(P.value.textarea,c.emoji));break}});const te=()=>{A()},oe=c=>{var l;return((l=b.find(d=>d.id==c))==null?void 0:l.name)+"消息"||"未知类型"},se=c=>{const{uri:l,name:d}=c.data||{};!l||!d||(m.value===t.IMAGE?o.image={url:l,name:d}:o.video={url:l,name:d})},M=I(!1),x=V(),le=I(""),L=async c=>{c&&(le.value=c,M.value=!0,await N(),x.value&&(x.value.open(),x.value.setUrl(c)))},E=I(!1),j=V(),O=async()=>{var c;E.value=!0,await N(),(c=j.value)==null||c.open()},ne=c=>{const{ext_info:l,file_name:d,file_url:u}=c;switch(E.value=!1,m.value){case t.IMAGE:o.image={url:u,name:d};break;case t.VIDEO:o.video={url:u,name:d};break;case t.LINK:o.link={name:d,img:u,desc:l.link_desc||"",link:l.link||""};break;case t.MINI_PROGRAM:o.miniProgram={name:d,pic:u,link:l.mini_program_path||"",appid:l.mini_program_appid};break;case t.FILE:o.file={name:d,url:u};break}},P=V(),ie=()=>{if(_.value.length>=6){X.msgError("最多只能添加6条信息");return}const l=b.find(T=>T.id===m.value);if(!l)return;const d=o[l.key];if(typeof d=="string"?!d:!Object.keys(d).length){X.msgError(l.error_tips);return}let f;switch(m.value){case t.TEXT:f={type:t.TEXT,content:o.text};break;case t.IMAGE:f={type:t.IMAGE,content:o.image.url||""};break;case t.VIDEO:f={type:t.VIDEO,content:o.video.url||""};break;case t.MINI_PROGRAM:f={type:t.MINI_PROGRAM,content:{name:o.miniProgram.name||"",pic:o.miniProgram.pic||"",link:o.miniProgram.link||"",appid:o.miniProgram.appid}};break;case t.LINK:f={type:t.LINK,content:{name:o.link.name||"",desc:o.link.desc||"",img:o.link.img||"",link:o.link.link||""}};break;case t.FILE:f={type:t.FILE,content:{name:o.file.name||"",url:o.file.url||""}};break;default:return}_.value=[..._.value,f],A()},A=()=>{o.text="",o.image={url:"",name:""},o.video={url:"",name:""},o.miniProgram={name:"",pic:"",link:"",appid:void 0},o.link={name:"",desc:"",img:""},o.file={name:"",url:""}},re=async c=>{Q.$confirm({message:"确定删除该素材吗？",onConfirm:()=>{_.value.splice(c,1)}})};return U({open:()=>{A(),m.value=t.TEXT}}),(c,l)=>{const d=fe,u=ve,f=ye,T=Pe,y=Ae,ae=Ge,R=Te,ce=Ne,de=Ce,$=Le,pe=je,me=Oe,ue=we("draggable");return i(),r(k,null,[n("div",Ke,[n("div",Be,[n("div",null,[a(u,{modelValue:e(m),"onUpdate:modelValue":l[0]||(l[0]=s=>Ie(m)?m.value=s:null),onTabClick:te},{default:v(()=>[(i(),r(k,null,G(b,s=>a(d,{key:s.id,label:s.name,name:s.id},null,8,["label","name"])),64))]),_:1},8,["modelValue"]),a(f,{title:"请注意：视频、小程序、链接、文件支持个微使用",type:"warning",class:"mt-2"}),n("div",Ue,[e(m)===e(t).TEXT?(i(),r("div",He,[a(T,{modelValue:e(o).text,"onUpdate:modelValue":l[1]||(l[1]=s=>e(o).text=s),ref_key:"textInputRef",ref:P,type:"textarea",autosize:{minRows:7,maxRows:15},placeholder:"点击输入您要发送的文本内容"},null,8,["modelValue"]),n("div",qe,[a(ae,{placement:"bottom",width:"466",trigger:"click","show-arrow":!1,"popper-style":{padding:0}},{reference:v(()=>[n("div",Je,[a(y,{name:"local-icon-phiz",size:24})])]),default:v(()=>[n("div",null,[a(Xe)])]),_:1}),p("",!0)])])):[e(t).IMAGE,e(t).VIDEO].includes(e(m))?(i(),r("div",Ye,[a(de,{class:"h-full w-full","show-progress":"","max-size":20,"show-file-list":!1,type:e(m)==e(t).IMAGE?"image":"video",onSuccess:se},{default:v(()=>[n("div",Ze,[(e(m)===e(t).IMAGE?!e(o).image.url:!e(o).video.url)?(i(),r(k,{key:0},[l[8]||(l[8]=n("img",{src:S,class:"w-8"},null,-1)),n("div",Qe,[D(" 点击上传"+g(e(m)===e(t).IMAGE?"图片":"视频")+"，或点击此",1),n("span",{class:"text-primary cursor-pointer hover:underline",onClick:h(O,["stop"])},"从素材库选择")])],64)):(i(),r("div",We,[e(m)===e(t).IMAGE?(i(),r("img",{key:0,src:e(o).image.url,class:"rounded-lg"},null,8,et)):(i(),r("video",{key:1,src:e(o).video.url,class:"rounded-lg"},null,8,tt)),e(o).video.url?(i(),r("div",{key:2,class:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 cursor-pointer z-30",onClick:l[2]||(l[2]=h(s=>L(e(o).video.url),["stop"]))},[a(ce)])):p("",!0),n("div",ot,[a(R,{onClick:l[3]||(l[3]=h(s=>e(m)===e(t).IMAGE?e(o).image={}:e(o).video={},["stop"]))},{default:v(()=>[a(y,{name:"el-icon-Delete"})]),_:1})])]))])]),_:1},8,["type"])])):[e(t).MINI_PROGRAM,e(t).LINK,e(t).FILE].includes(e(m))?(i(),r("div",st,[e(o).miniProgram.name||e(o).link.name||e(o).file.name?(i(),r("div",lt,[n("div",nt,[e(m)==e(t).MINI_PROGRAM?(i(),r("div",it,[a(z,{title:e(o).miniProgram.name,pic:e(o).miniProgram.pic,link:e(o).miniProgram.link},null,8,["title","pic","link"])])):p("",!0),e(m)==e(t).LINK?(i(),r("div",rt,[a(K,{title:e(o).link.name,desc:e(o).link.desc,img:e(o).link.img},null,8,["title","desc","img"])])):p("",!0),e(m)==e(t).FILE?(i(),r("div",at,[a(B,{name:e(o).file.name,url:e(o).file.url},null,8,["name","url"])])):p("",!0)]),n("div",ct,[a(R,{onClick:l[4]||(l[4]=h(s=>{e(o).miniProgram={},e(o).link={},e(o).file={}},["stop"]))},{default:v(()=>[a(y,{name:"el-icon-Delete"})]),_:1})])])):(i(),r("div",dt,[l[9]||(l[9]=n("img",{src:S,class:"w-8"},null,-1)),n("span",{class:"text-primary cursor-pointer hover:underline mt-4",onClick:h(O,["stop"])},"从素材库选择")]))])):p("",!0),n("div",pt,[a(R,{type:"primary",onClick:ie},{default:v(()=>[...l[10]||(l[10]=[D(" 添加信息内容 ",-1)])]),_:1})])]),l[11]||(l[11]=n("div",{class:"mt-8"},[n("div",{class:"flex justify-center"},[n("img",{src:$e,class:"w-[25px]"})])],-1))]),n("div",mt,[a($,null,{default:v(()=>[be((i(),r("div",ut,[n("div",_t,[(i(!0),r(k,null,G(e(_),(s,w)=>(i(),r("div",{key:w,class:"px-4 py-2 rounded-lg bg-[#2E2E2E] flex justify-between items-center"},[n("div",ft,[n("div",vt,"【"+g(oe(s.type))+"】",1),n("div",{class:Me(["flex-shrink-0",{"flex-1 w-0":s.type==e(t).TEXT}])},[s.type==e(t).TEXT?(i(),r("div",yt,g(s.content),1)):p("",!0),s.type==e(t).IMAGE?(i(),r("img",{key:1,src:s.content,class:"w-6 h-6 rounded-lg object-cover"},null,8,kt)):p("",!0),s.type==e(t).VIDEO?(i(),r("video",{key:2,src:s.content,class:"w-6 h-6 rounded-lg object-cover"},null,8,gt)):p("",!0),s.type==e(t).LINK?(i(),r("div",ht,[n("img",{src:s.content.img,class:"w-6 h-6 rounded-lg object-cover"},null,8,xt)])):p("",!0),s.type==e(t).MINI_PROGRAM?(i(),r("div",Et,[a(y,{name:"local-icon-mini_program_fill",size:20,color:"var(--color-primary)"})])):p("",!0),s.type==e(t).FILE?(i(),r("div",wt,[a(y,{name:"local-icon-file_fill",color:"#80B8F8",size:20})])):p("",!0)],2),n("div",It,g(typeof s.content=="object"?s.content.name:""),1)]),n("div",bt,[n("div",{class:"leading-[0] cursor-pointer",onClick:_e=>re(w)},[a(y,{name:"el-icon-Delete",color:"#ffffff"})],8,Mt),n("div",Pt,[a(y,{name:"el-icon-Rank",color:"#ffffff"})])])]))),128))])])),[[ue,W]])]),_:1})])]),C.showPreview?(i(),r("div",At,[n("div",Tt,[a($,null,{default:v(()=>[n("div",Rt,[(i(!0),r(k,null,G(e(_),(s,w)=>(i(),r("div",{key:w,class:"flex gap-x-2"},[n("div",Vt,[n("img",{src:e(Z).avatar,class:"w-8 h-8 rounded-md"},null,8,Gt)]),s.type==e(t).TEXT?(i(),r("div",Nt,g(s.content),1)):p("",!0),s.type==e(t).IMAGE?(i(),r("div",Ct,[a(pe,{src:s.content,"preview-src-list":[s.content],fit:"cover",class:"w-full h-full"},null,8,["src","preview-src-list"])])):p("",!0),s.type==e(t).VIDEO?(i(),r("div",Lt,[n("video",{src:s.content,fit:"cover",class:"w-full h-full"},null,8,jt),n("div",{class:"absolute top-0 left-0 w-full h-full flex items-center justify-center bg-[#00000080] cursor-pointer",onClick:_e=>L(s.content)},[a(y,{name:"local-icon-play",size:50,color:"#ffffff"})],8,Ot)])):p("",!0),s.type==e(t).MINI_PROGRAM?(i(),r("div",$t,[a(z,{title:s.content.name,pic:s.content.pic,link:s.content.link},null,8,["title","pic","link"])])):p("",!0),s.type==e(t).LINK?(i(),r("div",Dt,[a(K,{title:s.content.name,desc:s.content.desc,img:s.content.img},null,8,["title","desc","img"])])):p("",!0),s.type==e(t).FILE?(i(),r("div",Ft,[a(B,{name:s.content.name,url:s.content.url},null,8,["name","url"])])):p("",!0)]))),128))])]),_:1})])])):p("",!0)]),e(M)?(i(),F(me,{key:0,ref_key:"videoPreviewPlayerRef",ref:x,onClose:l[5]||(l[5]=s=>M.value=!1)},null,512)):p("",!0),e(E)?(i(),F(ze,{key:1,ref_key:"materialPickerRef",ref:j,limit:1,type:e(m),onClose:l[6]||(l[6]=s=>E.value=!1),onSelect:ne},null,8,["type"])):p("",!0)],64)}}});const Fo=Ve(Xt,[["__scopeId","data-v-b53e9310"]]);export{Fo as default};
