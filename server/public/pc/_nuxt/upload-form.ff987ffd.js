import{_ as ie}from"./index.vue.520aef1d.js";import{d as le,at as ne,z as ae,c as D,aF as re,bz as de,r as N,cq as ce,D as fe,k as f,I as E,s as u,m as o,q as r,v as S,t as _,Z as t,l as v,K as F,J as T,Y as ue,aI as pe,a0 as G,L as z,cP as me,dt as M,du as ve,cS as _e,G as P,y as xe,ax as ge,b5 as he,cQ as be,_ as De}from"./entry.46557796.js";import{E as we}from"./index.816355b6.js";import{_ as Ae}from"./index.c84588fb.js";/* empty css                   */import{h as ye}from"./digital_human.b276942f.js";import{DigitalHumanModelVersionEnum as l}from"./index.728f9c9c.js";import{commonUploadLimit as w,uploadLimit as n}from"./index.a571e11a.js";import"./index.fdfb054e.js";import"./index.6c2ab172.js";import"./cloneDeep.18da6720.js";/* empty css                  *//* empty css                    *//* empty css                  */const ke=""+new URL("video_upload_temp.93159d03.png",import.meta.url).href,Re=""+new URL("video_upload_error_temp.d2a965d5.png",import.meta.url).href,Ne=""+new URL("example.4bdca056.mp4",import.meta.url).href,Se={class:"rounded-[24px] flex overflow-hidden container"},Me={class:"absolute top-2 right-2"},Ce={class:"w-[400px] bg-[#101010] py-[30px] px-[20px] flex-shrink-0"},Ee={class:"flex items-center gap-x-2 mt-4"},Te={class:"text-lg text-white font-bold"},ze={class:"mt-[15px]"},Pe={class:"flex gap-4"},Ve={class:"flex flex-col gap-y-[6px]"},Ue={class:"text-[rgba(255,255,255,0.8)] flex-shrink-0"},$e={class:"text-[rgba(255,255,255,0.3)]"},He={class:"mt-2"},Ie={class:"flex items-center gap-x-2 mt-4"},Le={class:"flex-1 p-[30px] text-base"},Be={class:"flex items-center gap-x-3"},je={class:"text-white"},Fe={class:"flex flex-col gap-y-1"},Ge=["onClick"],Je=["src"],Ye={class:"text-white font-bold"},qe={class:"flex items-center gap-x-1 rounded-full bg-[#ffffff08] p-1 mt-5"},Ke={class:"rounded-xl grow min-h-0 mt-4"},Oe={class:"w-full rounded-lg h-[256px] bg-app-bg-1"},Qe={key:0,class:"flex flex-col items-center justify-center h-full"},Ze={class:"w-12 h-12 rounded-xl flex items-center justify-center border border-dashed border-[#ffffff1a] hover:border-[#ffffff33] cursor-pointer"},We={key:1,class:"w-full h-full relative"},Xe={class:"absolute top-0 left-0 w-full h-full"},eo=["src"],oo={class:"w-[45%] mx-auto h-full flex flex-col items-center justify-center rounded-lg relative overflow-hidden"},to=["src"],so={class:"absolute top-2 right-2 z-[11]"},io={class:"mt-4 flex justify-center"},lo=".mp4,.mov",no=le({__name:"upload-form",emits:["create","close","playVideo"],setup(ao,{expose:J,emit:Y}){const x=Y,q=ne(),g=ae(),C=D(()=>{const{channel:i}=q.getDigitalHumanConfig;return i&&i.length>0?i.filter(e=>e.status==1&&l.CHANJING==e.id):[]}),s=re({model_version:l.STANDARD,anchor_name:de().format("YYYYMMDDHHmm").substring(2),width:"",height:"",pic:"",url:""}),K=D(()=>{var i,e,d,a;return{[l.STANDARD]:(i=g.getTokenByScene(M.HUMAN_AVATAR))==null?void 0:i.score,[l.SUPER]:(e=g.getTokenByScene(M.HUMAN_AVATAR_PRO))==null?void 0:e.score,[l.ADVANCED]:(d=g.getTokenByScene(M.HUMAN_AVATAR_ADVANCED))==null?void 0:d.score,[l.ELITE]:(a=g.getTokenByScene(M.HUMAN_AVATAR_ELITE))==null?void 0:a.score}[s.model_version]}),V=D(()=>{var i;return(i=C.value.find(e=>e.id==s.model_version))==null?void 0:i.name}),U={resolution:`${w.minResolution}P-${w.maxResolution}P`,fileSize:w.size,videoMinDuration:w.videoMinDuration,videoMaxDuration:w.videoMaxDuration},A={[l.STANDARD]:{resolution:`${n[l.STANDARD].minResolution}P-${n[l.STANDARD].maxResolution}P`,fileSize:n[l.STANDARD].size,videoMinDuration:n[l.STANDARD].videoMinDuration,videoMaxDuration:n[l.STANDARD].videoMaxDuration},[l.SUPER]:{resolution:`${n[l.SUPER].minResolution}P-${n[l.SUPER].maxResolution}P`,fileSize:n[l.SUPER].size,videoMinDuration:n[l.SUPER].videoMinDuration,videoMaxDuration:n[l.SUPER].videoMaxDuration},[l.ADVANCED]:U,[l.ELITE]:U,[l.CHANJING]:{resolution:`${n[l.CHANJING].minResolution}P-${n[l.CHANJING].maxResolution}P`,fileSize:n[l.CHANJING].size,videoMinDuration:n[l.CHANJING].videoMinDuration,videoMaxDuration:n[l.CHANJING].videoMaxDuration}},O=["mp4","mov"],Q=D(()=>{var i,e,d,a;return[{name:"录制视频",value:"视频全程只能有一个人物，嘴型不得遮挡，不得多人出镜"},{name:"文件大小",value:`文件≤${(i=A[s.model_version])==null?void 0:i.fileSize}MB，${(e=A[s.model_version])==null?void 0:e.videoMinDuration}秒-${(d=A[s.model_version])==null?void 0:d.videoMaxDuration}秒`},{name:"文件格式",value:O.join("、")},{name:"视频帧率",value:"15fps≤帧率≤60fps"},{name:"视频要求",value:`清晰度必须为${(a=A[s.model_version])==null?void 0:a.resolution}`},{name:"声音要求",value:"视频内音频需要清晰、响亮且无嘈杂背景音等干扰"},{name:"录制框架",value:"视频应为人物正面出镜的近景画面，避免大角度侧脸或人脸过小"}]}),y=N(!1),$=D(()=>s.url&&s.anchor_name),Z=i=>{const{data:{uri:e}}=i;s.url=e,W(e)},p=N(!1),W=async i=>{p.value=!0;const{file:e,width:d,height:a}=await ve(i);s.width=d,s.height=a,e?_e({file:e}).then(h=>{s.pic=h.uri,p.value=!1}):p.value=!1},H=i=>{s.url="",s.pic="",y.value=!1,i&&(s.model_version=i)},X=async()=>{const{model_version:i,gender:e,pic:d,url:a,width:h,height:b}=s;if(!a){P.msgError("请上传视频");return}if(m.value==1)x("create",{modelType:m.value,formData:s}),k();else if(m.value==2)try{await ye({name:s.anchor_name,gender:e,url:a,pic:d,width:h,height:b,model_version:i}),g.getUser(),P.msgSuccess("克隆成功"),x("create",{modelType:m.value,formData:s}),k()}catch(R){P.msgError(R||"克隆失败")}},{lockFn:I,isLock:L}=ce(X),B=N(),m=N(1),ee=async i=>{var e;m.value=i,(e=B.value)==null||e.open()},k=()=>{x("close")},oe=async()=>{x("playVideo",Ne)};return fe(()=>C.value,i=>{i&&i.length&&(s.model_version=i[0].id)},{deep:!0,immediate:!0}),J({open:ee}),(i,e)=>{const d=ie,a=xe,h=we,b=ge,R=he,te=Ae,se=be;return f(),E(me,{ref_key:"uploadPopRef",ref:B,width:"778px",class:"digital-human-upload-popup",style:{padding:"0","background-color":"var(--app-bg-color-2)"},"cancel-button-text":"","confirm-button-text":"","show-close":!1,"append-to-body":!1,onClose:k},{default:u(()=>[o("div",Se,[o("div",Me,[o("div",{class:"w-6 h-6",onClick:k},[r(d)])]),o("div",Ce,[e[7]||(e[7]=o("div",{class:"title-text"},[S(" 上传视频 "),o("br"),S(" 同步创建形象并生成内容 ")],-1)),o("div",Ee,[r(a,{name:"local-icon-success_fill",color:"var(--color-primary)",size:18}),o("span",Te,"视频要求（"+_(t(V))+"）",1)]),o("div",ze,[o("div",Pe,[e[4]||(e[4]=o("div",{class:"flex-shrink-0"},[o("img",{src:ke,class:"w-[134px]"})],-1)),o("div",Ve,[(f(!0),v(T,null,F(t(Q),(c,j)=>(f(),v("div",{key:j,class:"text-[10px]"},[o("span",Ue,_(c.name),1),e[3]||(e[3]=o("span",{class:"text-[rgba(255,255,255,0.3)]"},"·",-1)),o("span",$e,_(c.value),1)]))),128))])]),o("div",He,[o("div",Ie,[r(a,{name:"local-icon-error_fill",color:"#ffffff",size:18}),e[5]||(e[5]=o("span",{class:"text-lg text-white font-bold"},"错误示例",-1))]),e[6]||(e[6]=o("img",{src:Re,class:"mt-[15px]"},null,-1))])])]),o("div",Le,[e[14]||(e[14]=o("div",{class:"text-[#ffffff80]"},"请上传一段视频，作为驱动数字人的 底版视频",-1)),o("div",{class:"cursor-pointer text-white mt-[10px] inline-block",onClick:oe}," 查看教程示例 "),r(h,{visible:t(y),"popper-class":"!w-[318px] !p-2 !bg-app-bg-2 !border-[--app-border-color-1] !rounded-xl",teleported:"","show-arrow":!1},{reference:u(()=>[o("div",{class:"mt-[15px] border border-[var(--app-border-color-1)] bg-app-bg-1 rounded-lg h-[48px] flex items-center justify-between px-3 cursor-pointer",onClick:e[0]||(e[0]=c=>y.value=!t(y))},[e[8]||(e[8]=o("div",{class:"text-[#ffffff80]"},"模型选择",-1)),o("div",Be,[o("div",je,_(t(V)),1),r(a,{name:"local-icon-up_down",size:20,color:"#ffffff0d"})])])]),default:u(()=>[o("div",null,[o("div",Fe,[(f(!0),v(T,null,F(t(C),c=>(f(),v("div",{key:c.id,class:ue(["flex items-center h-11 rounded-md hover:bg-app-bg-1 border border-[transparent] hover:border-[var(--app-border-color-1)] gap-x-3 px-3 cursor-pointer",{"bg-app-bg-1 border-[var(--app-border-color-1)]":t(s).model_version==c.id}]),onClick:j=>H(c.id)},[o("img",{src:c.icon,class:"w-5 h-5"},null,8,Je),o("div",Ye,_(c.name),1)],10,Ge))),128))])])]),_:1},8,["visible"]),o("div",qe,[r(a,{name:"local-icon-tips",size:16}),e[9]||(e[9]=o("div",{class:"text-[#ffffff4d] text-xs"},"注意：切换模型版本，需要重新上传视频及相关内容。",-1))]),o("div",Ke,[r(te,{class:"w-full h-full",type:"video",drag:"","show-progress":"",limit:1,"show-file-list":!1,"max-size":t(n)[t(s).model_version].size,"min-duration":t(n)[t(s).model_version].videoMinDuration,"max-duration":t(n)[t(s).model_version].videoMaxDuration,"video-min-width":t(n)[t(s).model_version].minResolution,"video-max-width":t(n)[t(s).model_version].maxResolution,accept:lo,onSuccess:Z},{default:u(()=>[o("div",Oe,[t(s).url?pe((f(),v("div",We,[t(p)?z("",!0):(f(),v(T,{key:0},[o("div",Xe,[o("img",{src:t(s).pic,class:"w-full h-full rounded-lg object-cover filter blur-sm"},null,8,eo)]),o("div",oo,[o("img",{src:t(s).pic,class:"w-full h-full rounded-lg object-cover"},null,8,to),o("div",{class:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 cursor-pointer",onClick:e[1]||(e[1]=G(c=>x("playVideo",t(s).url),["stop"]))},[r(a,{name:"local-icon-play",size:50,color:"#ffffff"})])]),o("div",so,[r(R,{content:"删除"},{default:u(()=>[r(b,{circle:"",color:"rgba(255,255,255,0.1)",onClick:e[2]||(e[2]=G(c=>H(),["stop"]))},{default:u(()=>[r(a,{name:"el-icon-Delete",size:14,color:"#ffffff"})]),_:1})]),_:1})])],64))])),[[se,t(p)]]):(f(),v("div",Qe,[o("div",Ze,[r(a,{name:"el-icon-Plus",color:"#ffffff"})]),e[10]||(e[10]=o("div",{class:"gap-2 mt-[15px] flex flex-col"},[o("span",{class:"text-white"},"点击此开始上传视频"),o("span",{class:"text-xs text-[#ffffff80]"},"支持拖拽上传")],-1)),e[11]||(e[11]=o("div",{class:"absolute bottom-2 left-0 w-full text-center text-[#ffffff80] text-[10px]"}," 为保证形象的复刻效果，推荐阅读左侧要求后录制上传 ",-1))]))])]),_:1},8,["max-size","min-duration","max-duration","video-min-width","video-max-width"])]),o("div",io,[t(m)==2?(f(),E(R,{key:0,placement:"top"},{content:u(()=>[o("div",null,"扣除算力："+_(t(K)||0),1)]),default:u(()=>[r(b,{type:"primary",class:"w-full !h-[50px] !rounded-full",loading:t(L)||t(p),disabled:!t($),onClick:t(I)},{default:u(()=>e[12]||(e[12]=[S(" 立即克隆 ",-1)])),_:1,__:[12]},8,["loading","disabled","onClick"])]),_:1})):z("",!0),t(m)==1?(f(),E(b,{key:1,type:"primary",class:"w-full !h-[50px] !rounded-full",loading:t(L)||t(p),disabled:!t($),onClick:t(I)},{default:u(()=>e[13]||(e[13]=[S(" 立即创建 ",-1)])),_:1,__:[13]},8,["loading","disabled","onClick"])):z("",!0)])])])]),_:1},512)}}});const Ao=De(no,[["__scopeId","data-v-136373c8"]]);export{Ao as default};
