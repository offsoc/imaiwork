import{d as qe,bP as Je,a as Ke,aG as Qe,dI as Ze,c as I,r as _,aF as pe,bC as me,A as Xe,cx as et,l as d,m as t,q as f,s as h,Z as s,J as k,K as P,t as v,L as g,I as T,bO as tt,G as C,dx as st,cY as ot,aH as X,ax as lt,u as it,k as r,v as R,Y as $,c$ as at,y as nt,_ as rt}from"./entry.ca4d3d61.js";import{_ as ct}from"./index.vue.c578915d.js";import{E as ut,a as pt}from"./index.5f182cdf.js";import{E as mt}from"./el-alert.a3499903.js";import{E as dt}from"./el-time-picker.e4236b4e.js";import{_ as ft}from"./index.vue.fa049f69.js";/* empty css                  *//* empty css               *//* empty css                     */import{u as vt}from"./useSocialPlatform.9d5915bd.js";import{g as _t,a as xt,p as ht}from"./device.b7e58507.js";import{PublishTaskTypeEnum as y,MaterialTypeEnum as de,SidebarTypeEnum as gt,MaterialActionType as yt}from"./index.db2ee73f.js";import bt from"./content-copywriting-material.216d87ef.js";import{_ as fe}from"./copywriting-card.vue.bfea6ac8.js";import ve from"./material-picker.ba99da78.js";import wt from"./material-popup.867f5a40.js";import kt from"./useMaterial.0d5cdbde.js";import{validateSchedule as Ct}from"./utils.82b5f057.js";import{E as ee}from"./index.8b07fb5c.js";import"./index.ab577458.js";import"./strings.5c02160d.js";import"./_baseIteratee.37ea2cef.js";import"./toNumber.33289b44.js";import"./clamp.ba5ce84b.js";import"./index.d577d4c6.js";import"./customParseFormat.06da92dd.js";import"./panel-time-pick.3d41fe8f.js";import"./index.4fbaf6cb.js";import"./debounce.bdbfd9e6.js";import"./sph_icon.de3a3562.js";import"./el-empty.355e6a02.js";import"./redbook.418b34fe.js";import"./index.28cc44d7.js";import"./index.803eaa3c.js";import"./index.62355f5a.js";import"./cloneDeep.d975dd37.js";/* empty css                  *//* empty css                    *//* empty css                  */import"./index.655612b0.js";import"./el-image.a5590741.js";import"./el-image-viewer.c57baf7b.js";import"./throttle.da389ed1.js";/* empty css                   */import"./useTemplate.afda57ca.js";import"./el-tabs.4bed391d.js";import"./raf.53a060df.js";import"./index.cbddee2f.js";import"./index.vue.9b80d373.js";import"./usePaging.15b2220c.js";import"./digital_human.b276942f.js";import"./index.b6d81f77.js";const Mt={class:"h-full bg-app-bg-2 rounded-[20px] overflow-x-auto dynamic-scroller"},Et={class:"h-full flex flex-col min-w-[1000px]"},It={class:"flex-shrink-0 flex items-center justify-between px-[14px] h-[88px] border-b border-[#ffffff1a]"},Vt={class:"flex items-center gap-1"},Pt={class:"px-5"},Tt={class:"flex-shrink-0 flex items-center justify-center h-[100px] border-b border-[#ffffff1a] gap-x-[150px]"},$t=["onClick"],At={class:"grow min-h-0 flex flex-col p-5"},St={key:0,class:"grow min-h-0 flex flex-col w-[456px] mx-auto"},Lt={class:"flex items-center justify-between flex-shrink-0"},Dt={class:"text-white font-bold text-[20px]"},Rt={class:"grow min-h-0 mt-5 flex gap-x-[18px]"},Ft={class:"content-item material-content"},Ht={class:"flex items-center justify-between flex-shrink-0 px-[14px]"},Gt={class:"text-[11px] text-white"},Ut={class:"text-[11px] text-white"},Ot={class:"grow min-h-0"},Bt={class:"px-[14px]"},jt={key:0,class:"mt-[14px] border border-app-border-2 rounded-xl p-2"},Wt=["onClick"],zt={key:1,class:"grow min-h-0 flex flex-col"},Nt={class:"flex items-center justify-between flex-shrink-0"},Yt={class:"grow min-h-0 mt-5 flex gap-x-[18px]"},qt={class:"content-item title-content"},Jt={class:"content-item desc-content"},Kt={class:"w-[456px] mx-auto"},Qt={class:"mt-[23px] flex flex-col gap-y-4"},Zt={class:"flex items-center gap-x-2"},Xt=["src"],es={class:"flex flex-wrap gap-2 mt-4"},ts=["onClick"],ss={class:"mt-4"},os={class:"rounded-xl bg-app-bg-3 border border-app-border-2 py-3"},ls={class:"px-3"},is={class:"text-[#ffffff80] mb-[13px] text-xs"},as={key:0,class:"mt-2"},ns={class:"text-[#FF2442] mt-1 text-xs"},F=99,_e=100,rs=".mp4,.mov",cs=50,H=9,G=30,us=qe({__name:"publish-panel",props:{type:{default:y.VIDEO}},emits:["back"],setup(xe,{emit:he}){const ge=xe,ye=he,be=Je(),we=Ke(),te=it(),{updateCopywritingMaterial:M}=kt(),{getPlatform:ke}=vt(),A={[y.VIDEO]:"视频",[y.IMAGE]:"图文"},Ce={[y.VIDEO]:de.VIDEO,[y.IMAGE]:de.IMAGE},U=[{step:1,title:"选择素材"},{step:2,title:"填写文案"},{step:3,title:"设定时间"}],{type:m}=Qe(ge),Me=Ze(),Ee=I(()=>Me.material_id),p=_(1),n=pe({name:`${A[m.value]}矩阵任务${me().format("YYYYMMDDHHmmss")}`,accounts:[],media_type:m.value,time_config:[],publish_frep:2}),l=pe({id:Ee.value,name:n.name,media_type:m.value,media_url:[],title:[],subtitle:[]}),O=_(!1),B=_(!1),j=_(!1),se=_(),oe=Xe(),W=_(),Ie=_(),Ve=_(),z=_([]),N=_([]),Y=_(""),le=I(()=>p.value===U.length),V=I(()=>m.value===y.VIDEO),S=I(()=>m.value===y.IMAGE),Pe=()=>{p.value===1?ae():p.value--},Te=o=>{o>p.value?ie():p.value=o},ie=async()=>{let o=!1;if(p.value===1)o=await Ae();else if(p.value===2)o=await Se();else if(le.value){await je();return}o&&(p.value++,tt({...be.query,step:p.value}))},$e=()=>{te.$confirm({message:"确定要取消创建吗？",theme:"dark",onConfirm:ae})},ae=()=>{ye("back"),p.value=1},Ae=async()=>l.media_url.length===0?(C.msgWarning("请选择素材"),!1):m.value===y.IMAGE&&l.media_url.some(o=>!Array.isArray(o.url)||o.url.length===0||o.url.some(e=>!e))?(C.msgWarning("请为每个图片组添加有效的图片，或删除空的图片组"),!1):!0,Se=async()=>l.title.length===0||l.title.every(o=>!o.content)?(C.msgWarning("请填写标题"),!1):l.subtitle.length===0||l.subtitle.every(o=>!o.content)?(C.msgWarning("请填写描述"),!1):(ze(),!0),q=_(0),E=_(-1),Le=I(()=>{if(V.value)return E.value===-1?F:F-l.media_url.length;if(S.value){const o=l.media_url[q.value];return E.value===-1?H:H-((o==null?void 0:o.url.length)||0)}return 0}),J=I(()=>E.value===-1),ne=async(o,e)=>{var c;q.value=e,E.value=o.index>-1?o.index:-1,B.value=!0,await X(),(c=oe.value)==null||c.open()},De=async o=>{if(V.value)if(J.value)for(const e of o){const c={url:e.url,pic:e.pic};if(!e.pic)try{const{file:x}=await st(e.url),a=await ot({file:x});c.pic=a.uri}catch{}l.media_url.push(c),K(e)}else l.media_url[E.value]=o[0];else if(S.value){const e=l.media_url[q.value];J.value?e.url.push(...o):e.url[E.value]=o[0]}M(l)},re=()=>M(l),ce=o=>{o.type===yt.ADD&&V.value&&K()},Re=()=>{l.media_url.push({url:[],date:""}),K()},Fe=o=>{te.$confirm({message:"确定要删除该素材组吗？",theme:"dark",onConfirm:()=>{l.media_url.splice(o,1),M(l)}})},He=async()=>{O.value=!0,await X(),se.value.open()},Ge=o=>{const{titleList:e,contentList:c}=o;e.length>0&&l.title.push(...e),c.length>0&&l.subtitle.push(...c),(e.length>0||c.length>0)&&M(l)},K=(o=!0)=>{l.title.push({content:""}),setTimeout(()=>l.subtitle.push({content:"",topic:[]}),100),o&&M(l)},Ue=()=>Oe()?n.accounts.length===0?(C.msgWarning("请选择发布账号"),!1):!0:!1,Oe=()=>{const{valid:o,errorIndexes:e}=Ct(n.time_config);return o?(N.value=[],!0):(N.value=e,C.msgWarning("时间配置存在冲突"),!1)},Be=o=>{o!=n.publish_frep&&(n.publish_frep=o,n.time_config=Array.from({length:o},(e,c)=>{const x=me().hour(9).minute(0),a=x.add(c*G,"minutes").format("HH:mm"),b=x.add(c*G+G,"minutes").format("HH:mm");return[a,b]}))},{lockFn:je,isLock:ue}=et(async()=>{if(Ue())try{const o=l.title.filter(a=>a.content).map((a,b)=>{var L,D;const Q=(L=l.subtitle[b])==null?void 0:L.content,Z=(D=l.subtitle[b])==null?void 0:D.topic;return{title:a.content,content:Q,topic:Z}});let e=[];m.value===y.VIDEO?e=l.media_url.map(a=>({url:[a.pic,a.url]})):e=l.media_url.map(a=>({url:a.url.map(b=>b.url)}));const{id:c}=await xt({name:n.name,media_url:e,copywriting:o,media_type:m.value}),x=z.value.filter(a=>n.accounts.includes(a.account)).map(a=>({account:a.account,id:a.id,type:a.type}));await ht({name:n.name,matrix_media_setting_id:c,time_config:n.time_config.map(a=>`${a[0]}-${a[1]}`),accounts:x,publish_frep:n.publish_frep,media_type:m.value,task_type:3,scene:2,data_type:0}),C.msgSuccess("发布成功"),we.push(`/app/matrix?type=${gt.ME_PUBLISH}`),setTimeout(()=>{window.location.reload()},500)}catch(o){Y.value=o,C.msgError(o)}}),We=()=>{n.time_config.length===0&&(n.time_config.push(["09:00","09:30"]),n.time_config.push(["09:30","10:00"]))},ze=()=>{Ne(),We()},Ne=async()=>{const{lists:o}=await _t({page_size:999});z.value=o},Ye=async o=>{var e,c;j.value=!0,await X(),(e=W.value)==null||e.open(),(c=W.value)==null||c.setUrl(o)};return(o,e)=>{const c=nt,x=lt,a=ct,b=ut,Q=pt,Z=mt,L=dt,D=ft;return r(),d(k,null,[t("div",Mt,[t("div",Et,[t("div",It,[t("div",{class:"flex items-center gap-2 cursor-pointer",onClick:Pe},[f(c,{name:"el-icon-ArrowLeft",color:"#ffffff"}),e[10]||(e[10]=t("div",{class:"text-white"},"返回上一步",-1))]),t("div",Vt,[f(x,{class:"!rounded-full !h-10 w-[98px] !border-app-border-2",color:"#181818",disabled:s(ue),onClick:$e},{default:h(()=>[...e[11]||(e[11]=[R("取消",-1)])]),_:1},8,["disabled"]),f(x,{type:"primary",class:"!rounded-full !h-10 w-[98px]",loading:s(ue),onClick:ie},{default:h(()=>[R(v(s(le)?"提交":"下一步"),1)]),_:1},8,["loading"])])]),t("div",Pt,[t("div",Tt,[(r(),d(k,null,P(U,(i,u)=>t("div",{key:u,class:"relative"},[t("div",{class:"flex flex-col items-center gap-2 cursor-pointer",onClick:w=>Te(i.step)},[t("div",{class:$(["w-6 h-6 rounded-full flex items-center justify-center text-white",[s(p)>=i.step?"bg-primary":"bg-[#ffffff0d]"]])},v(u+1),3),t("div",{class:$([s(p)>=i.step?"text-white":"text-[#ffffff80]"])},v(i.title),3)],8,$t),u!=U.length-1?(r(),d("div",{key:0,class:$(["absolute w-[120px] h-[1px] left-[calc(100%+15px)] top-[10px]",[s(p)>i.step?"bg-primary":"bg-[#ffffff1a]"]])},null,2)):g("",!0)])),64))])]),t("div",At,[s(p)==1?(r(),d("div",St,[t("div",Lt,[t("div",Dt,"选择"+v(A[s(m)]),1)]),t("div",Rt,[t("div",Ft,[t("div",Ht,[s(V)?(r(),d(k,{key:0},[t("div",Gt," 视频（共"+v(s(l).media_url.length)+"个视频） ",1),t("div",{class:"text-[11px] text-[#ffffff80] mt-2"}," 最多可选"+v(F)+"个，视频"+v(_e)+"m以下 ")],64)):g("",!0),s(S)?(r(),d(k,{key:1},[t("div",null,[t("div",Ut," 图文（共"+v(s(l).media_url.length)+"组） ",1),t("div",{class:"text-[11px] text-[#ffffff80] mt-2"}," 每组图片不超过"+v(H)+"张 ")]),f(x,{class:"!h-10 w-[106px] !border-[#ffffff1a]",color:"#262626",onClick:Re},{default:h(()=>[...e[12]||(e[12]=[R("添加图片组",-1)])]),_:1})],64)):g("",!0)]),t("div",Ot,[f(s(ee),null,{default:h(()=>[t("div",Bt,[s(V)?(r(),d("div",jt,[f(ve,{"material-list":s(l).media_url,"onUpdate:materialList":[e[0]||(e[0]=i=>s(l).media_url=i),re],type:s(m),accept:rs,"max-video-count":F,"max-size":_e,onPreviewVideo:Ye,onImportMaterial:e[1]||(e[1]=i=>ne(i,0)),onChangeMaterial:ce},null,8,["material-list","type"])])):g("",!0),s(S)?(r(!0),d(k,{key:1},P(s(l).media_url,(i,u)=>(r(),d("div",{class:"mt-[14px] border border-app-border-2 rounded-xl p-2 relative",key:u},[f(ve,{"material-list":i.url,"onUpdate:materialList":[w=>i.url=w,re],type:s(m),"max-size":cs,"max-image-count":H,onImportMaterial:w=>ne(w,u),onChangeMaterial:ce},null,8,["material-list","onUpdate:materialList","type","onImportMaterial"]),t("div",{class:"absolute -top-2 -right-2 w-5 h-5",onClick:w=>Fe(u)},[f(a,{"icon-size":14,theme:s(at).DARK},null,8,["theme"])],8,Wt)]))),128)):g("",!0)])]),_:1})])])])])):s(p)==2?(r(),d("div",zt,[t("div",Nt,[e[14]||(e[14]=t("div",{class:"text-white font-bold text-[20px]"},"填写文案",-1)),t("div",null,[f(x,{type:"primary",class:"!rounded-full !h-10 w-[106px]",onClick:He},{default:h(()=>[...e[13]||(e[13]=[R("智能文案",-1)])]),_:1})])]),t("div",Yt,[t("div",qt,[f(fe,{"model-value":s(l).title,"onUpdate:modelValue":[e[2]||(e[2]=i=>s(l).title=i),e[3]||(e[3]=i=>s(M)(s(l)))],type:1,"publish-type-name":A[s(m)]},null,8,["model-value","publish-type-name"])]),t("div",Jt,[f(fe,{"model-value":s(l).subtitle,"onUpdate:modelValue":[e[4]||(e[4]=i=>s(l).subtitle=i),e[5]||(e[5]=i=>s(M)(s(l)))],type:2,"publish-type-name":A[s(m)]},null,8,["model-value","publish-type-name"])])])])):s(p)==3?(r(),T(s(ee),{key:2},{default:h(()=>[t("div",Kt,[e[20]||(e[20]=t("div",{class:"font-bold text-white text-[20px]"},"发布设置",-1)),t("div",Qt,[t("div",null,[e[15]||(e[15]=t("div",{class:"text-[#ffffff80] mb-3"},"账号选择",-1)),f(Q,{modelValue:s(n).accounts,"onUpdate:modelValue":e[6]||(e[6]=i=>s(n).accounts=i),placeholder:"请选择发布的账号",class:"!w-full !h-11 account-select","popper-class":"dark-select-popper",multiple:"","collapse-tags":"","show-arrow":!1},{default:h(()=>[(r(!0),d(k,null,P(s(z),i=>(r(),T(b,{key:i.account,label:`${i.nickname}（${i.account}）`,value:i.account},{default:h(()=>{var u;return[t("div",Zt,[t("img",{src:(u=s(ke)(i.type))==null?void 0:u.icon,class:"w-4 h-4"},null,8,Xt),t("div",null,v(i.nickname)+"（"+v(i.account)+"）",1)])]}),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),t("div",null,[e[16]||(e[16]=t("div",{class:"text-[#ffffff80]"},"发布频率（每日）",-1)),t("div",es,[(r(),d(k,null,P([1,2,3,5,10],(i,u)=>t("div",{key:u,class:$(["cursor-pointer rounded-md px-4 py-2 border border-app-border-2 text-white hover:bg-app-bg-1",[s(n).publish_frep==i?"bg-primary hover:bg-primary":""]]),onClick:w=>Be(i)},v(i)+"条 ",11,ts)),64))])]),t("div",null,[e[19]||(e[19]=t("div",{class:"text-[#ffffff80] mb-3"},"选择时间",-1)),t("div",ss,[t("div",os,[t("div",ls,[f(Z,{type:"warning",effect:"dark"},{default:h(()=>[t("span",{class:"text-xs"},"设置的时间必须为n+1组的时间大于n组的时间，时间间隔"+v(G)+"分钟")]),_:1}),e[17]||(e[17]=t("div",{class:"text-white mt-4"},"任务发布设置",-1))]),f(s(ee),{ref_key:"timeConfigScrollbarRef",ref:Ie},{default:h(()=>[t("div",{class:"flex flex-col gap-3 mt-[5px] max-h-[300px] p-3",ref_key:"timeConfigWrapperRef",ref:Ve},[(r(!0),d(k,null,P(s(n).time_config,(i,u)=>(r(),d("div",null,[t("div",is," 每天第"+v(u+1)+"个任务发布时间 ",1),f(L,{class:$(["w-full",{"time-error":s(N).includes(u)}]),modelValue:s(n).time_config[u],"onUpdate:modelValue":w=>s(n).time_config[u]=w,"is-range":"","range-separator":"至","prefix-icon":"",format:"HH:mm","value-format":"HH:mm","popper-class":"dark-select-popper","show-arrow":!1},null,8,["class","modelValue","onUpdate:modelValue"])]))),256))],512)]),_:1},512)]),s(Y)?(r(),d("div",as,[e[18]||(e[18]=t("div",null,"任务冲突",-1)),t("view",ns,v(s(Y)),1)])):g("",!0)])])])])]),_:1})):g("",!0)])])]),s(O)?(r(),T(bt,{key:0,ref_key:"copywritingMaterialRef",ref:se,onClose:e[7]||(e[7]=i=>O.value=!1),onConfirm:Ge},null,512)):g("",!0),s(B)?(r(),T(wt,{key:1,ref_key:"materialPopRef",ref:oe,type:Ce[s(m)],limit:s(Le),multiple:s(J),onClose:e[8]||(e[8]=i=>B.value=!1),onConfirm:De},null,8,["type","limit","multiple"])):g("",!0),s(j)?(r(),T(D,{key:2,ref_key:"previewVideoRef",ref:W,onClose:e[9]||(e[9]=i=>j.value=!1)},null,512)):g("",!0)],64)}}});const co=rt(us,[["__scopeId","data-v-86e1fbec"]]);export{co as default};
