import{d as X,aF as Y,r as C,G as p,o as ee,k as c,l as r,m as s,q as n,s as l,Z as m,dA as te,aI as oe,I as D,v as b,t as N,J as M,L as w,bK as ne,aH as ae,dB as se,cT as ie,ax as le,y as ce,cP as re,u as de,_ as ue}from"./entry.d7219633.js";import{E as pe,a as me}from"./index.0a6eb9ae.js";import{E as _e}from"./el-switch.69f0f4ce.js";import{E as fe}from"./index.1f8dde63.js";import{E as he}from"./el-empty.77af023a.js";import{_ as ve}from"./index.vue.5e2341cc.js";/* empty css                        *//* empty css                        *//* empty css               *//* empty css                   *//* empty css                 *//* empty css                     */import{u as ge}from"./usePaging.3c53b51c.js";import{z as ke,M as ye,s as xe}from"./person_wechat.8bcf26fc.js";import{_ as Ce}from"./edit.vue.a70b5ff0.js";import be from"./useWeChatWs.2a9fe923.js";import{MsgTypeEnum as d}from"./index.cf59f1a8.js";import"./index.f15af271.js";import"./_baseIteratee.5c97421a.js";import"./debounce.085e8a4a.js";import"./index.ead96a32.js";import"./index.50778a9c.js";import"./index.4953ba77.js";import"./strings.03d3529c.js";import"./el-input-number.368c2208.js";import"./index.2311001e.js";/* empty css                  */import"./agent.a3fcedc5.js";import"./useWebSocket.ba3dfe12.js";const we={class:"h-full flex flex-col bg-white rounded-lg"},Ee={class:"flex items-center justify-end flex-shrink-0 p-4"},Te={class:"flex items-center justify-end gap-2 grow"},Ie={class:"grow min-h-0 flex flex-col overflow-hidden"},Pe={class:"grow min-h-0"},Fe={key:0},Ae={key:1},Se={key:0},Ve={key:1},We={key:2},Le={class:"flex justify-center"},Be={key:0,class:"flex items-center gap-2"},Ne={key:1,class:"flex items-center gap-2"},$e={class:"flex flex-col gap-2"},Re=["onClick"],De=["onClick"],Me=["onClick"],Ue={class:"flex justify-end p-4"},je=X({__name:"lists",setup(Ge){const $=de(),E=Y({takeover_mode:""}),{pager:k,getLists:_,resetPage:Oe,resetParams:qe}=ge({fetchFun:ke,params:E}),T=C(!1),I=C(),{on:P,send:U,actionType:F}=be(),f=C({}),R=C([]);P("error",()=>{p.closeLoading()}),P("message",async o=>{const{MsgType:e,Content:a}=o;e===d.Auth&&(F.value=null,f.value.accessToken=a.AccessToken,p.loading("更新好友中，请稍候..."),x(d.TriggerFriendPushTask)),e===d.FriendPushNotice&&await z(a),(e==d.WeChatOfflineNotice||e==d.WeChatOnlineNotice)&&_()}),P("action",async o=>{const{type:e,accessToken:a,deviceId:h,wechatId:u}=o;e===d.WechatLogoutTask&&(x(d.WechatLogoutTask,{deviceId:h,accessToken:a,wechatId:u}),F.value=void 0)});function x(o,e={}){const a={DeviceId:e.deviceId||f.value.device_code,AccessToken:e.accessToken||f.value.accessToken,WeChatId:e.wechatId||f.value.wechat_id,TaskId:e.TaskId||Date.now()};U({MsgType:o,Content:a})}const j=async o=>{var e,a;T.value=!0,await ae(),(e=I.value)==null||e.open(),(a=I.value)==null||a.setFormData(o)},G=async o=>{$.$confirm({message:"确定要下线该账号吗？",onConfirm:async()=>{F.value=d.WechatLogoutTask,x(d.Auth,{deviceId:o.device_code}),o.wechat_status=0,p.msgSuccess("下线指令已发送")}})},O=async o=>{$.$confirm({message:"确定要更新好友吗？如果好友数量较多，请耐心等待。",onConfirm:async()=>{f.value=o,x(d.Auth,{deviceId:o.device_code})}})},q=async o=>{try{await xe({wechat_id:o.wechat_id,open_ai:o.open_ai,remark:o.remark,takeover_mode:o.takeover_mode,takeover_type:o.takeover_type,robot_id:o.robot_id,sort:o.sort}),p.msgSuccess("设置成功"),_()}catch{p.msgError("设置失败"),o.open_ai=o.open_ai===1?0:1}};async function z(o){const{Friends:e=[],Page:a,Size:h,Count:u}=o;if(e.length===0&&u===0)return p.closeLoading(),p.msgSuccess("该账号下没有好友");if(e.length>0){const i=a===0;R.value=i?e:[...R.value,...e],await ye({wechat_id:f.value.wechat_id,friends:e.map(y=>H(f.value.wechat_id,y))}),h*a+e.length>=u&&(p.closeLoading(),p.msgSuccess("好友更新成功"))}}function H(o,e){const{FriendId:a,FriendNo:h,FriendNick:u,Memo:i,Avatar:y,Gender:g,Country:A,Province:S,City:V,Phone:W,Desc:L,Source:t,SourceExt:v,CreateTime:J,IsUnusual:K,Type:Z}=e,B=parseInt(t),Q=B<1e6?B+1e6:B;return{wechat_id:o,friend_id:a,friend_no:h,nickname:u,remark:i,gender:g,country:A,province:S,city:V,avatar:y,type:Z,label_ids:[],phone:W,desc:L,source:Q,source_ext:v,create_time:J,is_unusual:K,open_ai:1,takeover_mode:1}}return ee(()=>{_()}),(o,e)=>{const a=se,h=ie,u=le,i=pe,y=_e,g=ce,A=fe,S=he,V=me,W=ve,L=re;return c(),r(M,null,[s("div",we,[s("div",Ee,[s("div",Te,[n(h,{modelValue:E.takeover_mode,"onUpdate:modelValue":e[0]||(e[0]=t=>E.takeover_mode=t),onChange:m(_)},{default:l(()=>[n(a,{label:"全部",value:""}),n(a,{label:"人工介入",value:0}),n(a,{label:"AI接管",value:1})]),_:1},8,["modelValue","onChange"]),n(u,{icon:m(te),onClick:m(_)},null,8,["icon","onClick"])])]),s("div",Ie,[s("div",Pe,[oe((c(),D(V,{data:m(k).lists,stripe:"",height:"100%","row-style":{height:"60px"},"header-row-style":{height:"62px"}},{empty:l(()=>[n(S,{description:"暂无数据"})]),default:l(()=>[n(i,{label:"账号信息","min-width":"160"},{default:l(({row:t})=>[b(N(t.wechat_nickname),1),t.remark?(c(),r(M,{key:0},[b("("+N(t.remark)+")",1)],64)):w("",!0)]),_:1}),n(i,{prop:"wechat_id",label:"微信ID",width:"180"}),n(i,{label:"接管模式",width:"100"},{default:l(({row:t})=>[t.takeover_mode===1?(c(),r("span",Fe,"AI接管")):(c(),r("span",Ae,"人工介入"))]),_:1}),n(i,{prop:"robot_name",label:"关联机器人","min-width":"160"},{default:l(({row:t})=>[s("span",null,N(t.robot_name||"-"),1)]),_:1}),n(i,{label:"接管类型",width:"120"},{default:l(({row:t})=>[t.takeover_type===0?(c(),r("span",Se,"全部")):t.takeover_type===1?(c(),r("span",Ve,"私聊")):t.takeover_type===2?(c(),r("span",We,"群聊")):w("",!0)]),_:1}),n(i,{label:"AI总功能开关",width:"120"},{default:l(({row:t})=>[n(y,{modelValue:t.open_ai,"onUpdate:modelValue":v=>t.open_ai=v,"active-value":1,"inactive-value":0,onChange:v=>q(t)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),n(i,{label:"状态",width:"120"},{default:l(({row:t})=>[s("div",Le,[t.wechat_status===1?(c(),r("div",Be,e[3]||(e[3]=[s("div",{class:"w-2 h-2 bg-success rounded-full"},null,-1),b(" 在线 ",-1)]))):(c(),r("div",Ne,e[4]||(e[4]=[s("div",{class:"w-2 h-2 bg-danger rounded-full"},null,-1),b(" 离线 ",-1)])))])]),_:1}),n(i,{prop:"create_time",label:"创建时间",width:"180"}),n(i,{label:"操作",width:"120",fixed:"right"},{default:l(({row:t})=>[n(A,{"show-arrow":!1,"popper-class":"!w-[120px] !min-w-[120px] !p-[6px] !rounded-xl"},{reference:l(()=>[n(u,{link:""},{default:l(()=>[n(g,{name:"el-icon-MoreFilled"})]),_:1})]),default:l(()=>[s("div",$e,[s("div",{class:"px-2 py-1 hover:bg-primary-light-9 rounded-lg cursor-pointer flex items-center gap-2",onClick:v=>j(t)},[n(g,{name:"el-icon-EditPen"}),e[5]||(e[5]=s("span",null,"编辑",-1))],8,Re),t.wechat_status===1?(c(),r("div",{key:0,class:"px-2 py-1 hover:bg-primary-light-9 rounded-lg cursor-pointer flex items-center gap-2",onClick:v=>G(t)},[n(g,{name:"el-icon-SwitchButton"}),e[6]||(e[6]=s("span",null,"下线",-1))],8,De)):w("",!0),s("div",{class:"px-2 py-1 hover:bg-primary-light-9 rounded-lg cursor-pointer flex items-center gap-2",onClick:v=>O(t)},[n(g,{name:"el-icon-Refresh"}),e[7]||(e[7]=s("span",null,"更新好友",-1))],8,Me)])]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[L,m(k).loading]])]),s("div",Ue,[n(W,{modelValue:m(k),"onUpdate:modelValue":e[1]||(e[1]=t=>ne(k)?k.value=t:null),onChange:m(_)},null,8,["modelValue","onChange"])])])]),T.value?(c(),D(Ce,{key:0,ref_key:"editPopupRef",ref:I,onClose:e[2]||(e[2]=t=>T.value=!1),onSuccess:m(_)},null,8,["onSuccess"])):w("",!0)],64)}}});const xt=ue(je,[["__scopeId","data-v-8b596074"]]);export{xt as default};
