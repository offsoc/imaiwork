import{H as ot,g as lt,d as ht,e as ct,w as S,n as j}from"./markmap-common.ee5358ff.js";import"./d3-transition.d41d25b9.js";import{t as E,y as dt,i as pt}from"./d3-zoom.5b4ddffb.js";import{o as ut}from"./d3-scale.658849e8.js";import{m as gt}from"./d3-scale-chromatic.5d2e723e.js";import{l as mt}from"./d3-shape.154ce4ca.js";import{x as ft}from"./d3-selection.0cc3cb22.js";import{m as U,a as V,b as xt}from"./d3-array.056066cc.js";const Z=typeof navigator<"u"&&navigator.userAgent.includes("Macintosh"),yt=ut(gt),vt=(e=1,t=3,a=2)=>i=>e+t/a**i.state.depth,kt={autoFit:!1,duration:500,embedGlobalCSS:!0,fitRatio:.95,maxInitialScale:2,scrollForPan:Z,initialExpandLevel:-1,zoom:!0,pan:!0,toggleRecursively:!1,color:e=>{var t;return yt(`${((t=e.state)==null?void 0:t.path)||""}`)},lineWidth:vt(),maxWidth:0,nodeMinHeight:16,paddingX:8,spacingHorizontal:80,spacingVertical:5};function bt(e){let t=0;for(let a=0;a<e.length;a++)t=(t<<5)-t+e.charCodeAt(a)|0;return(t>>>0).toString(36)}function k(e){if(typeof e=="string"){const a=e;e=i=>i.matches(a)}const t=e;return function(){let a=Array.from(this.childNodes);return t&&(a=a.filter(i=>t(i))),a}}function wt(e){var t=0,a=e.children,i=a&&a.length;if(!i)t=1;else for(;--i>=0;)t+=a[i].value;e.value=t}function zt(){return this.eachAfter(wt)}function Et(e){var t=this,a,i=[t],n,o,h;do for(a=i.reverse(),i=[];t=a.pop();)if(e(t),n=t.children,n)for(o=0,h=n.length;o<h;++o)i.push(n[o]);while(i.length);return this}function Ct(e){for(var t=this,a=[t],i,n;t=a.pop();)if(e(t),i=t.children,i)for(n=i.length-1;n>=0;--n)a.push(i[n]);return this}function Xt(e){for(var t=this,a=[t],i=[],n,o,h;t=a.pop();)if(i.push(t),n=t.children,n)for(o=0,h=n.length;o<h;++o)a.push(n[o]);for(;t=i.pop();)e(t);return this}function St(e){return this.eachAfter(function(t){for(var a=+e(t.data)||0,i=t.children,n=i&&i.length;--n>=0;)a+=i[n].value;t.value=a})}function jt(e){return this.eachBefore(function(t){t.children&&t.children.sort(e)})}function Rt(e){for(var t=this,a=At(t,e),i=[t];t!==a;)t=t.parent,i.push(t);for(var n=i.length;e!==a;)i.splice(n,0,e),e=e.parent;return i}function At(e,t){if(e===t)return e;var a=e.ancestors(),i=t.ancestors(),n=null;for(e=a.pop(),t=i.pop();e===t;)n=e,e=a.pop(),t=i.pop();return n}function $t(){for(var e=this,t=[e];e=e.parent;)t.push(e);return t}function Bt(){var e=[];return this.each(function(t){e.push(t)}),e}function Dt(){var e=[];return this.eachBefore(function(t){t.children||e.push(t)}),e}function Ot(){var e=this,t=[];return e.each(function(a){a!==e&&t.push({source:a.parent,target:a})}),t}function M(e,t){var a=new R(e),i=+e.value&&(a.value=e.value),n,o=[a],h,s,l,p;for(t==null&&(t=Ht);n=o.pop();)if(i&&(n.value=+n.data.value),(s=t(n.data))&&(p=s.length))for(n.children=new Array(p),l=p-1;l>=0;--l)o.push(h=n.children[l]=new R(s[l])),h.parent=n,h.depth=n.depth+1;return a.eachBefore(Lt)}function Mt(){return M(this).eachBefore(_t)}function Ht(e){return e.children}function _t(e){e.data=e.data.data}function Lt(e){var t=0;do e.height=t;while((e=e.parent)&&e.height<++t)}function R(e){this.data=e,this.depth=this.height=0,this.parent=null}R.prototype=M.prototype={constructor:R,count:zt,each:Et,eachAfter:Xt,eachBefore:Ct,sum:St,sort:jt,path:Rt,ancestors:$t,descendants:Bt,leaves:Dt,links:Ot,copy:Mt};const It="d3-flextree",Tt="2.1.2",Ft="build/d3-flextree.js",Pt="index",Wt={name:"Chris Maloney",url:"http://chrismaloney.org"},Nt="Flexible tree layout algorithm that allows for variable node sizes.",Kt=["d3","d3-module","layout","tree","hierarchy","d3-hierarchy","plugin","d3-plugin","infovis","visualization","2d"],Ut="https://github.com/klortho/d3-flextree",Vt="WTFPL",Yt={type:"git",url:"https://github.com/klortho/d3-flextree.git"},Zt={clean:"rm -rf build demo test","build:demo":"rollup -c --environment BUILD:demo","build:dev":"rollup -c --environment BUILD:dev","build:prod":"rollup -c --environment BUILD:prod","build:test":"rollup -c --environment BUILD:test",build:"rollup -c",lint:"eslint index.js src","test:main":"node test/bundle.js","test:browser":"node test/browser-tests.js",test:"npm-run-all test:*",prepare:"npm-run-all clean build lint test"},qt={"d3-hierarchy":"^1.1.5"},Gt={"babel-plugin-external-helpers":"^6.22.0","babel-preset-es2015-rollup":"^3.0.0",d3:"^4.13.0","d3-selection-multi":"^1.0.1",eslint:"^4.19.1",jsdom:"^11.6.2","npm-run-all":"^4.1.2",rollup:"^0.55.3","rollup-plugin-babel":"^2.7.1","rollup-plugin-commonjs":"^8.0.2","rollup-plugin-copy":"^0.2.3","rollup-plugin-json":"^2.3.0","rollup-plugin-node-resolve":"^3.0.2","rollup-plugin-uglify":"^3.0.0","uglify-es":"^3.3.9"},Jt={name:It,version:Tt,main:Ft,module:Pt,"jsnext:main":"index",author:Wt,description:Nt,keywords:Kt,homepage:Ut,license:Vt,repository:Yt,scripts:Zt,dependencies:qt,devDependencies:Gt},{version:Qt}=Jt,te=Object.freeze({children:e=>e.children,nodeSize:e=>e.data.size,spacing:0});function G(e){const t=Object.assign({},te,e);function a(s){const l=t[s];return typeof l=="function"?l:()=>l}function i(s){const l=h(o(),s,p=>p.children);return l.update(),l.data}function n(){const s=a("nodeSize"),l=a("spacing");return class q extends M.prototype.constructor{constructor(c){super(c)}copy(){const c=h(this.constructor,this,u=>u.children);return c.each(u=>u.data=u.data.data),c}get size(){return s(this)}spacing(c){return l(this,c)}get nodes(){return this.descendants()}get xSize(){return this.size[0]}get ySize(){return this.size[1]}get top(){return this.y}get bottom(){return this.y+this.ySize}get left(){return this.x-this.xSize/2}get right(){return this.x+this.xSize/2}get root(){const c=this.ancestors();return c[c.length-1]}get numChildren(){return this.hasChildren?this.children.length:0}get hasChildren(){return!this.noChildren}get noChildren(){return this.children===null}get firstChild(){return this.hasChildren?this.children[0]:null}get lastChild(){return this.hasChildren?this.children[this.numChildren-1]:null}get extents(){return(this.children||[]).reduce((c,u)=>q.maxExtents(c,u.extents),this.nodeExtents)}get nodeExtents(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}static maxExtents(c,u){return{top:Math.min(c.top,u.top),bottom:Math.max(c.bottom,u.bottom),left:Math.min(c.left,u.left),right:Math.max(c.right,u.right)}}}}function o(){const s=n(),l=a("nodeSize"),p=a("spacing");return class extends s{constructor(c){super(c),Object.assign(this,{x:0,y:0,relX:0,prelim:0,shift:0,change:0,lExt:this,lExtRelX:0,lThr:null,rExt:this,rExtRelX:0,rThr:null})}get size(){return l(this.data)}spacing(c){return p(this.data,c.data)}get x(){return this.data.x}set x(c){this.data.x=c}get y(){return this.data.y}set y(c){this.data.y=c}update(){return J(this),Q(this),this}}}function h(s,l,p){const c=(u,g)=>{const m=new s(u);Object.assign(m,{parent:g,depth:g===null?0:g.depth+1,height:0,length:1});const x=p(u)||[];return m.children=x.length===0?null:x.map(y=>c(y,m)),m.children&&Object.assign(m,m.children.reduce((y,v)=>({height:Math.max(y.height,v.height+1),length:y.length+v.length}),m)),m};return c(l,null)}return Object.assign(i,{nodeSize(s){return arguments.length?(t.nodeSize=s,i):t.nodeSize},spacing(s){return arguments.length?(t.spacing=s,i):t.spacing},children(s){return arguments.length?(t.children=s,i):t.children},hierarchy(s,l){const p=typeof l>"u"?t.children:l;return h(n(),s,p)},dump(s){const l=a("nodeSize"),p=c=>u=>{const g=c+"  ",m=c+"    ",{x,y}=u,v=l(u),b=u.children||[],z=b.length===0?" ":`,${g}children: [${m}${b.map(p(m)).join(m)}${g}],${c}`;return`{ size: [${v.join(", ")}],${g}x: ${x}, y: ${y}${z}},`};return p(`
`)(s)}}),i}G.version=Qt;const J=(e,t=0)=>(e.y=t,(e.children||[]).reduce((a,i)=>{const[n,o]=a;J(i,e.y+e.ySize);const h=(n===0?i.lExt:i.rExt).bottom;n!==0&&re(e,n,o);const s=ce(h,n,o);return[n+1,s]},[0,null]),ee(e),he(e),e),Q=(e,t,a)=>{typeof t>"u"&&(t=-e.relX-e.prelim,a=0);const i=t+e.relX;return e.relX=i+e.prelim-a,e.prelim=0,e.x=a+e.relX,(e.children||[]).forEach(n=>Q(n,i,e.x)),e},ee=e=>{(e.children||[]).reduce((t,a)=>{const[i,n]=t,o=i+a.shift,h=n+o+a.change;return a.relX+=h,[o,h]},[0,0])},re=(e,t,a)=>{const i=e.children[t-1],n=e.children[t];let o=i,h=i.relX,s=n,l=n.relX,p=!0;for(;o&&s;){o.bottom>a.lowY&&(a=a.next);const c=h+o.prelim-(l+s.prelim)+o.xSize/2+s.xSize/2+o.spacing(s);(c>0||c<0&&p)&&(l+=c,ae(n,c),ie(e,t,a.index,c)),p=!1;const u=o.bottom,g=s.bottom;u<=g&&(o=se(o),o&&(h+=o.relX)),u>=g&&(s=ne(s),s&&(l+=s.relX))}!o&&s?oe(e,t,s,l):o&&!s&&le(e,t,o,h)},ae=(e,t)=>{e.relX+=t,e.lExtRelX+=t,e.rExtRelX+=t},ie=(e,t,a,i)=>{const n=e.children[t],o=t-a;if(o>1){const h=i/o;e.children[a+1].shift+=h,n.shift-=h,n.change-=i-h}},ne=e=>e.hasChildren?e.firstChild:e.lThr,se=e=>e.hasChildren?e.lastChild:e.rThr,oe=(e,t,a,i)=>{const n=e.firstChild,o=n.lExt,h=e.children[t];o.lThr=a;const s=i-a.relX-n.lExtRelX;o.relX+=s,o.prelim-=s,n.lExt=h.lExt,n.lExtRelX=h.lExtRelX},le=(e,t,a,i)=>{const n=e.children[t],o=n.rExt,h=e.children[t-1];o.rThr=a;const s=i-a.relX-n.rExtRelX;o.relX+=s,o.prelim-=s,n.rExt=h.rExt,n.rExtRelX=h.rExtRelX},he=e=>{if(e.hasChildren){const t=e.firstChild,a=e.lastChild,i=(t.prelim+t.relX-t.xSize/2+a.relX+a.prelim+a.xSize/2)/2;Object.assign(e,{prelim:i,lExt:t.lExt,lExtRelX:t.lExtRelX,rExt:a.rExt,rExtRelX:a.rExtRelX})}},ce=(e,t,a)=>{for(;a!==null&&e>=a.lowY;)a=a.next;return{lowY:e,index:t,next:a}},de=".markmap{--markmap-max-width: 9999px;--markmap-a-color: #0097e6;--markmap-a-hover-color: #00a8ff;--markmap-code-bg: #f0f0f0;--markmap-code-color: #555;--markmap-highlight-bg: #ffeaa7;--markmap-table-border: 1px solid currentColor;--markmap-font: 300 16px/20px sans-serif;--markmap-circle-open-bg: #fff;--markmap-text-color: #333;--markmap-highlight-node-bg: #ff02;font:var(--markmap-font);color:var(--markmap-text-color)}.markmap-link{fill:none}.markmap-node>circle{cursor:pointer}.markmap-foreign{display:inline-block}.markmap-foreign p{margin:0}.markmap-foreign a{color:var(--markmap-a-color)}.markmap-foreign a:hover{color:var(--markmap-a-hover-color)}.markmap-foreign code{padding:.25em;font-size:calc(1em - 2px);color:var(--markmap-code-color);background-color:var(--markmap-code-bg);border-radius:2px}.markmap-foreign pre{margin:0}.markmap-foreign pre>code{display:block}.markmap-foreign del{text-decoration:line-through}.markmap-foreign em{font-style:italic}.markmap-foreign strong{font-weight:700}.markmap-foreign mark{background:var(--markmap-highlight-bg)}.markmap-foreign table,.markmap-foreign th,.markmap-foreign td{border-collapse:collapse;border:var(--markmap-table-border)}.markmap-foreign img{display:inline-block}.markmap-foreign svg{fill:currentColor}.markmap-foreign>div{width:var(--markmap-max-width);text-align:left}.markmap-foreign>div>div{display:inline-block}.markmap-highlight rect{fill:var(--markmap-highlight-node-bg)}.markmap-dark .markmap{--markmap-code-bg: #1a1b26;--markmap-code-color: #ddd;--markmap-circle-open-bg: #444;--markmap-text-color: #eee}",B="g.markmap-node",pe="path.markmap-link",ue="g.markmap-highlight",D=mt();function Y(e,t){const a=xt(e,t);return e[a]}function O(e){e.stopPropagation()}const ge=new ot;class tt{constructor(t,a){this.options={...kt},this._disposeList=[],this.handleZoom=i=>{const{transform:n}=i;this.g.attr("transform",n)},this.handlePan=i=>{i.preventDefault();const n=E(this.svg.node()),o=n.translate(-i.deltaX/n.k,-i.deltaY/n.k);this.svg.call(this.zoom.transform,o)},this.handleClick=(i,n)=>{let o=this.options.toggleRecursively;(Z?i.metaKey:i.ctrlKey)&&(o=!o),this.toggleNode(n,o)},this.ensureView=this.ensureVisible,this.svg=t.datum?t:ft(t),this.styleNode=this.svg.append("style"),this.zoom=dt().filter(i=>this.options.scrollForPan&&i.type==="wheel"?i.ctrlKey&&!i.button:(!i.ctrlKey||i.type==="wheel")&&!i.button).on("zoom",this.handleZoom),this.setOptions(a),this.state={id:this.options.id||this.svg.attr("id")||lt(),rect:{x1:0,y1:0,x2:0,y2:0}},this.g=this.svg.append("g"),this.g.append("g").attr("class","markmap-highlight"),this._observer=new ResizeObserver(ht(()=>{this.renderData()},100)),this._disposeList.push(ge.tap(()=>{this.setData()}),()=>this._observer.disconnect())}getStyleContent(){const{style:t}=this.options,{id:a}=this.state,i=typeof t=="function"?t(a):"";return[this.options.embedGlobalCSS&&de,i].filter(Boolean).join(`
`)}updateStyle(){this.svg.attr("class",ct(this.svg.attr("class"),"markmap",this.state.id));const t=this.getStyleContent();this.styleNode.text(t)}async toggleNode(t,a=!1){var i,n;const o=(i=t.payload)!=null&&i.fold?0:1;a?S(t,(h,s)=>{h.payload={...h.payload,fold:o},s()}):t.payload={...t.payload,fold:(n=t.payload)!=null&&n.fold?0:1},await this.renderData(t)}_initializeData(t){let a=0;const{color:i,initialExpandLevel:n}=this.options;let o=0,h=0;return S(t,(s,l,p)=>{var c,u,g,m;h+=1,s.children=(c=s.children)==null?void 0:c.map(y=>({...y})),a+=1,s.state={...s.state,depth:h,id:a,rect:{x:0,y:0,width:0,height:0},size:[0,0]},s.state.key=[(u=p==null?void 0:p.state)==null?void 0:u.id,s.state.id].filter(Boolean).join(".")+bt(s.content),s.state.path=[(g=p==null?void 0:p.state)==null?void 0:g.path,s.state.id].filter(Boolean).join("."),i(s);const x=((m=s.payload)==null?void 0:m.fold)===2;x?o+=1:(o||n>=0&&s.state.depth>=n)&&(s.payload={...s.payload,fold:1}),l(),x&&(o-=1),h-=1}),t}_relayout(){if(!this.state.data)return;this.g.selectAll(k(B)).selectAll(k("foreignObject")).each(function(l){var p;const c=(p=this.firstChild)==null?void 0:p.firstChild,u=[c.scrollWidth,c.scrollHeight];l.state.size=u});const{lineWidth:t,paddingX:a,spacingHorizontal:i,spacingVertical:n}=this.options,o=G({}).children(l=>{var p;if(!((p=l.payload)!=null&&p.fold))return l.children}).nodeSize(l=>{const[p,c]=l.data.state.size;return[c,p+(p?a*2:0)+i]}).spacing((l,p)=>(l.parent===p.parent?n:n*2)+t(l.data)),h=o.hierarchy(this.state.data);o(h);const s=h.descendants();s.forEach(l=>{const p=l.data;p.state.rect={x:l.y,y:l.x-l.xSize/2,width:l.ySize-i,height:l.xSize}}),this.state.rect={x1:U(s,l=>l.data.state.rect.x)||0,y1:U(s,l=>l.data.state.rect.y)||0,x2:V(s,l=>l.data.state.rect.x+l.data.state.rect.width)||0,y2:V(s,l=>l.data.state.rect.y+l.data.state.rect.height)||0}}setOptions(t){this.options={...this.options,...t},this.options.zoom?this.svg.call(this.zoom):this.svg.on(".zoom",null),this.options.pan?this.svg.on("wheel",this.handlePan):this.svg.on("wheel",null)}async setData(t,a){a&&this.setOptions(a),t&&(this.state.data=this._initializeData(t)),this.state.data&&(this.updateStyle(),await this.renderData())}async setHighlight(t){this.state.highlight=t||void 0,await this.renderData()}_getHighlightRect(t){const a=this.svg.node(),i=4/E(a).k,n={...t.state.rect};return n.x-=i,n.y-=i,n.width+=2*i,n.height+=2*i,n}async renderData(t){const{paddingX:a,autoFit:i,color:n,maxWidth:o,lineWidth:h}=this.options,s=this.state.data;if(!s)return;const l={},p={},c=[];S(s,(r,d,f)=>{var w;(w=r.payload)!=null&&w.fold||d(),l[r.state.id]=r,f&&(p[r.state.id]=f.state.id),c.push(r)});const u={},g={},m=r=>{!r||u[r.state.id]||S(r,(d,f)=>{u[d.state.id]=r.state.id,f()})},x=r=>g[u[r.state.id]]||s.state.rect,y=r=>(l[u[r.state.id]]||s).state.rect;g[s.state.id]=s.state.rect,t&&m(t);let{highlight:v}=this.state;v&&!l[v.state.id]&&(v=void 0);let b=this.g.selectAll(k(ue)).selectAll(k("rect")).data(v?[this._getHighlightRect(v)]:[]).join("rect").attr("x",r=>r.x).attr("y",r=>r.y).attr("width",r=>r.width).attr("height",r=>r.height);const z=this.g.selectAll(k(B)).each(r=>{g[r.state.id]=r.state.rect}).data(c,r=>r.state.key),H=z.enter().append("g").attr("data-depth",r=>r.state.depth).attr("data-path",r=>r.state.path).each(r=>{m(l[p[r.state.id]])}),C=z.exit().each(r=>{m(l[p[r.state.id]])}),X=z.merge(H).attr("class",r=>{var d;return["markmap-node",((d=r.payload)==null?void 0:d.fold)&&"markmap-fold"].filter(Boolean).join(" ")}),_=X.selectAll(k("line")).data(r=>[r],r=>r.state.key),L=_.enter().append("line").attr("stroke",r=>n(r)).attr("stroke-width",0),I=_.merge(L),T=X.selectAll(k("circle")).data(r=>{var d;return(d=r.children)!=null&&d.length?[r]:[]},r=>r.state.key),F=T.enter().append("circle").attr("stroke-width",0).attr("r",0).on("click",(r,d)=>this.handleClick(r,d)).on("mousedown",O).merge(T).attr("stroke",r=>n(r)).attr("fill",r=>{var d;return(d=r.payload)!=null&&d.fold&&r.children?n(r):"var(--markmap-circle-open-bg)"}),P=this._observer,W=X.selectAll(k("foreignObject")).data(r=>[r],r=>r.state.key),A=W.enter().append("foreignObject").attr("class","markmap-foreign").attr("x",a).attr("y",0).style("opacity",0).on("mousedown",O).on("dblclick",O);A.append("xhtml:div").append("xhtml:div").html(r=>r.content).attr("xmlns","http://www.w3.org/1999/xhtml"),A.each(function(){var r;const d=(r=this.firstChild)==null?void 0:r.firstChild;P.observe(d)});const N=C.selectAll(k("foreignObject"));N.each(function(){var r;const d=(r=this.firstChild)==null?void 0:r.firstChild;P.unobserve(d)});const K=A.merge(W),et=c.flatMap(r=>{var d;return(d=r.payload)!=null&&d.fold?[]:r.children.map(f=>({source:r,target:f}))}),$=this.g.selectAll(k(pe)).data(et,r=>r.target.state.key),rt=$.exit(),at=$.enter().insert("path","g").attr("class","markmap-link").attr("data-depth",r=>r.target.state.depth).attr("data-path",r=>r.target.state.path).attr("d",r=>{const d=x(r.target),f=[d.x+d.width,d.y+d.height];return D({source:f,target:f})}).attr("stroke-width",0).merge($);this.svg.style("--markmap-max-width",o?`${o}px`:null),await new Promise(requestAnimationFrame),this._relayout(),b=b.data(v?[this._getHighlightRect(v)]:[]).join("rect"),this.transition(b).attr("x",r=>r.x).attr("y",r=>r.y).attr("width",r=>r.width).attr("height",r=>r.height),H.attr("transform",r=>{const d=x(r);return`translate(${d.x+d.width-r.state.rect.width},${d.y+d.height-r.state.rect.height})`}),this.transition(C).attr("transform",r=>{const d=y(r),f=d.x+d.width-r.state.rect.width,w=d.y+d.height-r.state.rect.height;return`translate(${f},${w})`}).remove(),this.transition(X).attr("transform",r=>`translate(${r.state.rect.x},${r.state.rect.y})`);const it=C.selectAll(k("line"));this.transition(it).attr("x1",r=>r.state.rect.width).attr("stroke-width",0),L.attr("x1",r=>r.state.rect.width).attr("x2",r=>r.state.rect.width),I.attr("y1",r=>r.state.rect.height+h(r)/2).attr("y2",r=>r.state.rect.height+h(r)/2),this.transition(I).attr("x1",-1).attr("x2",r=>r.state.rect.width+2).attr("stroke",r=>n(r)).attr("stroke-width",h);const nt=C.selectAll(k("circle"));this.transition(nt).attr("r",0).attr("stroke-width",0),F.attr("cx",r=>r.state.rect.width).attr("cy",r=>r.state.rect.height+h(r)/2),this.transition(F).attr("r",6).attr("stroke-width","1.5"),this.transition(N).style("opacity",0),K.attr("width",r=>Math.max(0,r.state.rect.width-a*2)).attr("height",r=>r.state.rect.height),this.transition(K).style("opacity",1),this.transition(rt).attr("d",r=>{const d=y(r.target),f=[d.x+d.width,d.y+d.height+h(r.target)/2];return D({source:f,target:f})}).attr("stroke-width",0).remove(),this.transition(at).attr("stroke",r=>n(r.target)).attr("stroke-width",r=>h(r.target)).attr("d",r=>{const d=r.source,f=r.target,w=[d.state.rect.x+d.state.rect.width,d.state.rect.y+d.state.rect.height+h(d)/2],st=[f.state.rect.x,f.state.rect.y+f.state.rect.height+h(f)/2];return D({source:w,target:st})}),i&&this.fit()}transition(t){const{duration:a}=this.options;return t.transition().duration(a)}async fit(t=this.options.maxInitialScale){const a=this.svg.node(),{width:i,height:n}=a.getBoundingClientRect(),{fitRatio:o}=this.options,{x1:h,y1:s,x2:l,y2:p}=this.state.rect,c=l-h,u=p-s,g=Math.min(i/c*o,n/u*o,t),m=pt.translate((i-c*g)/2-h*g,(n-u*g)/2-s*g).scale(g);return this.transition(this.svg).call(this.zoom.transform,m).end().catch(j)}findElement(t){let a;return this.g.selectAll(k(B)).each(function(i){i===t&&(a={data:i,g:this})}),a}async ensureVisible(t,a){var i;const n=(i=this.findElement(t))==null?void 0:i.data;if(!n)return;const o=this.svg.node(),h=o.getBoundingClientRect(),s=E(o),[l,p]=[n.state.rect.x,n.state.rect.x+n.state.rect.width+2].map(b=>b*s.k+s.x),[c,u]=[n.state.rect.y,n.state.rect.y+n.state.rect.height].map(b=>b*s.k+s.y),g={left:0,right:0,top:0,bottom:0,...a},m=[g.left-l,h.width-g.right-p],x=[g.top-c,h.height-g.bottom-u],y=m[0]*m[1]>0?Y(m,Math.abs)/s.k:0,v=x[0]*x[1]>0?Y(x,Math.abs)/s.k:0;if(y||v){const b=s.translate(y,v);return this.transition(this.svg).call(this.zoom.transform,b).end().catch(j)}}async centerNode(t,a){var i;const n=(i=this.findElement(t))==null?void 0:i.data;if(!n)return;const o=this.svg.node(),h=o.getBoundingClientRect(),s=E(o),l=(n.state.rect.x+n.state.rect.width/2)*s.k+s.x,p=(n.state.rect.y+n.state.rect.height/2)*s.k+s.y,c={left:0,right:0,top:0,bottom:0,...a},u=(c.left+h.width-c.right)/2,g=(c.top+h.height-c.bottom)/2,m=(u-l)/s.k,x=(g-p)/s.k;if(m||x){const y=s.translate(m,x);return this.transition(this.svg).call(this.zoom.transform,y).end().catch(j)}}async rescale(t){const a=this.svg.node(),{width:i,height:n}=a.getBoundingClientRect(),o=i/2,h=n/2,s=E(a),l=s.translate((o-s.x)*(1-t)/s.k,(h-s.y)*(1-t)/s.k).scale(t);return this.transition(this.svg).call(this.zoom.transform,l).end().catch(j)}destroy(){this.svg.on(".zoom",null),this.svg.html(null),this._disposeList.forEach(t=>{t()})}static create(t,a,i=null){const n=new tt(t,a);return i&&n.setData(i).then(()=>{n.fit()}),n}}export{tt as i};
