function f(l){function p(n,c){const e=n.pos,t=n.src.charCodeAt(e);if(c||t!==43)return!1;const r=n.scanDelims(n.pos,!0);let i=r.length;const o=String.fromCharCode(t);if(i<2)return!1;if(i%2){const s=n.push("text","",0);s.content=o,i--}for(let s=0;s<i;s+=2){const u=n.push("text","",0);u.content=o+o,!(!r.can_open&&!r.can_close)&&n.delimiters.push({marker:t,length:0,jump:s/2,token:n.tokens.length-1,end:-1,open:r.can_open,close:r.can_close})}return n.pos+=r.length,!0}function k(n,c){let e;const t=[],r=c.length;for(let i=0;i<r;i++){const o=c[i];if(o.marker!==43||o.end===-1)continue;const s=c[o.end];e=n.tokens[o.token],e.type="ins_open",e.tag="ins",e.nesting=1,e.markup="++",e.content="",e=n.tokens[s.token],e.type="ins_close",e.tag="ins",e.nesting=-1,e.markup="++",e.content="",n.tokens[s.token-1].type==="text"&&n.tokens[s.token-1].content==="+"&&t.push(s.token-1)}for(;t.length;){const i=t.pop();let o=i+1;for(;o<n.tokens.length&&n.tokens[o].type==="ins_close";)o++;o--,i!==o&&(e=n.tokens[o],n.tokens[o]=n.tokens[i],n.tokens[i]=e)}}l.inline.ruler.before("emphasis","ins",p),l.inline.ruler2.before("emphasis","ins",function(n){const c=n.tokens_meta,e=(n.tokens_meta||[]).length;k(n,n.delimiters);for(let t=0;t<e;t++)c[t]&&c[t].delimiters&&k(n,c[t].delimiters)})}export{f as i};
