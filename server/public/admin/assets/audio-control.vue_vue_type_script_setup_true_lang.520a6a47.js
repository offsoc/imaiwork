import{a3 as pe,a as ve}from"./element-plus.e618cff3.js";import{p as T,f as h,_ as fe}from"./index.03099c94.js";import{d as me,b as N,r,w as ge,o as m,c as g,a as l,Q as v,H as x,u,O as f,V as j,P as B,a5 as q,W as H,L as X,J as I,n as J}from"./@vue.fa3e2f74.js";const he={class:"h-full flex items-center px-4 gap-8"},xe={class:"flex items-center gap-4"},_e={class:"grow relative"},ye={class:"absolute -bottom-[20px] left-0 text-[#27264d73] text-xs"},we={class:"w-full h-1 relative cursor-pointer progress-bar bg-primary-light-7 group"},be={class:"absolute top-0 left-0 w-full h-full flex"},Ee={class:"bg-primary-light-6 min-w-[4px] mx-[2px] relative h-full"},Te={class:"rounded-lg p-4 bg-primary-light-7 min-w-[400px] text-xs"},Ce={class:"flex gap-1"},ke={class:"text-[#585A73]"},De={class:"text-primary font-bold"},Fe={class:"text-[#585A73] mt-2 leading-[20px]"},$e={class:"absolute -bottom-[20px] right-0 text-[#27264d73] text-xs"},Ae={class:"min-w-[50px]"},Se={class:"text-primary cursor-pointer"},Be={class:"flex flex-col justify-center items-center gap-4"},Me=["onClick"],Re=me({__name:"audio-control",props:{music:{default:""},contentList:{default:[]}},emits:["play","pause","next","prev","end","update-time"],setup(O,{expose:Q,emit:G}){const _=G,C=O,c=N(()=>{const{contentList:e}=C;return e.map(t=>({...t,width:0}))}),k=r(null),D=r(null),y=r(!1),w=r("1.0"),K=["2.0","1.5","1.25","1.0","0.75"],M=N(()=>c.value.reduce((e,t)=>e+(t.End-t.Start),0)),U=(e,t)=>{if(e){const a=(e.End-e.Start)/M.value*100,p=c.value.slice(0,t).reduce((o,i)=>o+(i.End-i.Start),0)/M.value*100;return{width:`${a}%`,left:`${p}%`}}return{}},F=r(C.music),s=r(null),b=r(0);r(0);const d=r(!1),$=r("00:00"),L=r("00:00"),E=r(!1),z=r(!1),A=r(null),S=r("00:00"),P=async()=>{await J(),s.value&&(s.value.src=F.value,s.value.load())},Y=async e=>{F.value=e,await J(),P()},Z=()=>{s.value&&(E.value=!0,L.value=T(s.value.duration))},ee=()=>{d.value&&s.value&&s.value.play(),E.value=!1},te=()=>{z.value=!0,E.value=!1},se=()=>z.value||!F.value?(h.msgError("\u65E0\u6CD5\u64AD\u653E\u97F3\u4E50"),d.value=!1,!1):E.value?(h.msgError("\u64AD\u653E\u5668\u6B63\u5728\u52A0\u8F7D\uFF0C\u8BF7\u7A0D\u7B49"),d.value=!1,!1):s.value?!0:(h.msgError("\u64AD\u653E\u5668\u521D\u59CB\u5316\u5931\u8D25"),P(),d.value=!1,!1),le=()=>{var t;!se()||(d.value=!0,(t=s.value)==null||t.play(),_("play"))},oe=()=>{var e;_("pause"),d.value=!1,(e=s.value)==null||e.pause()},ae=()=>{d.value?oe():le()},ne=()=>{d.value=!1,_("end")},ue=e=>{var n;const t=document.querySelector(".progress-bar");if(t){const a=t.getBoundingClientRect(),p=e.clientX-a.left,o=p/a.width*(((n=s.value)==null?void 0:n.duration)||0);A.value=c.value.find(i=>o>=i.Start/1e3&&o<i.End/1e3)||{},S.value=T(o),k.value&&(k.value.style.left=`${p}px`),D.value&&(D.value.style.left=`${p}px`)}},re=e=>{var n;const t=document.querySelector(".progress-bar");if(t){const a=t.getBoundingClientRect(),o=(e.clientX-a.left)/a.width*100;b.value=o;const i=b.value/100*(((n=s.value)==null?void 0:n.duration)||0);R(i),V(i)}},R=e=>{c.value.forEach(t=>{let{Start:n,End:a}=t;n=Math.floor(n/1e3),a=Math.ceil(a/1e3),e>=a?t.width="100%":e>=n&&e<a?t.width=`${(e-n)/(a-n)*100}%`:t.width="0%"})},V=e=>{s.value&&(s.value.currentTime=e,$.value=T(e))},ie=()=>{var e;s.value&&($.value=T(s.value.currentTime),c.value.length>1?R(s.value.currentTime):b.value=s.value.currentTime/(((e=s.value)==null?void 0:e.duration)||0)*100||0,_("update-time",s.value.currentTime*1e3))},W=e=>{s.value?s.value.currentTime+=e:h.msgError("\u5F53\u524D\u97F3\u9891\u672A\u52A0\u8F7D")},ce=e=>{s.value?(w.value=e,s.value.playbackRate=Number(e)):h.msgError("\u5F53\u524D\u97F3\u9891\u672A\u52A0\u8F7D")};return ge(()=>C.music,e=>{e&&Y(e)},{immediate:!0}),Q({seek:V}),(e,t)=>{const n=fe,a=ve,p=pe;return m(),g(B,null,[l("div",he,[l("div",xe,[l("div",null,[v(a,{content:"\u540E\u90005\u79D2"},{default:x(()=>[l("div",{onClick:t[0]||(t[0]=o=>W(-5))},[v(n,{name:"local-icon-replay5",color:"var(--el-color-primary)",size:24})])]),_:1})]),l("button",{class:"w-9 h-9 flex items-center justify-center bg-primary rounded-full",onClick:t[1]||(t[1]=o=>ae())},[v(n,{name:u(d)?"local-icon-music_pause":"local-icon-music_play",color:"#ffffff",size:18},null,8,["name"])]),l("div",null,[v(a,{content:"\u5FEB\u8FDB5\u79D2"},{default:x(()=>[l("div",{onClick:t[2]||(t[2]=o=>W(5))},[v(n,{name:"local-icon-neplay5",color:"var(--el-color-primary)",size:24})])]),_:1})])]),l("div",_e,[l("div",ye,f(u($)),1),l("div",{class:"relative py-2 group",onMousemove:j(ue,["stop"]),onClick:re},[l("div",we,[l("div",be,[(m(!0),g(B,null,q(u(c),(o,i)=>(m(),g("div",{key:i,class:"h-full absolute top-0 hover:h-[6px] z-50",style:H(U(o,i)),onMousemove:t[3]||(t[3]=de=>y.value=!0),onMouseleave:t[4]||(t[4]=de=>y.value=!1)},[l("div",Ee,[l("div",{class:"absolute top-0 left-0 h-full bg-primary max-w-full",style:H({width:u(c).length==1?`${u(b)}%`:o.width})},null,4)])],36))),128))]),u(y)&&u(c).length>1?(m(),g("div",{key:0,class:"absolute -top-[20px] -translate-x-1/2 -translate-y-full",ref_key:"sectionTooltipRef",ref:D},[l("div",Te,[l("div",Ce,[l("span",ke,f(u(S)),1),l("span",De,f(u(A).Headline),1)]),l("div",Fe,f(u(A).Summary),1)])],512)):X("",!0)]),v(a,{content:u(S),placement:"top"},{default:x(()=>[l("div",{class:I(["absolute h-[16px] w-[2px] bg-primary -top-[4px] invisible group-hover:visible",{"z-[8888]":u(c).length==1}]),ref_key:"timeTooltipRef",ref:k,onMousemove:t[5]||(t[5]=j(o=>y.value=!1,["stop"]))},null,34)]),_:1},8,["content"])],32),l("div",$e,f(u(L)),1)]),l("div",Ae,[v(p,{placement:"top","popper-class":"!w-[90px] !min-w-[90px]"},{reference:x(()=>[l("div",Se,f(u(w)=="1.0"?"\u500D\u901F":`${u(w)}x`),1)]),default:x(()=>[l("div",Be,[(m(),g(B,null,q(K,o=>l("div",{class:I(["hover:text-primary cursor-pointer",{"text-primary":u(w)==o}]),onClick:i=>ce(o)},f(o)+"x ",11,Me)),64))])]),_:1})])]),e.music?(m(),g("audio",{key:0,ref_key:"audio",ref:s,class:"hidden",onEnded:ne,onTimeupdate:ie,onCanplay:ee,onLoadedmetadata:Z,onError:te},null,544)):X("",!0)],64)}}});export{Re as _};
