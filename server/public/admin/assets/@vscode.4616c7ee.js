import{k as C}from"./katex.42c635ec.js";var M=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function F(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function N(e){var n=e.default;if(typeof n=="function"){var c=function(){return n.apply(this,arguments)};c.prototype=n.prototype}else c={};return Object.defineProperty(c,"__esModule",{value:!0}),Object.keys(e).forEach(function(i){var l=Object.getOwnPropertyDescriptor(e,i);Object.defineProperty(c,i,l.get?l:{enumerable:!0,get:function(){return e[i]}})}),c}var B={},L=M&&M.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(B,"__esModule",{value:!0});const j=L(C.exports);function y(e,n){const c=e.src[n-1],i=e.src[n],l=e.src[n+1];if(i!=="$")return{can_open:!1,can_close:!1};let r=!1,t=!1;return c!=="$"&&c!=="\\"&&(c===void 0||x(c)||!S(c))&&(r=!0),l!=="$"&&(l==null||x(l)||!S(l))&&(t=!0),{can_open:r,can_close:t}}function x(e){return/^\s$/u.test(e)}function S(e){return/^[\w\d]$/u.test(e)}function w(e,n){const c=e.src[n-1],i=e.src[n],l=e.src[n+1],r=e.src[n+2];return i==="$"&&c!=="$"&&c!=="\\"&&l==="$"&&r!=="$"?{can_open:!0,can_close:!0}:{can_open:!1,can_close:!1}}function P(e,n){if(e.src[e.pos]!=="$")return!1;const c=e.tokens.at(-1);if((c==null?void 0:c.type)==="html_inline"&&/^<\w+.+[^/]>$/.test(c.content))return!1;let i=y(e,e.pos);if(!i.can_open)return n||(e.pending+="$"),e.pos+=1,!0;let l=e.pos+1,r=l,t;for(;(r=e.src.indexOf("$",r))!==-1;){for(t=r-1;e.src[t]==="\\";)t-=1;if((r-t)%2==1)break;r+=1}if(r===-1)return n||(e.pending+="$"),e.pos=l,!0;if(r-l===0)return n||(e.pending+="$$"),e.pos=l+1,!0;if(i=y(e,r),!i.can_close)return n||(e.pending+="$"),e.pos=l,!0;if(!n){const a=e.push("math_inline","math",0);a.markup="$",a.content=e.src.slice(l,r)}return e.pos=r+1,!0}function E(e,n,c,i){var l,r,t,a=!1,m,o=e.bMarks[n]+e.tShift[n],f=e.eMarks[n];if(o+2>f||e.src.slice(o,o+2)!=="$$")return!1;o+=2;let k=e.src.slice(o,f);if(i)return!0;for(k.trim().slice(-2)==="$$"&&(k=k.trim().slice(0,-2),a=!0),r=n;!a&&(r++,!(r>=c||(o=e.bMarks[r]+e.tShift[r],f=e.eMarks[r],o<f&&e.tShift[r]<e.blkIndent)));)e.src.slice(o,f).trim().slice(-2)==="$$"?(t=e.src.slice(0,f).lastIndexOf("$$"),l=e.src.slice(o,t),a=!0):e.src.slice(o,f).trim().includes("$$")&&(t=e.src.slice(0,f).trim().indexOf("$$"),l=e.src.slice(o,t),a=!0);return e.line=r+1,m=e.push("math_block","math",0),m.block=!0,m.content=(k&&k.trim()?k+`
`:"")+e.getLines(n+1,r,e.tShift[n],!0)+(l&&l.trim()?l:""),m.map=[n,e.line],m.markup="$$",!0}function D(e,n,c,i){const l=e.bMarks[n]+e.tShift[n],r=e.eMarks[n];if(!e.src.slice(l,r).match(/^\s*\\begin\s*\{([^{}]+)\}/))return!1;if(n>0){const _=e.bMarks[n-1]+e.tShift[n-1],u=e.eMarks[n-1],h=e.src.slice(_,u);if(!/^\s*$/.test(h))return!1}if(i)return!0;const m=[];let o=n,f,k=!1;e:for(;!k&&!(o>=c);o++){const _=e.bMarks[o]+e.tShift[o],u=e.eMarks[o];if(_<u&&e.tShift[o]<e.blkIndent)break;const h=e.src.slice(_,u);for(const s of h.matchAll(/(\\begin|\\end)\s*\{([^{}]+)\}/g))if(s[1]==="\\begin")m.push(s[2].trim());else if(s[1]==="\\end"&&(m.pop(),!m.length)){f=e.src.slice(_,u),k=!0;break e}}e.line=o+1;const p=e.push("math_block","math",0);return p.block=!0,p.content=(e.getLines(n,o,e.tShift[n],!0)+(f!=null?f:"")).trim(),p.map=[n,e.line],p.markup="$$",!0}function H(e,n){var c,i,l,r,t;if(e.src.slice(e.pos,e.pos+2)!=="$$")return!1;if(r=w(e,e.pos),!r.can_open)return n||(e.pending+="$$"),e.pos+=2,!0;for(c=e.pos+2,i=c;(i=e.src.indexOf("$$",i))!==-1;){for(t=i-1;e.src[t]==="\\";)t-=1;if((i-t)%2==1)break;i+=2}return i===-1?(n||(e.pending+="$$"),e.pos=c,!0):i-c===0?(n||(e.pending+="$$$$"),e.pos=c+2,!0):(r=w(e,i),r.can_close?(n||(l=e.push("math_block","math",0),l.block=!0,l.markup="$$",l.content=e.src.slice(c,i)),e.pos=i+2,!0):(n||(e.pending+="$$"),e.pos=c,!0))}function T(e,n){const c=e.src.slice(e.pos);if(!/^\n\\begin/.test(c))return!1;if(e.pos+=1,n)return!0;const i=c.split(/\n/g).slice(1);let l;const r=[];e:for(var t=0;t<i.length;++t){const o=i[t];for(const f of o.matchAll(/(\\begin|\\end)\s*\{([^{}]+)\}/g))if(f[1]==="\\begin")r.push(f[2].trim());else if(f[1]==="\\end"&&(r.pop(),!r.length)){l=t;break e}}if(typeof l>"u")return!1;const a=i.slice(0,l+1).reduce((o,f)=>o+f.length,0)+l+1,m=e.push("math_inline_bare_block","math",0);return m.block=!0,m.markup="$$",m.content=c.slice(1,a),e.pos=e.pos+a,!0}function v(e,n,c,i){const l=e.tokens;for(let r=l.length-1;r>=0;r--){const t=l[r],a=[];if(t.type!=="html_block")continue;const m=t.content;for(const o of m.matchAll(i)){if(!o.groups)continue;const f=o.groups.html_before_math,k=o.groups.math,p=o.groups.html_after_math;f&&a.push({...t,type:"html_block",map:null,content:f}),k&&a.push({...t,type:n,map:null,content:k,markup:c,block:!0,tag:"math"}),p&&a.push({...t,type:"html_block",map:null,content:p})}a.length>0&&l.splice(r,1,...a)}return!0}function $(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function q(e,n){var _;const c=(_=n==null?void 0:n.katex)!=null?_:j.default,i=n==null?void 0:n.enableBareBlocks,l=n==null?void 0:n.enableMathBlockInHtml,r=n==null?void 0:n.enableMathInlineInHtml,t=n==null?void 0:n.enableFencedBlocks;e.inline.ruler.after("escape","math_inline",P),e.inline.ruler.after("escape","math_inline_block",H),i&&e.inline.ruler.before("text","math_inline_bare_block",T),e.block.ruler.after("blockquote","math_block",(u,h,s,b)=>i&&D(u,h,s,b)?!0:E(u,h,s,b),{alt:["paragraph","reference","blockquote","list"]});const a=/(?<html_before_math>[\s\S]*?)\$\$(?<math>[\s\S]+?)\$\$(?<html_after_math>(?:(?!\$\$[\s\S]+?\$\$)[\s\S])*)/gm,m=/(?<html_before_math>[\s\S]*?)\$(?<math>.*?)\$(?<html_after_math>(?:(?!\$.*?\$)[\s\S])*)/gm;l&&e.core.ruler.push("math_block_in_html_block",u=>v(u,"math_block","$$",a)),r&&e.core.ruler.push("math_inline_in_html_block",u=>v(u,"math_inline","$",m));const o=u=>{const h=/\\begin\{(align|equation|gather|cd|alignat)\}/ig.test(u);try{return c.renderToString(u,{...n,displayMode:h})}catch(s){return n!=null&&n.throwOnError&&console.log(s),`<span class="katex-error" title="${$(u)}">${$(s+"")}</span>`}},f=(u,h)=>{const s=u[h].content,d=s.length>2&&s[0]==="`"&&s[s.length-1]==="`"?s.slice(1,-1):s;return o(d)},k=u=>{try{return`<p class="katex-block">${c.renderToString(u,{...n,displayMode:!0})}</p>`}catch(h){return n!=null&&n.throwOnError&&console.log(h),`<p class="katex-block katex-error" title="${$(u)}">${$(h+"")}</p>`}},p=(u,h)=>k(u[h].content)+`
`;if(e.renderer.rules.math_inline=f,e.renderer.rules.math_inline_block=p,e.renderer.rules.math_inline_bare_block=p,e.renderer.rules.math_block=p,t){const u="math",h=e.renderer.rules.fence;e.renderer.rules.fence=function(s,b,d,O,I){const g=s[b];return g.info.trim().toLowerCase()===u&&t?k(g.content)+`
`:(h==null?void 0:h.call(this,s,b,d,O,I))||""}}}var R=B.default=q;export{R as _,N as a,M as c,F as g};
