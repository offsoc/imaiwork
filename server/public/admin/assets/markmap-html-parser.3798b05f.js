import{l as I}from"./cheerio.dde8322c.js";import{w as M}from"./markmap-common.ee5358ff.js";const $={"div,p":({$node:e})=>({queue:e.children()}),"h1,h2,h3,h4,h5,h6":({$node:e,getContent:n})=>({...n(e.contents())}),"ul,ol":({$node:e})=>({queue:e.children(),nesting:!0}),li:({$node:e,getContent:n})=>{const s=e.children().filter("ul,ol");let r;if(e.contents().first().is("div,p"))r=n(e.children().first());else{let u=e.contents();const h=u.index(s);h>=0&&(u=u.slice(0,h)),r=n(u)}return{queue:s,nesting:!0,...r}},"table,pre,p>img:only-child":({$node:e,getContent:n})=>({...n(e)})},H={selector:"h1,h2,h3,h4,h5,h6,ul,ol,li,table,pre,p>img:only-child",selectorRules:$},b="markmap: ",x=/^h[1-6]$/,A=/^[uo]l$/,w=/^li$/;function j(e){return x.test(e)?+e[1]:A.test(e)?8:w.test(e)?9:7}function P(e,n){const s={...H,...n},r=I(e),u=r("body");let h=0;const E={id:h,tag:"",html:"",level:0,parent:0,childrenLevel:0,children:[]},m=[];let v=0;return g(u.children()),E;function C(t){var l;const{parent:c}=t,i={id:++h,tag:t.tagName,level:t.level,html:t.html,childrenLevel:0,children:t.nesting?[]:void 0,parent:c.id};return(l=t.comments)!=null&&l.length&&(i.comments=t.comments),Object.keys(t.data||{}).length&&(i.data=t.data),c.children&&((c.childrenLevel===0||c.childrenLevel>i.level)&&(c.children=[],c.childrenLevel=i.level),c.childrenLevel===i.level&&c.children.push(i)),i}function O(t){let l;for(;(l=m[m.length-1])&&l.level>=t;)m.pop();return l||E}function S(t){var l;const c=k(t),i=(l=r.html(c.$node))==null?void 0:l.trimEnd();return{comments:c.comments,html:i}}function k(t){const l=[];return t=t.filter((c,i)=>{if(i.type==="comment"){const f=i.data.trim();if(f.startsWith(b))return l.push(f.slice(b.length).trim()),!1}return!0}),{$node:t,comments:l}}function g(t,l){t.each((c,i)=>{var f;const a=r(i),_=(f=Object.entries(s.selectorRules).find(([T])=>a.is(T)))==null?void 0:f[1],o=_==null?void 0:_({$node:a,$:r,getContent:S});if((o==null?void 0:o.queue)&&!o.nesting){g(o.queue,l);return}const d=j(i.tagName);if(!o){d<=6&&(v=d);return}if(v>0&&d>v||!a.is(s.selector))return;v=0;const y=d<=6;let p={...a.closest("p").data(),...a.data()},L=o.html||"";if(a.is("ol>li")&&(l==null?void 0:l.children)){const q=+(a.parent().attr("start")||1)+l.children.length;L=`${q}. ${L}`,p={...p,listIndex:q}}const R=C({parent:l||O(d),nesting:!!o.queue||y,tagName:i.tagName,level:d,html:L,comments:o.comments,data:p});y&&m.push(R),o.queue&&g(o.queue,R)})}}function D(e){return M(e,(n,s)=>{const r={content:n.html,children:s()||[]};return n.data&&(r.payload={tag:n.tag,...n.data}),n.comments&&(n.comments.includes("foldAll")?r.payload={...r.payload,fold:2}:n.comments.includes("fold")&&(r.payload={...r.payload,fold:1})),r})}function K(e,n){const s=P(e,n);return D(s)}export{K as b};
