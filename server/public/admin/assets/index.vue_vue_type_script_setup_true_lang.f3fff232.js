import{O,P as V,I as j}from"./element-plus.09e738c5.js";import{f as h,d as $}from"./index.1bd46af0.js";import{d as I,s as N,r as v,b as U,w as q,o as c,c as p,P as F,a7 as z,a5 as E,G as w,C as G,aj as K,ak as M,D as H,u,v as y,F as J,a as f,O as Q,M as T,K as W}from"./@vue.b0c8b5fa.js";const X={class:"upload"},Y={class:"file-list p-4"},Z={class:"flex-1"},ae=I({__name:"index",props:{files:{type:Array,default:()=>[]},type:{type:String,default:"image"},multiple:{type:Boolean,default:!0},limit:{type:Number,default:10},data:{type:Object,default:()=>({})},name:{type:String,default:"file"},header:{type:Object,default:()=>({})},showFileList:{type:Boolean,default:!1}},emits:["end","change","error","success","update:files"],setup(i,{emit:_}){const l=i,n=_,g=N(),r=v(!1),s=v([]),b=()=>{r.value=!0},m=e=>{n("change",e),s.value.length==0&&n("end")},k=(e,t)=>{m(t),n("success",e),n("update:files",[...l.files,{url:e.uri,name:e.name}]);const a=s.value.indexOf(t);!l.showFileList&&s.value.splice(a,1)},x=e=>{const t=s.value.indexOf(e),a=l.files;a.splice(t,1),n("update:files",[...a])},A=(e,t)=>{var a;m(t),h.msgError(`${t.name}\u6587\u4EF6\u4E0A\u4F20\u5931\u8D25`),(a=g.value)==null||a.abort(t),r.value=!1,n("error",t)},B=()=>{h.msgError(`\u8D85\u51FA\u4E0A\u4F20\u4E0A\u9650${l.limit}\uFF0C\u8BF7\u91CD\u65B0\u4E0A\u4F20`)},C=()=>{s.value=[],r.value=!1},P=U(()=>{switch(l.type){case"image":return".jpg,.png,.gif,.jpeg";case"video":return".wmv,.avi,.mpg,.mpeg,.3gp,.mov,.mp4,.flv,.rmvb,.mkv";case"audio":return".mp3,.m4a,.wav,.mov";default:return"*"}}),D=e=>$(l.type,{file:e.file,name:l.name,header:l.header,data:l.data},t=>{const a=t;a.percent=t.total>0?t.loaded/t.total*100:0,e.onProgress(a)});return q(()=>l.files,e=>{!s.value.length&&(e==null?void 0:e.length)&&(s.value=[...e])},{immediate:!0}),(e,t)=>{const a=O,L=V,R=j;return c(),p("div",X,[F(a,H({"file-list":u(s),"onUpdate:fileList":t[0]||(t[0]=o=>y(s)?s.value=o:null),ref_key:"uploadRefs",ref:g},e.$attrs,{multiple:i.multiple,limit:i.limit,"show-file-list":i.showFileList,"on-progress":b,"on-success":k,"on-exceed":B,"on-error":A,accept:u(P),"on-change":m,"on-remove":x,"http-request":D}),z({_:2},[E(e.$slots,(o,d)=>({name:d,fn:w(S=>[G(e.$slots,d,K(M(S)))])}))]),1040,["file-list","multiple","limit","show-file-list","accept"]),!i.showFileList&&u(s).length?(c(),J(R,{key:0,modelValue:u(r),"onUpdate:modelValue":t[1]||(t[1]=o=>y(r)?r.value=o:null),title:"\u4E0A\u4F20\u8FDB\u5EA6","close-on-click-modal":!1,width:"500px",modal:!1,onClose:C},{default:w(()=>[f("div",Y,[(c(!0),p(Q,null,E(u(s),(o,d)=>(c(),p("div",{key:d,class:"mb-5"},[f("div",null,T(o.name),1),f("div",Z,[F(L,{percentage:parseInt(String(o.percentage))},null,8,["percentage"])])]))),128))])]),_:1},8,["modelValue"])):W("",!0)])}}});export{ae as _};
