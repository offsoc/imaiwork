"use strict";const e=require("../../common/vendor.js"),r=require("./http.js"),t=require("../auth.js"),s=require("../../enums/requestEnums.js"),o=require("../../stores/user.js"),n=require("../../router/index.js"),u=require("../../config/index.js"),i={requestInterceptorsHook(e,r){const{urlPrefix:t,baseUrl:s,withToken:n}=r;e.header=e.header||{},t&&(e.url=`${t}${e.url}`),s&&(e.url=`${s}${e.url}`);const i=o.useUserStore().token||null;return n&&!e.header.token&&(e.header.token=i),e.header.version=u.config.version,e},async responseInterceptorsHook(r,u,i){const{isTransformResponse:a,isReturnDefaultResponse:c,isAuth:d}=u;if(c)return r;if(!a)return r.data;const{logout:l}=o.useUserStore(),{code:m,data:h,msg:p,show:q}=r.data;switch(m){case s.RequestCodeEnum.SUCCESS:return p&&q&&e.index.$u.toast(p),h;case s.RequestCodeEnum.FAILED:return p&&q&&e.index.$u.toast(p),Promise.reject(p);case s.RequestCodeEnum.TOKEN_INVALID:return l(),(d||n.router.currentRoute.value.path.indexOf("ai_modules")>-1)&&!t.getToken()&&n.router.navigateTo({path:"/pages/login/login"}),Promise.reject(p);default:return h}},async responseInterceptorsCatchHook(r,t){var o;return(null==(o=r.method)?void 0:o.toUpperCase())==s.RequestMethodsEnum.POST&&e.index.$u.toast("请求失败，请重试"),t.errMsg||t}},a={requestOptions:{timeout:u.config.timeout},baseUrl:u.config.baseUrl,isReturnDefaultResponse:!1,isTransformResponse:!0,urlPrefix:u.config.urlPrefix,ignoreCancel:!1,withToken:!0,isAuth:!1,retryCount:2,retryTimeout:1e3,requestHooks:i};const c=new r.HttpRequest(e.merge(a,d||{}));var d;exports.request=c;
