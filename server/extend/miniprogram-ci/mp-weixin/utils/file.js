"use strict";const e=require("../common/vendor.js"),t=t=>new Promise(((i,o)=>{e.index.getSetting({success:n=>{n.authSetting[t]?i(!0):e.index.authorize({scope:t,success:()=>{i(!0)},fail:async n=>{try{if((await e.index.showModal({title:"提示",content:"您关闭了权限，需要前往设置页面打开权限才能继续使用该功能。",confirmText:"去设置",cancelText:"取消"})).confirm){const o=await e.index.openSetting();o.authSetting&&o.authSetting[t]?i(!0):i(!1)}else i(!1)}catch(s){o(s)}}})}})}));e.ref(!1),exports.requestAuthorization=t,exports.saveVideoToPhotosAlbum=async function(i){try{if(!(await t("scope.writePhotosAlbum")))return void e.index.$u.toast("您关闭了权限，请前往设置打开权限");e.index.showLoading({title:"下载中"});const{tempFilePath:o}=await e.index.downloadFile({url:i});await e.index.saveVideoToPhotosAlbum({filePath:o}),e.index.hideLoading(),e.index.showToast({title:"保存成功",icon:"success",duration:3e3})}catch(o){e.index.hideLoading(),e.index.showToast({title:"保存失败",icon:"none",duration:3e3})}};
