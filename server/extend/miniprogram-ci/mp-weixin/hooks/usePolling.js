"use strict";const e=require("../common/vendor.js");let t={};exports.usePolling=function(n,l){const{key:u,time:o=2e3,totalTime:r,count:c,callback:i=(()=>!1)}=l;let s=null,a=null,d=0,f=!1;const m=e.ref(null),v=e.ref(null);function T(){if(!f){if(a&&a<=Date.now())return h(),void i();if(c&&d>=c)return h(),void i();d++,s=setTimeout((()=>{n().then((e=>{m.value=e,T()})).catch((e=>{v.value=e}))}),o)}}const h=()=>{s&&(clearTimeout(s),s=null,a=null,d=0,f=!0,u&&delete t[u])};return{start:()=>{f=!1,h(),u&&t[u]&&(t[u].end(),delete t[u]),a=r?Date.now()+r:null,T(),u&&(t[u]={end:h})},end:h,error:v,result:m}};
