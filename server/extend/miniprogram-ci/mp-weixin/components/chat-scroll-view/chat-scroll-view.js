"use strict";const e=require("../../common/vendor.js"),t=require("../../utils/util.js"),s=require("../../hooks/useKeyboardHeight.js");if(require("../../stores/navigationBarTitle.js"),require("../../router/index.js"),require("../../stores/user.js"),require("../../api/user.js"),require("../../utils/request/index.js"),require("../../utils/request/http.js"),require("../../enums/requestEnums.js"),require("../../utils/request/cancel.js"),require("../../utils/auth.js"),require("../../enums/constantEnums.js"),require("../../utils/cache.js"),require("../../config/index.js"),require("../../hooks/useShareMessage.js"),require("../../stores/app.js"),require("../../api/app.js"),require("../../api/chat.js"),require("../../api/voice_chat.js"),!Array){(e.resolveComponent("chat-record-item")+e.resolveComponent("u-icon")+e.resolveComponent("u-line"))()}Math||((()=>"../chat-record-item/chat-record-item.js")+(()=>"../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../uni_modules/vk-uview-ui/components/u-line/u-line.js")+n)();const n=()=>"../knb-select/knb-select.js",i=e.defineComponent({__name:"chat-scroll-view",props:{contentList:{default:()=>[]},placeholder:{default:"在这里输入任何问题 ..."},sendDisabled:{type:Boolean,default:!1},tokens:{default:0},isStop:{type:Boolean,default:!1},isDeep:{type:Boolean,default:!1},isNetwork:{type:Boolean,default:!1},isStaff:{type:Boolean,default:!1}},emits:["update:modelValue","contentPost","close","add-session","update:fileLists","update:deep","update:network","confirmKnb"],setup(n,{expose:i,emit:o}){const r=n,a=e.ref(!1);e.ref(!1);const u=()=>{a.value=!a.value,o("update:deep",a.value)},l=e.shallowRef(),c=e.ref({}),p=e.ref(!1),d=()=>{var e;p.value=!0,null==(e=l.value)||e.open(c.value)},f=e=>{c.value=e.data,o("confirmKnb",e)},m=e.ref([]);e.shallowRef();const v=e.ref(""),g=e.ref(0),{dynamicHeight:h}=s.useKeyboardHeight(),j=e.ref(!1),q=()=>{j.value=!0},y=()=>{""!=v.value.replace(/(^\s*)|(\s*$)/g,"")?r.sendDisabled||(o("contentPost",v.value),e.nextTick$1((()=>{k()})),w(),v.value="",m.value=[]):e.index.$u.toast("输入为空")},b=()=>{o("close")},{proxy:x}=e.getCurrentInstance(),k=async()=>{await e.nextTick$1(),t.getRect(".content-box",!1,x).then((e=>{g.value=e.height}))};e.computed((()=>1-m.value.filter((e=>t.isImageUrl(e.url))).length));const _=e.shallowRef(),w=()=>{var t,s;(null==(t=_.value)?void 0:t.blur)&&(null==(s=_.value)||s.blur()),e.index.hideKeyboard()};e.ref();const B=e.ref(0);return e.onMounted((()=>{(async()=>{await e.nextTick$1();const{safeAreaInsets:s}=e.index.$u.sys();t.getRect(".chatBottomBox",!1,x).then((e=>{B.value=e.height+s.bottom+100}))})()})),e.onUnmounted((()=>{b()})),i({scrollToBottom:k,setUserInput:(e="")=>{v.value=e}}),(t,s)=>e.e({a:n.contentList.length},n.contentList.length?e.e({b:n.contentList.length},n.contentList.length?{c:e.f(n.contentList,((t,s,n)=>({a:"50638bd3-0-"+n,b:e.p({type:t.type,avatar:t.form_avatar,content:1==t.type?t.message:t.reply,"reasoning-content":t.reasoning_content,"is-reasoning-finished":t.is_reasoning_finished,loading:t.loading,"consume-tokens":t.consume_tokens,"file-lists":t.fileLists,index:s,"is-markdown":2==t.type,showCopyBtn:2==t.type}),c:`${t.id} + ${s} + ''`})))}:{},{d:e.unref(g),e:e.o((e=>{o("add-session")}))}):{},{f:n.isStaff?1:"",g:e.unref(j)?"120rpx":"0",h:n.placeholder,i:e.o(q),j:e.o((e=>j.value=!1)),k:e.unref(v),l:e.o((t=>e.isRef(v)?v.value=t.detail.value:null)),m:n.isStop},n.isStop?{n:e.p({name:"/static/images/icons/chat_stop.svg",size:36}),o:e.o(b)}:e.e({p:e.unref(v).trim()},e.unref(v).trim()?{q:e.p({name:"/static/images/icons/arrow_up_primary.svg",size:36})}:{r:e.p({name:"/static/images/icons/arrow_up.svg",size:36})},{s:e.n(e.unref(v).trim()?"bg-primary-light-9":"bg-_hF2F2F2_"),t:e.o(y)}),{v:n.isDeep},n.isDeep?{w:e.p({name:"/static/images/icons/deep.svg",size:28}),x:e.unref(a)?1:"",y:e.o(u)}:{},{z:e.p({direction:"vertical",color:"#F1F1F2"}),A:e.p({name:"/static/images/icons/note_book.svg",size:28}),B:e.unref(p)&&e.unref(c).id?1:"",C:e.o(d),D:e.p({name:"/static/images/icons/tips.svg",size:32}),E:0==n.contentList.length?1:"",F:n.contentList.length||n.isStaff?e.unref(h)+"px":e.unref(h)-e.unref(B)+"px",G:e.sr(l,"50638bd3-8",{k:"knbSelectRef"}),H:e.o(f),I:e.o((e=>p.value=!1))})}}),o=e._export_sfc(i,[["__scopeId","data-v-50638bd3"]]);wx.createComponent(o);
