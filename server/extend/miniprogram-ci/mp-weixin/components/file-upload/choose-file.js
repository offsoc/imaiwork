"use strict";const e=require("../../common/vendor.js"),t="chooseFile:fail";function s(e,t){return e.tempFiles.forEach((e=>{e.name||(e.name=e.tempFilePath.substring(e.tempFilePath.lastIndexOf("/")+1)),t&&(e.fileType=t)})),e.tempFilePaths||(e.tempFilePaths=e.tempFiles.map((e=>e.tempFilePath))),e}const i=e=>{const t=e.lastIndexOf("."),s=e.length;return{name:e.substring(0,t),ext:e.substring(t+1,s)}};exports.chooseFile=function(i={type:"file"}){return"image"===i.type?function(i){const{count:n,sizeType:o=["original","compressed"],sourceType:r}=i;return new Promise(((i,a)=>{e.index.chooseMedia({count:n,sizeType:o,sourceType:r,success(e){const t={tempFilePaths:e.tempFiles.map((e=>e.tempFilePath)),tempFiles:e.tempFiles,failedCount:0,errMsg:e.errMsg};i(s(t,"image"))},fail(e){a({errMsg:e.errMsg.replace("chooseImage:fail",t)})}})}))}(i):"video"===i.type?function(i){const{count:n,camera:o,maxDuration:r,sourceType:a}=i;return new Promise(((i,l)=>{e.index.chooseMedia({count:n,mediaType:["video"],camera:o,maxDuration:r,sourceType:a,success(e){i(s(e,"video"))},fail(e){l({errMsg:e.errMsg.replace("chooseVideo:fail",t)})}})}))}(i):function(i){const{count:n,extension:o,type:r}=i;return new Promise(((i,a)=>{let l=e.index.chooseFile;if(void 0!==e.wx$1&&"function"==typeof e.wx$1.chooseMessageFile&&(l=e.wx$1.chooseMessageFile),"function"!=typeof l)return a({errMsg:t+" 请指定 type 类型，该平台仅支持选择 image 或 video。"});l({type:r,count:n,extension:o,success(e){i(s(e))},fail(s){112==s.errno&&e.index.$u.toast("请到微信小程序后台完善用户隐私保护指引"),a({errMsg:s.errMsg.replace("chooseFile:fail",t)})}})}))}(i)},exports.getFileName=e=>{const t=e.lastIndexOf("."),s=e.lastIndexOf("/");return-1===t?e:e.substring(s+1)},exports.getFilesByExtname=(t,s=[])=>{const n=[],o=[];return s.length?(t.tempFiles.forEach((e=>{const t=i(e.name).ext.toLowerCase();-1!==s.indexOf(t)&&(o.push(e),n.push(e.path))})),o.length!==t.tempFiles.length&&e.index.showToast({title:`当前选择了${t.tempFiles.length}个文件 ，${t.tempFiles.length-o.length} 个文件格式不正确`,icon:"none",duration:5e3}),{filePaths:n,files:o}):{filePaths:t.tempFilePaths,files:t.tempFiles}},exports.normalizeFileData=e=>{const t=i(e.name).ext.toLowerCase();return{name:e.name,uuid:e.uuid,extname:t||"",fileType:e.fileType,path:e.tempFilePath||e.path,url:e.tempFilePath||e.path,size:e.size,progress:0,status:"ready",errMsg:""}};
