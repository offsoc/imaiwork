"use strict";const e=require("../../../common/vendor.js"),t=require("../../../common/assets.js"),r=require("../../../api/recharge.js"),i=require("../../../api/user.js"),s=require("../../../utils/pay/index.js"),a=require("../../../hooks/useLockFn.js"),n=require("../../../enums/appEnums.js"),o=require("../../../stores/user.js"),u=require("../../../utils/util.js"),c=require("../../../utils/client.js"),l=require("../../../stores/app.js"),p=require("../../../config/index.js");if(require("../../../utils/request/index.js"),require("../../../utils/request/http.js"),require("../../../enums/requestEnums.js"),require("../../../utils/request/cancel.js"),require("../../../utils/auth.js"),require("../../../enums/constantEnums.js"),require("../../../utils/cache.js"),require("../../../router/index.js"),require("../../../utils/pay/alipay.js"),require("../../../utils/pay/balance.js"),require("../../../utils/pay/pay.js"),require("../../../utils/pay/wechat.js"),require("../../../utils/pay/e_wechat.js"),require("../../../utils/pay/e_alipay.js"),require("../../../hooks/useShareMessage.js"),require("../../../stores/navigationBarTitle.js"),require("../../../api/app.js"),require("../../../api/chat.js"),require("../../../api/voice_chat.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-button")+e.resolveComponent("u-checkbox")+e.resolveComponent("empty")+e.resolveComponent("z-paging")+e.resolveComponent("popup-bottom"))()}Math||((()=>"../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-checkbox/u-checkbox.js")+(()=>"../../../components/empty/empty.js")+(()=>"../../../node-modules/z-paging/components/z-paging/z-paging.js")+(()=>"../../../components/popup-bottom/popup-bottom.js"))();const d=e.defineComponent({__name:"recharge",setup(d){const f=l.useAppStore(),g=o.useUserStore(),m=e.computed((()=>g.userTokens)),h=e.computed((()=>f.getCardCodeConfig)),_=e.computed((()=>{const{customer_service:e}=f.getWebsiteConfig;return{qrcode:null==e?void 0:e.wx_image}})),y=e.computed((()=>b.value.find((e=>e.id==q.value)))),v=e.ref(!0),j=e.ref(!0),b=e.ref([]),q=e.ref(-1),x="tokens",k=e.ref(-1),w=e.ref([]),F=async()=>{const{lists:e}=await r.getPaymentList({from:x});e&&e.length&&(w.value=e,k.value=w.value[0].id)},C=u.series((async()=>{e.index.showLoading({title:"创建订单中"});try{const t=await r.createRechargeOrder({type:1,package_id:y.value.id});return e.index.hideLoading(),t}catch(t){return e.index.hideLoading(),e.index.showToast({icon:"none",title:t||"创建订单失败",duration:3e3}),Promise.reject(t)}}),(async t=>{e.index.showLoading({title:"正在支付中"});try{return await r.prePay({order_id:t.order_id,from:x,pay_way:k.value})}catch(i){return e.index.hideLoading(),e.index.showToast({title:i||"支付失败",icon:"none",duration:3e3}),Promise.reject(i)}}),(async t=>{try{return await s.pay.payment(t.pay_way,t.config)}catch(r){return e.index.showToast({title:r||"支付失败",icon:"none",duration:5e3}),Promise.reject(r)}})),{isLock:L,lockFn:S}=a.useLockFn((async()=>{try{const e=await C();z(e)}catch(t){e.index.hideLoading(),e.index.showToast({title:t||"支付失败",icon:"none",duration:3e3})}})),z=t=>{switch(t){case n.PayStatusEnum.SUCCESS:e.index.$u.toast("购买成功"),g.getUser();case n.PayStatusEnum.FAIL:}},$=e.ref(!1),P=e.ref([]),U=e.shallowRef(),E=async(e,t)=>{var r,s;try{const{lists:s}=await i.accountLog({page_no:e,page_size:t,type:"tokens",is_order:1,action:1});null==(r=U.value)||r.complete(s)}catch(a){null==(s=U.value)||s.complete([])}};return(async()=>{const{lists:e}=await r.getRechargeList({type:1});F(),b.value=e,j.value=!1,e&&e.length&&(q.value=e[0].id)})(),(r,i)=>e.e({a:e.p({"border-bottom":!1,"is-fixed":!1,background:{background:"transparent"},"back-icon-color":"#ffffff","title-color":"#ffffff",title:"充值中心","title-bold":!0}),b:e.t(e.unref(m)),c:`url(${e.unref(p.config).baseUrl}static/images/recharge_img1.png)`,d:e.unref(c.isIOS)()},e.unref(c.isIOS)()?{e:t._imports_0$1,f:t._imports_0$1,g:`url(${e.unref(p.config).baseUrl}static/images/recharge_qrcode_bg.png)`,h:e.unref(_).qrcode,i:e.o((e=>$.value=!0)),j:e.p({type:"primary",shape:"circle","custom-style":{height:"90rpx",fontSize:"26rpx"}})}:e.e({k:t._imports_1,l:e.f(e.unref(b),((r,i,s)=>e.e({a:e.t(r.price),b:e.n(e.unref(q)==r.id?"text-_hFF9500_":"text-white"),c:e.n(e.unref(q)==r.id?"text-_hFF9500_":"text-_h808080_"),d:e.unref(q)==r.id},e.unref(q)==r.id?{e:t._imports_2}:{f:t._imports_0$2},{g:e.t(r.package_info.tokens),h:e.n(e.unref(q)==r.id?"text-_hFF9500_":"text-_h16F49F_"),i:e.n(e.unref(q)==r.id?"border-_h624E35_ bg-_hff95001a_":"bg-_h16f49f1a_ border-_h16f49f33_"),j:i,k:e.unref(q)==r.id?`url(${e.unref(p.config).baseUrl}static/images/recharge_tokens_item_active_bg.png)`:`url(${e.unref(p.config).baseUrl}static/images/recharge_tokens_item_bg.png)`,l:e.o((e=>{return t=r.id,void(q.value=t);var t}),i)}))),m:`url(${e.unref(p.config).baseUrl}static/images/recharge_box_bg.png)`,n:e.o((t=>e.isRef(v)?v.value=t:null)),o:e.p({shape:"circle",size:"28",modelValue:e.unref(v)}),p:1==e.unref(h).is_open},(e.unref(h).is_open,{}),{q:e.o(e.unref(S)),r:e.p({type:"primary",shape:"circle",loading:e.unref(L),"custom-style":{height:"100rpx",fontSize:"26rpx"}}),s:e.o((e=>$.value=!0))}),{t:e.f(e.unref(P),((t,r,i)=>({a:e.t(t.remark),b:e.t(t.sn),c:e.t(t.change_amount_desc),d:e.t(t.create_time),e:r}))),v:e.sr(U,"16e8aeaa-5,16e8aeaa-4",{k:"pagingRef"}),w:e.o(E),x:e.o((t=>e.isRef(P)?P.value=t:null)),y:e.p({fixed:!1,"default-page-size":20,"safe-area-inset-bottom":!0,"auto-show-back-to-top":!0,modelValue:e.unref(P)}),z:e.o((t=>e.isRef($)?$.value=t:null)),A:e.p({title:"订阅记录","is-disabled-touch":!0,"custom-class":"bg-_hF9FAFB_",show:e.unref($)})})}}),f=e._export_sfc(d,[["__scopeId","data-v-16e8aeaa"]]);wx.createPage(f);
