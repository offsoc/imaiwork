"use strict";const e=require("../../../common/vendor.js"),s=require("../../../common/assets.js"),i=require("../../../api/app.js"),r=require("../../../components/file-upload/choose-file.js");if(require("../../../utils/request/index.js"),require("../../../utils/request/http.js"),require("../../../enums/requestEnums.js"),require("../../../utils/request/cancel.js"),require("../../../utils/auth.js"),require("../../../enums/constantEnums.js"),require("../../../utils/cache.js"),require("../../../stores/user.js"),require("../../../api/user.js"),require("../../../hooks/useShareMessage.js"),require("../../../router/index.js"),require("../../../utils/util.js"),require("../../../stores/navigationBarTitle.js"),require("../../../stores/app.js"),require("../../../api/chat.js"),require("../../../api/voice_chat.js"),require("../../../config/index.js"),!Array){e.resolveComponent("u-icon")()}Math;const t=e.defineComponent({__name:"choose_file",setup(t){const a=e.ref(1),u=e.ref(0),n=e.ref([]),o=[".html",".xml",".doc",".docx",".txt",".pdf",".csv",".xlsx"],l=async s=>{if(n.value.length>=a.value)return void e.index.showToast({title:`您最多选择 ${a.value} 个文件`,icon:"none"});let i={};"record"===s?i=await r.chooseFile({type:"file",extension:o,count:a.value-n.value.length}):("album"===s||"camera"===s)&&(i=await r.chooseFile({type:"image",count:1,sizeType:["original","compressed"],sourceType:["album"]})),c(i)},c=async s=>{1===Number(a.value)&&(n.value=[]);const{files:i}=r.getFilesByExtname(s,[]),t=[];for(let e=0;e<i.length&&!(a.value-n.value.length<=0);e++){const s=r.normalizeFileData(i[e]);s.size<20971520&&(n.value.push(s),t.push(s))}await m(t),e.index.$emit("chooseFile",n.value),e.index.navigateBack()},m=s=>{const r=s.length;let t=0,a=0;return new Promise((u=>{e.index.showLoading({title:"上传中,请稍后",mask:!0});const o=async()=>{const l=t++,c=s[l],m=n.value.findIndex((e=>e.path===c.path));try{const{uri:e,id:s}=await i.uploadFile("file",{filePath:c.path},(e=>{n.value[m].progress=e}));n.value[m].status="success",n.value[m].url=e,n.value[m].id=s}catch(h){n.value[m].errMsg=h,n.value[m].status="error"}if(a++,a===r)return e.index.hideLoading(),void u();t<r&&o()};for(let e=0;e<Math.min(r,2);e++)o()}))};return e.onLoad((({limit:e,sum_image:s})=>{a.value=Number(e),u.value=Number(s)})),(i,r)=>e.e({a:s._imports_0$3,b:e.t(o.join(",")),c:e.t(e.unref(a)),d:e.p({name:"/static/images/icons/weixin.svg",size:32}),e:e.o((e=>l("record"))),f:e.unref(u)>0},e.unref(u)>0?{g:e.o((e=>l("album")))}:{},{h:e.unref(u)>0},e.unref(u)>0?{i:e.o((e=>l("camera")))}:{},{j:e.p({name:"close",size:24,color:"#8B8B96"}),k:e.o((s=>{e.index.navigateBack()}))})}});wx.createPage(t);
