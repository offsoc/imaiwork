"use strict";const e=require("../../../common/vendor.js");require("../static/Recorder-UniCore/app-uni-support.js"),e.Recorder.inInstal=!0,exports.useRecorder=function(o,n){o=o||{type:"mp3",sampleRate:16e3,bitRate:32,duration:3e4,numberOfChannels:1,encodeBitRate:64e3,format:"mp3",frameSize:1200};const r=e.ref(!1),a=e.ref(0),t=()=>{e.RecordApp.Stop(((o,t,l)=>{e.RecordApp.UniSaveLocalFile("recorder.mp3",o,(async e=>{var o;null==(o=null==n?void 0:n.onstop)||o.call(n,{tempFilePath:e,duration:a.value})}),(e=>{console.log(e)})),r.value=!1}))};return e.onBeforeUnmount((()=>{t()})),{isRecording:r,recordTime:a,start:async()=>{try{e.RecordApp.Start({type:"mp3",bitRate:16,sampleRate:16e3,onProcess:(e,r,l,c,i,s)=>{var u;a.value=l,(null==o?void 0:o.duration)&&a.value>(null==o?void 0:o.duration)?t():null==(u=null==n?void 0:n.ondata)||u.call(n,{pcmData:e[e.length-1],powerLevel:r,sampleRate:c,duration:l})}},(async()=>{var o,r;const a=e.RecordApp.UniFindCanvas;null==(o=null==n?void 0:n.onstart)||o.call(n),null==(r=null==n?void 0:n.ondrawAudio)||r.call(n,a,e.Recorder)}))}catch(r){return Promise.reject(r)}},authorize:()=>new Promise((async(o,n)=>{e.RecordApp.RequestPermission((()=>{o()}),(async n=>{e.index.showModal({title:"开启麦克风权限",content:"为了正常使用语音输入功能，请开启麦克风权限",confirmText:"去设置",success:async n=>{if(n.confirm){const{authSetting:n}=await e.index.openSetting();n["scope.record"]&&o()}}})}))})),stop:t,resume:()=>{e.RecordApp.Resume((()=>{var e;null==(e=null==n?void 0:n.onresume)||e.call(n)}))},pause:()=>{e.RecordApp.Pause((()=>{var e;null==(e=null==n?void 0:n.onpause)||e.call(n)}))}}};
