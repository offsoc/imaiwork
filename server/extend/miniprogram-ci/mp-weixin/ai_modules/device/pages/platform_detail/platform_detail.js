"use strict";const e=require("../../../../common/vendor.js"),t=require("../../../../api/device.js"),a=require("../../../../api/agent.js"),n=require("../../../../enums/appEnums.js"),u=require("../../../../utils/util.js"),o=require("../../hooks/useDevice.js"),i=require("../../hooks/useDeviceWs.js"),r=require("../../enums/index.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../config/index.js"),require("../../../../common/assets.js"),require("../../../../hooks/useWebSocket.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-icon")+e.resolveComponent("u-switch")+e.resolveComponent("u-tabs")+e.resolveComponent("empty")+e.resolveComponent("z-paging")+e.resolveComponent("u-popup")+e.resolveComponent("u-button")+e.resolveComponent("popup-bottom")+e.resolveComponent("video-preview")+e.resolveComponent("confirm-dialog"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-switch/u-switch.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-tabs/u-tabs.js")+(()=>"../../../../components/empty/empty.js")+(()=>"../../../../node-modules/z-paging/components/z-paging/z-paging.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+(()=>"../../../../components/popup-bottom/popup-bottom.js")+(()=>"../../../../components/video-preview/video-preview.js")+(()=>"../../../../components/confirm-dialog/confirm-dialog.js"))();const s=e.defineComponent({__name:"platform_detail",setup(s){const{send:l,onEvent:c,close:p}=i.useDeviceWs(),{platformLogo:d}=o.useDevice(),m=e.ref(""),v=e.ref(),f=[{name:"微信",type:n.AppTypeEnum.WECHAT},{name:"小红书",type:n.AppTypeEnum.XHS},{name:"抖音",type:n.AppTypeEnum.DOUYIN},{name:"快手",type:n.AppTypeEnum.KUAISHOU}],_=e.ref(n.AppTypeEnum.WECHAT),g=e.ref({}),E=e.computed((()=>f.find((e=>e.type==_.value)))),h=e.ref(!1),y=e.shallowRef(),C=e.ref([]),b=e.ref(""),A=e.ref(!1),T=e.computed((()=>{const e={name:"发布详情",key:"publish_detail"};return _.value==n.AppTypeEnum.XHS?[e,{name:"私信详情",key:"private_detail"}]:[e]})),D=e.ref(0),w=e.shallowRef(),x=e.ref([]),j=e.ref(!1),k=e.ref(!1),R=e.ref([{title:"正在发送指令",status:1,type:"send",errorCode:n.DeviceCmdCodeEnum.OPEN_APP_ERROR},{title:"手机正在处理指令",status:0,type:n.DeviceCmdEnum.APP_EXEC,errorCode:n.DeviceCmdCodeEnum.OPEN_APP_ERROR},{title:"正在打开目标应用",status:0,type:n.DeviceCmdEnum.OPEN_APP,errorCode:n.DeviceCmdCodeEnum.OPEN_APP_ERROR},{title:"正在切换到个人中心",status:0,type:n.DeviceCmdEnum.OPEN_PERSON_CENTER,errorCode:n.DeviceCmdCodeEnum.OPEN_APP_ERROR},{title:"正在获取账号信息",status:0,type:n.DeviceCmdEnum.GET_ACCOUNT_INFO,errorCode:n.DeviceCmdCodeEnum.GET_ACCOUNT_INFO_ERROR},{title:"正在等待数据返回",status:0,type:n.DeviceCmdEnum.DATA_SEND,errorCode:n.DeviceCmdCodeEnum.DATA_SEND_ERROR},{title:"已完成",status:0,type:n.DeviceCmdEnum.GET_ACCOUNT_INFO_COMPLETE}]),O=e.ref(0),q=e.ref(!1),N=e.reactive({url:"",pic:""}),P=e.computed((()=>R.value.every((e=>2===e.status)))),L=e.computed((()=>{const e=[],t=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"];return x.value.forEach((a=>{const n=a.message_time.split(" ")[0],u=e.find((e=>e.date===n));u?u.list.push(a):e.push({date:n,date_text:`${n.split("-")[0]}.${n.split("-")[1]}.${n.split("-")[2]} ${t[new Date(n).getDay()]}`,list:[a]})})),e.sort(((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()))}));c("success",(async a=>{const{type:u,content:o,deviceId:i,appType:s}=a;if(_.value!=n.AppTypeEnum.WECHAT){if(R.value.find((e=>e.type===u)))for(let e=0;e<R.value.length;e++){const t=R.value[e];if(u==n.DeviceCmdEnum.APP_EXEC&&(R.value[0].status=2),t.type===u){O.value=e,t.status=1,u==n.DeviceCmdEnum.GET_ACCOUNT_INFO_COMPLETE&&(R.value[R.value.length-1].status=2);break}t.status=O.value>=e?2:0}}if(u===n.DeviceCmdEnum.GET_USER_INFO){const{account:a,account_no:n,extra:u,avatar:l,nickname:c}=o,p={account:a,account_no:n,avatar:l,device_code:i,type:s,nickname:c,extra:JSON.stringify(u)};v.value===r.DeviceEventAction.ADD_ACCOUNT?(await t.addDeviceAccount(p),e.index.hideLoading()):v.value===r.DeviceEventAction.UPDATE_ACCOUNT&&await t.updateDeviceAccount({...p,id:g.value.id}),v.value=null,j.value=!1,e.index.hideLoading(),G(),w.value.reload()}})),c("error",(t=>{const{type:a,code:u}=t;e.index.hideLoading();for(const e of R.value)if(e.type===a&&u===e.errorCode){e.status=3;break}a===n.DeviceCmdEnum.GET_USER_INFO&&e.index.showToast({title:t.error,icon:"none",duration:3e3})}));const U=async(e,t)=>{var n,u;try{const{lists:u}=await a.getAgentList({page:e,page_size:t,source:1});null==(n=y.value)||n.complete(u)}catch(o){null==(u=y.value)||u.complete([])}},S=e=>{const t=d[e];return _.value==e?t.activeIcon:t.icon},I=e=>{var t;D.value!==e&&(D.value=e,null==(t=w.value)||t.reload())},F=e=>{e==r.DeviceEventAction.ADD_ACCOUNT?W():j.value=!0,v.value=e,R.value.forEach((e=>{e.status=0})),O.value=0},W=()=>{j.value=!1,_.value!=n.AppTypeEnum.WECHAT?k.value=!0:e.index.showLoading({title:"更新中...",mask:!0}),R.value[0].status=1,l({type:n.DeviceCmdEnum.GET_USER_INFO,content:{deviceId:m.value},deviceId:m.value,appType:_.value})},z=async()=>{A.value=!1,e.index.showLoading({title:"删除中...",mask:!0});try{await t.deleteDeviceAccount({id:g.value.id}),e.index.hideLoading(),e.index.showToast({title:"移除账号成功",icon:"none",duration:3e3}),G()}catch(a){e.index.hideLoading(),e.index.showToast({title:a||"移除账号失败",icon:"none",duration:3e3})}},H=async a=>{e.index.showLoading({title:"更新中...",mask:!0});try{await t.changeAccountStatus({account:g.value.account,open_ai:a?1:0}),e.index.hideLoading(),e.index.showToast({title:"更新成功",icon:"none",duration:3e3}),G()}catch(n){e.index.hideLoading(),e.index.showToast({title:"更新失败",icon:"none",duration:3e3})}},B=async()=>{e.index.showLoading({title:"绑定中...",mask:!0});try{await t.changeAccountStatus({account:g.value.account,robot_id:b.value,takeover_mode:1,open_ai:g.value.open_ai}),e.index.hideLoading(),e.index.showToast({title:"绑定成功",icon:"none",duration:3e3}),G(),h.value=!1}catch(a){e.index.hideLoading(),e.index.showToast({title:"绑定失败",icon:"none",duration:3e3})}},G=async()=>{const{lists:e}=await t.getDeviceAccountList({device_code:m.value,type:_.value});e&&e.length>0?(g.value=e[0],b.value=e[0].robot_id):g.value={}},V=async(e,a)=>{var n,u;try{let u=[];if(0===D.value){const{lists:n}=await t.getDevicePublishRecordList({device_code:m.value,account_type:_.value,account:g.value.account,page:e,page_size:a,task_type:3});u=n||[]}else{const{lists:n}=await t.getDevicePrivateChatRecordList({device_code:m.value,page:e,page_size:a,type:_.value});u=n||[]}null==(n=w.value)||n.complete(u)}catch(o){null==(u=w.value)||u.complete([])}},X=e=>{switch(e){case 0:default:return"text-primary bg-primary-light-9";case 1:return"text-_h00C08E_ bg-_rgba_0b192b142b0d1__";case 2:return"text-_hFF2442_ bg-_rgba_255b36b66b0d1__"}},M=e=>({0:"未发布",1:"已发布",2:"发布失败",3:"发布中"}[e]||"未知状态");return e.onLoad((e=>{const{device_code:t,app_type:a}=e;t&&(_.value=a||n.AppTypeEnum.WECHAT,m.value=t,G())})),e.onUnload((()=>{p()})),(t,a)=>{var o;return e.e({a:e.p({title:"平台详情","title-bold":!0,"border-bottom":!1,"is-fixed":!1,background:{background:"transparent"}}),b:e.f(f,((t,a,n)=>({a:S(t.type),b:a,c:e.unref(_)==t.type?1:"",d:e.o((e=>(async e=>{var t;_.value!==e&&(_.value=e,D.value=0,await G(),null==(t=w.value)||t.reload())})(t.type)),a)}))),c:e.t(null==(o=e.unref(E))?void 0:o.name),d:e.unref(g).account},e.unref(g).account?{e:e.p({name:"reload",color:"#0065FB"}),f:e.o((t=>F(e.unref(r.DeviceEventAction).UPDATE_ACCOUNT)))}:{},{g:e.unref(g).account},e.unref(g).account?e.e({h:e.unref(g).avatar,i:e.t(e.unref(g).nickname),j:e.t(e.unref(g).account),k:e.t(e.unref(u.formatNumberToWanOrYi)(e.unref(g).followers||0)),l:e.t(e.unref(u.formatNumberToWanOrYi)(e.unref(g).fans||0)),m:e.t(e.unref(u.formatNumberToWanOrYi)(e.unref(g).thumbup_collect||0)),n:e.unref(_)==e.unref(n.AppTypeEnum).XHS},e.unref(_)==e.unref(n.AppTypeEnum).XHS?e.e({o:e.o(H),p:e.o((t=>e.unref(g).open_ai=t)),q:e.p({"active-value":1,"inactive-value":0,size:32,modelValue:e.unref(g).open_ai}),r:1==e.unref(g).open_ai},1==e.unref(g).open_ai?{s:e.t(e.unref(g).robot_name||"未配置"),t:e.unref(g).robot_name?1:"",v:e.p({name:"arrow-right",color:"#B2B2B2"}),w:e.o((e=>h.value=!0))}:{}):{},{x:e.t(e.unref(g).update_time),y:e.o((e=>A.value=!0))}):{z:e.o((t=>F(e.unref(r.DeviceEventAction).ADD_ACCOUNT)))},{A:e.o(I),B:e.p({"bg-color":"transparent",current:e.unref(D),list:e.unref(T),"is-scroll":!1}),C:0===e.unref(D)},0===e.unref(D)?{D:e.f(e.unref(x),((t,a,n)=>e.e({a:M(t.status)},M(t.status)?{b:e.t(M(t.status)),c:e.n(X(t.status))}:{},{d:t.pic||t.material_url,e:e.o((a=>(t=>{const{pic:a}=t;e.index.previewImage({urls:[a]})})(t)),a),f:1==t.material_type},1==t.material_type?{g:e.o((e=>(e=>{q.value=!0,N.pic=e.pic,N.url=e.material_url})(t)),a)}:{},{h:e.t(t.material_title),i:e.t(t.material_subtitle),j:t.material_tag},t.material_tag?{k:e.f(t.material_tag,((t,a,n)=>({a:e.t(t),b:a})))}:{},{l:e.t(t.publish_time),m:t.remark&&2==t.status},t.remark&&2==t.status?{n:e.t(t.remark)}:{},{o:a})))}:{},{E:1===e.unref(D)},1===e.unref(D)?{F:e.f(e.unref(L),((t,a,n)=>({a:e.t(t.date_text),b:e.f(t.list,((t,a,n)=>({a:e.t(t.message_content||"-"),b:e.t(t.message_time||"-"),c:e.t(t.reply_content||"-"),d:e.t(t.reply_time||"-"),e:a}))),c:a})))}:{},{G:e.sr(w,"72f357fc-5",{k:"pagingRef"}),H:e.o(V),I:e.o((t=>e.isRef(x)?x.value=t:null)),J:e.p({fixed:!1,"safe-area-inset-bottom":!0,modelValue:e.unref(x)}),K:e.o((e=>j.value=!1)),L:e.o(W),M:e.o((e=>j.value=!1)),N:e.o((t=>e.isRef(j)?j.value=t:null)),O:e.p({mode:"center","border-radius":"20",width:"80%",modelValue:e.unref(j)}),P:e.f(e.unref(R),((t,a,n)=>e.e({a:0==t.status},(t.status,{}),{b:1==t.status},(t.status,{}),{c:2==t.status},2==t.status?{d:"72f357fc-9-"+n+",72f357fc-8",e:e.p({name:"checkmark",color:"#0065FB",size:"16"})}:{},{f:a!==e.unref(R).length-1},a!==e.unref(R).length-1?{g:e.n(2==t.status?"bg-primary":"bg-_h0000001a_")}:{},{h:e.t(t.title),i:0==t.status?1:"",j:1==t.status},(t.status,{}),{k:3==t.status},(t.status,{}),{l:a}))),Q:e.unref(P)},e.unref(P)?{R:e.o((e=>k.value=!1)),S:e.p({type:"primary","custom-style":{height:"90rpx",fontWeight:"bold",borderRadius:"20rpx"}})}:{},{T:e.o((e=>k.value=!1)),U:e.p({"custom-style":{height:"90rpx",fontWeight:"bold",borderRadius:"20rpx"}}),V:e.o((e=>k.value=!1)),W:e.o((t=>e.isRef(k)?k.value=t:null)),X:e.p({mode:"center","border-radius":"20",width:"80%","mask-close-able":!1,modelValue:e.unref(k)}),Y:e.f(e.unref(C),((t,a,n)=>e.e({a:t.image,b:e.t(t.name),c:e.t(t.intro),d:e.unref(b)==t.id},e.unref(b)==t.id?{e:"72f357fc-14-"+n+",72f357fc-13",f:e.p({name:"checkmark",color:"#ffffff",size:"20"})}:{},{g:e.n(e.unref(b)==t.id?"bg-primary flex items-center justify-center":"border border-solid border-_h00000033_"),h:t.id,i:e.unref(b)==t.id?1:"",j:e.o((e=>(e=>{b.value=b.value===e.id?"":e.id})(t)),t.id)}))),Z:e.sr(y,"72f357fc-13,72f357fc-12",{k:"robotPagingRef"}),aa:e.o(U),ab:e.o((t=>e.isRef(C)?C.value=t:null)),ac:e.p({fixed:!1,"safe-area-inset-bottom":!0,modelValue:e.unref(C)}),ad:e.o(B),ae:e.p({type:"primary","custom-style":{height:"90rpx",fontWeight:"bold",borderRadius:"20rpx"},disabled:!e.unref(b)}),af:e.o((e=>h.value=!1)),ag:e.p({show:e.unref(h),title:"选择智能体","custom-class":"bg-_hF9FAFB_","show-close-btn":!0,"is-disabled-touch":!0}),ah:e.o((t=>e.isRef(q)?q.value=t:null)),ai:e.p({title:"视频预览",poster:e.unref(N).pic,"video-url":e.unref(N).url,show:e.unref(q)}),aj:e.o(z),ak:e.o((t=>e.isRef(A)?A.value=t:null)),al:e.p({content:"确定要删除账号吗？",center:!0,modelValue:e.unref(A)})})}}}),l=e._export_sfc(s,[["__scopeId","data-v-72f357fc"]]);wx.createPage(l);
