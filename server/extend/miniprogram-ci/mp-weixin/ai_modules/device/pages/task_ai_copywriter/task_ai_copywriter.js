"use strict";const e=require("../../../../common/vendor.js"),u=require("../../../../common/assets.js"),t=require("../../../../api/device.js"),n=require("../../../../stores/user.js"),a=require("../../../../enums/appEnums.js"),r=require("../../enums/index.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../router/index.js"),require("../../../../config/index.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-input")+e.resolveComponent("u-icon")+e.resolveComponent("u-popup"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js"))();const o=e.defineComponent({__name:"task_ai_copywriter",setup(o){const i=n.useUserStore(),{userTokens:s}=e.toRefs(i),l=e.ref(""),c=e.ref(150),p=e.ref([]),v=[1,3,5,10,20,30],f=e.ref(1),d=e.ref(!1),m=e.ref(!1),g=e.ref(""),j=e.ref([]),q=e.computed((()=>p.value.every((e=>"success"===e.status)))),h=e.computed((()=>{var e;return(null==(e=i.getTokenByScene(a.TokensSceneEnum.MATRIX_COPYWRITER))?void 0:e.score)*f.value})),b=async u=>{if(u.trim()){if(!(s.value<=h.value||d.value))try{d.value=!0,p.value=Array.from({length:f.value},(()=>({title:"",content:"",status:"pending"})));const e=await t.generateMatrixPrompt({keywords:u,number:f.value});p.value=e.map((e=>({title:e.title,content:e.content,topic:e.topic,status:"success"})))}catch(n){d.value=!1,e.index.showToast({title:n||"生成失败，请重试",icon:"none",duration:3e3})}}else e.index.$u.toast("请输入文案")},x=()=>{if(d.value){if(!q.value)return void e.index.$u.toast("正在生成中，请稍后再试");d.value=!1}p.value=[],d.value=!1,b(l.value)},k=()=>{p.value[j.value[0]].topic[j.value[1]]=g.value,m.value=!1},_=()=>{q.value?(e.index.$emit("confirm",{type:r.ListenerTypeEnum.TASK_AI_COPYWRITER,data:p.value.filter((e=>e.title)).map((e=>({title:e.title,content:e.content,topic:e.topic})))}),p.value=[],e.index.navigateBack()):e.index.$u.toast("文案在生成中...")},y=()=>{p.value.length>0?(p.value=[],d.value=!1):e.index.navigateBack()};return e.onLoad((e=>{c.value=e.limit})),(t,n)=>e.e({a:e.p({title:"AI文案生成","title-bold":!0,"is-fixed":!1,"border-bottom":!1,background:{background:"transparent"},"custom-back":y}),b:!e.unref(d)},e.unref(d)?{i:e.f(e.unref(p),((t,n,a)=>e.e({a:"pending"===t.status},"pending"===t.status?{b:u._imports_0$33,c:e.t(n+1)}:{d:"b7a5a51e-1-"+a,e:e.o((e=>t.title=e),n),f:e.p({"placeholder-style":"color: #7C7E80; ",maxlength:"30",modelValue:t.title}),g:"b7a5a51e-2-"+a,h:e.o((e=>t.content=e),n),i:e.p({type:"textarea","placeholder-style":"color: #7C7E80; ",maxlength:"500","auto-height":!1,modelValue:t.content}),j:e.t(t.content.length),k:e.f(t.topic,((u,t,r)=>({a:e.t(u),b:"b7a5a51e-3-"+a+"-"+r,c:e.o((e=>((e,u)=>{p.value[e].topic.splice(u,1)})(n,t)),n),d:e.o((e=>((e,u)=>{j.value=[e,u],g.value=p.value[e].topic[u],m.value=!0})(n,t)),n)}))),l:e.p({name:"close",size:"16",color:"#ffffff"}),m:n,n:"b7a5a51e-4-"+a,o:e.p({name:"close",color:"#ffffff",size:"16"}),p:e.o((e=>(e=>{p.value.splice(e,1),0===p.value.length&&(d.value=!1)})(n)),n)},{q:n})))}:{c:500,d:e.unref(l),e:e.o((u=>e.isRef(l)?l.value=u.detail.value:null)),f:e.t(e.unref(l).length),g:e.t(500),h:e.f(v,((u,t,n)=>({a:e.t(u),b:u,c:e.unref(f)===u?1:"",d:e.o((e=>f.value=u),u)})))},{j:!e.unref(d)},e.unref(d)?{n:e.o(x),o:e.n(e.unref(q)?"bg-black":"bg-_h787878CC_"),p:e.o(_)}:{k:e.t(e.unref(h)),l:e.n(e.unref(l).length>0?"bg-black":"bg-_h787878CC_"),m:e.o((u=>b(e.unref(l))))},{q:e.o((u=>e.isRef(g)?g.value=u:null)),r:e.p({placeholder:"请输入标签",maxlength:"20","placeholder-style":"color: #0000004d; font-size: 26rpx;",modelValue:e.unref(g)}),s:e.o((e=>m.value=!1)),t:e.o(k),v:e.o((u=>e.isRef(m)?m.value=u:null)),w:e.p({mode:"center",width:"90%","border-radius":20,modelValue:e.unref(m)})})}}),i=e._export_sfc(o,[["__scopeId","data-v-b7a5a51e"]]);wx.createPage(i);
