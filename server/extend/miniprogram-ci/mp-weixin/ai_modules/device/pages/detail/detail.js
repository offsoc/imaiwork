"use strict";const e=require("../../../../common/vendor.js"),a=require("../../../../api/device.js"),t=require("../../../../utils/util.js"),u=require("../../hooks/useDevice.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../config/index.js"),require("../../../../common/assets.js"),require("../../../../enums/appEnums.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-icon")+e.resolveComponent("empty")+e.resolveComponent("u-input")+e.resolveComponent("u-popup"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+n+o+i+(()=>"../../../../components/empty/empty.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js")+r+l)();const n=()=>"../../components/calendar-simple/calendar-simple.js",i=()=>"../../components/task-list/task-list.js",o=()=>"../../components/semi-circle-progress/semi-circle-progress.js",r=()=>"../../components/task-detail-pop/task-detail-pop.js",l=()=>"../../components/task-edit-name/task-edit-name.js",s=e.defineComponent({__name:"detail",setup(n){const i=e.ref(""),o=e.ref({}),r=e.ref(e.index.$u.timeFormat(new Date,"yyyy-mm-dd")),l=e.ref(!1),s=e.ref(""),c=e.ref([]),d=e.ref(0),v=e.ref(!1),p=e.ref(!1),m={page_no:1,page_size:10},f=e.ref([{title:"总任务",value:0,key:"all"},{title:"已完成",value:0,key:"completed"},{title:"待开始",value:0,key:"waiting"},{title:"执行中",value:0,key:"execution"},{title:"已失败",value:0,key:"failure"}]),h=e.shallowRef(null),g=e.shallowRef(null),y=e.ref(!1),k=e.ref(!1),{platformLogo:j}=u.useDevice(),_=e.computed((()=>{switch(o.value.status){case 0:return"text-_hFF2442_ bg-_rgba_255b36b66b0d1__";case 1:return"text-_h00C08E_ bg-_rgba_0b192b142b0d1__";default:return"text-primary bg-primary-light-9"}})),w=e.computed((()=>{var e,a,t;const u=(null==(e=f.value.find((e=>"all"===e.key)))?void 0:e.value)||0,n=(null==(a=f.value.find((e=>"completed"===e.key)))?void 0:a.value)||0,i=(null==(t=f.value.find((e=>"failure"===e.key)))?void 0:t.value)||0;return 0==u?0:Math.round((n+i)/u*100)})),q=()=>{l.value=!0,s.value=o.value.device_name},x=async()=>{e.index.showLoading({title:"修改中...",mask:!0});try{await a.updateDevice({device_code:i.value,device_name:s.value}),e.index.hideLoading(),e.index.showToast({title:"修改成功",icon:"none",duration:3e3}),o.value.device_name=s.value,l.value=!1}catch(t){e.index.hideLoading(),e.index.showToast({title:t,icon:"none",duration:3e3})}},b=()=>{e.index.showModal({title:"解除设备绑定",content:"解除设备绑定后，设备将无法使用",success:async t=>{if(t.confirm){e.index.showLoading({title:"解除中...",mask:!0});try{await a.unbindDevice({device_code:i.value}),e.index.hideLoading(),e.index.showToast({title:"解除成功",icon:"none",duration:3e3}),e.index.$u.route({url:"/pages/phone/phone",type:"reLaunch"})}catch(u){e.index.hideLoading(),e.index.showToast({title:u,icon:"none",duration:3e3})}}}})},D=()=>{m.page_no=1,c.value=[],p.value=!1,v.value=!1,E(),C()},L=async a=>{var t;y.value=!0,await e.nextTick$1(),null==(t=h.value)||t.getDetail(a)},R=async a=>{var t;k.value=!0,await e.nextTick$1(),null==(t=g.value)||t.setFormData(a)},T=e=>{c.value.forEach((a=>{a.id==e.id&&(a.name=e.name)}))},C=async()=>{const e=await a.getDeviceTaskCalendarStatistics({day:r.value,device_code:i.value});f.value.forEach((a=>{a.value=e[a.key]}))},E=async()=>{v.value=!0;try{const{lists:e,count:t}=await a.getDeviceTaskList({device_code:i.value,date:r.value,...m});p.value=!(e.length<(m.page_size||t)),c.value=c.value.concat(e),d.value=t}finally{v.value=!1}},$=async()=>{await(async()=>{const e=await a.getDeviceDetail({device_code:i.value});o.value=e})(),D()};return e.onShow((()=>{$()})),e.onLoad((e=>{i.value=e.device_code})),e.onReachBottom((()=>{!v.value&&p.value&&(m.page_no++,E())})),(a,u)=>{var n;return e.e({a:e.p({title:"设备详情","title-bold":!0,"border-bottom":!1,background:{background:"#DDEAFB"}}),b:e.t(0===e.unref(o).status?"离线":1===e.unref(o).status?"在线":"工作中"),c:e.n(e.unref(_)),d:e.t(e.unref(o).device_name||"-"),e:e.o(q),f:e.t(e.unref(o).device_code),g:e.t(e.unref(o).create_time),h:e.f(e.unref(o).accounts,((a,t,u)=>({a:e.unref(j)[a.type].activeIcon,b:t,c:`/ai_modules/device/pages/platform_detail/platform_detail?device_code=${e.unref(i)}&app_type=${a.type}`}))),i:e.p({name:"arrow-right",color:"#0000004d"}),j:0==(null==(n=e.unref(o).accounts)?void 0:n.length)?1:"",k:`/ai_modules/device/pages/platform_detail/platform_detail?device_code=${e.unref(i)}`,l:e.p({name:"arrow-right",color:"#0000004d"}),m:e.o(b),n:e.o(D),o:e.o((a=>e.isRef(r)?r.value=a:null)),p:e.p({modelValue:e.unref(r)}),q:e.t(e.unref(w)),r:e.p({progress:e.unref(w)}),s:e.f(e.unref(f),((a,u,n)=>({a:e.t(e.unref(t.formatNumberToWanOrYi)(a.value)),b:e.t(a.title),c:a.key}))),t:e.t(e.unref(c).length),v:e.unref(c).length>0},e.unref(c).length>0?{w:e.o(L),x:e.o(R),y:e.p({list:e.unref(c)})}:{z:e.p({text:"暂无任务"})},{A:e.o((a=>e.isRef(s)?s.value=a:null)),B:e.p({placeholder:"请输入设备名称",maxlength:"30","placeholder-style":"color: #0000004d; font-size: 26rpx;",modelValue:e.unref(s)}),C:e.o((e=>l.value=!1)),D:e.o(x),E:e.o((a=>e.isRef(l)?l.value=a:null)),F:e.p({mode:"center",width:"90%","border-radius":20,modelValue:e.unref(l)}),G:e.sr(h,"48bb7898-9",{k:"taskDetailRef"}),H:e.o(D),I:e.o((a=>e.isRef(y)?y.value=a:null)),J:e.p({modelValue:e.unref(y)}),K:e.sr(g,"48bb7898-10",{k:"taskEditNameRef"}),L:e.o(T),M:e.o((a=>e.isRef(k)?k.value=a:null)),N:e.p({modelValue:e.unref(k)})})}}});wx.createPage(s);
