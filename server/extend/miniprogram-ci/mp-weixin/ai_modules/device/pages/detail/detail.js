"use strict";const e=require("../../../../common/vendor.js"),a=require("../../../../api/device.js"),t=require("../../../../utils/util.js"),i=require("../../hooks/useDevice.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../config/index.js"),require("../../../../common/assets.js"),require("../../../../enums/appEnums.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-icon")+e.resolveComponent("empty")+e.resolveComponent("u-input")+e.resolveComponent("u-popup"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+u+o+n+(()=>"../../../../components/empty/empty.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js"))();const u=()=>"../../components/calendar-simple/calendar-simple.js",n=()=>"../../components/task-list/task-list.js",o=()=>"../../components/semi-circle-progress/semi-circle-progress.js",r=e.defineComponent({__name:"detail",setup(u){const n=e.ref(""),o=e.ref({}),r=e.ref(e.index.$u.timeFormat(new Date,"yyyy-mm-dd")),s=e.ref(!1),l=e.ref(""),c=e.ref([]),d=e.ref(0),v=e.ref(!1),p=e.ref(!1),m={page_no:1,page_size:10},f=e.ref([{title:"总任务",value:0,key:"all"},{title:"已完成",value:0,key:"completed"},{title:"待开始",value:0,key:"waiting"},{title:"执行中",value:0,key:"execution"},{title:"已失败",value:0,key:"failure"}]),{platformLogo:g}=i.useDevice(),h=e.computed((()=>{switch(o.value.status){case 0:return"text-_hFF2442_ bg-_rgba_255b36b66b0d1__";case 1:return"text-_h00C08E_ bg-_rgba_0b192b142b0d1__";default:return"text-primary bg-primary-light-9"}})),y=e.computed((()=>{var e,a,t;const i=(null==(e=f.value.find((e=>"all"===e.key)))?void 0:e.value)||0,u=(null==(a=f.value.find((e=>"completed"===e.key)))?void 0:a.value)||0,n=(null==(t=f.value.find((e=>"failure"===e.key)))?void 0:t.value)||0;return 0==i?0:Math.round((u+n)/i*100)})),_=()=>{s.value=!0,l.value=o.value.device_name},j=async()=>{e.index.showLoading({title:"修改中...",mask:!0});try{await a.updateDevice({device_code:n.value,device_name:l.value}),e.index.hideLoading(),e.index.showToast({title:"修改成功",icon:"none",duration:3e3}),o.value.device_name=l.value,s.value=!1}catch(t){e.index.hideLoading(),e.index.showToast({title:t,icon:"none",duration:3e3})}},q=()=>{e.index.showModal({title:"解除设备绑定",content:"解除设备绑定后，设备将无法使用",success:async t=>{if(t.confirm){e.index.showLoading({title:"解除中...",mask:!0});try{await a.unbindDevice({device_code:n.value}),e.index.hideLoading(),e.index.showToast({title:"解除成功",icon:"none",duration:3e3}),e.index.$u.route({url:"/pages/phone/phone",type:"reLaunch"})}catch(i){e.index.hideLoading(),e.index.showToast({title:i,icon:"none",duration:3e3})}}}})},w=()=>{m.page_no=1,c.value=[],p.value=!1,v.value=!1,b(),x()},k=e=>{c.value.forEach((a=>{a.id==e.id&&(a.name=e.name)}))},x=async()=>{const e=await a.getDeviceTaskCalendarStatistics({day:r.value,device_code:n.value});f.value.forEach((a=>{a.value=e[a.key]}))},b=async()=>{v.value=!0;try{const{lists:e,count:t}=await a.getDeviceTaskList({device_code:n.value,date:r.value,...m});p.value=!(e.length<(m.page_size||t)),c.value=c.value.concat(e),d.value=t}finally{v.value=!1}},D=async()=>{await(async()=>{const e=await a.getDeviceDetail({device_code:n.value});o.value=e})(),await x(),await b()};return e.onLoad((e=>{n.value=e.device_code,D()})),e.onReachBottom((()=>{!v.value&&p.value&&(m.page_no++,b())})),(a,i)=>{var u;return e.e({a:e.p({title:"设备详情","title-bold":!0,"border-bottom":!1,background:{background:"#DDEAFB"}}),b:e.t(0===e.unref(o).status?"离线":1===e.unref(o).status?"在线":"工作中"),c:e.n(e.unref(h)),d:e.t(e.unref(o).device_name||"-"),e:e.o(_),f:e.t(e.unref(o).device_code),g:e.t(e.unref(o).create_time),h:e.f(e.unref(o).accounts,((a,t,i)=>({a:e.unref(g)[a.type].activeIcon,b:t,c:`/ai_modules/device/pages/platform_detail/platform_detail?device_code=${e.unref(n)}&app_type=${a.type}`}))),i:e.p({name:"arrow-right",color:"#0000004d"}),j:0==(null==(u=e.unref(o).accounts)?void 0:u.length)?1:"",k:`/ai_modules/device/pages/platform_detail/platform_detail?device_code=${e.unref(n)}`,l:e.p({name:"arrow-right",color:"#0000004d"}),m:e.o(q),n:e.o(w),o:e.o((a=>e.isRef(r)?r.value=a:null)),p:e.p({modelValue:e.unref(r)}),q:e.t(e.unref(y)),r:e.p({progress:e.unref(y)}),s:e.f(e.unref(f),((a,i,u)=>({a:e.t(e.unref(t.formatNumberToWanOrYi)(a.value)),b:e.t(a.title),c:a.key}))),t:e.t(e.unref(c).length),v:e.unref(c).length>0},e.unref(c).length>0?{w:e.o(w),x:e.o(k),y:e.p({list:e.unref(c)})}:{z:e.p({text:"暂无任务"})},{A:e.o((a=>e.isRef(l)?l.value=a:null)),B:e.p({placeholder:"请输入设备名称",maxlength:"30","placeholder-style":"color: #0000004d; font-size: 26rpx;",modelValue:e.unref(l)}),C:e.o((e=>s.value=!1)),D:e.o(j),E:e.o((a=>e.isRef(s)?s.value=a:null)),F:e.p({mode:"center",width:"90%","border-radius":20,modelValue:e.unref(s)})})}}});wx.createPage(r);
