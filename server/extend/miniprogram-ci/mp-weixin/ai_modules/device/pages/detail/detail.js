"use strict";const e=require("../../../../common/vendor.js"),t=require("../../../../api/device.js"),a=require("../../../../utils/util.js"),u=require("../../hooks/useDevice.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../config/index.js"),require("../../../../common/assets.js"),require("../../../../enums/appEnums.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-icon")+e.resolveComponent("empty")+e.resolveComponent("u-input")+e.resolveComponent("u-popup"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+i+o+n+(()=>"../../../../components/empty/empty.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js"))();const i=()=>"../../components/calendar-simple/calendar-simple.js",n=()=>"../../components/task-list/task-list.js",o=()=>"../../components/semi-circle-progress/semi-circle-progress.js",r=e.defineComponent({__name:"detail",setup(i){const n=e.ref(""),o=e.ref({}),r=e.ref(e.index.$u.timeFormat(new Date,"yyyy-mm-dd")),s=e.ref(!1),l=e.ref(""),c=e.ref([]),d=e.ref(0),v=e.ref(!1),p=e.ref(!1),m={page_no:1,page_size:10},f=e.ref([{title:"总任务",value:0,key:"all"},{title:"已完成",value:0,key:"completed"},{title:"待开始",value:0,key:"waiting"},{title:"执行中",value:0,key:"execution"},{title:"已失败",value:0,key:"failure"}]),{platformLogo:g}=u.useDevice(),h=e.computed((()=>{switch(o.value.status){case 0:return"text-_hFF2442_ bg-_rgba_255b36b66b0d1__";case 1:return"text-_h00C08E_ bg-_rgba_0b192b142b0d1__";default:return"text-primary bg-primary-light-9"}})),y=e.computed((()=>{var e,t,a;const u=(null==(e=f.value.find((e=>"all"===e.key)))?void 0:e.value)||0,i=(null==(t=f.value.find((e=>"completed"===e.key)))?void 0:t.value)||0,n=(null==(a=f.value.find((e=>"failure"===e.key)))?void 0:a.value)||0;return 0==u?0:Math.round((i+n)/u*100)})),_=()=>{s.value=!0,l.value=o.value.device_name},j=async()=>{e.index.showLoading({title:"修改中...",mask:!0});try{await t.updateDevice({device_code:n.value,device_name:l.value}),e.index.hideLoading(),e.index.showToast({title:"修改成功",icon:"none",duration:3e3}),o.value.device_name=l.value,s.value=!1}catch(a){e.index.hideLoading(),e.index.showToast({title:a,icon:"none",duration:3e3})}},q=()=>{e.index.showModal({title:"解除设备绑定",content:"解除设备绑定后，设备将无法使用",success:async a=>{if(a.confirm){e.index.showLoading({title:"解除中...",mask:!0});try{await t.unbindDevice({device_code:n.value}),e.index.hideLoading(),e.index.showToast({title:"解除成功",icon:"none",duration:3e3}),e.index.$u.route({url:"/pages/phone/phone",type:"reLaunch"})}catch(u){e.index.hideLoading(),e.index.showToast({title:u,icon:"none",duration:3e3})}}}})},w=()=>{m.page_no=1,c.value=[],p.value=!1,v.value=!1,x(),k()},k=async()=>{const e=await t.getDeviceTaskCalendarStatistics({day:r.value,device_code:n.value});f.value.forEach((t=>{t.value=e[t.key]}))},x=async()=>{v.value=!0;try{const{lists:e,count:a}=await t.getDeviceTaskList({device_code:n.value,date:r.value,...m});p.value=!(e.length<(m.page_size||a)),c.value=c.value.concat(e),d.value=a}finally{v.value=!1}},b=async()=>{await(async()=>{const e=await t.getDeviceDetail({device_code:n.value});o.value=e})(),await k(),await x()};return e.onLoad((e=>{n.value=e.device_code,b()})),e.onReachBottom((()=>{!v.value&&p.value&&(m.page_no++,x())})),(t,u)=>{var i;return e.e({a:e.p({title:"设备详情","title-bold":!0,"border-bottom":!1,background:{background:"#DDEAFB"}}),b:e.t(0===e.unref(o).status?"离线":1===e.unref(o).status?"在线":"工作中"),c:e.n(e.unref(h)),d:e.t(e.unref(o).device_name||"-"),e:e.o(_),f:e.t(e.unref(o).device_code),g:e.t(e.unref(o).create_time),h:e.f(e.unref(o).accounts,((t,a,u)=>({a:e.unref(g)[t.type].activeIcon,b:a,c:`/ai_modules/device/pages/platform_detail/platform_detail?device_code=${e.unref(n)}&app_type=${t.type}`}))),i:e.p({name:"arrow-right",color:"#0000004d"}),j:0==(null==(i=e.unref(o).accounts)?void 0:i.length)?1:"",k:`/ai_modules/device/pages/platform_detail/platform_detail?device_code=${e.unref(n)}`,l:e.p({name:"arrow-right",color:"#0000004d"}),m:e.o(q),n:e.o(w),o:e.o((t=>e.isRef(r)?r.value=t:null)),p:e.p({modelValue:e.unref(r)}),q:e.t(e.unref(y)),r:e.p({progress:e.unref(y)}),s:e.f(e.unref(f),((t,u,i)=>({a:e.t(e.unref(a.formatNumberToWanOrYi)(t.value)),b:e.t(t.title),c:t.key}))),t:e.t(e.unref(c).length),v:e.unref(c).length>0},e.unref(c).length>0?{w:e.o(w),x:e.o(w),y:e.p({list:e.unref(c)})}:{z:e.p({text:"暂无任务"})},{A:e.o((t=>e.isRef(l)?l.value=t:null)),B:e.p({placeholder:"请输入设备名称",maxlength:"30","placeholder-style":"color: #0000004d; font-size: 26rpx;",modelValue:e.unref(l)}),C:e.o((e=>s.value=!1)),D:e.o(j),E:e.o((t=>e.isRef(s)?s.value=t:null)),F:e.p({mode:"center",width:"90%","border-radius":20,modelValue:e.unref(s)})})}}});wx.createPage(r);
