"use strict";const e=require("../../../../common/vendor.js"),s=require("../../../../api/app.js"),i=require("../../../../components/file-upload/choose-file.js"),u=require("../../enums/index.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../config/index.js"),!Array){(e.resolveComponent("u-icon")+e.resolveComponent("u-button")+e.resolveComponent("confirm-dialog")+e.resolveComponent("upload-progress"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+(()=>"../../../../components/confirm-dialog/confirm-dialog.js")+(()=>"../../../../components/upload-progress/upload-progress.js"))();const r=e.defineComponent({__name:"task_img_group",setup(r){const o=["jpg","png"],t=[5e3,5e3],n=e.ref([]),a=e.ref([]),l=e.ref(!0),p=e.ref(!1),c=e.ref(!1),f=e.computed((()=>`\n        <div>· 图片素材支持：${o.join("、")}格式，50M以内，分辨率不超过${t[0]}*${t[1]}</div>\n    <div class="mt-2">· 最多可传9张图片</div>\n    <div class="mt-2">· 不符合条件的图片会被自动删除</div>\n    `)),m=()=>{l.value?(l.value=!1,p.value=!0):d()},d=async()=>{a.value=[];try{const{tempFiles:r}=await i.chooseFile({type:"image",count:9,extension:o}),l=[];for(const s of r)try{const{width:i,height:u}=await e.index.getImageInfo({src:s.tempFilePath});if(i>t[0]||u>t[1])continue;if(s.size>52428800)continue;l.push(s)}catch(u){continue}if(0===l.length)return void e.index.$u.toast("所选图片素材均不符合条件，重新上传");a.value=l.map((e=>({...e,progress:0}))),c.value=!0;for(const e of a.value){const i=await s.uploadFile("image",{filePath:e.tempFilePath},(s=>v(s,e)));n.value.push(i.uri)}a.value.every((e=>100===e.progress))&&(c.value=!1)}catch(u){e.index.$u.toast(u),a.value=[],c.value=!1}},v=(e,s)=>{const i=a.value.findIndex((e=>e.tempFilePath===s.tempFilePath));-1!==i&&(a.value[i]={...a.value[i],progress:e})},g=()=>{0!==n.value.length?(e.index.$emit("confirm",{type:u.ListenerTypeEnum.CHOOSE_IMG,data:n.value}),e.index.navigateBack()):e.index.$u.toast("至少需要上传1张图")};return e.onLoad((e=>{e.imgs&&(n.value=JSON.parse(e.imgs))})),(s,i)=>e.e({a:e.t(e.unref(n).length),b:e.t(9),c:e.unref(n).length<9},e.unref(n).length<9?{d:e.p({name:"plus",size:"24",color:"#ffffff"}),e:e.o(m)}:{},{f:e.f(e.unref(n),((s,i,u)=>({a:s,b:"122ba698-1-"+u,c:e.o((e=>(e=>{n.value.splice(e,1)})(i)),i),d:i}))),g:e.p({name:"close",size:"24",color:"#ffffff"}),h:e.o(g),i:e.p({type:"primary","custom-style":{height:"100rpx",borderRadius:"12rpx",fontWeight:"bold"}}),j:e.o(d),k:e.o((s=>e.isRef(p)?p.value=s:null)),l:e.p({content:e.unref(f),"confirm-text":"去上传",modelValue:e.unref(p)}),m:e.o((s=>e.isRef(c)?c.value=s:null)),n:e.p({"upload-list":e.unref(a),modelValue:e.unref(c)})})}});wx.createPage(r);
