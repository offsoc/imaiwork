"use strict";const e=require("../../../../common/vendor.js"),t=require("../../../../api/device.js"),i=require("../../../../utils/util.js"),n=require("../../hooks/useDevice.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../config/index.js"),require("../../../../common/assets.js"),require("../../../../enums/appEnums.js"),!Array){(e.resolveComponent("confirm-dialog")+e.resolveComponent("empty")+e.resolveComponent("popup-bottom")+e.resolveComponent("video-preview")+e.resolveComponent("u-button")+e.resolveComponent("u-popup"))()}Math||(a+(()=>"../../../../components/confirm-dialog/confirm-dialog.js")+(()=>"../../../../components/empty/empty.js")+(()=>"../../../../components/popup-bottom/popup-bottom.js")+(()=>"../../../../components/video-preview/video-preview.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js"))();const a=()=>"../task-card/task-card.js",u=e.defineComponent({__name:"task-list",props:{list:null},emits:["delete","update-name"],setup(a,{emit:u}){const o=a,r=e.ref(!1),s=e.ref({}),l=e.ref(!1),d=e.ref({}),c=e.ref(!1),p=e.reactive({id:"",sub_task_id:"",source:"",name:""}),m=e.ref(!1),{platformLogo:f,getTaskStatusStyle:v,getTaskStatusText:_}=n.useDevice(),h=e.computed((()=>{const e={morning:"上午",afternoon:"下午"};return o.list.sort(((e,t)=>e.start_time.localeCompare(t.start_time))).reduce(((t,i)=>{const n=5!=i.start_time.length,a=new Date(n?i.start_time:`2000-01-01 ${i.start_time}`).getHours()<12?"morning":"afternoon";let u=t.find((t=>t.title===e[a]));return u||(u={title:e[a],list:[]},t.push(u)),i.time=n?`${i.start_time.split(" ")[1]}-${i.end_time.split(" ")[1]}`:`${i.start_time}-${i.end_time}`,u.list.push(i),t}),[])})),g=e=>{i.setFormData(e,p),m.value=!0},k=async()=>{if(p.name){e.index.showLoading({title:"保存中...",mask:!0});try{await t.updateDeviceTaskName(p),e.index.hideLoading(),e.index.showToast({title:"保存成功",icon:"none",duration:3e3}),m.value=!1,u("update-name")}catch(i){e.index.hideLoading(),e.index.showToast({title:i||"保存失败",icon:"none",duration:3e3})}}else e.index.$u.toast("请输入任务名称")},j=()=>{c.value=!0},x=async()=>{r.value=!1,e.index.showLoading({title:"删除中...",mask:!0});try{await t.deleteDeviceTaskCalendar({id:s.value.id,sub_task_id:s.value.sub_task_id,source:s.value.source}),e.index.hideLoading(),e.index.showToast({title:"删除成功",icon:"none",duration:3e3}),y(),r.value=!1,l.value=!1,d.value={},s.value={},u("delete")}catch(i){e.index.hideLoading(),e.index.showToast({title:"删除失败",icon:"none",duration:3e3})}},y=async()=>{try{const e=await t.getDeviceTaskSubtasks({id:s.value.id,sub_task_id:s.value.sub_task_id,source:s.value.source});d.value=e}catch(e){d.value={}}},b=()=>{const{material_url:t}=d.value.detail;if(!t)return;const i=t.split(",");console.log("pics",i),e.index.previewImage({urls:i})};return(t,i)=>{var n,a,u,o,q,w,C,T,S,D,L,$,z,F,R,E,I,M,V,A,B;return e.e({a:e.f(e.unref(h),((t,i,n)=>({a:e.t(t.title),b:e.f(t.list,((t,i,a)=>({a:e.t(t.time),b:e.o((e=>(e=>{l.value=!0,s.value=e,y()})(t)),i),c:e.o(g,i),d:"34a35824-0-"+n+"-"+a,e:e.p({item:t}),f:i}))),c:t.status}))),b:e.o(x),c:e.o((t=>e.isRef(r)?r.value=t:null)),d:e.p({content:"确定要删除任务吗？",center:!0,"z-index":1001,modelValue:e.unref(r)}),e:e.t(null==(n=e.unref(d).detail)?void 0:n.task_name),f:e.t(e.unref(_)(e.unref(s).status)),g:e.n(e.unref(v)(e.unref(s).status)),h:e.t(e.unref(d).task_category),i:e.t((null==(a=e.unref(d).device_info)?void 0:a.device_name)||(null==(u=e.unref(d).device_info)?void 0:u.device_code)||"-"),j:e.t(e.unref(s).day),k:e.t(e.unref(d).start_time),l:e.t(e.unref(d).end_time),m:(null==(o=e.unref(d).account_info)?void 0:o.avatar)||(null==(q=e.unref(d).account_info)?void 0:q.wechat_avatar),n:e.unref(d).account_type},e.unref(d).account_type?{o:e.unref(f)[e.unref(d).account_type].activeIcon}:{},{p:e.t((null==(w=e.unref(d).account_info)?void 0:w.nickname)||(null==(C=e.unref(d).account_info)?void 0:C.wechat_nickname)||"-"),q:[4,1].includes(e.unref(d).task_type)},[4,1].includes(e.unref(d).task_type)?e.e({r:e.unref(d).detail},e.unref(d).detail?e.e({s:4==e.unref(d).task_type},4==e.unref(d).task_type?{t:e.t((null==(S=null==(T=e.unref(d).detail)?void 0:T.keywords)?void 0:S.length)||0),v:e.f(null==(D=e.unref(d).detail)?void 0:D.keywords,((t,i,n)=>({a:e.t(t),b:t})))}:{},{w:1==e.unref(d).task_type},1==e.unref(d).task_type?e.e({x:null==(L=e.unref(d).detail)?void 0:L.pic,y:e.o(b),z:1==(null==($=e.unref(d).detail)?void 0:$.material_type)},1==(null==(z=e.unref(d).detail)?void 0:z.material_type)?{A:e.o(j)}:{},{B:e.t(null==(F=e.unref(d).detail)?void 0:F.material_title),C:e.t(null==(R=e.unref(d).detail)?void 0:R.material_subtitle),D:null==(E=e.unref(d).detail)?void 0:E.material_tag},(null==(I=e.unref(d).detail)?void 0:I.material_tag)?{E:e.f(null==(M=e.unref(d).detail)?void 0:M.material_tag,((t,i,n)=>({a:e.t(t),b:t})))}:{},{F:e.t(null==(V=e.unref(d).detail)?void 0:V.publish_time)}):{}):{G:e.p({text:"内容还在生成中，请耐心等待...",size:240})}):{},{H:e.o((e=>r.value=!0)),I:e.o((t=>e.isRef(l)?l.value=t:null)),J:e.p({title:"任务详情","custom-class":"bg-_hF6F6F6_","show-footer":!1,height:"70%",show:e.unref(l)}),K:e.o((t=>e.isRef(c)?c.value=t:null)),L:e.p({title:"视频预览",poster:null==(A=e.unref(d).detail)?void 0:A.pic,"video-url":null==(B=e.unref(d).detail)?void 0:B.material_url,show:e.unref(c)}),M:e.unref(m),N:e.unref(p).name,O:e.o((t=>e.unref(p).name=t.detail.value)),P:e.o((e=>m.value=!1)),Q:e.p({shape:"circle","custom-style":{height:"100rpx",boxShadow:"0 0 0 1px rgba(0, 0, 0, 0.1)",backgroundColor:"transparent",color:"rgba(0,0,0,0.3)",fontSize:"26rpx"}}),R:e.o(k),S:e.p({type:"primary",shape:"circle","custom-style":{flex:1,height:"100rpx",boxShadow:"0 6px 12px 0 rgba(0, 101, 251, 0.20)",fontSize:"26rpx"}}),T:e.o((e=>m.value=!1)),U:e.o((t=>e.isRef(m)?m.value=t:null)),V:e.p({mode:"center",width:"90%","border-radius":"64",closeable:!1,modelValue:e.unref(m)})})}}}),o=e._export_sfc(u,[["__scopeId","data-v-34a35824"]]);wx.createComponent(o);
