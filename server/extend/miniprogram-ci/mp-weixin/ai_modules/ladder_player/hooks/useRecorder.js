"use strict";const e=require("../../../common/vendor.js");require("../static/Recorder-UniCore/app-uni-support.js"),e.Recorder.inInstal=!0,exports.useRecorder=function(t,n){t=t||{type:"mp3",sampleRate:16e3,bitRate:32,duration:3e4,numberOfChannels:1,encodeBitRate:64e3,format:"mp3",frameSize:1200};const r=e.ref(!1),o=e.ref(0),a=t=>new Promise((async(n,r)=>{e.RecordApp.UniWebViewActivate(t),e.RecordApp.RequestPermission((()=>{n()}),(async t=>{e.index.showModal({title:"开启麦克风权限",content:"为了正常使用语音输入功能，请开启麦克风权限",confirmText:"去设置",success:async t=>{if(t.confirm){const{authSetting:t}=await e.index.openSetting();t["scope.record"]&&n()}}})}))})),s=()=>{e.RecordApp.Stop(((t,a,s)=>{e.RecordApp.UniSaveLocalFile("recorder.mp3",t,(async e=>{var t;null==(t=null==n?void 0:n.onstop)||t.call(n,{tempFilePath:e,duration:o.value})}),(e=>{console.log(e)})),r.value=!1}))};return e.onBeforeUnmount((()=>{s()})),{isRecording:r,recordTime:o,start:async r=>{try{await a(r),e.RecordApp.UniWebViewActivate(r),e.RecordApp.Start({type:"mp3",bitRate:16,sampleRate:16e3,onProcess:(e,r,a,l,i,c)=>{var u;o.value=a,(null==t?void 0:t.duration)&&o.value>(null==t?void 0:t.duration)?s():null==(u=null==n?void 0:n.ondata)||u.call(n,{pcmData:e[e.length-1],powerLevel:r,sampleRate:l,duration:a})},onProcess_renderjs:"function(buffers,powerLevel,duration,bufferSampleRate,newBufferIdx,asyncEnd){\n\t\t\t\t\t    //App中在这里修改buffers会改变生成的音频文件，但注意：buffers会先转发到逻辑层onProcess后才会调用本方法，因此在逻辑层的onProcess中需要重新修改一遍\n\t\t\t\t\t    //本方法可以返回true，renderjs中的onProcess将开启异步模式，处理完后调用asyncEnd结束异步，注意：这里异步修改的buffers一样的不会在逻辑层的onProcess中生效\n\t\t\t\t\t    //App中是在renderjs中进行的可视化图形绘制，因此需要写在这里，this是renderjs模块的this（也可以用This变量）；如果代码比较复杂，请直接在renderjs的methods里面放个方法xxxFunc，这里直接使用this.xxxFunc(args)进行调用\n\t\t\t\t\t     // if(this.waveView) this.waveView.input(buffers[buffers.length-1],powerLevel,bufferSampleRate);\n\t\t\t\t\t\tthis.callback({\n\t\t\t\t\t\t\tpcmData: buffers[buffers.length - 1],\n\t\t\t\t\t\t\tpowerLevel: powerLevel,\n\t\t\t\t\t\t\tsampleRate: bufferSampleRate,\n\t\t\t\t\t\t})\n\t\t\t\t\t}"},(async()=>{var t,r;const o=e.RecordApp.UniFindCanvas;null==(t=null==n?void 0:n.onstart)||t.call(n),null==(r=null==n?void 0:n.ondrawAudio)||r.call(n,o,e.Recorder)}))}catch(l){return Promise.reject(l)}},authorize:a,stop:s,resume:()=>{e.RecordApp.Resume((()=>{var e;null==(e=null==n?void 0:n.onresume)||e.call(n)}))},pause:()=>{e.RecordApp.Pause((()=>{var e;null==(e=null==n?void 0:n.onpause)||e.call(n)}))}}};
