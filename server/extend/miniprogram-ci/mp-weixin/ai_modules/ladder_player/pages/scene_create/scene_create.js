"use strict";const e=require("../../../../common/vendor.js"),o=require("../../../../common/assets.js"),n=require("../../../../api/ladder_player.js"),i=require("../../../../hooks/useKeyboardHeight.js"),r=require("../../../../stores/app.js"),t=require("../../../../enums/appEnums.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../config/index.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-input")+e.resolveComponent("u-icon")+e.resolveComponent("u-button")+e.resolveComponent("u-line")+e.resolveComponent("u-popup"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-line/u-line.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js")+a)();const a=()=>"../../../../components/knb-select/knb-select.js",u=e.defineComponent({__name:"scene_create",setup(a){const u=r.useAppStore(),{dynamicHeight:s}=i.useKeyboardHeight(),d=e.reactive({id:"",name:"",description:"",coach_name:"",coach_persona:"",coach_voice:"",practitioner_persona:"",coach_emotion:"",coach_intensity:"",index_id:void 0,kb_id:void 0,kb_type:""}),c=e.ref(null),l=e.computed((()=>{var e;const o=(null==(e=u.getLadderConfig)?void 0:e.emotions)||[];return o.length?(d.id||(d.coach_emotion=o[0].value),o):[]})),p=e.computed((()=>{var e;const o=(null==(e=u.getLadderConfig)?void 0:e.intensity)||[];return o.length?(d.id||(d.coach_intensity=o[0].value),o):[]})),m=e.computed((()=>{var e;const o=(null==(e=u.getLadderConfig)?void 0:e.voice)||[];return o.length?(d.id||(d.coach_voice=o[0].code),o):[]})),h=e.shallowRef(),v=e.ref({name:"",index_id:""}),f=e=>{const{type:o,data:n}=e;v.value=n,o==t.KnbTypeEnum.RAG?(d.index_id=n.index_id,d.kb_id=void 0):(d.kb_id=n.id,d.index_id=void 0),d.kb_type=o==t.KnbTypeEnum.RAG?1:2},_=e.ref(!1),x=async()=>{if(!d.name)return void e.index.$u.toast("请输入场景名称");if(!d.description)return void e.index.$u.toast("请输入场景简介");if(!d.coach_name)return void e.index.$u.toast("请输入陪练者名称");if(!d.coach_persona)return void e.index.$u.toast("请输入陪练画像描述");if(!d.practitioner_persona)return void e.index.$u.toast("请输入我的角色");e.index.showLoading({title:"创建中",mask:!0});const o=d.id?"编辑":"创建";try{const i=d.id?await n.lpSceneEdit(d):await n.lpSceneAdd(d);if(e.index.hideLoading(),e.index.showToast({title:`${o}成功`,icon:"none",duration:3e3}),!d.id)return void e.index.$u.route({url:"/ai_modules/ladder_player/pages/chat/chat",params:{id:i.id},type:"redirect"});setTimeout((()=>{e.index.navigateBack()}),2e3)}catch(i){e.index.hideLoading(),e.index.showToast({title:i||`${o}失败`,icon:"none",duration:3e3})}},g=()=>{e.index.showModal({title:"提示",content:"确定要删除场景吗？",success:async o=>{if(o.confirm){e.index.showLoading({title:"删除中",mask:!0});try{await n.lpSceneDelete({id:d.id}),e.index.hideLoading(),e.index.showToast({title:"删除成功",icon:"none",duration:3e3}),setTimeout((()=>{e.index.navigateBack({delta:2})}),2e3)}catch(i){e.index.hideLoading(),e.index.showToast({title:i||"删除失败",icon:"none",duration:3e3})}}}})},y=async e=>{for(const o in d)null!=e[o]&&null!=e[o]&&(d[o]=e[o])};return e.onLoad((e=>{e.id&&(d.id=e.id,(async()=>{var e,o;const i=await n.lpSceneDetail({id:d.id});c.value=i,v.value.index_id=null==(e=i.knowledge)?void 0:e.index_id,v.value.name=null==(o=i.knowledge)?void 0:o.name,y(i)})())})),(n,i)=>e.e({a:e.p({"is-fixed":!1,"border-bottom":!1,background:{background:"transparent"}}),b:o._imports_0$25,c:e.f(e.unref(m),((o,n,i)=>({a:o.logo,b:e.t(o.name),c:n,d:e.unref(d).coach_voice===o.code?1:"",e:e.o((n=>e.unref(d).coach_voice=o.code),n)}))),d:e.o((o=>e.unref(d).name=o)),e:e.p({placeholder:"点击此输入您想练习的场景；如：茶叶销售","placeholder-style":"color: #524B6B;",modelValue:e.unref(d).name}),f:e.o((o=>e.unref(v).name=o)),g:e.p({placeholder:"点击配置挂载知识库","placeholder-style":"color: #524B6B;",disabled:!0,modelValue:e.unref(v).name}),h:e.p({name:"arrow-right",color:"#524B6B",size:24}),i:e.o((o=>(async()=>{var o;await e.nextTick$1(),null==(o=h.value)||o.open(v.value)})())),j:e.o((o=>e.unref(d).description=o)),k:e.p({placeholder:"简单概括您的场景，如：售后服务人员，正在沟通处理客户提出的退款问题",type:"textarea","placeholder-style":"color: #524B6B;",height:"160",modelValue:e.unref(d).description}),l:e.o((o=>e.unref(d).coach_name=o)),m:e.p({placeholder:"点击此输入您设定的陪练者名称；如：王总","placeholder-style":"color: #524B6B;",modelValue:e.unref(d).coach_name}),n:e.f(e.unref(l),((o,n,i)=>({a:e.t(o.name),b:n,c:e.unref(d).coach_emotion==o.value?1:"",d:e.o((n=>e.unref(d).coach_emotion=o.value),n)}))),o:e.f(e.unref(p),((o,n,i)=>({a:e.t(o.name),b:n,c:e.unref(d).coach_intensity==o.value?1:"",d:e.o((n=>e.unref(d).coach_intensity=o.value),n)}))),p:e.o((o=>e.unref(d).coach_persona=o)),q:e.p({placeholder:"点击此输入您需要创建的陪练对象背景设定；如：对茶叶研究很丰富的上市公司老板，对圈子和品质要求较高，脾气不太好。",type:"textarea","placeholder-style":"color: #524B6B;",height:"160",modelValue:e.unref(d).coach_persona}),r:e.o((o=>e.unref(d).practitioner_persona=o)),s:e.p({placeholder:"点击此输入您当前扮演的角色；如：茶叶首席销售","placeholder-style":"color: #524B6B;",modelValue:e.unref(d).practitioner_persona}),t:e.unref(s)+"px",v:e.unref(d).id},e.unref(d).id?{}:{w:o._imports_1$14},{x:e.o(x),y:e.p({type:"primary",shape:"circle","custom-style":{width:"556rpx",height:"104rpx"}}),z:e.unref(c)&&0!=e.unref(c).user_id},e.unref(c)&&0!=e.unref(c).user_id?{A:e.p({name:"trash-fill",color:"#fff",size:48}),B:e.o((e=>_.value=!0))}:{},{C:e.p({name:"info-circle",color:"#FE975F",size:32}),D:e.o((e=>_.value=!1)),E:e.o(g),F:e.o((o=>e.isRef(_)?_.value=o:null)),G:e.p({mode:"bottom","border-radius":"40",height:"25%",modelValue:e.unref(_)}),H:e.sr(h,"6f2455f0-13",{k:"knbSelectRef"}),I:e.o(f),J:e.p({"show-vector":!1})})}});wx.createPage(u);
