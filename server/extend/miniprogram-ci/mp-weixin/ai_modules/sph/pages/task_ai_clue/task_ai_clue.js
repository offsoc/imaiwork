"use strict";const e=require("../../../../common/vendor.js"),u=require("../../../../common/assets.js"),t=require("../../../../api/sph.js"),n=require("../../../../stores/user.js"),r=require("../../../../enums/appEnums.js"),a=require("../../enums/index.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../router/index.js"),require("../../../../config/index.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-icon"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+s)();const s=()=>"../../components/clue-edit/clue-edit.js",i=e.defineComponent({__name:"task_ai_clue",setup(s){const i=n.useUserStore(),{userTokens:o}=e.toRefs(i),l=e.ref(),c=e.ref(""),v=e.ref(150),f=e.ref([]),d=[10,20,30,40,50],p=e.ref(d[0]),m=e.ref(-1),q=e.ref(!1),j=e.ref(null),g=e.ref(!1),b=e.computed((()=>f.value.every((e=>"success"===e.status)))),h=e.computed((()=>{var e;const u=null==(e=i.getTokenByScene(r.TokensSceneEnum.SPH_AI_CLUE))?void 0:e.score;return parseFloat(u)*p.value})),k=async u=>{if(u.trim()){if(!g.value)if(o.value<h.value)e.index.$u.toast("算力不足，请充值！");else try{g.value=!0,f.value=Array.from({length:p.value},(()=>({title:"",content:"",status:"pending"})));const e=await t.getAiKeywords({keyword:c.value,targetCount:p.value,channelVersion:l.value});f.value=e.filter((e=>-1==e.indexOf("="))).map((e=>({content:e.trim(),status:"success"})))}catch(n){g.value=!1,e.index.showToast({title:n||"生成失败，请重试",icon:"none",duration:3e3})}}else e.index.$u.toast("请输入文案")},x=()=>{if(g.value){if(!b.value)return void e.index.$u.toast("正在生成中，请稍后再试");g.value=!1}f.value=[],g.value=!1,k(c.value)},_=e=>{f.value[m.value].content=e,q.value=!1},y=()=>{b.value?(e.index.$emit("confirm",{type:a.ListenerTypeEnum.TASK_AI_CLUE,data:f.value.map((e=>e.content))}),f.value=[],e.index.navigateBack()):e.index.$u.toast("文案在生成中...")},C=()=>{f.value.length>0?(f.value=[],g.value=!1):e.index.navigateBack()};return e.onLoad((e=>{v.value=e.limit,l.value=e.type})),(t,n)=>e.e({a:e.p({title:"线索词AI生成","title-bold":!0,"is-fixed":!1,"border-bottom":!1,background:{background:"transparent"},"custom-back":C}),b:!e.unref(g)},e.unref(g)?{i:e.f(e.unref(f),((t,n,r)=>e.e({a:"pending"===t.status},"pending"===t.status?{b:u._imports_0$29,c:e.t(n+1)}:{d:e.t(t.content),e:e.o((u=>(async u=>{m.value=u,q.value=!0,await e.nextTick$1(),j.value.setFormData(f.value[u].content)})(n)),n),f:"43c704bb-1-"+r,g:e.p({name:"close",color:"#ffffff",size:"16"}),h:e.o((e=>(e=>{f.value.splice(e,1),0===f.value.length&&(g.value=!1)})(n)),n)},{i:n})))}:{c:500,d:e.unref(c),e:e.o((u=>e.isRef(c)?c.value=u.detail.value:null)),f:e.t(e.unref(c).length),g:e.t(500),h:e.f(d,((u,t,n)=>({a:e.t(u),b:u,c:e.unref(p)===u?1:"",d:e.o((e=>p.value=u),u)})))},{j:!e.unref(g)},e.unref(g)?{n:e.o(x),o:e.n(e.unref(b)?"bg-black":"bg-_h787878CC_"),p:e.o(y)}:{k:e.t(e.unref(h)),l:e.n(e.unref(c).length>0?"bg-black":"bg-_h787878CC_"),m:e.o((u=>k(e.unref(c))))},{q:e.sr(j,"43c704bb-2",{k:"clueEditRef"}),r:e.o(_),s:e.o((e=>q.value=!1)),t:e.o((u=>e.isRef(q)?q.value=u:null)),v:e.p({modelValue:e.unref(q)})})}}),o=e._export_sfc(i,[["__scopeId","data-v-43c704bb"]]);wx.createPage(o);
