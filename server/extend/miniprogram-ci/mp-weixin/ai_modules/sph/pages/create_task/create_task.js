"use strict";const e=require("../../../../common/vendor.js"),r=require("../../../../api/sph.js"),o=require("../../../../api/device.js"),s=require("../../../../hooks/useLockFn.js"),t=require("../../../../hooks/usePaging.js"),u=require("../../../../stores/app.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../config/index.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-icon")+e.resolveComponent("u-button")+e.resolveComponent("u-input")+e.resolveComponent("u-popup"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js"))();const i=e.defineComponent({__name:"create_task",setup(i){const a=u.useAppStore(),n=e.computed((()=>a.config.wechat_remarks||[])),p=e.ref([]),c=e.ref(!1),l=e.ref(""),d=e.reactive({crawl_type:"",chat_type:"0",chat_number:30,chat_interval_time:10,greeting_content:"",add_type:"1",remark:"",add_number:15,add_interval_time:10,private_message_prompt:"",add_friends_prompt:"",wechat_id:"",wechat_reg_type:0,add_remark_enable:1,remarks:n.value}),{pager:h,getLists:m}=t.usePaging({fetchFun:o.getDeviceList,params:{page_size:999}}),v=()=>{l.value?(p.value.unshift(l.value),l.value="",c.value=!1):e.index.$u.toast("请输入检索词")},g=()=>{l.value="",c.value=!1},x=()=>{e.index.$u.route({url:"/ai_modules/sph/pages/create_task_set/create_task_set",params:{data:JSON.stringify(d)}})},{lockFn:_,isLock:f}=s.useLockFn((async()=>{if(0===p.value.length)return void e.index.$u.toast("请输入检索词");const o=h.lists.map((e=>e.device_code));if(0!==o.length){e.index.showLoading({title:"创建中...",mask:!0});try{await r.createTask({...d,type:[4],device_codes:o,keywords:p.value}),e.index.hideLoading(),e.index.$u.route({url:"/ai_modules/sph/pages/index/index",type:"reLaunch"})}catch(s){e.index.hideLoading(),e.index.showToast({title:s,icon:"none",duration:3e3})}}else e.index.$u.toast("当前账号无绑定设备")}));return e.onLoad((({keywords:e,type:r})=>{e&&(e=JSON.parse(decodeURIComponent(e)),p.value.push(...e)),r&&(d.crawl_type=r)})),e.onShow((()=>{m(),e.index.$on("save",(r=>{Object.assign(d,r),e.index.$off("save")}))})),(r,o)=>({a:e.p({title:"检索关键词设置",background:{backgroundColor:"#f6f6f6"}}),b:e.o((e=>c.value=!0)),c:e.f(e.unref(p),((r,o,s)=>({a:e.t(r),b:"6ef7a26f-1-"+s,c:e.o((r=>(r=>{e.index.showModal({title:"提示",content:"确定删除该关键词吗？",success:e=>{e.confirm&&p.value.splice(r,1)}})})(o)),o),d:o}))),d:e.p({name:"close",color:"#787878",size:16}),e:e.o(e.unref(_)),f:e.p({type:"primary",shape:"circle","custom-style":{width:"100%",height:"100rpx",boxShadow:"0 6px 12px 0 rgba(0, 101, 251, 0.20)",fontSize:"26rpx"},disabled:e.unref(f)}),g:e.o(x),h:e.p({shape:"circle","custom-style":{width:"100%",height:"100rpx",boxShadow:"0 0 0 1px rgba(0, 0, 0, 0.1)",backgroundColor:"transparent",color:"rgba(0,0,0,0.3)",fontSize:"26rpx"}}),i:e.o((r=>e.isRef(l)?l.value=r:null)),j:e.p({placeholder:"请输入检索词","placeholder-style":"font-size:26rpx;color:rgba(0,0,0,0.2)",focus:e.unref(c),maxlength:30,modelValue:e.unref(l)}),k:e.o(g),l:e.p({shape:"circle","custom-style":{height:"100rpx",boxShadow:"0 0 0 1px rgba(0, 0, 0, 0.1)",backgroundColor:"transparent",color:"rgba(0,0,0,0.3)",fontSize:"26rpx"}}),m:e.o(v),n:e.p({type:"primary",shape:"circle","custom-style":{flex:1,height:"100rpx",boxShadow:"0 6px 12px 0 rgba(0, 101, 251, 0.20)",fontSize:"26rpx"}}),o:e.o(g),p:e.o((r=>e.isRef(c)?c.value=r:null)),q:e.p({mode:"center",width:"90%","border-radius":"64",closeable:!1,modelValue:e.unref(c)})})}});wx.createPage(i);
