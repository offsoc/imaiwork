"use strict";const i=require("../../../common/vendor.js"),e=require("../../../components/file-upload/choose-file.js"),o=require("../../../api/app.js"),n=require("../enums/index.js"),t={size:300,minResolution:360,maxResolution:1080,videoMinDuration:5,videoMaxDuration:600},a={[n.DigitalHumanModelVersionEnum.STANDARD]:{size:100,minResolution:480,maxResolution:1080,videoMinDuration:15,videoMaxDuration:60},[n.DigitalHumanModelVersionEnum.SUPER]:{size:500,minResolution:640,maxResolution:2048,videoMinDuration:2,videoMaxDuration:120},[n.DigitalHumanModelVersionEnum.ADVANCED]:t,[n.DigitalHumanModelVersionEnum.ELITE]:t,[n.DigitalHumanModelVersionEnum.CHANJING]:{size:2e3,minResolution:360,maxResolution:2048,videoMinDuration:30,videoMaxDuration:300},[n.DigitalHumanModelVersionEnum.SHANJIAN]:{size:100,minResolution:360,maxResolution:2e3,videoMinDuration:10,videoMaxDuration:30}};exports.commonUploadLimit=t,exports.uploadLimit=a,exports.useUpload=n=>{const{size:t=100,resolution:a=[640,2048],duration:s=[15,60],extension:u=["mp4","mov"],maxDuration:r=10,sizeType:l=["original"],onSuccess:d,onError:m,onProgress:c}=n,p=i.reactive({url:"",pic:"",seconds:0,duration:"00:00",width:0,height:0}),D=async e=>{const{tempFiles:o}=e,n=o[0],u=n.size,r=n.width,l=n.height;p.width=r,p.height=l;const c=n.duration,D=r>=a[0]&&r<=a[1],v=c>=s[0]&&c<=s[1];if(u>1024*t*1024)i.index.showToast({title:`视频大小不能超过${t}M`,icon:"none",duration:4e3});else if(D)if(v)try{await h(n.thumbTempFilePath),await x(n.tempFilePath),null==d||d(p)}catch(M){null==m||m({type:"video",error:M})}else i.index.showToast({title:`上传视频时长不能小于${s[0]}秒或大于${s[1]}秒`,icon:"none",duration:4e3});else i.index.showToast({title:`上传视频分辨率不能满足${a[0]}-${a[1]}`,icon:"none",duration:4e3})},x=async i=>{const{uri:e}=await o.uploadFile("video",{filePath:i},(i=>{null==c||c({type:"video",progress:i})}));p.url=e},h=async i=>{const{uri:e}=await o.uploadImage(i,"","",(i=>{null==c||c({type:"image",progress:i})}));p.pic=e};return{upload:async()=>{try{const i=await e.chooseFile({count:1,type:"video",camera:"front",sourceType:["album"],extension:u,maxDuration:r,sizeType:l});D(i)}catch(i){null==m||m(i)}},uploadResult:p}};
