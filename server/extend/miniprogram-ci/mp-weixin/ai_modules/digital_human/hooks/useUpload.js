"use strict";const i=require("../../../common/vendor.js"),o=require("../../../components/file-upload/choose-file.js"),e=require("../../../api/app.js"),n=require("../enums/index.js"),t={size:300,minResolution:360,maxResolution:1080,videoMinDuration:5,videoMaxDuration:600},a={[n.DigitalHumanModelVersionEnum.STANDARD]:{size:100,minResolution:480,maxResolution:1080,videoMinDuration:15,videoMaxDuration:60},[n.DigitalHumanModelVersionEnum.SUPER]:{size:500,minResolution:640,maxResolution:2048,videoMinDuration:2,videoMaxDuration:120},[n.DigitalHumanModelVersionEnum.ADVANCED]:t,[n.DigitalHumanModelVersionEnum.ELITE]:t,[n.DigitalHumanModelVersionEnum.CHANJING]:{size:2e3,minResolution:360,maxResolution:2048,videoMinDuration:30,videoMaxDuration:300}};exports.commonUploadLimit=t,exports.uploadLimit=a,exports.useUpload=n=>{const{size:t=100,resolution:a=[640,2048],duration:s=[15,60],extension:u=["mp4","mov"],onSuccess:r,onError:l,onProgress:d}=n,m=i.reactive({url:"",pic:"",seconds:0,duration:"00:00",width:0,height:0}),c=async o=>{const{tempFiles:e}=o,n=e[0],u=n.size,l=n.width,d=n.height;m.width=l,m.height=d,u>1024*t*1024?i.index.showToast({title:`视频大小不能超过${t}M`,icon:"none",duration:4e3}):l<a[0]||l>a[1]?i.index.showToast({title:`上传视频分辨率不能满足${a[0]}*${a[1]}`,icon:"none",duration:4e3}):n.duration<s[0]||n.duration>s[1]?i.index.showToast({title:`上传视频时长不能小于${s[0]}秒或大于${s[1]}秒`,icon:"none",duration:4e3}):(await h(n.thumbTempFilePath),await p(n.tempFilePath),null==r||r(m))},p=async o=>{try{const{uri:i}=await e.uploadFile("video",{filePath:o},(i=>{null==d||d({type:"video",progress:i})}));m.url=i}catch(n){if(null==l||l(n),"uploadFile:fail abort"==n)return;i.index.$u.toast("上传失败")}},h=async i=>{const{uri:o}=await e.uploadImage(i,"","",(i=>{null==d||d({type:"image",progress:i})}));m.pic=o};return{upload:async()=>{try{const i=await o.chooseFile({count:1,type:"video",camera:"front",sourceType:["album"],extension:u});c(i)}catch(i){null==l||l(i)}},uploadResult:m}};
