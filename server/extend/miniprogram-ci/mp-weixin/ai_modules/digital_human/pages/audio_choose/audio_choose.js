"use strict";const e=require("../../../../common/vendor.js"),a=require("../../../../common/assets.js"),i=require("../../../../api/material.js"),t=require("../../../../api/app.js"),r=require("../../../../hooks/useAudio.js"),s=require("../../../../components/file-upload/choose-file.js"),u=require("../../enums/index.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../config/index.js"),!Array){(e.resolveComponent("u-tabs")+e.resolveComponent("empty")+e.resolveComponent("z-paging")+e.resolveComponent("u-button"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-tabs/u-tabs.js")+(()=>"../../../../components/empty/empty.js")+(()=>"../../../../node-modules/z-paging/components/z-paging/z-paging.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-button/u-button.js"))();const o=e.defineComponent({__name:"audio_choose",setup(o){const n=[{name:"系统",value:"system"},{name:"我的",value:"0"},{name:"科技",value:"1"},{name:"悬疑",value:"2"},{name:"抒情",value:"3"},{name:"欢快",value:"4"},{name:"古典",value:"5"},{name:"跳跃",value:"6"}],l=e.ref(0),p=e=>{var a;l.value=e,null==(a=c.value)||a.reload()},m=e.ref([]),c=e.ref(),d=async(e,a)=>{var t,r;try{const r=n[l.value].value;let s=[];"system"==r?(({lists:s}=await i.getMaterialLibraryList({m_type:6,page_no:e,page_size:a})),s=s.map((e=>({...e,url:e.content,id:`${e.id}-system`})))):({lists:s}=await i.getMaterialMusicList({page_no:e,page_size:a,style:r})),null==(t=c.value)||t.complete(s)}catch(s){null==(r=c.value)||r.complete([])}},v=async()=>{const e=await s.chooseFile({count:9,type:"file",extension:[".mp3",".wav"]});g(e)},g=async a=>{const{tempFiles:i}=a;i.forEach((a=>{a.size>20971520?e.index.$u.toast("文件包含超过20M，无法上传"):h(a)}))},h=async a=>{var r;try{s="上传中",e.index.showLoading({title:s,mask:!0});const{uri:u}=await t.uploadFile("audio",{filePath:a.path});e.index.hideLoading(),await i.addMaterialMusic({url:u,name:a.name,type:"0"}),e.index.$u.toast("上传成功"),null==(r=c.value)||r.reload()}catch(u){((a,i=5e3)=>{e.index.showToast({title:a,icon:"none",duration:i})})(u||"解析失败")}finally{e.index.hideLoading()}var s},f=e.ref(),{play:j,setUrl:y,pause:q,pauseAll:x,isPlaying:b}=r.useAudio(),_=e.ref(),w=e=>{var a;return(null==(a=_.value)?void 0:a.id)==e},k=()=>{0!=_.value.length?(e.index.$emit("confirm",{type:u.ListenerTypeEnum.CHOOSE_MUSIC,data:_.value}),e.index.navigateBack()):e.index.$u.toast("请选择背景音乐")};return e.onLoad((a=>{e.index.setNavigationBarColor({frontColor:"#000000",backgroundColor:"#F9FAFB"})})),(i,t)=>e.e({a:e.o(p),b:e.p({list:n,current:e.unref(l),height:"100","bar-width":"108","font-size":"26rpx","bg-color":"#F9FAFB",gutter:"40","active-color":"#000000","inactive-color":"#00000080","bar-style":{backgroundColor:"var(--color-primary)",height:"4rpx",bottom:"-5rpx"}}),c:e.f(e.unref(m),((i,t,r)=>e.e({a:w(i.id)},w(i.id)?{b:a._imports_0$11}:{c:a._imports_1$8},{d:e.n(w(i.id)?"bg-primary":"bg-_h0000000d_"),e:e.t(i.name),f:e.t(e.unref(b)&&e.unref(f)==i.id?"暂停":"播放"),g:e.n(w(i.id)?"text-primary":"text-_h00000080_"),h:e.o((e=>(({id:e,url:a})=>{b.value&&f.value!==e&&x(),b.value?q():(f.value!==e&&y(a),j(),f.value=e)})(i)),t),i:w(i.id)},w(i.id)?{j:a._imports_1$6}:{k:a._imports_2$3},{l:t,m:w(i.id)?1:"",n:e.o((e=>{var a;w((a=i).id)?_.value="":_.value=a}),t)}))),d:e.sr(c,"482cbc38-1",{k:"pagingRef"}),e:e.o(d),f:e.o((a=>e.isRef(m)?m.value=a:null)),g:e.p({fixed:!1,"safe-area-inset-bottom":!0,modelValue:e.unref(m)}),h:"0"==n[e.unref(l)].value},"0"==n[e.unref(l)].value?{i:e.o(v)}:{},{j:e.o(k),k:e.p({type:"primary",shape:"circle","custom-style":{width:"100%",height:"100rpx",boxShadow:"0 6px 12px 0 rgba(0, 101, 251, 0.20)",fontSize:"26rpx"}})})}});wx.createPage(o);
