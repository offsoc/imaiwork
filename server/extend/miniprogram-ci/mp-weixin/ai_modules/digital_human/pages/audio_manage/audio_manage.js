"use strict";const e=require("../../../../common/vendor.js"),r=require("../../../../common/assets.js"),s=require("../../../../hooks/useAudio.js"),o=require("../../../../api/digital_human.js"),n=require("../../../../hooks/useLockFn.js"),a=require("../../../../utils/util.js"),u=require("../../../../stores/app.js"),i=require("../../../../stores/user.js"),t=require("../../../../enums/appEnums.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../router/index.js"),require("../../../../config/index.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),!Array){(e.resolveComponent("u-search")+e.resolveComponent("u-swipe-action")+e.resolveComponent("empty")+e.resolveComponent("z-paging"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-search/u-search.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-swipe-action/u-swipe-action.js")+(()=>"../../../../components/empty/empty.js")+(()=>"../../../../node-modules/z-paging/components/z-paging/z-paging.js"))();const l=e.defineComponent({__name:"audio_manage",setup(l){var d,c;const m=u.useAppStore(),{getDigitalHumanConfig:v}=e.toRefs(m),f=i.useUserStore(),{userTokens:p}=e.toRefs(f),g=null==(d=f.getTokenByScene(t.TokensSceneEnum.HUMAN_AUDIO))?void 0:d.score,h=null==(c=f.getTokenByScene(t.TokensSceneEnum.HUMAN_AUDIO_PRO))?void 0:c.score,q=e.computed((()=>"1"===b.model_version?h:"2"===b.model_version?g:null)),j=e.computed((()=>v.value.reduce(((e,r)=>(e[r.id]=r.name,e)),{}))),_=e.ref(""),w=()=>{var e;null==(e=k.value)||e.reload()},y=e.ref([]),k=e.shallowRef(),x=async(e,r)=>{var s;try{const{lists:n}=await o.getAudioList({page_no:e,page_size:r,name:_.value});n.forEach((e=>{e.show=!1})),null==(s=k.value)||s.complete(n)}catch(n){console.log(n)}},A=[{text:"删除",style:{backgroundColor:"#dd524d"}}],T=e=>{y.value.forEach((e=>{e.show=!1})),y.value[e].show=!0},L=e.ref(),R=e.ref(0),S=e.ref(),{play:C,pauseAll:E,setUrl:U,duration:z,isPlaying:I}=s.useAudio({onPlay:()=>{clearInterval(S.value),R.value=0,S.value=setInterval((()=>{R.value+=1}),1e3)},onStop:()=>{L.value=void 0,R.value=0,clearInterval(S.value)}}),M=e.ref(),b=e.reactive({name:"",msg:"",voice_id:"",model_version:""}),P=e.ref({name:[{required:!0,message:"请输入音频名称"}],msg:[{required:!0,message:"请输入音频内容"}],voice_id:[{required:!0,message:"请选择音色"}],model_version:[{required:!0,message:"请选择模型"}]}),$=e.ref(!1);e.ref(!1),e.reactive({name:""}),e.ref([]),e.ref(!1),e.ref({});return n.useLockFn((async()=>{var r;p.value<q.value?e.index.$u.toast("算力不足，请充值！"):null==(r=M.value)||r.validate((async r=>{var s;if(r)try{e.index.showLoading({title:"正在转写",mask:!0}),await o.createAudio(b),e.index.hideLoading(),f.getUser(),$.value=!1,null==(s=k.value)||s.reload()}catch(n){e.index.hideLoading()}}))})),e.onLoad((async()=>{var r;await e.nextTick$1(),null==(r=k.value)||r.reload()})),e.onReady((()=>{var e;null==(e=M.value)||e.setRules(P.value)})),(s,n)=>({a:e.o(w),b:e.o(w),c:e.o((r=>e.isRef(_)?_.value=r:null)),d:e.p({placeholder:"请输入音频名称",shape:"square","show-action":!1,modelValue:e.unref(_)}),e:e.f(e.unref(y),((s,n,u)=>e.e({a:e.t(e.unref(j)[s.model_version]),b:e.t(s.name),c:e.unref(z)&&e.unref(I)&&e.unref(L)===n},e.unref(z)&&e.unref(I)&&e.unref(L)===n?{d:e.t(e.unref(a.formatAudioTime)(e.unref(R))),e:e.t(e.unref(a.formatAudioTime)(e.unref(z)))}:{},{f:e.unref(L)!=n},e.unref(L)!=n?{g:r._imports_0$10,h:e.o((e=>(async e=>{L.value=e;const r=y.value[e].url;U(r),C()})(n)),n)}:e.unref(I)&&e.unref(L)==n?{j:r._imports_1$5,k:e.o((e=>(L.value=void 0,void E())),n)}:{},{i:e.unref(I)&&e.unref(L)==n,l:n,m:e.o(T,n),n:e.o((r=>((r,s)=>{e.index.showModal({title:"删除",content:"是否删除该音频",success:async n=>{if(n.confirm){e.index.showLoading({title:"删除中...",mask:!0});try{await o.deleteAudio({id:r}),y.value.splice(s,1),e.index.showToast({title:"删除成功",icon:"none",duration:2e3})}catch(a){e.index.showToast({title:a||"删除失败",icon:"none",duration:2e3})}finally{e.index.hideLoading()}}}})})(s.id,n)),n),o:"41122af8-2-"+u+",41122af8-1",p:e.p({index:n,options:A,show:s.show})}))),f:e.sr(k,"41122af8-1",{k:"pagingRef"}),g:e.o(x),h:e.o((r=>e.isRef(y)?y.value=r:null)),i:e.p({fixed:!1,auto:!1,"safe-area-inset-bottom":!0,modelValue:e.unref(y)})})}});wx.createPage(l);
