"use strict";const e=require("../../../../common/vendor.js"),r=require("../../../../common/assets.js"),s=require("../../../../hooks/useAudio.js"),n=require("../../../../api/digital_human.js"),o=require("../../../../hooks/useLockFn.js"),u=require("../../../../utils/util.js"),a=require("../../../../stores/app.js"),i=require("../../../../stores/user.js"),t=require("../../../../enums/appEnums.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../router/index.js"),require("../../../../config/index.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),!Array){(e.resolveComponent("u-search")+e.resolveComponent("u-swipe-action")+e.resolveComponent("empty")+e.resolveComponent("z-paging"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-search/u-search.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-swipe-action/u-swipe-action.js")+(()=>"../../../../components/empty/empty.js")+(()=>"../../../../node-modules/z-paging/components/z-paging/z-paging.js"))();const l=e.defineComponent({__name:"audio_manage",setup(l){var d,c;const m=a.useAppStore(),{getDigitalHumanConfig:v}=e.toRefs(m),f=i.useUserStore(),{userTokens:p}=e.toRefs(f),g=null==(d=f.getTokenByScene(t.TokensSceneEnum.HUMAN_AUDIO))?void 0:d.score,h=null==(c=f.getTokenByScene(t.TokensSceneEnum.HUMAN_AUDIO_PRO))?void 0:c.score,q=e.computed((()=>"1"===M.model_version?h:"2"===M.model_version?g:null)),j=e.computed((()=>v.value.reduce(((e,r)=>(e[r.id]=r.name,e)),{}))),_=e.ref(""),w=()=>{var e;null==(e=k.value)||e.reload()},y=e.ref([]),k=e.shallowRef(),x=async(e,r)=>{var s,o;try{const{lists:o}=await n.getAudioList({page_no:e,page_size:r,name:_.value});o.forEach((e=>{e.show=!1})),null==(s=k.value)||s.complete(o)}catch(u){null==(o=k.value)||o.complete([])}},A=[{text:"删除",style:{backgroundColor:"#dd524d"}}],T=e=>{y.value.forEach((e=>{e.show=!1})),y.value[e].show=!0},L=e.ref(),R=e.ref(0),S=e.ref(),{play:b,pauseAll:C,setUrl:E,duration:U,isPlaying:z}=s.useAudio({onPlay:()=>{clearInterval(S.value),R.value=0,S.value=setInterval((()=>{R.value+=1}),1e3)},onStop:()=>{L.value=void 0,R.value=0,clearInterval(S.value)}}),I=e.ref(),M=e.reactive({name:"",msg:"",voice_id:"",model_version:""}),P=e.ref({name:[{required:!0,message:"请输入音频名称"}],msg:[{required:!0,message:"请输入音频内容"}],voice_id:[{required:!0,message:"请选择音色"}],model_version:[{required:!0,message:"请选择模型"}]}),$=e.ref(!1);e.ref(!1),e.reactive({name:""}),e.ref([]),e.ref(!1),e.ref({});return o.useLockFn((async()=>{var r;p.value<q.value?e.index.$u.toast("算力不足，请充值！"):null==(r=I.value)||r.validate((async r=>{var s;if(r)try{e.index.showLoading({title:"正在转写",mask:!0}),await n.createAudio(M),e.index.hideLoading(),f.getUser(),$.value=!1,null==(s=k.value)||s.reload()}catch(o){e.index.hideLoading()}}))})),e.onLoad((async()=>{var r;await e.nextTick$1(),null==(r=k.value)||r.reload()})),e.onReady((()=>{var e;null==(e=I.value)||e.setRules(P.value)})),(s,o)=>({a:e.o(w),b:e.o(w),c:e.o((r=>e.isRef(_)?_.value=r:null)),d:e.p({placeholder:"请输入音频名称",shape:"square","show-action":!1,modelValue:e.unref(_)}),e:e.f(e.unref(y),((s,o,a)=>e.e({a:e.t(e.unref(j)[s.model_version]),b:e.t(s.name),c:e.unref(U)&&e.unref(z)&&e.unref(L)===o},e.unref(U)&&e.unref(z)&&e.unref(L)===o?{d:e.t(e.unref(u.formatAudioTime)(e.unref(R))),e:e.t(e.unref(u.formatAudioTime)(e.unref(U)))}:{},{f:e.unref(L)!=o},e.unref(L)!=o?{g:r._imports_2$2,h:e.o((e=>(async e=>{L.value=e;const r=y.value[e].url;E(r),b()})(o)),o)}:e.unref(z)&&e.unref(L)==o?{j:r._imports_1$5,k:e.o((e=>(L.value=void 0,void C())),o)}:{},{i:e.unref(z)&&e.unref(L)==o,l:o,m:e.o(T,o),n:e.o((r=>((r,s)=>{e.index.showModal({title:"删除",content:"是否删除该音频",success:async o=>{if(o.confirm){e.index.showLoading({title:"删除中...",mask:!0});try{await n.deleteAudio({id:r}),y.value.splice(s,1),e.index.hideLoading(),e.index.showToast({title:"删除成功",icon:"none",duration:2e3})}catch(u){e.index.hideLoading(),e.index.showToast({title:u||"删除失败",icon:"none",duration:2e3})}}}})})(s.id,o)),o),o:"1918ba82-2-"+a+",1918ba82-1",p:e.p({index:o,options:A,show:s.show})}))),f:e.sr(k,"1918ba82-1",{k:"pagingRef"}),g:e.o(x),h:e.o((r=>e.isRef(y)?y.value=r:null)),i:e.p({fixed:!1,auto:!1,"safe-area-inset-bottom":!0,modelValue:e.unref(y)})})}});wx.createPage(l);
