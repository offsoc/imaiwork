"use strict";const e=require("../../../../common/vendor.js"),a=require("../../../../common/assets.js"),u=require("../../../../api/digital_human.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../config/index.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-search")+e.resolveComponent("empty")+e.resolveComponent("z-paging")+e.resolveComponent("u-input")+e.resolveComponent("u-popup"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-search/u-search.js")+(()=>"../../../../components/empty/empty.js")+(()=>"../../../../node-modules/z-paging/components/z-paging/z-paging.js")+n+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js"))();const n=()=>"../../components/video-preview-v2/video-preview-v2.js",o=e.defineComponent({__name:"montage_works",setup(n){const o=e.ref([]),i=e.ref(0),r=e.ref(""),s=e.ref(!1),t=e.ref([]),l=e.ref(!1),c=e.ref(-1),d=e.ref(""),p=e=>{var a;null==(a=v.value)||a.reload()},v=e.shallowRef(),m=async(e,a)=>{var n,o;try{const{lists:o,count:s}=await u.getShanjianTaskRecord({page_no:e,page_size:a,name:r.value});i.value=s,o.forEach((e=>{e.is_delete=!1})),null==(n=v.value)||n.complete(o)}catch(s){null==(o=v.value)||o.complete([])}},f=e.ref(!1),h=e.reactive({url:"",pic:""}),g=e=>t.value.some((a=>a.id==e.id)),j=()=>{s.value=!0},_=()=>{e.index.$u.route({url:"/ai_modules/digital_human/pages/montage_publish/montage_publish",params:{task_id:JSON.stringify(t.value.map((e=>e.id))),scene:2}}),s.value=!1,t.value=[]},q=async()=>{if(d.value){l.value=!1,e.index.showLoading({title:"修改中...",mask:!0});try{await u.updateShanjianTaskName({id:o.value[c.value].id,name:d.value}),e.index.hideLoading(),e.index.showToast({title:"修改成功",icon:"none",duration:3e3}),o.value[c.value].name=d.value}catch(a){e.index.showToast({title:a||"修改失败",icon:"none",duration:3e3})}}else e.index.$u.toast("请输入名称")};return(n,i)=>e.e({a:e.p({"border-bottom":!1,"is-fixed":!1,background:{background:"transparent"},title:"混剪记录","title-bold":!0}),b:e.o(p),c:e.o(p),d:e.o((a=>e.isRef(r)?r.value=a:null)),e:e.p({"bg-color":"#FFFFFF",height:"72","search-icon-color":"#ABB1B3","placeholder-color":"#ABB1B3","show-action":!1,modelValue:e.unref(r)}),f:e.f(e.unref(o),((n,i,r)=>e.e(e.unref(s)?{a:e.o((a=>(a=>{const{task:u}=a;u.every((e=>3!=e.status))?e.index.$u.toast("只有生成成功的视频才能去发布"):s.value&&(g(a)?t.value=t.value.filter((e=>e.id!=e.id)):t.value.push(a))})(n)),i)}:{},{b:e.t(n.name),c:e.o((e=>(e=>{c.value=e,d.value=o.value[e].name,l.value=!0})(i)),i),d:e.t(n.create_time)},e.unref(s)?e.e({g:g(n)},g(n)?{h:a._imports_1$7}:{i:a._imports_2$4}):{e:a._imports_0$6,f:e.o((a=>(async a=>{e.index.showModal({title:"您真的要删除吗？",content:"删除后将无法找回，且该操作不可逆！",success:async n=>{var o;if(n.confirm){e.index.showLoading({title:"删除中...",mask:!0});try{return await u.deleteShanjianTaskRecord({id:a}),null==(o=v.value)||o.reload(),e.index.hideLoading(),void e.index.showToast({title:"删除成功",icon:"none",duration:3e3})}catch(i){e.index.hideLoading(),e.index.showToast({title:i||"删除失败",icon:"none",duration:3e3})}}}})})(n.id)),i)},{j:e.f(n.task,((u,n,o)=>e.e({a:u.pic,b:e.t(u.name),c:3==u.status},3==u.status?{d:e.o((e=>(e=>{const{video_result_url:a,pic:u}=e;h.url=a,h.pic=u,f.value=!0})(u)),n)}:e.e({e:2==u.status},2==u.status?{f:a._imports_0$7,g:e.t(u.remark||"生成失败")}:{}),{h:e.t(u.create_time),i:n}))),k:i}))),g:e.unref(s),h:!e.unref(s),i:e.sr(v,"c5001887-2",{k:"pagingRef"}),j:e.o(m),k:e.o((a=>e.isRef(o)?o.value=a:null)),l:e.p({fixed:!1,"safe-area-inset-bottom":!0,modelValue:e.unref(o)}),m:!e.unref(s)},e.unref(s)?{o:e.t(e.unref(t).length),p:e.n(e.unref(t).length>0?"bg-black":"bg-_h787878CC_"),q:e.o((e=>{s.value=!1,t.value=[]})),r:e.n(e.unref(t).length>0?"bg-black":"bg-_h787878CC_"),s:e.o(_)}:{n:e.o(j)},{t:e.unref(s)?1:"",v:e.o((e=>f.value=!1)),w:e.o((a=>e.isRef(f)?f.value=a:null)),x:e.p({"video-url":e.unref(h).url,poster:e.unref(h).pic,show:e.unref(f)}),y:e.o((a=>e.isRef(d)?d.value=a:null)),z:e.p({placeholder:"请输入名称",maxlength:"30",clearable:!0,"placeholder-style":"color: #0000004d; font-size: 26rpx;",modelValue:e.unref(d)}),A:e.o((e=>l.value=!1)),B:e.o(q),C:e.o((a=>e.isRef(l)?l.value=a:null)),D:e.p({mode:"center",width:"90%","border-radius":20,modelValue:e.unref(l)})})}}),i=e._export_sfc(o,[["__scopeId","data-v-c5001887"]]);wx.createPage(i);
