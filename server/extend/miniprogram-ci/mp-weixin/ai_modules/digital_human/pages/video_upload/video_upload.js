"use strict";const e=require("../../../../common/vendor.js"),o=require("../../../../common/assets.js"),i=require("../../../../config/index.js"),n=require("../../../../enums/appEnums.js"),r=require("../../enums/index.js"),a=require("../../../../stores/user.js"),u=require("../../hooks/useUpload.js"),s=require("../../../../utils/request/cancel.js");if(require("../../../../api/user.js"),require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../router/index.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../components/file-upload/choose-file.js"),!Array){(e.resolveComponent("u-button")+e.resolveComponent("recharge-popup"))()}Math||(t+(()=>"../../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+l+(()=>"../../../../components/recharge-popup/recharge-popup.js"))();const t=()=>"../../components/video-player/video-player.js",l=()=>"../../components/upload-loading/upload-loading.js",m=e.defineComponent({__name:"video_upload",setup(t){const l=["mp4","mov"],m=a.useUserStore(),{userTokens:d}=e.toRefs(m),p=e.shallowRef(),c=e.reactive({name:"",url:"",pic:"",anchor_id:"",model_version:"",width:0,height:0}),g=e.ref(!1),v=e.ref(),A=e.ref(!1),E=e.ref(0),f=e.shallowRef();e.ref(!1);const D=e.ref(""),h={resolution:`${u.commonUploadLimit.minResolution}P-${u.commonUploadLimit.maxResolution}P`,fileSize:u.commonUploadLimit.size},M=e=>`${u.uploadLimit[e].minResolution}P-${u.uploadLimit[e].maxResolution}P`;r.DigitalHumanModelVersionEnum.STANDARD,M(r.DigitalHumanModelVersionEnum.STANDARD),u.uploadLimit[r.DigitalHumanModelVersionEnum.STANDARD].size,r.DigitalHumanModelVersionEnum.SUPER,M(r.DigitalHumanModelVersionEnum.SUPER),u.uploadLimit[r.DigitalHumanModelVersionEnum.SUPER].size,r.DigitalHumanModelVersionEnum.ADVANCED,r.DigitalHumanModelVersionEnum.ELITE,r.DigitalHumanModelVersionEnum.CHANJING,M(r.DigitalHumanModelVersionEnum.CHANJING),u.uploadLimit[r.DigitalHumanModelVersionEnum.CHANJING].size,r.DigitalHumanModelVersionEnum.SHANJIAN,M(r.DigitalHumanModelVersionEnum.SHANJIAN),u.uploadLimit[r.DigitalHumanModelVersionEnum.SHANJIAN].size;const _=e.computed((()=>{const e=c.model_version?"string"==typeof c.model_version?parseInt(c.model_version):c.model_version:r.DigitalHumanModelVersionEnum.STANDARD;Object.values(r.DigitalHumanModelVersionEnum).includes(e)||r.DigitalHumanModelVersionEnum.STANDARD;const o=h;return[{name:"视频方向",value:"横向或纵向"},{name:"文件格式",value:l.join("、")},{name:"分辨率",value:o.resolution},{name:"声音要求",value:"视频内音频需要清晰、响亮且无嘈杂背景音等干扰"},{name:"文件大小",value:`小于${o.fileSize}MB`}]}));e.computed((()=>c.model_version?u.uploadLimit[c.model_version]:null));const H=e=>m.getTokenByScene(e),N=e=>{const o={pro:{avatar:n.TokensSceneEnum.HUMAN_AVATAR_PRO},normal:{avatar:n.TokensSceneEnum.HUMAN_AVATAR},advanced:{avatar:n.TokensSceneEnum.HUMAN_AVATAR_ADVANCED},elite:{avatar:n.TokensSceneEnum.HUMAN_AVATAR_ELITE},chanjing:{avatar:n.TokensSceneEnum.HUMAN_AVATAR_CHANJING}};switch(e){case r.DigitalHumanModelVersionEnum.SUPER:return o.pro;case r.DigitalHumanModelVersionEnum.ADVANCED:return o.advanced;case r.DigitalHumanModelVersionEnum.ELITE:return o.elite;case r.DigitalHumanModelVersionEnum.CHANJING:return o.chanjing;default:return o.normal}},j=()=>{s.requestCancel.remove("/upload/video"),s.requestCancel.remove("/upload/image"),A.value=!1,E.value=0,D.value="",q()},x=async()=>{e.index.$emit("confirm",{type:r.ListenerTypeEnum.VIDEO_UPLOAD,data:c}),e.index.navigateBack()},V=()=>{e.index.$u.route({url:"/ai_modules/digital_human/pages/index/index",type:"redirect"})},q=()=>{e.index.setNavigationBarColor({frontColor:"#000000",backgroundColor:"#F9FAFB"})};return e.onLoad((e=>{try{e.type&&(p.value=e.type)}catch(o){console.error("页面加载参数处理失败:",o)}})),(n,a)=>e.e({a:o._imports_0$8,b:e.p({"play-icon-size":88,poster:`${e.unref(i.config).baseUrl}static/images/dh_example_bg2.png`,"video-url":`${e.unref(i.config).baseUrl}static/videos/dh_example2.mp4`}),c:o._imports_1$2,d:o._imports_2$1,e:e.f(e.unref(_),((o,i,n)=>({a:e.t(i+1),b:e.t(o.name),c:e.t(o.value),d:i}))),f:o._imports_3,g:o._imports_4,h:e.o((o=>(async()=>{var o;if(p.value===r.ModeTypeEnum.ANCHOR){const i=N(r.DigitalHumanModelVersionEnum.SHANJIAN),n=N(r.DigitalHumanModelVersionEnum.CHANJING),{score:a}=H(i.avatar),{score:u}=H(n.avatar);if(d.value<a+u)return g.value=!0,await e.nextTick$1(),void(null==(o=v.value)||o.open())}e.index.setNavigationBarColor({frontColor:"#000000",backgroundColor:"#000000"});const{upload:i}=u.useUpload({size:u.commonUploadLimit.size,resolution:[u.commonUploadLimit.minResolution,u.commonUploadLimit.maxResolution],duration:[u.commonUploadLimit.videoMinDuration,u.commonUploadLimit.videoMaxDuration],extension:l,async onSuccess(o){const{url:i,pic:n,width:r,height:a}=o;c.url=i,c.pic=n,c.width=r,c.height=a,c.name=e.index.$u.timeFormat(Date.now(),"yyyymmddhhMM"),x()},onProgress(e){f.value=e.type,E.value=e.progress,D.value="video"===f.value?"视频正在上传中...":"图片正在上传中...",A.value=!0},onError(o){o.errMsg&&"chooseMedia:fail api scope is not declared in the privacy agreement"===o.errMsg?e.index.$u.toast("请完善隐私协议，否则无法使用"):o&&o.errMsg&&-1==o.errMsg.indexOf("cancel")&&e.index.$u.toast(o.errMsg||"上传失败"),A.value=!1,E.value=0,q()}});i()})())),i:e.p({type:"primary",shape:"circle","custom-style":{height:"90rpx",boxShadow:" 0px 3px 12px 0px rgba(0, 0, 0, 0.12)",fontSize:"26rpx"}}),j:e.unref(A)},e.unref(A)?{k:e.o(j),l:e.o(V),m:e.o(x),n:e.p({progress:e.unref(E),"loading-text":e.unref(D),"progress-type":e.unref(f),"show-back":e.unref(c).model_version!==e.unref(r.DigitalHumanModelVersionEnum).SHANJIAN})}:{},{o:e.unref(g)},e.unref(g)?{p:e.sr(v,"fcc5d774-3",{k:"rechargePopupRef"}),q:e.o((e=>g.value=!1))}:{})}}),d=e._export_sfc(m,[["__scopeId","data-v-fcc5d774"]]);wx.createPage(d);
