"use strict";const e=require("../../../../common/vendor.js"),o=require("../../../../common/assets.js"),i=require("../../../../api/digital_human.js"),n=require("../../../../api/app.js"),r=require("../../../../stores/app.js"),u=require("../../../../stores/user.js"),a=require("../../../../utils/cache.js"),t=require("../../enums/index.js"),s=require("../../config/copywriter.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../router/index.js"),require("../../../../config/index.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),!Array){(e.resolveComponent("u-icon")+e.resolveComponent("u-switch")+e.resolveComponent("u-input")+e.resolveComponent("recharge-popup"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-switch/u-switch.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+l+c+m+d+p+_+h+v+(()=>"../../../../components/recharge-popup/recharge-popup.js"))();const l=()=>"../../components/video-preview/video-preview.js",c=()=>"../../components/choose-anchor/choose-anchor.js",m=()=>"../../components/choose-tone/choose-tone.js",d=()=>"../../components/choose-model/choose-model.js",p=()=>"../../components/model-rule/model-rule.js",_=()=>"../../components/content-input/content-input.js",v=()=>"../../components/agreement/agreement.js",h=()=>"../../components/create-panel/create-panel.js",f=e.defineComponent({__name:"video_create",setup(l){const c=r.useAppStore(),m=u.useUserStore(),d=e.ref(!0),p="create_agreement",_=e.reactive({name:"",pic:"",width:0,height:0,anchor_id:"",anchor_name:"",gender:"male",model_version:"",audio_type:t.CreateTypeEnum.TEXT,voice_id:"-1",voice_type:1,voice_name:"",msg:"",video_url:"",automatic_clip:0,clip_type:t.ClipStyleEnum.AI_RECOMMEND,music_url:"",music_name:"",music_type:1}),v=e.ref([]),h=e.ref(!1),f=e.ref(!1),g=e.ref(""),y=e.ref(!1),w=e.ref(!1),j=e.ref(-1),E=e.ref(!1),x=e.ref(!1),q=e.shallowRef(),C=e.shallowRef(),D=e.ref(),H=e.computed((()=>({[t.DigitalHumanModelVersionEnum.STANDARD]:150,[t.DigitalHumanModelVersionEnum.SUPER]:300,[t.DigitalHumanModelVersionEnum.ADVANCED]:1e3,[t.DigitalHumanModelVersionEnum.ELITE]:1e3,[t.DigitalHumanModelVersionEnum.CHANJING]:4e3}[_.model_version]||150))),b=e.computed((()=>{var e;return(null==(e=c.getDigitalHumanConfig)?void 0:e.channel)||[]})),M=e.computed((()=>!!_.model_version)),R=e.computed((()=>b.value.reduce(((e,o)=>(e[o.id]=o.name,e)),{}))),T=e.computed((()=>M.value&&(1==_.voice_type||!!_.voice_id)&&!!_.msg)),A=e.computed((()=>-1==_.voice_id)),V=e.computed((()=>_.model_version==t.DigitalHumanModelVersionEnum.CHANJING||A.value)),N=e.reactive({is_open:!1}),$=e=>{const{name:o,model_version:i,anchor_id:n,url:r,pic:u,width:a,height:s}=e;_.model_version!==i&&(_.msg="",_.voice_id="",_.voice_name=""),_.anchor_id=n,_.anchor_name=o,_.model_version=i,_.video_url=r,_.pic=u,_.width=a,_.height=s,_.model_version==t.DigitalHumanModelVersionEnum.CHANJING&&(_.voice_id="-1")},I=e=>{$(e);v.value.some((o=>o.anchor_id===e.anchor_id))||(v.value=[e,...v.value]),h.value=!1},S=()=>{f.value=!0},L=o=>{f.value=!1,e.index.$u.route({url:`/ai_modules/digital_human/pages/video_upload/video_upload?model_version=${o}&type=${t.ModeTypeEnum.ANCHOR}`})},O=()=>{w.value=!0},k=e=>{const{voice_id:o,name:i,type:n}=e;w.value=!1,_.voice_id!==o&&(_.voice_id=o,_.voice_name=i,_.voice_type=n)},J=()=>{var e;null==(e=q.value)||e.open()},P=()=>{a.cache.set(p,"1"),G()},U=()=>{var e;null==(e=D.value)||e.open()},G=async()=>{var o;if(a.cache.get(p)){x.value=!1;try{e.index.showLoading({title:"正在生成",mask:!0});const n="-1"==_.voice_id?void 0:_.voice_id;await i.createTask({name:e.index.$u.timeFormat(Date.now(),"yyyymmddhhMM").substring(2),msg:_.msg,pic:_.pic,video_url:_.video_url,anchor_id:_.anchor_id,anchor_name:_.anchor_name,voice_id:n,voice_name:_.voice_name,voice_type:_.voice_type,audio_type:_.audio_type,model_version:_.model_version,width:_.width,height:_.height,automatic_clip:_.automatic_clip,clip_type:_.clip_type,music_url:_.music_url,music_type:_.music_type}),null==(o=C.value)||o.close(),m.getUser(),e.index.hideLoading(),e.index.showToast({title:"创作成功，请在我的作品中查看",icon:"none",duration:3e3}),setTimeout((()=>{z()}),3e3)}catch(n){e.index.hideLoading(),e.index.showToast({title:n||"生成失败",icon:"none",duration:3e3})}}else x.value=!0},z=()=>{e.index.$u.route({url:"/ai_modules/digital_human/pages/index/index",type:"redirect"})};return e.onShow((()=>{e.index.$on("confirm",(o=>{const{type:i,data:n}=o;i===t.ListenerTypeEnum.AI_COPYWRITER&&(_.msg=n.content,_.msg.length>H.value&&(_.msg=_.msg.slice(0,H.value))),t.ListenerTypeEnum.CHOOSE_STYLES,i===t.ListenerTypeEnum.CHOOSE_MUSIC&&(_.music_url=n.url,_.music_name=n.name),e.index.$off("confirm")})),(async()=>{const{code:e}=await n.getClipConfig();N.is_open=1e4==e})()})),e.onLoad((e=>{const{type:o,data:n}=e;if(o===t.ListenerTypeEnum.UPLOAD_VIDEO)try{const e=JSON.parse(decodeURIComponent(n)),{name:o,url:i,model_version:r,anchor_id:u,pic:a,width:s,height:l}=e;_.model_version||_.model_version===u||(_.voice_id="",_.voice_name="",_.msg=""),r==t.DigitalHumanModelVersionEnum.CHANJING&&(_.voice_id="-1"),Object.assign(_,{anchor_name:o,video_url:i,model_version:r,anchor_id:u,pic:a,width:s,height:l});v.value.some((e=>e.anchor_id===u))||(v.value=[...v.value,e])}catch(r){console.error("解析数据失败",r)}finally{d.value=!1}else(async()=>{try{const{lists:e}=await i.getAnchorList({page_size:10,page_no:1,type:0,model_version:t.DigitalHumanModelVersionEnum.CHANJING});e&&e.length&&(v.value=v.value.concat(e),$(e[0]))}finally{d.value=!1}})()})),(i,n)=>e.e({a:!e.unref(d)},e.unref(d)?{}:e.e({b:o._imports_0$6,c:e.o((e=>h.value=!0)),d:e.unref(v).length},e.unref(v).length?{e:e.f(e.unref(v),((i,n,r)=>e.e({a:e.unref(_).anchor_id===i.anchor_id},e.unref(_).anchor_id===i.anchor_id?{b:o._imports_1$4}:{},{c:e.o((e=>{var o;(o=i.url)&&(y.value=!0,g.value=o)}),i.anchor_id||n),d:e.unref(R)[i.model_version]},e.unref(R)[i.model_version]?{e:e.t(e.unref(R)[i.model_version])}:{},{f:i.anchor_id||n,g:`url(${i.pic})`,h:e.o((e=>$(i)),i.anchor_id||n)}))),f:o._imports_1$3}:{g:o._imports_3$1,h:e.o((e=>S()))},{i:e.n(e.unref(M)?"border-_0rpx_ border-t-_1rpx_ border-b-_1rpx_ border-solid border-_hE5E5E5_":"grow min-h-0 flex flex-col items-center justify-center"),j:e.unref(A)},e.unref(A)?{}:{k:e.t(e.unref(_).voice_name||"无"),l:e.n(e.unref(_).voice_name?"text-primary":"text-_rgba_0b0b0b0d3__")},{m:e.p({name:"arrow-right",color:"rgba(0, 0, 0, 0.2)",size:"22"}),n:e.o((e=>O())),o:e.unref(N).is_open},e.unref(N).is_open?e.e({p:e.o((o=>e.unref(_).automatic_clip=o)),q:e.p({size:"36","active-value":"1","inactive-value":"0",modelValue:e.unref(_).automatic_clip})},{},{}):{},{w:e.unref(M)?"":1,x:o._imports_4$1,y:e.o((e=>{s.createVideoCopywriter.length&&(j.value=(j.value+1)%s.createVideoCopywriter.length,_.msg=s.createVideoCopywriter[j.value])})),z:o._imports_5,A:`/ai_modules/digital_human/pages/ai_copywriter/ai_copywriter?limit=${e.unref(H)}`,B:e.o(J),C:e.o((o=>e.unref(_).msg=o)),D:e.p({type:"textarea",height:"364",placeholder:"请输入或粘贴您的文案 ...","placeholder-style":"color: #00000033; font-size: 26rpx;",disabled:!0,maxlength:e.unref(H),modelValue:e.unref(_).msg}),E:e.unref(_).msg},e.unref(_).msg?{F:e.t(e.unref(_).msg.length),G:e.t(e.unref(H))}:{},{H:o._imports_6,I:e.o((e=>{E.value=!0})),J:e.o((o=>{var i;T.value?null==(i=C.value)||i.confirm():_.model_version?1==_.voice_type||_.voice_id?_.msg||(e.index.$u.toast("请先输入视频文案"),J()):(e.index.$u.toast("请先选择音色"),O()):S()}))}),{K:e.o((e=>y.value=!1)),L:e.o((o=>e.isRef(y)?y.value=o:null)),M:e.p({title:"视频预览","video-url":e.unref(g),show:e.unref(y)}),N:e.o(I),O:e.o((o=>e.isRef(h)?h.value=o:null)),P:e.p({show:e.unref(h)}),Q:e.o(k),R:e.o((o=>e.isRef(w)?w.value=o:null)),S:e.p({"model-version":e.unref(_).model_version,"active-tone":e.unref(_).voice_id,"show-original-tone":e.unref(V),show:e.unref(w)}),T:e.o(L),U:e.o((o=>e.isRef(f)?f.value=o:null)),V:e.p({show:e.unref(f)}),W:e.o((o=>e.isRef(E)?E.value=o:null)),X:e.p({show:e.unref(E)}),Y:e.sr(q,"783b0fcd-10",{k:"contentInputRef"}),Z:e.o((o=>e.unref(_).msg=o)),aa:e.p({"text-limit":e.unref(H),"model-value":e.unref(_).msg}),ab:e.sr(C,"783b0fcd-11",{k:"createPanelRef"}),ac:e.o(G),ad:e.o(U),ae:e.p({formData:e.unref(_)}),af:e.o(P),ag:e.o((e=>x.value=!1)),ah:e.p({"show-agreement":e.unref(x)}),ai:e.sr(D,"783b0fcd-13",{k:"rechargePopupRef"})})}}),g=e._export_sfc(f,[["__scopeId","data-v-783b0fcd"]]);wx.createPage(g);
