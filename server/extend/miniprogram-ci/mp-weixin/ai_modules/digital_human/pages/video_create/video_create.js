"use strict";const e=require("../../../../common/vendor.js"),o=require("../../../../common/assets.js"),i=require("../../../../api/digital_human.js"),n=require("../../../../api/app.js"),r=require("../../../../stores/app.js"),a=require("../../../../stores/user.js"),u=require("../../../../utils/cache.js"),t=require("../../enums/index.js"),s=require("../../config/copywriter.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../router/index.js"),require("../../../../config/index.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../utils/util.js"),require("../../../../stores/navigationBarTitle.js"),!Array){(e.resolveComponent("u-icon")+e.resolveComponent("u-switch")+e.resolveComponent("u-input")+e.resolveComponent("video-preview")+e.resolveComponent("recharge-popup"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-switch/u-switch.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../components/video-preview/video-preview.js")+l+c+m+d+p+v+_+(()=>"../../../../components/recharge-popup/recharge-popup.js"))();const l=()=>"../../components/choose-anchor/choose-anchor.js",c=()=>"../../components/choose-tone/choose-tone.js",m=()=>"../../components/choose-model/choose-model.js",d=()=>"../../components/model-rule/model-rule.js",p=()=>"../../components/content-input/content-input.js",_=()=>"../../components/agreement/agreement.js",v=()=>"../../components/create-panel/create-panel.js",h=e.defineComponent({__name:"video_create",setup(l){const c=r.useAppStore(),m=a.useUserStore(),d=e.ref(!0),p="create_agreement",_=e.reactive({name:"",pic:"",width:0,height:0,anchor_id:"",anchor_name:"",gender:"male",model_version:t.DigitalHumanModelVersionEnum.CHANJING,audio_type:t.CreateTypeEnum.TEXT,voice_id:"-1",voice_type:1,voice_name:"",msg:"",video_url:"",automatic_clip:0,clip_type:t.ClipStyleEnum.AI_RECOMMEND,music_url:"",music_name:"",music_type:1}),v=e.ref([]),h=e.ref(!1),g=e.ref(!1),f=e.ref(""),y=e.ref(!1),w=e.ref(!1),E=e.ref(-1),j=e.ref(!1),C=e.ref(!1),x=e.shallowRef(),q=e.shallowRef(),H=e.ref(),R=e.computed((()=>({[t.DigitalHumanModelVersionEnum.STANDARD]:150,[t.DigitalHumanModelVersionEnum.SUPER]:300,[t.DigitalHumanModelVersionEnum.ADVANCED]:1e3,[t.DigitalHumanModelVersionEnum.ELITE]:1e3,[t.DigitalHumanModelVersionEnum.CHANJING]:4e3}[_.model_version]||150))),A=e.computed((()=>{var e;return(null==(e=c.getDigitalHumanConfig)?void 0:e.channel)||[]})),T=e.computed((()=>!!_.model_version));e.computed((()=>A.value.reduce(((e,o)=>(e[o.id]=o.name,e)),{})));const N=e.computed((()=>T.value&&(1==_.voice_type||!!_.voice_id)&&!!_.msg)),M=e.computed((()=>-1==_.voice_id)),D=e.computed((()=>_.model_version==t.DigitalHumanModelVersionEnum.CHANJING||M.value)),$=e.reactive({is_open:!1}),b=e=>{const{name:o,model_version:i,anchor_id:n,url:r,pic:a,width:u,height:s}=e;_.model_version!==i&&(_.msg="",_.voice_id="",_.voice_name=""),_.anchor_id=n,_.anchor_name=o,_.model_version=i,_.video_url=r,_.pic=a,_.width=u,_.height=s,_.model_version==t.DigitalHumanModelVersionEnum.CHANJING&&(_.voice_id="-1")},V=e=>{b(e);v.value.some((o=>o.anchor_id===e.anchor_id))||(v.value=[e,...v.value]),h.value=!1},I=()=>{e.index.$u.route({url:`/ai_modules/digital_human/pages/anchor_create/anchor_create?source=${t.DigitalHumanModelVersionEnum.CHANJING}&type=${t.ModeTypeEnum.ANCHOR}`})},L=o=>{g.value=!1,e.index.$u.route({url:`/ai_modules/digital_human/pages/video_upload/video_upload?model_version=${o}&type=${t.ModeTypeEnum.ANCHOR}`})},O=()=>{w.value=!0},S=e=>{const{voice_id:o,name:i,type:n}=e;w.value=!1,_.voice_id!==o&&(_.voice_id=o,_.voice_name=i,_.voice_type=n)},k=()=>{var e;null==(e=x.value)||e.open()},J=()=>{u.cache.set(p,"1"),P()},G=()=>{var e;null==(e=H.value)||e.open()},P=async()=>{var o;if(u.cache.get(p)){C.value=!1;try{e.index.showLoading({title:"正在生成",mask:!0});const n="-1"==_.voice_id?void 0:_.voice_id;await i.createTask({name:e.index.$u.timeFormat(Date.now(),"yyyymmddhhMM"),msg:_.msg,pic:_.pic,video_url:_.video_url,anchor_id:_.anchor_id,anchor_name:_.anchor_name,voice_id:n,voice_name:_.voice_name,voice_type:_.voice_type,audio_type:_.audio_type,model_version:_.model_version,width:_.width,height:_.height,automatic_clip:_.automatic_clip,clip_type:_.clip_type,music_url:_.music_url,music_type:_.music_type}),null==(o=q.value)||o.close(),m.getUser(),e.index.hideLoading(),e.index.showToast({title:"创作成功，请在我的作品中查看",icon:"none",duration:3e3}),setTimeout((()=>{U()}),3e3)}catch(n){e.index.hideLoading(),e.index.showToast({title:n||"生成失败",icon:"none",duration:3e3})}}else C.value=!0},U=()=>{e.index.$u.route({url:"/ai_modules/digital_human/pages/index/index",type:"redirect"})},z=e=>{const{name:o,url:i,anchor_id:n,pic:r,width:a,height:u,model_version:t}=e;Object.assign(_,{anchor_name:o,video_url:i,anchor_id:n,model_version:t,pic:r,width:a,height:u}),v.value=[e,...v.value]};return e.onLoad((async o=>{o.type==t.ListenerTypeEnum.CREATE_ANCHOR&&z(JSON.parse(decodeURIComponent(o.data))),e.index.$on("confirm",(e=>{var o;const{type:i,data:n}=e;i===t.ListenerTypeEnum.CREATE_ANCHOR&&z(n),i===t.ListenerTypeEnum.AI_COPYWRITER&&(_.msg=n.content,(null==(o=_.msg)?void 0:o.length)>R.value&&(_.msg=_.msg.slice(0,R.value))),t.ListenerTypeEnum.CHOOSE_STYLES,i===t.ListenerTypeEnum.CHOOSE_MUSIC&&(_.music_url=n.url,_.music_name=n.name)})),(async()=>{try{const{lists:e}=await i.getAnchorList({page_size:10,page_no:1,type:0,status:"0,1",model_version:t.DigitalHumanModelVersionEnum.CHANJING});e&&e.length&&(v.value=v.value.concat(e),b(e[0]))}finally{d.value=!1}})(),(async()=>{const{code:e}=await n.getClipConfig();$.is_open=1e4==e})()})),(i,n)=>e.e({a:!e.unref(d)},e.unref(d)?{}:e.e({b:o._imports_1$3,c:e.o((e=>h.value=!0)),d:e.unref(v).length},e.unref(v).length?{e:e.f(e.unref(v),((i,n,r)=>e.e({a:e.unref(_).anchor_id==i.anchor_id},e.unref(_).anchor_id==i.anchor_id?{b:o._imports_1$4}:{},{c:e.o((e=>{var o;(o=i.url)&&(y.value=!0,f.value=o)}),i.anchor_id||n),d:i.anchor_id||n,e:`url(${i.pic})`,f:e.o((e=>b(i)),i.anchor_id||n)}))),f:o._imports_2$2}:{g:o._imports_3$1,h:e.o((e=>I()))},{i:e.n(e.unref(T)?"border-_0rpx_ border-t-_1rpx_ border-b-_1rpx_ border-solid border-_hE5E5E5_":"grow min-h-0 flex flex-col items-center justify-center"),j:e.unref(M)},e.unref(M)?{}:{k:e.t(e.unref(_).voice_name||"无"),l:e.n(e.unref(_).voice_name?"text-primary":"text-_rgba_0b0b0b0d3__")},{m:e.p({name:"arrow-right",color:"rgba(0, 0, 0, 0.2)",size:"22"}),n:e.o((e=>O())),o:e.unref($).is_open},e.unref($).is_open?e.e({p:e.o((o=>e.unref(_).automatic_clip=o)),q:e.p({size:"36","active-value":1,"inactive-value":0,modelValue:e.unref(_).automatic_clip})},{},{}):{},{w:e.unref(T)?"":1,x:o._imports_4$1,y:e.o((e=>{s.createVideoCopywriter.length&&(E.value=(E.value+1)%s.createVideoCopywriter.length,_.msg=s.createVideoCopywriter[E.value])})),z:o._imports_5,A:`/ai_modules/digital_human/pages/ai_copywriter/ai_copywriter?limit=${e.unref(R)}`,B:e.o(k),C:e.o((o=>e.unref(_).msg=o)),D:e.p({type:"textarea",height:"364",placeholder:"请输入或粘贴您的文案 ...","placeholder-style":"color: #00000033; font-size: 26rpx;",disabled:!0,maxlength:e.unref(R),modelValue:e.unref(_).msg}),E:e.unref(_).msg},e.unref(_).msg?{F:e.t(e.unref(_).msg.length),G:e.t(e.unref(R))}:{},{H:o._imports_7,I:e.o((e=>{j.value=!0})),J:e.o((o=>{var i;N.value?null==(i=q.value)||i.confirm():_.model_version?1==_.voice_type||_.voice_id?_.msg||(e.index.$u.toast("请先输入视频文案"),k()):(e.index.$u.toast("请先选择音色"),O()):I()}))}),{K:e.o((e=>y.value=!1)),L:e.o((o=>e.isRef(y)?y.value=o:null)),M:e.p({title:"视频预览","video-url":e.unref(f),show:e.unref(y)}),N:e.o(V),O:e.o((o=>e.isRef(h)?h.value=o:null)),P:e.p({show:e.unref(h)}),Q:e.o(S),R:e.o((o=>e.isRef(w)?w.value=o:null)),S:e.p({"model-version":e.unref(_).model_version,"active-tone":e.unref(_).voice_id,"show-original-tone":e.unref(D),show:e.unref(w)}),T:e.o(L),U:e.o((o=>e.isRef(g)?g.value=o:null)),V:e.p({show:e.unref(g)}),W:e.o((o=>e.isRef(j)?j.value=o:null)),X:e.p({show:e.unref(j)}),Y:e.sr(x,"b0346062-10",{k:"contentInputRef"}),Z:e.o((o=>e.unref(_).msg=o)),aa:e.p({"text-limit":e.unref(R),"model-value":e.unref(_).msg}),ab:e.sr(q,"b0346062-11",{k:"createPanelRef"}),ac:e.o(P),ad:e.o(G),ae:e.p({formData:e.unref(_)}),af:e.o(J),ag:e.o((e=>C.value=!1)),ah:e.p({"show-agreement":e.unref(C)}),ai:e.sr(H,"b0346062-13",{k:"rechargePopupRef"})})}}),g=e._export_sfc(h,[["__scopeId","data-v-b0346062"]]);wx.createPage(g);
