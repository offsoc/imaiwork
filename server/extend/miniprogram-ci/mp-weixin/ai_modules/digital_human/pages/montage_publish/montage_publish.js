"use strict";const e=require("../../../../common/vendor.js"),t=require("../../../../api/digital_human.js"),i=require("../../../../utils/util.js"),n=require("../../enums/index.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../config/index.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-input")+e.resolveComponent("u-icon")+e.resolveComponent("u-notice-bar")+e.resolveComponent("u-popup"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-notice-bar/u-notice-bar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js"))();const r=e.defineComponent({__name:"montage_publish",setup(r){const s=e.reactive({name:`混剪自动发布任务${e.index.$u.timeFormat(new Date,"yyyymmddhhMM")}`,accounts:[],publish_frep:2,video_ids:[],time_config:[{start_time:"09:00",end_time:"09:30"},{start_time:"09:30",end_time:"10:30"}],media_type:1,data_type:0,task_type:2,scene:1}),o=e.ref(""),u=e.ref({}),a=e.ref(!1),m=e.computed((()=>s.accounts.length>0));function d(e){const t=e=>{if(!e)return NaN;const[t,i]=(e||"").split(":").map(Number);return 60*t+i},i=e.map((e=>({start_time:e.start_time,end_time:e.end_time,s:t(e.start_time),e:t(e.end_time)}))).reduce(((e,t,i,n)=>{const r=(t,i)=>{e[t]||(e[t]={start_time:!1,end_time:!1}),e[t][i]=!0};if(null!=t.start_time&&""!==t.start_time||r(i,"start_time"),null!=t.end_time&&""!==t.end_time||r(i,"end_time"),isNaN(t.s)||isNaN(t.e))return e;if(t.s>=t.e&&(r(i,"start_time"),r(i,"end_time")),i>0){const e=n[i-1];!isNaN(e.e)&&t.s<e.e&&(r(i-1,"end_time"),r(i,"start_time"))}return e}),{});return{valid:0===Object.keys(i).length,errors:i}}const c=async()=>{if(s.name)if(m.value){e.index.showLoading({title:"创建中...",mask:!0});try{await t.createShanjianPublish({...s,time_config:s.time_config.map((e=>`${e.start_time}-${e.end_time}`))}),a.value=!0,e.index.hideLoading()}catch(i){o.value=i,e.index.hideLoading(),e.index.showToast({title:i||"创建失败",icon:"none",duration:3e3})}}else e.index.$u.toast("请选择发布账号");else e.index.$u.toast("请输入任务名称")},l=()=>{e.index.$u.route({url:"/ai_modules/digital_human/pages/index/index",type:"reLaunch"})};return e.onLoad((t=>{s.video_ids=i.isJson(t.task_id)?JSON.parse(t.task_id):t.task_id,s.scene=t.scene,e.index.$on("confirm",(e=>{const{type:t,data:i}=e;if(t===n.ListenerTypeEnum.CHOOSE_ACCOUNT){if(0==i.length)return;s.accounts=i.map((e=>({account:e.account,type:e.type,id:e.id})))}}))})),(t,i)=>e.e({a:e.p({title:"创建发布任务","title-bold":!0,"is-fixed":!1,"border-bottom":!1,background:{background:"transparent"}}),b:e.o((t=>e.unref(s).name=t)),c:e.p({"placeholder-style":"font-size: 24rpx;",placeholder:"请输入任务名称",maxlength:"50",modelValue:e.unref(s).name}),d:e.t(e.unref(s).accounts.length?`${e.unref(s).accounts.length}个账号`:"选择账号"),e:e.n(e.unref(s).accounts.length?"text-_h00B862_":"text-_h00000033_"),f:e.p({name:"arrow-right",size:"24",color:"#00000033"}),g:`/ai_modules/device/pages/account_choose/account_choose?account=${JSON.stringify(e.unref(s).accounts)}`,h:e.f([1,2,3,5,10],((t,i,n)=>({a:e.t(t),b:t,c:e.unref(s).publish_frep===t?1:"",d:e.o((i=>(t=>{t!=s.publish_frep&&(s.publish_frep=t,s.time_config=Array.from({length:t},((t,i)=>{const n=new Date;n.setHours(9,0,0);const r=new Date(n.getTime()+30*i*60*1e3),s=new Date(r.getTime()+18e5);return{start_time:e.index.$u.timeFormat(r,"hh:MM"),end_time:e.index.$u.timeFormat(s,"hh:MM")}})),u.value={})})(t)),t)}))),i:e.unref(s).publish_frep>0},e.unref(s).publish_frep>0?e.e({j:e.p({mode:"vertical",padding:"20rpx 0","border-radius":"8","font-size":"24rpx",autoplay:!1,"volume-icon":!1,list:["发布的间隔时间必须大于30分钟"]}),k:e.f(e.unref(s).time_config,((t,i,n)=>{var r,o;return{a:e.t(i+1),b:e.t(t.start_time||"开始时间"),c:e.n((null==(r=e.unref(u)[i])?void 0:r.start_time)?"text-_hFF3C26_ font-bold":t.start_time?"text-_h00B862_ font-bold":"text-_h00000033_"),d:"ed0b891d-4-"+n,e:t.start_time,f:e.o((t=>((t,i)=>{const{value:n}=t.detail,r=s.time_config[i],o=new Date(`2000/01/01 ${n}`);r.start_time=n,o.setMinutes(o.getMinutes()+30),r.end_time=e.index.$u.timeFormat(o,"hh:MM");const{errors:a}=d(s.time_config);u.value=a})(t,i)),i),g:e.t(t.end_time||"结束时间"),h:e.n((null==(o=e.unref(u)[i])?void 0:o.end_time)?"text-_hFF3C26_ font-bold":t.end_time?"text-_h00B862_ font-bold":"text-_h00000033_"),i:"ed0b891d-5-"+n,j:t.end_time,k:!t.end_time,l:e.o((t=>(t=>{s.time_config[t].start_time||e.index.$u.toast("请先选择开始时间")})(i)),i),m:e.o((t=>((t,i)=>{const{value:n}=t.detail,r=s.time_config[i];if(n<=r.start_time)return void e.index.$u.toast("结束时间不能小于开始时间");const o=new Date(`2000/01/01 ${r.start_time}`);if(new Date(`2000/01/01 ${n}`).getTime()-o.getTime()<18e5)return void e.index.$u.toast("结束时间不能小于开始时间30分钟");r.end_time=n;const{errors:a}=d(s.time_config);u.value=a})(t,i)),i),n:i}})),l:e.p({name:"arrow-right",size:"24",color:"#00000033"}),m:e.p({name:"arrow-right",size:"24",color:"#00000033"}),n:Object.keys(e.unref(u)).length>0},(Object.keys(e.unref(u)).length,{})):{},{o:e.unref(o)},e.unref(o)?{p:e.t(e.unref(o))}:{},{q:e.n(e.unref(m)?"bg-black":"bg-_h787878CC_"),r:e.o(c),s:e.p({name:"checkmark",color:"#ffffff",size:"28"}),t:e.o(l),v:e.o((t=>e.isRef(a)?a.value=t:null)),w:e.p({mode:"center","border-radius":"48",width:"90%","mask-close-able":!1,modelValue:e.unref(a)})})}}),s=e._export_sfc(r,[["__scopeId","data-v-ed0b891d"]]);wx.createPage(s);
