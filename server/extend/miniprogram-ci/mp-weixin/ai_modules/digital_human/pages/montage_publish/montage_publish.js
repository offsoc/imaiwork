"use strict";const e=require("../../../../common/vendor.js"),n=require("../../../../api/digital_human.js"),i=require("../../enums/index.js"),t=require("../../../../utils/util.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../stores/app.js"),require("../../../../api/app.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),require("../../../../config/index.js"),!Array){(e.resolveComponent("u-navbar")+e.resolveComponent("u-input")+e.resolveComponent("u-icon")+e.resolveComponent("u-notice-bar")+e.resolveComponent("u-popup"))()}Math||((()=>"../../../../uni_modules/vk-uview-ui/components/u-navbar/u-navbar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-icon/u-icon.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-notice-bar/u-notice-bar.js")+(()=>"../../../../uni_modules/vk-uview-ui/components/u-popup/u-popup.js"))();const r=e.defineComponent({__name:"montage_publish",setup(r){const o=e.reactive({name:`混剪自动发布任务-${e.index.$u.timeFormat(new Date,"yyyymmdd hhMM")}`,accounts:[],publish_frep:2,video_ids:[],time_config:["09:00","09:15"],media_type:1,data_type:0,task_type:2}),u=e.ref([]),s=e.ref(!1),a=e.computed((()=>o.accounts.length>0)),c=(n,i)=>{o.time_config[i]=n.detail.value;const{valid:t,errorIndexes:r}=function(e,n=15){const i=e.filter((e=>e.time));if(i.length<=1)return{valid:!0};const t=i.map(((n,i)=>({time:n.time,originalIndex:e.indexOf(n)}))).sort(((e,n)=>new Date(`2000/01/01 ${e.time}`).getTime()-new Date(`2000/01/01 ${n.time}`).getTime()));for(let r=1;r<t.length;r++){const e=new Date(`2000/01/01 ${t[r-1].time}`).getTime(),i=(new Date(`2000/01/01 ${t[r].time}`).getTime()-e)/6e4;if(i<n)return{valid:!1,errorIndexes:[t[r-1].originalIndex,t[r].originalIndex],gapMinutes:i}}return{valid:!0}}(o.time_config,15);if(!t)return e.index.$u.toast("发布的间隔时间必须大于15分钟"),void(u.value=r||[]);u.value=[]};const d=async()=>{if(a.value){e.index.showLoading({title:"创建中...",mask:!0});try{await n.createShanjianPublish(o),s.value=!0,e.index.hideLoading()}catch(i){e.index.hideLoading(),e.index.showToast({title:i||"创建失败",icon:"none",duration:3e3})}}},l=()=>{e.index.$u.route({url:"/ai_modules/digital_human/pages/index/index",type:"reLaunch"})};return e.onLoad((e=>{o.video_ids=t.isJson(e.task_id)?JSON.parse(e.task_id):e.task_id})),e.onShow((()=>{e.index.$on("confirm",(n=>{const{type:t,data:r}=n;if(t===i.ListenerTypeEnum.CHOOSE_ACCOUNT){if(0==r.length)return;o.accounts=r.map((e=>({account:e.account,type:e.type,id:e.id})))}e.index.$off("confirm")}))})),(n,i)=>e.e({a:e.p({title:"创建发布任务","title-bold":!0,"is-fixed":!1,"border-bottom":!1,background:{background:"transparent"}}),b:e.o((n=>e.unref(o).name=n)),c:e.p({"placeholder-style":"font-size: 24rpx;",placeholder:"请输入任务名称",maxlength:"50",modelValue:e.unref(o).name}),d:e.t(e.unref(o).accounts.length?`${e.unref(o).accounts.length}个账号`:"选择账号"),e:e.n(e.unref(o).accounts.length?"text-_h00B862_":"text-_h00000033_"),f:e.p({name:"arrow-right",size:"24",color:"#00000033"}),g:`/ai_modules/digital_human/pages/account_choose/account_choose?account=${JSON.stringify(e.unref(o).accounts)}`,h:e.f([1,2,3,5,10],((n,i,t)=>({a:e.t(n),b:n,c:e.unref(o).publish_frep===n?1:"",d:e.o((i=>(n=>{n!=o.publish_frep&&(5!=n&&10!=n||e.index.$u.toast("建议选择更小的发布频率，如2条、3条"),o.publish_frep=n,o.time_config=Array.from({length:n},((n,i)=>{const t=new Date;return t.setHours(9,0,0),e.index.$u.timeFormat(new Date(t.getTime()+15*i*60*1e3),"hh:MM")})))})(n)),n)}))),i:e.unref(o).publish_frep>0},e.unref(o).publish_frep>0?{j:e.p({mode:"vertical",padding:"20rpx 0","border-radius":"8",autoplay:!1,"volume-icon":!1,list:["发布的间隔时间必须大于15分钟"]}),k:e.f(e.unref(o).time_config,((n,i,t)=>({a:e.t(i+1),b:e.t(n||"未选择"),c:e.n(e.unref(u).includes(i)?"text-_hFF3C26_ font-bold":n?"text-_h00B862_ font-bold":"text-_h00000033_"),d:n,e:e.o((e=>c(e,i)),i),f:"cb22500c-4-"+t,g:e.unref(u).includes(i)?1:"",h:i}))),l:e.p({name:"arrow-right",size:"24",color:"#00000033"})}:{},{m:e.n(e.unref(a)?"bg-black":"bg-_h787878CC_"),n:e.o(d),o:e.p({name:"checkmark",color:"#ffffff",size:"28"}),p:e.o(l),q:e.o((n=>e.isRef(s)?s.value=n:null)),r:e.p({mode:"center","border-radius":"48",width:"90%","mask-close-able":!1,modelValue:e.unref(s)})})}}),o=e._export_sfc(r,[["__scopeId","data-v-cb22500c"]]);wx.createPage(o);
