"use strict";const e=require("../../../../common/vendor.js"),i=require("../../../../api/app.js"),t=require("../../../../utils/util.js"),n=require("../../enums/index.js"),r=require("../../../../stores/app.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../config/index.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),!Array){e.resolveComponent("u-loading")()}Math;const a=e.defineComponent({__name:"montage_auth_camera",setup(a){const s=r.useAppStore(),o=e.computed((()=>s.getDigitalHumanConfig.shanjian_auth)),u=e.ref(!0),d=e.ref(0),l=e.ref(180);let c=e.ref(),h=e.ref();const m=()=>{u.value=!1,h.value=e.index.createCameraContext(),h.value.startRecord({success:e=>{p()},fail:i=>{e.index.showToast({title:i||"录制失败",icon:"none",duration:3e3})}})},p=()=>{c.value=setInterval((()=>{d.value++,d.value>=l.value&&q()}),1e3)},q=async()=>{d.value<5?e.index.showToast({title:"录制时间不能小于5秒",icon:"none",duration:3e3}):(clearInterval(c.value),e.index.showLoading({title:"正在结束录制...",mask:!0}),h.value.stopRecord({success:async t=>{const{tempThumbPath:r,tempVideoPath:a}=t;e.index.hideLoading(),e.index.showLoading({title:"正在上传...",mask:!0});try{const[s,o]=await Promise.all([i.uploadFile("image",{filePath:r}),i.uploadFile("video",{filePath:a})]);e.index.hideLoading(),e.index.showToast({title:"上传成功，即将返回上一页",icon:"none",duration:3e3}),e.index.navigateBack(),e.index.$emit("confirm",{type:n.ListenerTypeEnum.UPLOAD_AUTH_CAMERA,data:{...t,pic:s.uri,url:o.uri}})}catch(s){e.index.hideLoading(),e.index.showToast({title:s||"上传失败，请重新上传",icon:"none",duration:3e3})}},fail:i=>{e.index.hideLoading()}}))},x=i=>{e.index.hideLoading(),e.index.showToast({title:i,icon:"none",duration:3e3})};return e.onHide((()=>{e.index.hideLoading()})),(i,n)=>e.e({a:e.o(m),b:e.o(x),c:e.o(q),d:e.t(e.unref(o)),e:e.t(e.unref(t.formatAudioTime)(e.unref(d))),f:e.o(q),g:e.unref(u)},e.unref(u)?{h:e.p({size:"40"})}:{})}});wx.createPage(a);
