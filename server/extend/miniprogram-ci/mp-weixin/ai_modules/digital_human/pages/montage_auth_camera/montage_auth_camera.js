"use strict";const e=require("../../../../common/vendor.js"),i=require("../../../../api/app.js"),n=require("../../../../utils/util.js"),r=require("../../enums/index.js"),a=require("../../../../stores/app.js");if(require("../../../../utils/request/index.js"),require("../../../../utils/request/http.js"),require("../../../../enums/requestEnums.js"),require("../../../../utils/request/cancel.js"),require("../../../../utils/auth.js"),require("../../../../enums/constantEnums.js"),require("../../../../utils/cache.js"),require("../../../../stores/user.js"),require("../../../../api/user.js"),require("../../../../hooks/useShareMessage.js"),require("../../../../router/index.js"),require("../../../../stores/navigationBarTitle.js"),require("../../../../config/index.js"),require("../../../../api/chat.js"),require("../../../../api/voice_chat.js"),!Array){e.resolveComponent("u-loading")()}Math;const t=e.defineComponent({__name:"montage_auth_camera",setup(t){const s=a.useAppStore(),u=e.computed((()=>s.getDigitalHumanConfig.shanjian_auth)),o=e.ref(!0),d=e.ref(0),l=e.ref(180);let c=e.ref(),h=e.ref();const m=e.ref(!0),f=()=>{o.value=!1,h.value=e.index.createCameraContext(),h.value.startRecord({success:e=>{p()},fail:i=>{e.index.showToast({title:i||"录制失败",icon:"none",duration:3e3})}})},p=()=>{c.value=setInterval((()=>{d.value++,d.value>=l.value&&q()}),1e3)},q=async()=>{m.value&&(d.value<5?e.index.showToast({title:"录制时间不能小于5秒",icon:"none",duration:3e3}):(clearInterval(c.value),e.index.showLoading({title:"正在结束录制...",mask:!0}),h.value.stopRecord({success:async n=>{const{tempThumbPath:a,tempVideoPath:t}=n;e.index.hideLoading(),e.index.showLoading({title:"正在上传...",mask:!0});try{const[s,u]=await Promise.all([i.uploadFile("image",{filePath:a}),i.uploadFile("video",{filePath:t})]);e.index.hideLoading(),e.index.showToast({title:"上传成功，即将返回上一页",icon:"none",duration:3e3}),e.index.navigateBack(),e.index.$emit("confirm",{type:r.ListenerTypeEnum.UPLOAD_AUTH_CAMERA,data:{...n,pic:s.uri,url:u.uri}})}catch(s){e.index.hideLoading(),e.index.showToast({title:s||"上传失败，请重新上传",icon:"none",duration:3e3})}},fail:i=>{e.index.hideLoading()}})))},v=i=>{e.index.hideLoading(),e.index.showToast({title:i,icon:"none",duration:3e3})};return e.onUnload((()=>{m.value=!1,clearInterval(c.value),e.index.hideLoading()})),(i,r)=>e.e({a:e.unref(m)},e.unref(m)?{b:e.o(f),c:e.o(v),d:e.o(q)}:{},{e:e.t(e.unref(u)),f:e.t(e.unref(n.formatAudioTime)(e.unref(d))),g:e.o(q),h:e.unref(o)},e.unref(o)?{i:e.p({size:"40"})}:{})}});wx.createPage(t);
