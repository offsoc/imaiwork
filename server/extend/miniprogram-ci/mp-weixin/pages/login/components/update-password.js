"use strict";const e=require("../../../common/vendor.js"),r=require("../../../api/app.js"),o=require("../../../enums/appEnums.js"),s=require("../../../api/user.js");if(require("../../../utils/request/index.js"),require("../../../utils/request/http.js"),require("../../../enums/requestEnums.js"),require("../../../utils/request/cancel.js"),require("../../../utils/auth.js"),require("../../../enums/constantEnums.js"),require("../../../utils/cache.js"),require("../../../stores/user.js"),require("../../../hooks/useShareMessage.js"),require("../../../router/index.js"),require("../../../utils/util.js"),require("../../../stores/navigationBarTitle.js"),require("../../../stores/app.js"),require("../../../api/chat.js"),require("../../../api/voice_chat.js"),require("../../../config/index.js"),!Array){(e.resolveComponent("u-input")+e.resolveComponent("u-verification-code")+e.resolveComponent("u-button")+e.resolveComponent("popup-bottom"))()}Math||((()=>"../../../uni_modules/vk-uview-ui/components/u-input/u-input.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-verification-code/u-verification-code.js")+(()=>"../../../uni_modules/vk-uview-ui/components/u-button/u-button.js")+(()=>"../../../components/popup-bottom/popup-bottom.js"))();const i=e.defineComponent({__name:"update-password",props:{show:{type:Boolean}},emits:["update:show","success"],setup(i,{emit:u}){const n=i,t=e.computed({get:()=>n.show,set(e){u("update:show",e)}}),a=e.reactive({email:"",mobile:"",password:"",scene:"2",code:"",password_confirm:""}),p=e.reactive({mobile:{isFocus:!1,isError:!1},code:{isFocus:!1,isError:!1},password:{isFocus:!1,isError:!1},password_confirm:{isFocus:!1,isError:!1}}),c=e.useRouter(),d=e.computed((()=>e.index.$u.test.mobile(a.mobile))),l=e.shallowRef(),m=e.ref(""),f=e=>{m.value=e},w=()=>{if(!d.value){p.mobile.isError=!0;const r=a.mobile?"请输入正确的手机号码":"请输入手机号码";return e.index.$u.toast(r),!1}return p.mobile.isError=!1,!0},h=async()=>{var s,i;if(w()&&(null==(s=l.value)?void 0:s.canGetCode))try{await r.smsSend({scene:o.SMSEnum.FIND_PASSWORD,mobile:a.mobile}),e.index.$u.toast("发送成功"),null==(i=l.value)||i.start()}catch(u){e.index.$u.toast(u||"发送失败")}},b=async()=>{w()&&!(a.code?(p.code.isError=!1,a.password?(p.password.isError=!1,a.password_confirm?(p.password_confirm.isError=!1,a.password!==a.password_confirm?(p.password.isError=!0,p.password_confirm.isError=!0,e.index.$u.toast("两次输入的密码不一致"),1):(p.password.isError=!1,p.password_confirm.isError=!1,0)):(p.password_confirm.isError=!0,e.index.$u.toast("请输入确认密码"),1)):(p.password.isError=!0,e.index.$u.toast("请输入密码"),1)):(p.code.isError=!0,e.index.$u.toast("请输入验证码"),1))&&(await s.forgotPassword(a),setTimeout((()=>{c.navigateBack()}),1500))};return(r,o)=>({a:e.o((r=>e.unref(p).mobile.isFocus=!1)),b:e.o((r=>e.unref(p).mobile.isFocus=!0)),c:e.o((r=>e.unref(a).mobile=r)),d:e.p({type:"number",maxlength:"11",placeholder:"请输入手机号","placeholder-style":`color:${e.unref(p).mobile.isError?"#FB0000":" rgba(0,0,0,.2)"};font-size:26rpx;`,modelValue:e.unref(a).mobile}),e:e.unref(p).mobile.isFocus?1:"",f:e.unref(p).mobile.isError?1:"",g:e.o((r=>e.unref(p).code.isFocus=!1)),h:e.o((r=>e.unref(p).code.isFocus=!0)),i:e.o((r=>e.unref(a).code=r)),j:e.p({placeholder:"请输入验证码","placeholder-style":`color:${e.unref(p).code.isError?"#FB0000":" rgba(0,0,0,.2)"};font-size:26rpx;`,modelValue:e.unref(a).code}),k:e.sr(l,"0f026d33-3,0f026d33-0",{k:"uCodeRef"}),l:e.o(f),m:e.p({"start-text":"发送验证码","change-text":"发送验证码（xs）",seconds:60}),n:e.t(e.unref(m)),o:e.n(e.unref(d)?"text-primary":"text-muted"),p:e.o(h),q:e.unref(p).code.isFocus?1:"",r:e.unref(p).code.isError?1:"",s:e.o((r=>e.unref(p).password.isFocus=!1)),t:e.o((r=>e.unref(p).password.isFocus=!0)),v:e.o((r=>e.unref(a).password=r)),w:e.p({placeholder:"6-20位数字+字母或符号组合","placeholder-style":`color:${e.unref(p).password.isError?"#FB0000":" rgba(0,0,0,.2)"};font-size:26rpx;`,modelValue:e.unref(a).password}),x:e.unref(p).password.isFocus?1:"",y:e.unref(p).password.isError?1:"",z:e.o((r=>e.unref(p).password_confirm.isFocus=!1)),A:e.o((r=>e.unref(p).password_confirm.isFocus=!0)),B:e.o((r=>e.unref(a).password_confirm=r)),C:e.p({placeholder:"再次输入新密码","placeholder-style":`color:${e.unref(p).password_confirm.isError?"#FB0000":" rgba(0,0,0,.2)"};font-size:26rpx;`,modelValue:e.unref(a).password_confirm}),D:e.unref(p).password_confirm.isFocus?1:"",E:e.unref(p).password_confirm.isError?1:"",F:e.o((e=>b())),G:e.p({type:"primary",shape:"circle","custom-style":{height:"90rpx","box-shadow":"0px 6px 12px 0px rgba(0,101,251,0.2)"}}),H:e.o((r=>e.isRef(t)?t.value=r:null)),I:e.p({title:"找回密码",height:"85%",show:e.unref(t)})})}});wx.createComponent(i);
